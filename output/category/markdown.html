<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>TH's Notes - markdown</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">TH's Notes </a></h1>
                <nav><ul>
                    <li class="active"><a href="/category/markdown.html">markdown</a></li>
                    <li><a href="/category/review.html">Review</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/shi-yong-rspec-xie-feature-tests.html">"使用 RSpec 寫 Feature Tests"</a></h1>
<footer class="post-info">
        <abbr class="published" title="2014-12-07T14:13:10+08:00">
                Published: 日 07 12月 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/andrew-tsai.html">Andrew Tsai</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>

</footer><!-- /.post-info --><p>在開發 Rails 專案時，我們可使用 Feature Tests
來模擬使用者在應用程式中的操作流程;
這裡將介紹如何使用 <a href="https://github.com/rspec/rspec-rails">RSpec</a>
搭配 <a href="https://github.com/jnicklas/capybara">Capybara</a>
來撰寫這方面的測試。</p>
<h3>安裝套件</h3>
<p>在 Gemfile 加入 <code>gem 'capybara'</code>
然後執行 <code>bundle</code> 安裝 Capybara。</p>
<p>假使安裝套件時遇到 'An error occurred while installing nokogiri' 這樣的錯誤訊息</p>
<div class="highlight"><pre>Gem::Ext::BuildError: ERROR: Failed to build gem native extension.

    /Users/tsaith/.rvm/rubies/ruby-2.1.1/bin/ruby -r ./siteconf20141220-15553-1vqn6mc.rb extconf.rb
checking if the C compiler accepts ... yes
checking if the C compiler accepts -Wno-error=unused-command-line-argument-hard-error-in-future... no
Building nokogiri using packaged libraries.
checking for iconv... yes
************************************************************************
IMPORTANT NOTICE:

Buidling Nokogiri with a packaged version of libxml2-2.9.2
with the following patches applied:
    - 0001-Revert-Missing-initialization-for-the-catalog-module.patch
    - 0002-Fix-missing-entities-after-CVE-2014-3660-fix.patch

Team Nokogiri will keep on doing their best to provide security
updates in a timely manner, but if this is a concern for you and want
to use the system library instead; abort this installation process and
reinstall nokogiri as follows:

    gem install nokogiri -- --use-system-libraries
        [--with-xml2-config=/path/to/xml2-config]
        [--with-xslt-config=/path/to/xslt-config]

If you are using Bundler, tell it to use the option:

    bundle config build.nokogiri --use-system-libraries
    bundle install

Note, however, that nokogiri is not fully compatible with arbitrary
versions of libxml2 provided by OS/package vendors.
************************************************************************
Extracting libxml2-2.9.2.tar.gz into tmp/x86_64-apple-darwin12.5.0/ports/libxml2/2.9.2... OK
Running patch with /Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/nokogiri-1.6.5/ports/patches/libxml2/0001-Revert-Missing-initialization-for-the-catalog-module.patch...
Running &#39;patch&#39; for libxml2 2.9.2... OK
Running patch with /Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/nokogiri-1.6.5/ports/patches/libxml2/0002-Fix-missing-entities-after-CVE-2014-3660-fix.patch...
Running &#39;patch&#39; for libxml2 2.9.2... OK
Running &#39;configure&#39; for libxml2 2.9.2... ERROR, review &#39;/Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/nokogiri-1.6.5/ext/nokogiri/tmp/x86_64-apple-darwin12.5.0/ports/libxml2/2.9.2/configure.log&#39; to see what happened.
*** extconf.rb failed ***
Could not create Makefile due to some reason, probably lack of necessary
libraries and/or headers.  Check the mkmf.log file for more details.  You may
need configuration options.

Provided configuration options:
    --with-opt-dir
    --without-opt-dir
    --with-opt-include
    --without-opt-include=<span class="cp">${</span><span class="n">opt</span><span class="o">-</span><span class="nb">dir</span><span class="cp">}</span>/include
    --with-opt-lib
    --without-opt-lib=<span class="cp">${</span><span class="n">opt</span><span class="o">-</span><span class="nb">dir</span><span class="cp">}</span>/lib
    --with-make-prog
    --without-make-prog
    --srcdir=.
    --curdir
    --ruby=/Users/tsaith/.rvm/rubies/ruby-2.1.1/bin/ruby
    --help
    --clean
    --use-system-libraries
    --enable-static
    --disable-static
    --with-zlib-dir
    --without-zlib-dir
    --with-zlib-include
    --without-zlib-include=<span class="cp">${</span><span class="n">zlib</span><span class="o">-</span><span class="nb">dir</span><span class="cp">}</span>/include
    --with-zlib-lib
    --without-zlib-lib=<span class="cp">${</span><span class="n">zlib</span><span class="o">-</span><span class="nb">dir</span><span class="cp">}</span>/lib
    --enable-cross-build
    --disable-cross-build
/Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/mini_portile-0.6.1/lib/mini_portile.rb:279:in `block in execute&#39;: Failed to complete configure task (RuntimeError)
    from /Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/mini_portile-0.6.1/lib/mini_portile.rb:271:in `chdir&#39;
    from /Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/mini_portile-0.6.1/lib/mini_portile.rb:271:in `execute&#39;
    from /Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/mini_portile-0.6.1/lib/mini_portile.rb:66:in `configure&#39;
    from /Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/mini_portile-0.6.1/lib/mini_portile.rb:109:in `cook&#39;
    from extconf.rb:268:in `block in process_recipe&#39;
    from extconf.rb:167:in `tap&#39;
    from extconf.rb:167:in `process_recipe&#39;
    from extconf.rb:455:in `<span class="nt">&lt;main&gt;</span>&#39;

extconf failed, exit code 1

Gem files will remain installed in /Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/nokogiri-1.6.5 for inspection.
Results logged to /Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/extensions/x86_64-darwin-12/2.1.0-static/nokogiri-1.6.5/gem_make.out
An error occurred while installing nokogiri (1.6.5), and Bundler cannot continue.
Make sure that `gem install nokogiri -v &#39;1.6.5&#39;` succeeds before bundling.
</pre></div>


<p>可以試著指定系統內建的函式庫來安裝 Nokogiri</p>
<div class="highlight"><pre>bundle config build.nokogiri --use-system-libraries
</pre></div>


<p>然後再執行一次 <code>bundle</code>。</p>
<h3>設定 spec_helper.rb</h3>
<p>在 spec/spec_helper.rb 裡面加入 <code>require 'capybara/rails'</code></p>
<div class="highlight"><pre><span class="c1"># This file is copied to spec/ when you run &#39;rails generate rspec:install&#39;</span>
<span class="no">ENV</span><span class="o">[</span><span class="s2">&quot;RAILS_ENV&quot;</span><span class="o">]</span> <span class="o">||=</span> <span class="s1">&#39;test&#39;</span>
<span class="nb">require</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s2">&quot;../../config/environment&quot;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
<span class="nb">require</span> <span class="s1">&#39;rspec/rails&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;capybara/rails&#39;</span>
</pre></div>


<h3>編寫測試</h3>
<p>假設我們現在想要模擬使用者的登入流程，
請新增檔案 spec/features/user_signs_in_spec.rb
並加入內容如下</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">feature</span> <span class="s2">&quot;User signs in&quot;</span> <span class="k">do</span>

  <span class="n">scenario</span> <span class="s2">&quot;with valid email and password&quot;</span> <span class="k">do</span>
    <span class="n">alice</span> <span class="o">=</span> <span class="no">Fabricate</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>                     <span class="c1"># 宣告使用者</span>
    <span class="n">visit</span> <span class="n">sign_in_path</span>                           <span class="c1"># 訪問登入網頁</span>
    <span class="n">fill_in</span> <span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="n">alice</span><span class="o">.</span><span class="n">email</span>        <span class="c1"># 填寫 Email</span>
    <span class="n">fill_in</span> <span class="s1">&#39;Password&#39;</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="n">alice</span><span class="o">.</span><span class="n">password</span>  <span class="c1"># 填寫 Password</span>
    <span class="n">click_button</span> <span class="s1">&#39;Sign in&#39;</span>                       <span class="c1"># 按下 Sign in 按鈕</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_content</span> <span class="n">alice</span><span class="o">.</span><span class="n">full_name</span> <span class="c1"># 預期網頁的內容會出現使用者的名字</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>


<p>上面的 <code>feature</code> 和 <code>scenario</code> 其意義等同於
RSpec 中的 <code>describe ..., :type =&gt; :feature</code> 和 <code>it</code>;
<a href="https://www.relishapp.com/rspec/rspec-rails/docs/feature-specs/feature-spec">Relish</a> 提供了豐富的語法介紹。</p>
<p>最後，執行 <code>rspec</code> 即可看到測試結果。</p>
<p _="%" endblockquote="endblockquote">{% blockquote Thomas C. Gale %}
Good design adds value faster than it adds cost.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/shi-yong-rspec-zhuan-xie-functional-tests.html" rel="bookmark"
                           title="Permalink to "使用 RSpec 撰寫 Functional Tests"">"使用 RSpec 撰寫 Functional Tests"</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-12-07T14:12:54+08:00">
                Published: 日 07 12月 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/andrew-tsai.html">Andrew Tsai</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>

</footer><!-- /.post-info -->                <p>在開發 Rails 專案時，我們可以撰寫 Functional Tests 來測試
controller 的功能是否正常工作;
例如，如果想測試使用者的登入與登出，
就可以在 spec/controllers/ 下面新增一個檔案
sessions_controller_spec.rb，內容如下</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s2">&quot;spec_helper&quot;</span>

<span class="n">describe</span> <span class="no">SessionsController</span> <span class="k">do</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="no">Fabricate</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">&quot;GET new&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;redirects to the home page for authenticated users&quot;</span> <span class="k">do</span>
      <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
      <span class="n">get</span> <span class="ss">:new</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="n">to ...</span></pre></div>
                <a class="readmore" href="/shi-yong-rspec-zhuan-xie-functional-tests.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/shi-yong-rspec-zuo-zi-dong-ce-shi.html" rel="bookmark"
                           title="Permalink to "使用 RSpec 做自動測試"">"使用 RSpec 做自動測試"</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-12-06T10:40:23+08:00">
                Published: 六 06 12月 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/andrew-tsai.html">Andrew Tsai</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>

</footer><!-- /.post-info -->                <p><a href="https://github.com/rspec/rspec">RSpec</a> 是一套專為 Ruby
設計的 BDD (Behavior Deriven Development) 測試框架，
基於它所撰寫出的測試程式有著相當高的可讀性，
感覺就像是在閱讀產品的規格書。</p>
<h3>安裝套件</h3>
<p>在專案的 Gemfile 中加入 rspec-rails 的 gem，如下</p>
<div class="highlight"><pre><span class="n">group</span> <span class="o">:</span><span class="n">development</span><span class="o">,</span> <span class="o">:</span><span class="n">test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="o">,</span> <span class="s1">&#39;2.99&#39;</span>
<span class="n">end</span>
</pre></div>


<p>除了 RSpec 之外， 因為 <a href="https://github.com/thoughtbot/shoulda-matchers">shoulda-matchers</a>，
額外提供了許多有用的測試函式，建議一併安裝。</p>
<div class="highlight"><pre><span class="n">group</span> <span class="o">:</span><span class="n">test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;shoulda-matchers&#39;</span><span class="o">,</span> <span class="s1">&#39;2.7.0&#39;</span><span class="o">,</span> <span class="n">require</span><span class="o">:</span> <span class="kc">false</span>
<span class="n">end</span>
</pre></div>


<p>編輯完 Gemfile 後，請執行 ...</p>
                <a class="readmore" href="/shi-yong-rspec-zuo-zi-dong-ce-shi.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/iterm2-zhong-hao-yong-de-she-ding.html" rel="bookmark"
                           title="Permalink to "iTerm2 中好用的設定"">"iTerm2 中好用的設定"</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-12-05T09:47:12+08:00">
                Published: 五 05 12月 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/andrew-tsai.html">Andrew Tsai</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>

</footer><!-- /.post-info -->                <p><a href="http://iterm2.com/">iTerm2</a> 被設計用來取代 Mac 內建的 Terminal;
這裡記錄了我個人的一些偏好設定。</p>
<h3>偏好設定</h3>
<p>以下的偏好都可以在 Preference 裡面進行設定</p>
<ul>
<li>開啟新分頁時，自動進入前一個 session 的所在目錄</li>
</ul>
<p>Profile -&gt; General -&gt; Login shell</p>
<p>Profile -&gt; General -&gt; Reuse previous session's directory</p>
<ul>
<li>設定主題風格(例如背景顏色...等)</li>
</ul>
<p>Profile -&gt; Colors -&gt; Load Presets... -&gt; Tango Dark</p>
<ul>
<li>改變字型和大小</li>
</ul>
<p>Profile -&gt; Text -&gt; Change Font</p>
<ul>
<li>讓 alt/option key 可以在 Emacs 中正常工作</li>
</ul>
<p>Profile -&gt; Keys -&gt; Left option ...</p>
                <a class="readmore" href="/iterm2-zhong-hao-yong-de-she-ding.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/shi-zuo-jian-yi-de-sou-xun-gong-neng.html" rel="bookmark"
                           title="Permalink to "實作簡易的搜尋功能"">"實作簡易的搜尋功能"</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-12-02T13:12:39+08:00">
                Published: 二 02 12月 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/andrew-tsai.html">Andrew Tsai</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>

</footer><!-- /.post-info -->                <p>在電子商務中，商品的搜尋是很重要的一環，
這裡將介紹如何實作簡易的搜尋功能。</p>
<p>倘若我們現在希望開發一個搜尋影片的功能;
假設影片的類別名稱是 Video，
首先在 config/routes.rb 裡面加入 search 的路徑</p>
<div class="highlight"><pre>  <span class="n">resources</span> <span class="ss">:videos</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:show</span><span class="o">]</span> <span class="k">do</span>
    <span class="n">collection</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;videos#search&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
</pre></div>


<p>接著在 app/controllers/videos_controller.rb 裡面加入
search action</p>
<div class="highlight"><pre>  <span class="k">def</span> <span class="nf">search</span>
    <span class="vi">@videos</span> <span class="o">=</span> <span class="no">Video</span><span class="o">.</span><span class="n">search_by_title</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="s1">&#39;search_term&#39;</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>
</pre></div>


<p>然後在 app/models/video.rb 裡面新增 search_by_title ...</p>
                <a class="readmore" href="/shi-zuo-jian-yi-de-sou-xun-gong-neng.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/zai-rails-zhong-shi-yong-postgressql.html" rel="bookmark"
                           title="Permalink to "在 Rails 中使用 PostgresSQL"">"在 Rails 中使用 PostgresSQL"</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-11-26T19:11:45+08:00">
                Published: 三 26 11月 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/andrew-tsai.html">Andrew Tsai</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>

</footer><!-- /.post-info -->                <p><a href="http://www.postgresql.org/">PostgreSQL</a> 是目前相當受歡迎的一套開源資料庫，
下面將說明如何在 Rails 中使用它。</p>
<h3>安裝套件</h3>
<p>如若開發環境是 Mac 的話，請執行下列步驟</p>
<ul>
<li>下載 <a href="http://postgresapp.com/">Postgres.app</a> ，放到 /Applications/ 資料夾下</li>
<li>在 ~/.profile 加入</li>
</ul>
<div class="highlight"><pre><span class="x">export PATH=</span><span class="p">$</span><span class="nv">PATH</span><span class="x">:/Applications/Postgres.app/Contents/Versions/9.3/bin</span>
<span class="x">export PGHOST=localhost</span>
</pre></div>


<p>(假設版本號是 9.3)</p>
<h3>設定 Rails 資料庫</h3>
<ul>
<li>編輯 config/database.yml 內容如下</li>
</ul>
<div class="highlight"><pre><span class="n">development</span><span class="o">:</span>
  <span class="n">adapter</span><span class="o">:</span> <span class="n">postgresql</span>
  <span class="n">encoding</span><span class="o">:</span> <span class="n">unicode</span>
  <span class="n">database ...</span></pre></div>
                <a class="readmore" href="/zai-rails-zhong-shi-yong-postgressql.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/an-quan-di-she-ding-rails-you-jian-mi-ma.html" rel="bookmark"
                           title="Permalink to "安全地設定 Rails 郵件密碼"">"安全地設定 Rails 郵件密碼"</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-11-26T17:44:51+08:00">
                Published: 三 26 11月 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/andrew-tsai.html">Andrew Tsai</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>

</footer><!-- /.post-info -->                <p>將密碼寫進程式通常不是個好主意，因為當我們使用版本控制系統(例如 git)
儲存程式時，密碼也將會被一併存入，如果是開源的專案，
那麼任意人都可以取得這資訊;為避免此問題，
我們可以使用環境變數讓 Rails 較安全地存取密碼資訊。</p>
<h3>設定郵件密碼</h3>
<p>這裡以 config/environments/ 下的 production.rb 為例子，
在 password 這裡，我們可以使用 ENV 來讀取系統的環境變數。</p>
<div class="highlight"><pre>  <span class="c1"># Delivery method of mailer</span>
  <span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">delivery_method</span> <span class="o">=</span> <span class="ss">:smtp</span>

  <span class="c1"># Settings of the mailer</span>
  <span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">smtp_settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="ss">address</span><span class="p">:</span> <span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span>
    <span class="ss">port</span><span class="p">:</span> <span class="mi">587</span><span class="p">,</span>
    <span class="ss">domain</span><span class="p">:</span> <span class="s2">&quot;gmail.com ...</span></pre></div>
                <a class="readmore" href="/an-quan-di-she-ding-rails-you-jian-mi-ma.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/zai-rails-shi-yong-gmail-fa-song-you-jian.html" rel="bookmark"
                           title="Permalink to "在 Rails 使用 gmail 發送郵件"">"在 Rails 使用 gmail 發送郵件"</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-11-23T11:12:28+08:00">
                Published: 日 23 11月 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/andrew-tsai.html">Andrew Tsai</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>

</footer><!-- /.post-info -->                <p>建構網站時，發送信件往往是重要的一項功能，
例如，當使用者註冊或變更個人設定時，
這時候網站可以發送確認信函以提高安全性;
這裡將介紹如何在 Rails 中使用 gmail 發送郵件。</p>
<h3>設定郵件環境</h3>
<p>編輯 config/environments/ 下的 development.rb 和 production.rb 兩個檔案，
設定 <code>delivery_method</code> 和 <code>smtp_settings</code> 如下</p>
<div class="highlight"><pre>  <span class="c1"># Don&#39;t care if the mailer can&#39;t send.</span>
  <span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">raise_delivery_errors</span> <span class="o">=</span> <span class="kp">false</span>

  <span class="c1"># Delivery method of mailer</span>
  <span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">delivery_method</span> <span class="o">=</span> <span class="ss">:smtp</span>

  <span class="c1"># Settings of the ...</span></pre></div>
                <a class="readmore" href="/zai-rails-shi-yong-gmail-fa-song-you-jian.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/zhi-zuo-he-fa-bu-gem.html" rel="bookmark"
                           title="Permalink to "製作和發佈 gem"">"製作和發佈 gem"</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-11-21T14:25:57+08:00">
                Published: 五 21 11月 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/andrew-tsai.html">Andrew Tsai</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>

</footer><!-- /.post-info -->                <p>當我們在某個專案中完成了某個功能並且模組化後，
倘若其他專案也需要同樣功能，
或是希望分享給開源社群時，
這時候就可以將它製作成 gem 方便大家使用。</p>
<h3>製作過程</h3>
<ul>
<li>新增一個 gem 的資料夾，假設名稱為 voteable-gem</li>
<li>進入資料夾中，新增 lib 資料夾，並將寫好的程式檔案放進 lib/</li>
</ul>
<div class="highlight"><pre><span class="nv">$ </span>ls lib
voteable_th.rb
</pre></div>


<p>在上面的範例中，voteable_th.rb 是一個用來投票的模組，內容如下</p>
<div class="highlight"><pre><span class="k">module</span> <span class="nn">VoteableTh</span>
  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span> <span class="no">Concern</span>

  <span class="n">included</span> <span class="k">do</span>
    <span class="n">has_many</span> <span class="ss">:votes</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:voteable</span><span class="p">,</span> <span class="ss">:dependent</span> <span class="o">=&gt;</span> <span class="ss">:destroy</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">total_votes</span>
    <span class="n">up_votes</span> <span class="o">-</span> <span class="n">down_votes</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">up_votes</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">votes ...</span></pre></div>
                <a class="readmore" href="/zhi-zuo-he-fa-bu-gem.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/zai-rails-zhong-shi-yong-module.html" rel="bookmark"
                           title="Permalink to "在 Rails 中使用 module"">"在 Rails 中使用 module"</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-11-21T10:49:52+08:00">
                Published: 五 21 11月 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/andrew-tsai.html">Andrew Tsai</a>
        </address>
<p>In <a href="/category/markdown.html">markdown</a>.</p>

</footer><!-- /.post-info -->                <p>在開發 Rails 時，我們常常遇到一種情況，
不同的物件模型需要用到相同的功能，
這時候可以考慮將這功能包裝成一個模組，
以方便調用。</p>
<h3>設定搜尋路徑</h3>
<p>首先，在 config/application.rb 裡面加入 <code>config.autoload_paths += %W(#{config.root}/lib)</code> 設定 lib 為 modules 的存放路徑。</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../boot&#39;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>

<span class="nb">require</span> <span class="s1">&#39;rails/all&#39;</span>

<span class="c1"># Require the gems listed in Gemfile, including any gems</span>
<span class="c1"># you&#39;ve limited to :test, :development, or :production ...</span></pre></div>
                <a class="readmore" href="/zai-rails-zhong-shi-yong-module.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 3
        <a href="/category/markdown2.html">&raquo;</a>
</p>
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>