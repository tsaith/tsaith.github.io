<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>TH's Notes</title><link href="http://tsaith.github.io/" rel="alternate"></link><link href="http://tsaith.github.io/feeds/all.atom.xml" rel="self"></link><id>http://tsaith.github.io/</id><updated>2015-12-23T09:51:04+08:00</updated><entry><title>Implement a neural network for digit recognition</title><link href="http://tsaith.github.io/implement-a-neural-network-for-digit-recognition.html" rel="alternate"></link><updated>2015-12-23T09:51:04+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-12-23:implement-a-neural-network-for-digit-recognition.html</id><summary type="html">&lt;p&gt;This post will demonstrate how to implement a three-layers neural network for digit recognition.&lt;/p&gt;
&lt;p&gt;The detailed derivations of algorithm can be found from &lt;a href=""&gt;my scripts&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Main steps&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Preparing training/validation/testing datasets.&lt;/li&gt;
&lt;li&gt;Set the weight decay / numerical parameters.&lt;/li&gt;
&lt;li&gt;Check if the gradients of the loss function are correct.&lt;/li&gt;
&lt;li&gt;Training model.&lt;/li&gt;
&lt;li&gt;Estimate the prediction precision.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Ipython notebook&lt;/h3&gt;
&lt;p&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[1]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="k"&gt;load_ext&lt;/span&gt; autoreload
&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="k"&gt;autoreload&lt;/span&gt; 2
&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="k"&gt;matplotlib&lt;/span&gt; inline

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;matplotlib.pyplot&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;plt&lt;/span&gt;

&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;dnn_play.classifiers.neural_net&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;NeuralNet&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;neural_net_loss&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;rel_err_gradients&lt;/span&gt;

&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;dnn_play.utils.data_utils&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;load_mnist&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;dnn_play.utils.visualize_utils&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;display_network&lt;/span&gt;

&lt;span class="c"&gt;# Plot settings&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rcParams&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;figure.figsize&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;10.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;10.0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c"&gt;# set default size of plots&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rcParams&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;image.interpolation&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;nearest&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[2]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Load MNIST data&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_train&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_val&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_val&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_test&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_test&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;load_mnist&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="c"&gt;#(X_train, y_train), (X_val, y_val), (X_test, y_test) = load_mnist(n_train=5500, n_val=500, n_test=1000)&lt;/span&gt;

&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;X_train shape = {} y_train shape = {}&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_train&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;X_val   shape = {} y_val  shape = {}&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_val&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_val&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;X_test  shape = {} y_test shape = {}&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_test&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_test&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;X_train shape = (784, 55000) y_train shape = (55000,)
X_val   shape = (784, 5000) y_val  shape = (5000,)
X_test  shape = (784, 10000) y_test shape = (10000,)
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[3]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Number of layer units&lt;/span&gt;
&lt;span class="n"&gt;input_size&lt;/span&gt;  &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;X_train&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="c"&gt;# Dimension of features&lt;/span&gt;
&lt;span class="n"&gt;hidden_size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;28&lt;/span&gt;
&lt;span class="n"&gt;n_classes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;max&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;

&lt;span class="n"&gt;layer_units&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;input_size&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;hidden_size&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;n_classes&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="c"&gt;# Hyperparameters&lt;/span&gt;
&lt;span class="n"&gt;reg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt; &lt;span class="c"&gt;# Regulation, weight decay&lt;/span&gt;

&lt;span class="c"&gt;# Numerical parameters&lt;/span&gt;
&lt;span class="n"&gt;max_iters&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;400&lt;/span&gt;

&lt;span class="c"&gt;# Initialize weights&lt;/span&gt;
&lt;span class="n"&gt;clf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;NeuralNet&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;layer_units&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;weights&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;clf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;init_weights&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;loss&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;grad&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;neural_net_loss&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;weights&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;X_train&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;reg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;loss: %f&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;loss&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;loss: 1.249960
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[4]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Gradient checking&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;rel_err_gradients&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Gradient check passed!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Gradient check failed!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; 
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;Gradient check passed!
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[5]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;Training&lt;/span&gt;
&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;weights&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;loss_history&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;train_acc_history&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;val_acc_history&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;clf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_train&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;X_val&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_val&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
                                                                    &lt;span class="n"&gt;reg&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;reg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;max_iters&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;max_iters&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;verbose&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;iter:   20, loss: 0.419866, train_acc: 0.271382, val_acc: 0.275600
iter:   40, loss: 0.227288, train_acc: 0.701836, val_acc: 0.721800
iter:   60, loss: 0.146925, train_acc: 0.830582, val_acc: 0.853400
iter:   80, loss: 0.125238, train_acc: 0.852873, val_acc: 0.867800
iter:  100, loss: 0.096621, train_acc: 0.925655, val_acc: 0.944400
iter:  120, loss: 0.084912, train_acc: 0.940091, val_acc: 0.952800
iter:  140, loss: 0.081210, train_acc: 0.947855, val_acc: 0.960000
iter:  160, loss: 0.079193, train_acc: 0.951855, val_acc: 0.961800
iter:  180, loss: 0.078076, train_acc: 0.954109, val_acc: 0.963200
iter:  200, loss: 0.077142, train_acc: 0.955709, val_acc: 0.964800
iter:  220, loss: 0.076304, train_acc: 0.957345, val_acc: 0.966200
iter:  240, loss: 0.075594, train_acc: 0.958964, val_acc: 0.968400
iter:  260, loss: 0.075044, train_acc: 0.959473, val_acc: 0.968200
iter:  280, loss: 0.074649, train_acc: 0.960309, val_acc: 0.967000
iter:  300, loss: 0.074324, train_acc: 0.960764, val_acc: 0.968000
iter:  320, loss: 0.074067, train_acc: 0.961273, val_acc: 0.969000
iter:  340, loss: 0.073854, train_acc: 0.961636, val_acc: 0.968200
iter:  360, loss: 0.073678, train_acc: 0.961764, val_acc: 0.968800
iter:  380, loss: 0.073546, train_acc: 0.962364, val_acc: 0.969600
iter:  400, loss: 0.073417, train_acc: 0.962582, val_acc: 0.968200
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[6]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Plot the loss function and train / validation accuracies&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loss_history&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Loss history&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xlabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Iteration&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ylabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Loss&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;train_acc_history&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;val_acc_history&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Training accuracy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Validation accuracy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;lower right&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xlabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Iteration&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ylabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Clasification accuracy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt output_prompt"&gt;Out[6]:&lt;/div&gt;


&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;&amp;lt;matplotlib.text.Text at 0x1137ca390&amp;gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;


&lt;div class="output_png output_subarea "&gt;
&lt;img src="data:image/png;base64,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
Jgyavwt4Z/9J/xHxnIgYN8zPTQR25IPZqcCFg9b1jHDRwK+AK/PntR0DvBC4n/0DmySNCv+VJ6mc
9PdYLQFy+eHJrwL/h2xI8cGICGAz8Gf57dOgn/8R8FcRsQxYQTa02e/fgaUR8fuU0tX9P5dSui0i
Lsp/ZgLen1LaHBELh+ybYeYl6ZBFdqqEJEmSSoHDmpIkSSXEcCZJklRCDGeSJEklxHAmSZJUQgxn
kiRJJcRwJkmSVEIMZ5IkSSXEcCZJklRCDGeSJEklxHAmSZJUQgxnkiRJJcRwJkmSVEIMZ5IkSSXE
cCZJklRCDGeSJEklxHAmSZJUQgxnkiRJJcRwJkmSVEIKGs4i4isRsSkiHjnANv8nIlZGxJKIOLeQ
9UiSJJW6QvecfRVYNNLKiLgUODmltAC4BvhigeuRJEkqaQUNZymlXwE7DrDJq4Cv57f9LTA5ImYW
siZJkqRSVuxzzuYAawfNrwPmFqkWSZKkoqspdgFADJlP+20Qsd8ySZKkUpVSGppvDlqxe87WA/MG
zc/NL9tPSslpyHTDDTcUvYZSm2wT28V2sV1sE9ul2NORKnY4ux14M0BEXAjsTCltKm5JkiRJxVPQ
Yc2IuAV4ETA9ItYCNwC1ACmlL6WU7oyISyNiFdAGvK2Q9UiSJJW6goazlNJVB7HNdYWsYSxrbm4u
dgklxzYZnu0yPNtleLbL/myT4dkuhRGjMTZaaBGRyqFOSZKkiCCV8QUBkiRJGsRwJkmSVEJK4T5n
klSWenI9dPR20J3rpjvXTUdPB7MnzGZc7bhn/dnevl42t21mU+sm6mvq6e3rpb2nnc7eTmY2zWR8
3Xi6cl001DTQ2t3K7q7d5Ppy5FKOvtRHri977c5109nbSWdvJ125Ljp7O+nJ9VBTVUNtdS0NNQ1M
bpjMpPpJ1FTV0NPXQ0+uhz3de9jZuZO27jYmN0ymqa6JqqgadppQN4HxdePZ072HPV172N21m52d
O9nWsY2qqGJS/SQm1k9kT/ce+lIfUxunUlNVQ1VUEcTAfiL2vq+Oamqra6mtqqW6qnpgu/5ths7X
VtUybdw06qvrB9pv/Z71bGvfRleuK/u+VbXUVtdSHdXUVNVQXVVNfXU908dNp7qqeqDNcilHri9H
e0876/esJwhyKceOjh3kUo7dXbvp6u1i7sS5RETWtr1dA+2cSzkaaxrpznWTSznqq+upr6mnvrqe
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
RGVXr17N+eefT1JSEt/73ve46aabuPbaa6uMu7YYCwsLue666+jSpQtpaWlceeWVFcdmzZpF7969
SU5Opnv37rz55psAZGZmMn/+/Ipy2dnZFddfs2YNCQkJPPvss2RkZHDJJZcAcNVVV9G5c2dSUlK4
4IILWLp0acX5paWl3H777WRmZpKSksL555/P7t27GTRoEI888shB3+e0005j1qxZ4fwniwolZ8AX
Bavp0Cwz2mGIiEgc2LRpE9u3b2fdunVMnjyZ8vJyxowZw7p161i3bh2JiYncfPPNFeXN7KD5tHJz
c+nRowfbtm3jV7/6FWPGjDmissOHD6dv374UFhaSnZ3N9OnTq523q7YYr732Wnbv3s3SpUvZvHkz
48ePr7j+qFGjmDhxIkVFRSxYsICMjIwqY63q2gsWLGD58uXMmzcPgEGDBpGXl8eWLVs444wzuOaa
ayrK3nHHHSxevJiFCxdSWFjIgw8+SEJCAqNHj2b69OkV5T799FM2bNjAoEGDqvtPFH3uHvM/gTAj
55TfjvbLsydH9BoiIlK3Iv13Q13JzMz0+fPnu7v7u+++682bN/c9e/ZUW37x4sWemppasZ2VleXP
PPOMu7tPmTLFu3fvXnFs586dbma+adOmwyq7du1ab9q0qZeWllYcHzFihI8YMSKs7xQa44YNGzwh
IcF37NhxSLmxY8f6+PHjq6wjtF3c3e+9996K669evdrNzFevXl1tDNu3b3cz8+LiYt+/f78nJib6
Z599dki50tJST01N9by8PHd3v/322/2mm24K63vWprp7MLj/iPMe9ZwBa3cvIatH72iHISIidczs
6H/qWocOHWjevHnF9q5du7jhhhvIzMwkOTmZCy64gKKiompfdjjmmGMqPrdq1Qo4+Bm3cMpu2LCB
tLQ0WrZsWXE8PT292phrijE/P5+0tDSSk5MPOW/9+vWccMIJ1dZbm9CYysvLufPOO+nevTvJycl0
69YNgK1bt7J161Z2795d5bVatmzJkCFDmDZtGu7OjBkzqh2+jRVxn5ztKdvLNy1WMPjcU6IdioiI
1DH3o/+pa5WH7yZOnMjKlSvJzc2lqKiIf/3rX6EjRxHRuXNnCgsLKS0trdi3bt26asvXFGN6ejqF
hYUUFRUdcl56ejp5eXlV1tm6dWt27txZsb1x48ZDyoS21fPPP8/s2bOZP38+RUVFrF69GgiMALZv
356WLVtWe61Ro0bx/PPP8/bbb9OqVSvOOeecar9rLIj75Czni+U0KcnghPRW0Q5FRETiUElJCYmJ
iSQnJ1NYWMh9990X8WtmZGRw1llnkZ2dzb59+1i4cCGvv/56tc+c1RRj586dGThwIDfeeCM7duxg
3759LFiwAIAxY8YwZcoU3nnnHcrLyykoKGDFihUA9O7dmxkzZlBWVsaiRYt45ZVXalyrsqSkhBYt
WpCWlsbOnTu56667Ko4lJCRw/fXXM378eL7++mv279/PwoUL2bt3LwD9+vXDzLjjjjsYOXLkUbdf
pMV9cvY//7uEjuUa0hQRkfpROQG57bbbKC0tpX379px77rkMHDiw2iSl8kP0VdUXbtnnn3+ehQsX
0q5dO+6++26GDh160HDr4cQ4bdo0mjVrRo8ePejUqRMPP/wwAH369GHKlCmMGzeOlJQUsrKyKnro
7r//flatWkVqairZ2dkHPdxf1fcaOXIkGRkZdOnShVNOOaUi4TrgoYce4tRTT6VPnz60a9eOCRMm
UF5eftD5n3/+OSNGjKjyO8aSiE9Ca2YDgElAE+Bpd3+g0vFrgF8BBnwD/NzdP6tUxiMVZ997x9Pa
OzH/d7+OSP0iIhIZsTwJbUM0dOhQevbsyb333hvtUCJi2rRpPPXUUxW9enUhUpPQRrTnzMyaAI8A
A4CewDAzO7lSsa+A8939NOB+4MlIxlRZXsmnnNu9V31eUkREJOoWLVrEqlWrKC8vZ86cOcyePZsr
rrgi2mFFxK5du3j00UcZO3ZstEMJS6SHNc8G8tx9jbvvA2YAg0MLuPtCdz/wFOFHQNcIx3SQHU1W
cvFpPerzkiIiIlG3ceNGLrzwQtq2bcu4ceN44okn6NWr8XVWzJs3j44dO9K5c2eGDx8e7XDCEtFh
TTP7CXCpu/80uD0COMfdf1FN+TuAk9x9bKX9ERnW3LN3Py1/n8g3E0pok1j1OLuIiMQmDWtKtDXU
tTXD/r/GzC4Ergf6Ry6cg3321WYS9qYoMRMREZGYEenkrAAIndUuHVhfuZCZnQY8BQxw9+1VVZSd
nV3xOSsri6ysrKMObsmqAhL3dTnqekRERCR+5eTkkJOTU2f1RXpYsymwArgY2ADkAsPcfVlImeOA
d4AR7v5hNfVEZFhz3ORZvJz3FAV/fr3O6xYRkcjSsKZEW4Mc1nT3MjO7GZhHYCqNZ9x9mZndEDw+
GbgHSAUeD85Xss/dz45kXAes2lxAx5bqORMREZHYEelhTdx9DjCn0r7JIZ//C/ivSMdRlfyiAroe
o+RMREREYkdcrxCwubSAEzoqORMRkdiSkJDAV199BcDPf/5zfv/734dV9nA9//zzXHrppUd0rkRO
XCdnO/YXcHJXJWciIlK3BgwYUOVM+7NmzaJz584HLStUm8cff5zf/va3Rx3TmjVrSEhIOOja11xz
DfPmzTvquqVuxW1y5g6lzQrofbySMxERqVujR49m+vTph+yfNm0aI0aMICEhen/9xsNLFGVlZdEO
4ajEbXK2eTPQtoATOyk5ExGRujV48GC2bdvGv//974p927dv54033mDkyJHk5ubSr18/UlNTOfbY
Y/nFL37Bvn37qqxr9OjR3H333RXbf/7znzn22GPp2rUrzz777EFl33jjDU4//XSSk5M57rjjuO++
+yqOnX/++QCkpKSQlJTEhx9+yNSpU/nud79bUeaDDz6gT58+pKSkcPbZZ7Nw4cKKY1lZWdxzzz2c
d955JCUlcemll7Jt27YqY96xYweXXXYZHTt2JC0tjcsvv5yCgoKK44WFhVx33XV06dKFtLQ0rrzy
yopjs2bNonfv3iQnJ9O9e3fefPNNADIzM5k/f35FuezsbK699lrg217BZ599loyMDC655BIArrrq
Kjp37kxKSgoXXHABS5curTi/tLSU22+/nczMTFJSUjj//PPZvXs3gwYN4pFHHjno+5x22mnMmjWr
yu8aCXGbnC3+sgSa7iW1ZWq0QxERkUYmMTGRIUOG8Nxzz1Xse/nllzn55JM59dRTadq0Kf/93//N
tm3bWLhwIfPnz+exxx6rsi4zIzibAXPnzmXixIm8/fbbrFy5krfffvugsm3atGH69OkUFRXxxhtv
8Pjjj1ckFQcSxaKiIoqLi+nbt+9B5xYWFjJo0CBuu+02CgsLGT9+PIMGDWL79m+nH33xxReZOnUq
mzdvZu/evTz00ENVxlxeXs6YMWNYt24d69atIzExkZtvvrni+LXXXsvu3btZunQpmzdvZvz48QDk
5uYyatQoJk6cSFFREQsWLCAjI+OQdjiwXdmCBQtYvnx5xVDtoEGDyMvLY8uWLZxxxhlcc801FWXv
uOMOFi9ezMKFCyksLOTBBx8kISHhkF7PTz/9lA0bNjBo0KAqv2tEuHvM/wTCrFsDrlnu7e47oc7r
FRGR+hGJvxvq0nvvvecpKSm+Z88ed3c/99xzfdKkSVWW/ctf/uJXXnllxbaZ+apVq9zdffTo9Gai
HwAADjdJREFU0X733Xe7u/t1113nEyZMqCi3cuXKg8pWduutt/q4cePc3X316tVuZr5///6K41Om
TPHzzjvP3d2fe+45P+eccw46v1+/fj516lR3d8/KyvI//OEPFccee+wxHzBgQBgt4b548WJPTU11
d/cNGzZ4QkKC79ix45ByY8eO9fHjx1dZR2Zmps+fP79i+9577/URI0Yc9N1Wr15dbQzbt293M/Pi
4mLfv3+/JyYm+meffXZIudLSUk9NTfW8vDx3d7/99tv9pptuqrLO6u7B4P4jznsiPpVGLFq+HN5b
/y++e2nPaIciIiIRZPcd8TygFfzeI3tGq3///rRv355XX32Vs846i48//piZM2cCsHLlSsaPH88n
n3zCrl27KCsr46yzzqq1zq+//po+ffpUbB933HEHHf/oo4+48847+fLLL9m7dy979uxhyJAhYcW7
YcOGQ+rLyMhgw4YNFdvHHHNMxefExERKSkqqrGvXrl2MGzeOefPmVfS8lZSU4O7k5+eTlpZGcnLy
IeetX7/+qHqo0tO/XZSovLycu+66i3/84x9s2bKl4jm/rVu3Ulpayu7duznhhBMOqaNly5YMGTKE
adOmce+99zJjxgxeeeWVI47pSMRlcjbpkd0kXHg/91z492iHIiIiEXSkiVVdGTlyJM899xzLly9n
wIABdOjQAQhMj3HmmWfy0ksv0bp1ayZNmhRWAtC5c2fWrVtXsR36GWD48OHccsstzJs3j+bNmzNu
3Di2bt0KVD0MGKpLly7885//PGjf2rVrGThwYFjfNdTEiRNZuXIlubm5dOzYkSVLlnDGGWfg7qSn
p1NYWEhRUdEhCVp6ejp5eXlV1tm6dWt27txZsb1x48ZDyoR+x+eff57Zs2czf/58MjIy2LFjB2lp
abg77du3p2XLluTl5XHaaacdUs+oUaMYOXIk/fv3p1WrVpxzzjmH3QZHIy6fOZuzZTK9OpxJ3659
ay8sIiJyhEaOHMlbb73F008/zahRoyr2l5SU0LZtW1q1asXy5ct5/PHHq63Dv33EhyFDhjB16lSW
LVvGrl27Dnrg/0C9qampNG/enNzcXF544YWKhKVDhw4kJCSwatWqKq8zcOBAVq5cyYsvvkhZWRkv
vfQSy5cv57LLLjsolnCUlJSQmJhIcnIyhYWFB8XZuXNnBg4cyI033siOHTvYt28fCxYsAGDMmDFM
mTKFd955h/LycgoKClixYgUAvXv3ZsaMGZSVlbFo0SJeeeWVGhPOkpISWrRoQVpaGjt37uSuu+6q
OJaQkMD111/P+PHj+frrr9m/fz8LFy5k7969APTr1w8z44477mDkyJFhfee6FHfJmTsUJM7h533H
RDsUERFp5DIyMujfvz+7du3ihz/8YcX+hx56iBdeeIGkpCTGjh3L1VdfXe3D7qEPwg8YMIDbbruN
iy66iJNOOomLL774oLKPPfYY99xzD0lJSdx///0MHTq04lirVq34zW9+Q//+/UlLS+Ojjz46qO52
7drx+uuvM3HiRNq3b89DDz3E66+/TlpaWq1xVXbbbbdRWlpK+/btOffccxk4cOBBZadNm0azZs3o
0aMHnTp14uGHHwagT58+TJkyhXHjxpGSkkJWVlZF7+D999/PqlWrSE1NJTs7+6CH+yvHBoHEOCMj
gy5dunDKKadUJFyh/w1OPfVU+vTpQ7t27ZgwYcJBc8CNHDmSzz//nBEjRlT5HSMpoguf15W6XPh8
7Vo44ZHjWHlXDsenHl8ndYqISP3TwucSSdOmTeOpp56q6NWrSqQWPo+7nrPcT7/BE7eRkZwR7VBE
REQkBu3atYtHH32UsWPHRuX6cZecLVi6nPZ8hyYJTaIdioiIiMSYefPm0bFjRzp37szw4cOjEkPc
va25OH8p3TJOjnYYIiIiEoMuvfTSaqcIqS9x13OWV7SM3l01v5mIiIjEprhKzvbuha22lPN7KDkT
ERGR2BRXydmUKdC861LOOE7DmiIiIhKb4iY527MHfvfQVmi9kRNSD12uQURERCQWxM0LAX/4A7Q9
fwrfO+UnNGvSLNrhiIhIHahtSSKRhijiyZmZDQAmAU2Ap939gUrHewBTgNOB37j7xKrqef75wOz+
EPh94Kem7QOfV66EV2eWs+/nj3Njnxl1/RVFRCQKNAGtNFYRTc7MrAnwCHAJUAB8bGaz3X1ZSLFt
wC+AK2qq6403wCzwE6i76u2qjjVvDjdPfoFpean0ObZPnX2/aMvJySErKyvaYcQUtUnV1C5VU7tU
Te1yKLVJ1dQukRHpnrOzgTx3XwNgZjOAwUBFcubuW4AtZjaopoouuuPpIwqgdF8pizcuZuKnb/H3
q/7eqLrA9T/FodQmVVO7VE3tUjW1y6HUJlVTu0RGpJOzLkB+yPZ64JwjqejD9R8eUQAtmrSgR/se
PPi9B2nfqv0R1SEiIiJSXyKdnNXZAwFP//DIes5EREREGhKL5AOVZtYXyHb3AcHtCUB55ZcCgsfu
BUqqeiHAzPTUp4iIiDQY7n7Ez1FFuudsEXCimWUCG4ChwLBqylb7JY7mC4qIiIg0JBHtOQMws4F8
O5XGM+7+RzO7AcDdJ5vZMcDHQBJQDnwD9HT36K46KiIiIhIFEU/ORERERCR8Mb18k5kNMLPlZvYf
M/t1tOOJJjNbY2afmdliM8sN7kszs7fMbKWZvWlmKdGOM9LM7Fkz22Rmn4fsq7YdzGxC8P5Zbmbf
j07UkVdNu2Sb2frgPbM42It94FijbxczSzezd83sSzP7wsxuCe6P6/ulhnaJ9/ulpZl9ZGZLzGyp
mf0xuD9u75ca2iSu75UDzKxJ8Pu/Ftyuu3vF3WPyh8AwaB6QCTQDlgAnRzuuKLbHaiCt0r4HgV8F
P/8a+FO046yHdvgugdUkPq+tHYCewfumWfA+ygMSov0d6rFd7gXGV1E2LtoFOAboHfzcBlgBnBzv
90sN7RLX90vwu7YK/m4KfAicp/ulyjaJ+3sl+H3HA88Ds4PbdXavxHLPWcUEtu6+DzgwgW08q/xi
xA+BvwU//41aVlloDNz938D2Srura4fBwIvuvs8DEyHnEbivGp1q2gWqftEmLtrF3Te6+5Lg5xIC
k193Ic7vlxraBeL4fgFw913Bj80JdBBsR/dLVW0CcX6vmFlX4AfA03zbFnV2r8RyclbVBLZdqikb
Dxx428wWmdlPg/s6ufum4OdNQKfohBZ11bXDsQTumwPi8R76hZl9ambPhHSxx127BN8YPx34CN0v
FULa5cAs33F9v5hZgpktIXBfvOvuXxLn90s1bQJxfq8AfwF+SeBFxgPq7F6J5eRMbyocrL+7nw4M
BG4ys++GHvRA32nct1kY7RBPbfQ40A3oDXwNHDKHYIhG2y5m1gZ4BbjV3b8JPRbP90uwXf5BoF1K
0P2Cu5e7e2+gK3C+mV1Y6Xjc3S9VtEkWcX6vmNllwGZ3X0w104Ad7b0Sy8lZAZAesp3OwZlnXHH3
r4O/twCvEugS3WSBqUgws87A5uhFGFXVtUPle6hrcF9ccPfNHkSg6/1AN3rctIuZNSOQmE1z95nB
3XF/v4S0y/QD7aL75VvuXgS8AZyJ7hfgoDY5S/cK5wI/NLPVwIvARWY2jTq8V2I5OauYwNbMmhOY
wHZ2lGOKCjNrZWZtg59bA98HPifQHqOCxUYBM6uuodGrrh1mA1ebWXMz6wacCORGIb6oCP7hcMCV
BO4ZiJN2MTMDngGWuvukkENxfb9U1y66X6z9geE5M0sEvgcsJo7vl+ra5EACEhR394q73+Xu6e7e
DbgaeMfdr6UO75VIrxBwxNy9zMxuBubx7QS2y6IcVrR0Al4N/JlKU+B5d3/TzBYBL5vZGGANMCR6
IdYPM3sRuABob2b5wD3An6iiHdx9qZm9DCwFyoAbg//Sa3SqaJd7gSwz602g+3w1cGDy53hpl/7A
COAzM1sc3DcB3S9VtctdwLA4v186A38zswQCHRfT3H1+sI3i9X6prk2ei/N7pbID37HO/mzRJLQi
IiIiMSSWhzVFRERE4o6SMxEREZEYouRMREREJIYoORMRERGJIUrORERERGKIkjMRERGRGKLkTEQa
DDMrCf7OMLNhdVz3XZW236/L+kVEwqXkTEQakgMTM3YDhh/OiWZW26TbEw66kHv/w6lfRKSuKDkT
kYboT8B3zWyxmd1qZglm9mczyzWzT81sLICZZZnZv81sFvBFcN9MM1tkZl+Y2U+D+/4EJAbrmxbc
d6CXzoJ1f25mn5nZkJC6c8zs72a2zMymR6EdRKQRitnlm0REavBr4A53vxwgmIztcPezzawF8J6Z
vRksezrwf9x9bXD7OnffHlwrMNfM/uHud5rZTe5+esg1DvTS/QjoBZwGdAA+NrMFwWO9gZ7A18D7
Ztbf3TUcKiJHRT1nItIQWaXt7wMjg+sgfgikAd2Dx3JDEjOAW81sCbAQSCewCHFNzgNe8IDNwL+A
PgSSt1x33xBcJ28JkHkU30lEBFDPmYg0Hje7+1uhO8wsC9hZaftioK+77zazd4GWtdTrHJoMHuhV
2xOybz/6M1VE6oB6zkSkIfoGaBuyPQ+48cBD/2Z2kpm1quK8JGB7MDHrAfQNObavmpcG/g0MDT7X
1gE4H8jl0IRNRKRO6F95ItKQHOix+hTYHxyenAI8TGBI8X/NzIDNwJXB8h5y/lzgZ2a2FFhBYGjz
gCeBz8zsE3e/9sB57v6qmfULXtOBX7r7ZjM7uVLdVLEtInLYLPCohIiIiIjEAg1rioiIiMQQJWci
IiIiMUTJmYiIiEgMUXImIiIiEkOUnImIiIjEECVnIiIiIjFEyZmIiIhIDFFyJiIiIhJD/j9C4KSI
/OA7xwAAAABJRU5ErkJggg==
"
&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[7]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Visualize the weights &lt;/span&gt;

&lt;span class="n"&gt;W0&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;weights&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;W&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;display_network&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;W0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cmap&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gray&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt output_prompt"&gt;Out[7]:&lt;/div&gt;


&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;&amp;lt;matplotlib.image.AxesImage at 0x11381e400&amp;gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;


&lt;div class="output_png output_subarea "&gt;
&lt;img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlEAAAHxCAYAAABNiOmtAAAABHNCSVQICAgIfAhkiAAAAAlwSFlz
AAALEgAACxIB0t1+/AAAIABJREFUeJzsvVnMZdd5pvdtS7bEeWZxqqq/OBVJkZJIWpaswaQsRRbk
hjo3drptBULDyFU66SRAEDuAqCoKAbobCNK5TRAESiNw2ugEQjfgtiwrJmVqsEhxEMfiVFUci/NM
TbRPLlT/zrNfnnfV/vc5/0S+zw1Xnf/svdfwrXU2v3d93+pms1mFEEIIIYS18SubXYEQQgghhO1I
XqJCCCGEECaQl6gQQgghhAnkJSqEEEIIYQJ5iQohhBBCmEBeokIIIYQQJrD0l6iu6z7fdd0DXdc9
1HXdf7fs+4cQQgghbAW6ZeaJ6rruPVV1oKo+W1VPVtWtVfWPZ7PZ/Ut7SAghhBDCFmDZnqjfqKqH
Z7PZodls9ouq+r+q6h8u+RkhhBBCCJvOe5d8v/Or6nH8+4mq+ii/0HVdUqSHEEIIYdswm826eZ8v
+yVq1AvSbDarffv21b59+5b8+BCOTWwvbCaxv7BZxPam0XVz35+qavkvUU9W1U78e2f90hs1YN++
fXXTTTfVddddVysrK7WysrLkagSyf//+vnzDDTdsYk083Jun+/R+5VeWqzrffPPN9fd///dLvSe5
8cYb+/JW7e93Gtuhz1cX4ptuuqlms9lgYV5Pe1wvtkOfv5NYRn+v99pX5dfyZa/j68mhQ4fq8OHD
9elPf/qY3132S9RtVXVJ13UrVfVUVf0nVfWP9Uurb8M5/DiEEEIIW4lV586q146OCGWpr4az2eyt
qvqnVfXNqrqvqv6Ni8y7/vrrl/noEEaze/fuza5CeBcTz3vYLLL2LZ9le6JqNpv9h6r6D8f63vXX
X19//dd/vcznTvqbg652d/2Y74x9xnpes144t626i+nG/bu/+7u592q5mN/znvdMreLb6tZ1XV1w
wQX11ltvWffydnI7rwdvvfVWX1a7/tVf/dWF7u3sdzt4pcfOPfe9Vbu66KKLqmqc1LHMtWs79PFU
XNt07rvvc/0ZM/9baxyfs5XW6yr/As/2uPJ73/veuZ8ri8p5XO/d78rYe23EWLy7fy1CCCGEECaS
l6gQQgghhAnkJSqEEEIIYQJL3xO1HozZk9S6hvtw+Dn3fuheHaf5Oo2dUDuuGuq31HtZHqvdjnn+
ZsD+0r5kP//kJz+Z+72f/vSnfVn1bu7DcePX0sjZT+9///vnfs5ncPx0D9Ci++DWC7cnY2y6CH7+
a7/2a335Zz/7mf0e+4nPoV1zjPR7LsTf7ZvTazaC1rx09kMbYx/p9WPa3PoO/z1m/dCx4PV8zlay
67Hh+G6Nd9f//Oc/t9e7MeMY6zz6xS9+MfeZbu3X34jNXldYZ7aFZdqP2hKv5xpP3ve+9/Vl9qWu
sZw/DvbrlL1WZNE1JZ6oEEIIIYQJ5CUqhBBCCGEC20LOczhpR+HfnNuScpL+jc9xLl26Z9W96Fzt
rIuT9rYarLPr85Y7+rjjjpv7OV246g7m/V555ZW+TKnp9ddfn/t51bBvOX5nnHFGXz799NP78vHH
H9+XW273jaD1PP7Nuar185NPPnnu39hOjpGOxUknnTT3+a+99trcz3Us3nzzzb786quv9mUXCq1y
zEbIHm6+tp7nJCC2hW2vGtqZu4brkMoeHAvWjX3+xhtv9GWVsPgcXs9nqv0vgvafWwudBEeZWevF
vmE/83O2i+tFVdXLL7/cl7mucY5wvVDJifWhbMU6cyy0jbzfMu16TOqHquHvH+cybYZrL9tSNewn
rhkvvvhiXz711FP78plnntmXzznnnMG92GfsJ/Zry0adNM428xmL9nc8USGEEEIIE8hLVAghhBDC
BLaFnOdc6mN35TupjZ/TtV5VdcIJJ/Rluv7otqR7kZ+rNOgil+h2dJKj/m2shLlMnHud49KqC/uJ
rvZTTjmlL9MFrPfi39xYsC9VMuTYUs7i56xLS5qlVLJe0pKTdqqG7T/xxBPnXuNc4FVDeeP555+f
e/3jjz/el1UO5L3phud96epXt7+LVnKZkVuRnuuVWd5Fd1FCqBr2LW2U858yEeW3qmHbOJaUU9wz
qqqeeeaZvky7ZtlFw+pzCPu/FV24VlrRiW6bAD9nv1Iaqhq2jbIbOXjwYF9mH1UN+4lrAe33vPPO
68valpdeeqkvO2mO46/zkrZFCW3Rw4LdWqK24KLZiYtArarauXPn3OtdX7jI3qph+500SFvQvmQ7
+bdzzz13bh0XJZ6oEEIIIYQJ5CUqhBBCCGEC20LOG8OYBF1VQ1cfr1FpgO5Jfu+KK67oyzt27OjL
dMfTtVtV9dBDD/VluiTptqZrXaN46Orl91qu+kVQ96q7N12qTlqrGrqB2U9jkmhWVZ199tlz702p
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
"
&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[8]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Make predictions&lt;/span&gt;
&lt;span class="n"&gt;pred&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;clf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;predict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_test&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;acc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y_test&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;pred&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Accuracy: {:5.2f}% &lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;acc&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;Accuracy: 95.87% 

&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[9]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="c"&gt;# View some images and predictions&lt;/span&gt;
&lt;span class="n"&gt;n_images&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;
&lt;span class="n"&gt;images&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;X_test&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;n_images&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reshape&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="mi"&gt;28&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;28&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;n_images&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;pred&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;clf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;predict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_test&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;n_images&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n_images&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;n_images&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;images&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt; &lt;span class="p"&gt;:,&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;cmap&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gray&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Predicted digit: {}&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pred&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axis&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;off&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;


&lt;div class="output_png output_subarea "&gt;
&lt;img src="data:image/png;base64,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
RU5ErkJggg==
"
&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;&lt;/p&gt;
&lt;h3&gt;NeuralNet classifier&lt;/h3&gt;
&lt;div class="gist"&gt;
    &lt;script src='https://gist.github.com/f52c9be62504f52cc9ec.js'&gt;&lt;/script&gt;
    &lt;noscript&gt;
        &lt;pre&gt;&lt;code&gt;import numpy as np
import scipy.optimize
from dnn_play.activations import sigmoid, sigmoid_deriv
from dnn_play.utils.np_utils import to_binary_class_matrix, flatten_struct, pack_struct
from dnn_play.utils.gradient_utils import eval_numerical_gradient, rel_norm_diff

def ac_func(x):
    return sigmoid(x)

def ac_func_deriv(x):
    return sigmoid_deriv(x)

class NeuralNet(object):
    """
    Classifier of the neural network.
    """

    def __init__(self, layer_units, weights=None):
        self.weights = weights
        self.layer_units = layer_units

    def init_weights(self, eps=1e-4):
        """
        Initialize weights.
        layer_units: tuple stores the size of each layer.
        weights: structured weights.
        """

        layer_units = self.layer_units

        n_layers = len(layer_units)

        weights = [{} for i in range(n_layers - 1)]
        for i in range(n_layers - 1):
            weights[i]['W'] = eps * np.random.randn(layer_units[i+1], layer_units[i])
            weights[i]['b'] = np.zeros(layer_units[i+1])

        self.weights = weights

        return self.weights

    def fit(self, X, y, X_val, y_val,
            reg=0.0,
            learning_rate=1e-2,
            optimizer='L-BFGS-B', max_iters=100,
            sample_batches=True,
            n_epochs=30, batch_size=128,
            verbose=False):

        epoch = 0
        best_val_acc = 0.0
        best_weights = {}

        input_size, n_train = X.shape
        n_classes = np.max(y) + 1 # assume y takes values 0...K-1 where K is number of classes

        if self.weights is None:
            # lazily initialize weights
            self.weights = self.init_weights()

        # Solve with L-BFGS-B
        options = {'maxiter': max_iters, 'disp': verbose}

        def J(theta):

            weights = pack_struct(theta, self.layer_units)
            loss, grad = neural_net_loss(weights, X, y, reg)
            grad = flatten_struct(grad)

            return loss, grad

        # Callback to get accuracies based on training / validation sets
        iter_feval = 0
        loss_history = []
        train_acc_history = []
        val_acc_history   = []
        def progress(x):

             nonlocal iter_feval, best_weights, best_val_acc
             iter_feval += 1

             # Loss history
             weights = pack_struct(x, self.layer_units)
             loss, grad = neural_net_loss(weights, X, y, reg)
             loss_history.append(loss)

             # Training accurary
             y_pred_train = neural_net_predict(weights, X)
             train_acc = np.mean(y_pred_train == y)
             train_acc_history.append(train_acc)

             # Validation accuracy
             y_pred_val= neural_net_predict(weights, X_val)
             val_acc = np.mean(y_pred_val == y_val)
             val_acc_history.append(val_acc)

             # Keep track of the best weights based on validation accuracy
             if val_acc &gt; best_val_acc:
                 best_val_acc = val_acc
                 n_weights = len(weights)
                 best_weights = [{} for i in range(n_weights)]
                 for i in range(n_weights):
                     for p in weights[i]:
                         best_weights[i][p] = weights[i][p].copy()

             n_iters_verbose = max_iters / 20
             if iter_feval % n_iters_verbose == 0:
                 print("iter: {:4d}, loss: {:8f}, train_acc: {:4f}, val_acc: {:4f}".format(iter_feval, loss, train_acc, val_acc))

        # Minimize the loss function
        init_theta = flatten_struct(self.weights)
        results = scipy.optimize.minimize(J, init_theta, method=optimizer, jac=True, callback=progress, options=options)

        # Save weights
        self.weights = best_weights

        return self.weights, loss_history, train_acc_history, val_acc_history

    def predict(self, X):
        """
        X: the N x M input matrix, where each column data[:, i] corresponds to
              a single test set
        pred: the predicted results.
        """
        pred = neural_net_predict(self.weights, X)

        return pred

    def flatten_struct(self, data):
        return flatten_struct(data)

    def pack_struct(self, data):
        return pack_struct(data, self.layer_units)

def neural_net_loss(weights, X, y, reg):
    """
    Compute loss and gradients of the neutral network.
    """

    Y = to_binary_class_matrix(y)
    L = len(weights) # The index of the output layer
    z = []
    a = []

    # Number of samples
    m = X.shape[1]

    # Forward pass
    z.append(0)                 # Dummy element
    a.append(X)                 # Input activation

    for i in range(0, L):
        W = weights[i]['W']
        b = weights[i]['b']
        z.append(W.dot(a[-1]) + b.reshape((-1, 1)))
        a.append(ac_func(z[-1]))

    # Cost function
    sum_weight_square = 0.0 # Sum of weight square
    for i in range(L):
        W = weights[i]['W']
        sum_weight_square += np.sum(W*W)

    cost = 1.0/(2.0*m) * np.sum((a[-1] - Y)**2) + 0.5*reg*sum_weight_square

    # Backpropagation
    delta = [(a[-1] - Y) * ac_func_deriv(z[-1])]
    for i in reversed(range(L)): # Note that delta[0] will not be used
        W = weights[i]['W']
        d = W.T.dot(delta[0]) * ac_func_deriv(z[i])
        delta.insert(0, d) # Insert element at beginning

    # Gradients
    grad = [{} for i in range(L)]
    for i in range(L):
        W = weights[i]['W']
        grad[i]['W'] = delta[i+1].dot(a[i].T) / m + reg*W
        grad[i]['b'] = np.mean(delta[i+1], axis=1)

    return cost, grad

def neural_net_predict(weights, X):
    """
    X: the N x M input matrix, where each column data[:, i] corresponds to
          a single test set
    pred: the predicted results.
    """

    L = len(weights) # The index of the output layer
    z = []
    a = []

    # Number of samples
    m = X.shape[1]

    # Forward pass
    z.append(0)                 # Dummy element
    a.append(X)                 # Input activation

    for i in range(0, L):
        W = weights[i]['W']
        b = weights[i]['b']
        z.append(W.dot(a[-1]) + b.reshape((-1, 1)))
        a.append(ac_func(z[-1]))

    # Predictions
    pred = np.argmax(a[-1], axis=0)

    return pred

def rel_err_gradients():
    """
    Return the relative error between analytic and nemerical gradients.
    """

    # Number of layer units
    input_size  = 4 * 4
    hidden_size = 4
    n_classes = 10
    layer_units = (input_size, hidden_size, n_classes)

    X_train = np.random.randn(input_size, 100)
    y_train = np.random.randint(n_classes, size=100)
    reg = 1e-4

    # Define the classifier
    clf = NeuralNet(layer_units)

    # Initialize weights
    weights = clf.init_weights()

    # Analytic gradients of the cost function
    cost, grad = neural_net_loss(weights, X_train, y_train, reg)
    grad = clf.flatten_struct(grad) # Flattened gradients

    def J(theta):
        # Structured weights
        weights = clf.pack_struct(theta)
        return neural_net_loss(weights, X_train, y_train, reg)[0]

    theta = clf.flatten_struct(weights)
    numerical_grad = eval_numerical_gradient(J, theta)

    # Compare numerically computed gradients with those computed analytically
    rel_err = rel_norm_diff(numerical_grad, grad)

    return rel_err&lt;/code&gt;&lt;/pre&gt;
    &lt;/noscript&gt;
&lt;/div&gt;
&lt;p&gt;In case you are interested in all codes related in this demonstration, please check this &lt;a href="https://github.com/tsaith/dnn_play"&gt;repository&lt;/a&gt;.&lt;/p&gt;</summary><category term="cv"></category></entry><entry><title>My First Post</title><link href="http://tsaith.github.io/my-first-post.html" rel="alternate"></link><updated>2015-12-03T10:20:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-12-03:my-first-post.html</id><summary type="html">&lt;p&gt;Following is a review of my favorite mechanical keyboard.&lt;/p&gt;
&lt;p&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[14]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="k"&gt;load_ext&lt;/span&gt; autoreload
&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="k"&gt;autoreload&lt;/span&gt; 2
&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="k"&gt;matplotlib&lt;/span&gt; inline

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;matplotlib.pyplot&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;plt&lt;/span&gt;

&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;dnn_play.classifiers.softmax&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Softmax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;softmax_loss&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;rel_err_gradients&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;dnn_play.utils.data_utils&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;load_mnist&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;dnn_play.utils.visualize_utils&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;display_network&lt;/span&gt;


&lt;span class="c"&gt;# Plot settings&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rcParams&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;figure.figsize&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;10.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;10.0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c"&gt;# set default size of plots&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rcParams&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;image.interpolation&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;nearest&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;The autoreload extension is already loaded. To reload it, use:
  %reload_ext autoreload
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[10]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Load MNIST data&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_train&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_val&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_val&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_test&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_test&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;load_mnist&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="c"&gt;#(X_train, y_train), (X_val, y_val), (X_test, y_test) = load_mnist(n_train=9000, n_val=1000, n_test=1000)&lt;/span&gt;

&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;X_train shape = {} y_train shape = {}&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_train&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;X_val   shape = {} y_val  shape = {}&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_val&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_val&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;X_test  shape = {} y_test shape = {}&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_test&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_test&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;X_train shape = (784, 55000) y_train shape = (55000,)
X_val   shape = (784, 5000) y_val  shape = (5000,)
X_test  shape = (784, 10000) y_test shape = (10000,)
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[11]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Sanity check of softmax loss function&lt;/span&gt;

&lt;span class="c"&gt;# Number of layer units&lt;/span&gt;
&lt;span class="n"&gt;input_size&lt;/span&gt;  &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;X_train&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="c"&gt;# Dimension of features&lt;/span&gt;
&lt;span class="n"&gt;n_classes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;max&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;

&lt;span class="n"&gt;layer_units&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;input_size&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;n_classes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c"&gt;# Hyperparameters&lt;/span&gt;
&lt;span class="n"&gt;reg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;

&lt;span class="c"&gt;# Numerical parameters&lt;/span&gt;
&lt;span class="n"&gt;max_iters&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;400&lt;/span&gt;

&lt;span class="c"&gt;# Define classifier&lt;/span&gt;
&lt;span class="n"&gt;clf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Softmax&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;layer_units&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;weights&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;clf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;init_weights&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;loss&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;grad&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;softmax_loss&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;weights&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;X_train&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c"&gt;# Note there are 10 classes.&lt;/span&gt;
&lt;span class="c"&gt;# As a rough sanity check, our loss should be something close to -log(0.1).&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;loss: %f&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;loss&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;sanity check: %f&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.1&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;loss: 2.302530
sanity check: 2.302585
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[15]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Gradient checking&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;rel_err_gradients&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Gradient check passed!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Gradient check failed!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; 
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;Gradient check passed!
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[5]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;Training&lt;/span&gt;
&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;loss_history&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;train_acc_history&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;val_acc_history&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;clf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_train&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;X_val&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y_val&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
                                                                  &lt;span class="n"&gt;reg&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;reg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;max_iters&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;max_iters&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;verbose&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;   
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;iter:   20, loss: 0.325791, train_acc: 0.909036, val_acc: 0.928800
iter:   40, loss: 0.284069, train_acc: 0.923273, val_acc: 0.937000
iter:   60, loss: 0.272061, train_acc: 0.927273, val_acc: 0.939600
iter:   80, loss: 0.267148, train_acc: 0.930764, val_acc: 0.942400
iter:  100, loss: 0.264786, train_acc: 0.931800, val_acc: 0.941800
iter:  120, loss: 0.263709, train_acc: 0.932655, val_acc: 0.941800
iter:  140, loss: 0.263230, train_acc: 0.932382, val_acc: 0.941800
iter:  160, loss: 0.262966, train_acc: 0.932655, val_acc: 0.942000
iter:  180, loss: 0.262849, train_acc: 0.932873, val_acc: 0.942600
iter:  200, loss: 0.262792, train_acc: 0.933055, val_acc: 0.942400
iter:  220, loss: 0.262766, train_acc: 0.933127, val_acc: 0.942400
iter:  240, loss: 0.262751, train_acc: 0.933000, val_acc: 0.942200
iter:  260, loss: 0.262745, train_acc: 0.933055, val_acc: 0.942400
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[6]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Plot the loss function and train / validation accuracies&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loss_history&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Loss history&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xlabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Iteration&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ylabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Loss&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;train_acc_history&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;val_acc_history&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Training accuracy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Validation accuracy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;lower right&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xlabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Iteration&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ylabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Clasification accuracy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt output_prompt"&gt;Out[6]:&lt;/div&gt;


&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;&amp;lt;matplotlib.text.Text at 0x10636f358&amp;gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;


&lt;div class="output_png output_subarea "&gt;
&lt;img src="data:image/png;base64,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
B7OqZnH8rOM5uPpgtjRtYXdz9se/qryK2VWzmTNxDrOrZjN74mymjJ/Cqq2rWLd7HWfMP4Mp46fw
lXu/wpbGLfzj2f/IaQefxsotK3lhxwtsadzCvEnzOG7mcVSWVdLa0crmhs3UNdSxsX4ju5t3k0hs
rN/Io3WP0p7amTtxLucffT7nHn4uEUFjayMTSif0+4/8s9ue5ZqHr6GyrJLpE6YzLsYxe+Jsli5a
yvjS8S+bv7W9lbKSsr3P+3q/hpYGNtZvZGvTVg6ZfAhzJs6hI3Wwq3nXSw6QbWhtoK6+jlXbVvFY
3WNEBLOrZlNeUk5zezNPbX6KtbvWcuT0Izn1oFM5Z+E5zKicweptq2lsbWTahGlc98h1XHHvFQAc
Me0I1uxYw67mXRw/63hOmnMS25q20dLewqyqWSycspAT55zI4tmLWTBlAUGwu2U37R3tbGncwk2P
38QdL9xBR+qgorSC2VWzsy9OguqKauZMnMNR04/iqBlHsXbnWp7Y/AQbdm9gT9sejp15LHOr57Kp
YRNTxk/htYe+luqKaupb6tlYv5FtTdtYMGUBs6pm0d7RztamrWys38iu5l0ATCidwOyJs2nvaKeu
oY6W9hZa21t5ZuszrNq2iinjp+z9Pe1p20NdQ93e7a/79r21aStbGrfQkTpoaW9hU8OmvSGnoaWB
9tROVVn/vzgbWxsBegwR7R3t7GzeycTyiZRE3/+pSWQhrLKsksbWxl5fU99ST+m4Uto62igrKaOi
pIKO1MHult17X1tdXs24GEdDawPzJ81n3qTsKk+7mnexqWETE0onMKtqFuUl5bR1tLG5cTN19XXs
btnNpIpJRC+X5ux8n0kVk3oMbuNLx+/dLgAmj5/MrMrsffb32Xe37Kauvo66hjo2NWyiraPtZfM1
tzXT1Na0d73Mnjib2VWz+/WfkPGl45lVNWvvNtv5ebbv2c7G+o3UNdSxtXEriUTpuFJmVc1iyvgp
L1sXicS2pm1sbthMe2rfO76v13RqT+1sbdzK1qatdKSOveObWptobm9mXIyjJEoOOLillK2/I6Yd
QUSwuWEz1RXVTJswje1N29natPUlf1saWxuJiEEFt0kVk5hZOZP6lnq2NG55ybp4xdxXcOslt/bx
6sJnp02D1vk76CkopJRo7Wjt9Y9na3srVz90Nf96579SWVbJknlL2Nm8k+1N2wGYOmEqi2ctZtG0
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
V9c/fs3NsH17FuC6dgQ6h0mTstDV346cJCm/DG2joP6m1ia+ufybXHHvFRw942i+9dZvFe21x4ZC
c3MWrjZsyLo3GzZk/5tvbc26Wp279roODQ1ZJ6CjIwswhx0Gxx6bhbLS0qzrUlWVdaNe8Qo49dQs
KHWXUvY+zc1ZCGxuzp7PmZMFrM55Wlr2teQlSeoPQ1ue6//B4z/gE7/+BKccdAp/e9bfcspBp+S1
ntGkcxfO9u3w+OPZ80WLsmD13HNZd2vDhn0BrXPYtSvbJXbQQdlxUp3HSpWWZj87d+91HSZPznYj
NDRkYarS+5JLkkYZQ1se6//afV/jinuv4IYLbuCM+WfkrY6R1tCQ7VJcu/alw/r1+455evrprCtW
VpZ1tI47Lut0rV6d7RY87DCYPz/rYM2duy+kHXRQdqzVYM9KkyRptDG05an+bz34LT5/1+e5/b23
c+iUQ/NSw2B1dGTHXb3wQnacV0NDdnxUfX12DNfTT8OqVdlxWZ1no+3Zk3XGFi7MDkCfPz87+Hv+
/OwA8NLc+chHHpk991grSZIyhrY81F/fUs/Cry7krj+9i6NmHDXi738gUsq6Yps2ZcP998MDD2QH
6a9blx1wP29edpzXlCn7jv2aNSsLXkcemZ31V1GR7d4sLc26ZKVeLEaSpAPixXXz4D8f+k/OXnD2
qAts7e3ZJSzWrMk6Z3feCXffnYWwuXOzY79OPRX+6q+yg/Tnzy/MCzhKklSM7LQdoNb2Vhb9xyJ+
9Mc/4pXzXjmi792TxsbsWLJf/Qq+/OVsN+bChXDSSfDqV8OZZ2adNEmSlF922kbI89uf5/uPfZ/n
dzzPYVMPy0tgq6uD2lq4/Xb43e/2XYn+oIOy64J973twRvGcDyFJUlGx09YPHamDM689kyOmHcH8
SfO5ZPElHDvz2GF9z7a2LKD98IfZhWI3bMiuR/aa18A558BZZ8GCBdkV5j3YX5Kk0c9O2wi45qFr
CILr3n7dsN25YNs2+PGPs7M1H3kE7r03u7L+O94BF1+cXRJj0SJPAJAkqVjZaetDSonl65fzlhvf
wq/e9StOnHPioJfZ0ZFdSuPmm+HXv4YTTsiuVfaVr8DZZ2fHoh17bHY82vTpQ/AhJEnSqGCnbZg8
u+1ZzrvpPJramvjns/95UIFt69ZsN+ctt2Rnc06eDG99K3zsY9nNxZ95Bv7f/8sCnCRJUk/stPWg
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
QmCC
"
&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[7]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Visualize the weights &lt;/span&gt;

&lt;span class="n"&gt;W0&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;W&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;display_network&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;W0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cmap&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gray&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt output_prompt"&gt;Out[7]:&lt;/div&gt;


&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;&amp;lt;matplotlib.image.AxesImage at 0x107726278&amp;gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;


&lt;div class="output_png output_subarea "&gt;
&lt;img src="data:image/png;base64,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
vai/SaKl9s/nI9mQrpHkwpxslcY+JfukpG8krefrJLGTNjJQ/+Z65ISaJ4KuaSbJ4UZFq9xLAn+W
t+meJzGfNkFk8f+WW26pyjzwwANVLCdHjeANCXnupP6g5Ik5kWFE3ecki1NyRqJFZCcJn5IW0zVl
aMxRf9O5SN7Ofd66sYeSjubPKeoPunfp8+cTn/hEFcubCOizjT4rKZY/d/fs2VOVobFJG1xoM0Ce
xygZJ83VdJ+Ocp7xmyURERGRHlwsiYiIiPTgYklERESkBxdLIiIiIj3MuuBNtMi8JEuS0JWFQHod
Sbsk/JKcnCVXEirpXNdff30Vu/nmmweOSVgnQY1EQpJt81O9SQomGZNkxiwnU71IjCQZk4TrYWkR
cqk/SFykco8//ngVy2IqZWomKZsE7w0bNkxbhrIAU7+RPJyvicRzkkmpj3Kf0zihjQbUrnRfziS7
7qggmZQy5m/fvn3gmO6tFjE8os7ETdIrZV4n+Znmo9y/NDZJ5m7JOE9iO50/b2SI4LbYv3//wDGN
HaJVKh8WGq95bqO2oE0X1Ef5tTSv0evuvvvuKnbVVVdVsdzWNFfQeM3Z3yPqLPQ0P9HcQBtJaONW
nmdoDNA81rKOaNkIcCJO/uwkIiIiModxsSQiIiLSg4slERERkR5cLImIiIj0MCcE75YM3iR5kViW
RTbK9EnZS0lMJWFs9+7dA8ckCl999dVVjATQnCmbBD4SF3/4wx9WMcpKnkVLagsSFykrbJbzqD9I
5iaJc5QiL50rjyeSS6n+1EeUZTiPHxJyqd+ornn8UOZsGufUlyRl5/bfuXNnVYbaokWWzFmBI3gM
tGRZjxg+2+6wryOhlSRduh8WLVo0cEwbLGhcLFmypIpt3Lhx4Jgyi3/pS1+qYj/5yU+q2Pr166tY
HmPXXHNNVYbGK81HedMI9S2NYSpH75nnfuoPGjutGf9boPNTLG+0obmidTNRvsep7RcsWFDFaG6j
98xCNNWVZPQs3EfU/Uuf15TBm85Fm5Xy5xZtZKDrJumb7vFh8ZslERERkR5cLImIiIj04GJJRERE
pIdZd5aG9QvoN0r6vTN7FPTbL/02u3Xr1ipGCbOy40O//VIiQ/KYrrvuuoHjYZ96f6Jy+Tdiuh76
nZdci+yitD5Velg/qfUJ4S0JG8mjoWukdqX+zUnfKHEbvY7qmv0UKkNjmKBy+fd/8h5o3FH/5nNR
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
"
&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[8]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Make predictions&lt;/span&gt;

&lt;span class="n"&gt;pred&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;clf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;predict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_test&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;acc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y_test&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;pred&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Accuracy: {:5.2f}% &lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;acc&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;
&lt;div class="output_subarea output_stream output_stdout output_text"&gt;
&lt;pre&gt;Accuracy: 92.43% 

&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In&amp;nbsp;[9]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span class="c"&gt;# View some images and predictions&lt;/span&gt;
&lt;span class="n"&gt;n_images&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;
&lt;span class="n"&gt;images&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;X_test&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;n_images&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reshape&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="mi"&gt;28&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;28&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;n_images&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;pred&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;clf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;predict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X_test&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;n_images&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n_images&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;n_images&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;images&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt; &lt;span class="p"&gt;:,&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;cmap&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gray&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Predicted digit: {}&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pred&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;
    &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axis&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;off&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;&lt;div class="prompt"&gt;&lt;/div&gt;


&lt;div class="output_png output_subarea "&gt;
&lt;img src="data:image/png;base64,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
RU5ErkJggg==
"
&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.flickr.com/photos/129481822@N05/15646273670/"&gt;&lt;img src="https://farm8.staticflickr.com/7518/15646273670_3d1f14d6e4_c.jpg" alt="Screen Shot 2014-11-20 at 上午10.47.28"&gt;&lt;/a&gt;&lt;/p&gt;</summary></entry><entry><title>Install Theano and CUDA Toolkit 7.5 on OSX</title><link href="http://tsaith.github.io/install-theano-and-cuda-toolkit-75-on-osx.html" rel="alternate"></link><updated>2015-11-18T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-11-18:install-theano-and-cuda-toolkit-75-on-osx.html</id><summary type="html">&lt;p&gt;This post describes the steps I used to install &lt;a href="http://deeplearning.net/software/theano/tutorial/"&gt;Theano&lt;/a&gt; on my Mac (OSX 10.9.5) with NVIDIA GeForce GTX 660M graphics card.&lt;/p&gt;
&lt;h3&gt;Install Theano&lt;/h3&gt;
&lt;p&gt;Please use &lt;code&gt;pip&lt;/code&gt; to install Theano as below&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;pip install Theano
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Then, create the &lt;code&gt;~/.theanorc&lt;/code&gt; with content as&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;[global]&lt;/span&gt;
&lt;span class="na"&gt;mode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;FAST_RUN&lt;/span&gt;
&lt;span class="na"&gt;floatX&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;float32&lt;/span&gt;
&lt;span class="na"&gt;device&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;gpu&lt;/span&gt;

&lt;span class="k"&gt;[nvcc]&lt;/span&gt;
&lt;span class="na"&gt;fastmath&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;True&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Install CUDA Toolkit&lt;/h3&gt;
&lt;p&gt;Download the package of CUDA Toolkit 7.5 from the official &lt;a href="https://developer.nvidia.com/cuda-downloads"&gt;link&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Install cuDNN&lt;/h3&gt;
&lt;p&gt;Next, we have to register on NVIDIA to be able to download &lt;a href="https://developer.nvidia.com/cudnn"&gt;cuDNN&lt;/a&gt;,
which is a GPU-accelerated library of primitives for deep neural networks.&lt;/p&gt;
&lt;p&gt;After downloading,
please uncompress the package and copy the header file and libraries to &lt;code&gt;include&lt;/code&gt; and &lt;code&gt;lib&lt;/code&gt; under the root directory of CUDA Toolkit (e.g. /usr/local/cuda), respectively.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;tar xzf cudnn-7.0-osx-x64-v3.0-prod.tgz
&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd &lt;/span&gt;cuda
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo cp include/cudnn.h /usr/local/cuda/include/
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo cp lib/libcudnn* /usr/local/cuda/lib/
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Add environment variables&lt;/h3&gt;
&lt;p&gt;Add the following environment variables to &lt;code&gt;~/.bash_profile&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="x"&gt; Theano&lt;/span&gt;
&lt;span class="x"&gt;export CUDA_ROOT=&amp;quot;/usr/local/cuda&amp;quot;&lt;/span&gt;
&lt;span class="x"&gt;export THEANO_FLAGS=&amp;quot;mode=FAST_RUN,device=gpu,floatX=float32&amp;quot;&lt;/span&gt;

&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="x"&gt; CUDA&lt;/span&gt;
&lt;span class="x"&gt;export LD_LIBRARY_PATH=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;CUDA_ROOT&lt;/span&gt;&lt;span class="x"&gt;/lib:&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;LD_LIBRARY_PATH&lt;/span&gt;&lt;span class="x"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="x"&gt;export PATH=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;CUDA_ROOT&lt;/span&gt;&lt;span class="x"&gt;/bin:&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="x"&gt;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;You may want to execute &lt;code&gt;source ~/.bash_profile&lt;/code&gt; to validate the settings right away.&lt;/p&gt;
&lt;h3&gt;Testing&lt;/h3&gt;
&lt;p&gt;Now, we can run a test code to see if the Theano works as expected.&lt;/p&gt;
&lt;p&gt;test.py:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;theano&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;function&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;shared&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sandbox&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;theano.tensor&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;T&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;

&lt;span class="n"&gt;vlen&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;30&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;768&lt;/span&gt;  &lt;span class="c"&gt;# 10 x #cores x # threads per core&lt;/span&gt;
&lt;span class="n"&gt;iters&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1000&lt;/span&gt;

&lt;span class="n"&gt;rng&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;numpy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;RandomState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;shared&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;numpy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;asarray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rng&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vlen&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;floatX&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;function&lt;/span&gt;&lt;span class="p"&gt;([],&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;maker&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fgraph&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;toposort&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="n"&gt;t0&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;iters&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;t1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Looping &lt;/span&gt;&lt;span class="si"&gt;%d&lt;/span&gt;&lt;span class="s"&gt; times took &lt;/span&gt;&lt;span class="si"&gt;%f&lt;/span&gt;&lt;span class="s"&gt; seconds&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;iters&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;t1&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;t0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Result is &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;,))&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;numpy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;any&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="nb"&gt;isinstance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Elemwise&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;maker&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fgraph&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;toposort&lt;/span&gt;&lt;span class="p"&gt;()]):&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Used the cpu&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Used the gpu&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Let's run this code on CPU and GPU, separately.&lt;/p&gt;
&lt;p&gt;CPU case:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ THEANO_FLAGS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;device=cpu&amp;#39;&lt;/span&gt; python test.py
&lt;span class="o"&gt;[&lt;/span&gt;Elemwise&lt;span class="o"&gt;{&lt;/span&gt;exp,no_inplace&lt;span class="o"&gt;}(&lt;/span&gt;&amp;lt;TensorType&lt;span class="o"&gt;(&lt;/span&gt;float32, vector&lt;span class="o"&gt;)&lt;/span&gt;&amp;gt;&lt;span class="o"&gt;)]&lt;/span&gt;
Looping &lt;span class="m"&gt;1000&lt;/span&gt; &lt;span class="nb"&gt;times &lt;/span&gt;took 14.474722 seconds
Result is &lt;span class="o"&gt;[&lt;/span&gt; 1.23178029  1.61879337  1.52278066 ...,  2.20771813  2.29967761
  1.62323284&lt;span class="o"&gt;]&lt;/span&gt;
Used the cpu
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;GPU case:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ THEANO_FLAGS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;device=gpu&amp;#39;&lt;/span&gt; python test.py
Using gpu device 0: GeForce GTX 660M &lt;span class="o"&gt;(&lt;/span&gt;CNMeM is disabled&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;GpuElemwise&lt;span class="o"&gt;{&lt;/span&gt;exp,no_inplace&lt;span class="o"&gt;}(&lt;/span&gt;&amp;lt;CudaNdarrayType&lt;span class="o"&gt;(&lt;/span&gt;float32, vector&lt;span class="o"&gt;)&lt;/span&gt;&amp;gt;&lt;span class="o"&gt;)&lt;/span&gt;, HostFromGpu&lt;span class="o"&gt;(&lt;/span&gt;GpuElemwise&lt;span class="o"&gt;{&lt;/span&gt;exp,no_inplace&lt;span class="o"&gt;}&lt;/span&gt;.0&lt;span class="o"&gt;)]&lt;/span&gt;
Looping &lt;span class="m"&gt;1000&lt;/span&gt; &lt;span class="nb"&gt;times &lt;/span&gt;took 0.517552 seconds
Result is &lt;span class="o"&gt;[&lt;/span&gt; 1.23178029  1.61879349  1.52278066 ...,  2.20771813  2.29967761
  1.62323296&lt;span class="o"&gt;]&lt;/span&gt;
Used the gpu
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Please note that Theano will have to compile the python code to generate C++/CUDA code when executing with GPU for the first time. Thus, the results shown above came from the execution of the second time.&lt;/p&gt;
&lt;p&gt;Finally, it can be observed that the runtime is greatly reduced when GPU is used : )&lt;/p&gt;</summary><category term="python"></category></entry><entry><title>Implement the exercises of UFLDL Tutorial with python 3</title><link href="http://tsaith.github.io/implement-the-exercises-of-ufldl-tutorial-with-python-3.html" rel="alternate"></link><updated>2015-11-11T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-11-11:implement-the-exercises-of-ufldl-tutorial-with-python-3.html</id><summary type="html">&lt;p&gt;In recent years, deep learning has received more and more attention and is applied to many things in our daily life.
Thus, I decide to dig into this powerful technology by self-teaching.&lt;/p&gt;
&lt;p&gt;Last month, I started to study &lt;a href="http://deeplearning.stanford.edu/wiki/index.php/UFLDL_Tutorial"&gt;UFLDL Tutorial&lt;/a&gt; which is an excellent learning material contributed by &lt;a href="https://en.wikipedia.org/wiki/Andrew_Ng"&gt;Andrew Ng&lt;/a&gt;.
I really like his way to explain concepts and appreciate his generosity to carefully prepare the online courses.&lt;/p&gt;
&lt;p&gt;In UFLDL Tutorial, the exercises are originally supposed to be done with Matlab.
However, I have no Matlab license.
Thus, I chose python (with version 3.4) to implement those exercises.
The codes and related introduction can be found &lt;a href="https://github.com/tsaith/ufldl_tutorial"&gt;here&lt;/a&gt;.&lt;/p&gt;</summary><category term="python"></category></entry><entry><title>A quick demo on face detection with python 3 and opencv 3</title><link href="http://tsaith.github.io/a-quick-demo-on-face-detection-with-python-3-and-opencv-3.html" rel="alternate"></link><updated>2015-10-10T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-10-10:a-quick-demo-on-face-detection-with-python-3-and-opencv-3.html</id><summary type="html">&lt;p&gt;Here, I record how to write a simple code for face detection with Harr-like features, which is based on python 3 and opencv 3.
The script &lt;code&gt;face_detector_haar.py&lt;/code&gt; below is just slightly modified from the &lt;a href="https://realpython.com/blog/python/face-recognition-with-python/"&gt;post&lt;/a&gt; written by Shantnu Tiwari.&lt;/p&gt;
&lt;p&gt;face_detector_haar.py:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;cv2&lt;/span&gt; &lt;span class="c"&gt;# OpenCV&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;

&lt;span class="c"&gt;# Input image&lt;/span&gt;
&lt;span class="n"&gt;image_path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="c"&gt;# Model parameters&lt;/span&gt;
&lt;span class="n"&gt;dir_path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/usr/local/Cellar/opencv3/3.0.0/share/OpenCV/haarcascades&amp;quot;&lt;/span&gt; &lt;span class="c"&gt;# Please modify this for your environment&lt;/span&gt;
&lt;span class="n"&gt;filename&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;haarcascade_frontalface_default.xml&amp;quot;&lt;/span&gt; &lt;span class="c"&gt;# for frontal faces&lt;/span&gt;
&lt;span class="c"&gt;#filename = &amp;quot;haarcascade_profileface.xml&amp;quot; # for profile faces&lt;/span&gt;
&lt;span class="n"&gt;model_path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dir_path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;filename&lt;/span&gt;

&lt;span class="c"&gt;# Create the classifier&lt;/span&gt;
&lt;span class="n"&gt;clf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CascadeClassifier&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;model_path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c"&gt;# Read the image&lt;/span&gt;
&lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imread&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image_path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;gray&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cvtColor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;COLOR_BGR2GRAY&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c"&gt;# Detect faces on image&lt;/span&gt;
&lt;span class="n"&gt;faces&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;clf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;detectMultiScale&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;gray&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;scaleFactor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;1.1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;minNeighbors&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;minSize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CASCADE_SCALE_IMAGE&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Found {0} faces!&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;faces&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;

&lt;span class="c"&gt;# Draw a rectangle around the faces&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;faces&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rectangle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;w&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Faces found&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;waitKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Please make sure the &lt;code&gt;model_path&lt;/code&gt;  in code is correctly set when considering your OpenCV environment.
The &lt;code&gt;haarcascade_frontalface_default.xml&lt;/code&gt; and &lt;code&gt;haarcascade_profileface.xml&lt;/code&gt; are the model files of frontal and profile face detection, respectively.&lt;/p&gt;
&lt;p&gt;To execute the script:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;python3 face_detector_haar.py photo.jpg
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Some results are demonstrated as following.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm1.staticflickr.com/626/21558529013_489118d07d_z.jpg"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm6.staticflickr.com/5740/22189822451_d32dd51a35_z.jpg"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm1.staticflickr.com/639/22189825981_0a76874f9e_z.jpg"&gt;&lt;/p&gt;</summary><category term="cv"></category><category term="python"></category></entry><entry><title>A Python binding of Compressive Tracking</title><link href="http://tsaith.github.io/a-python-binding-of-compressive-tracking.html" rel="alternate"></link><updated>2015-09-30T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-09-30:a-python-binding-of-compressive-tracking.html</id><summary type="html">&lt;p&gt;Recently I read an interesting paper &lt;a href="http://www4.comp.polyu.edu.hk/~cslzhang/CT/eccv_ct_camera.pdf"&gt;"Real-time Compressive Tracking"&lt;/a&gt; which applied &lt;a href="https://en.wikipedia.org/wiki/Compressed_sensing"&gt;compressive sensing&lt;/a&gt; on object tracking to dramatically reduce the calculations and showed remarkable results.
Kaihua Zhang (the author) kindly had released the source code(both Matlab and C++ versions) of the algorithm on his &lt;a href="http://www4.comp.polyu.edu.hk/~cslzhang/CT/CT.htm"&gt;webpage&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;A python binding&lt;/h3&gt;
&lt;p&gt;Personally I prefer to test algorithms with python,
hence, I have tried to build a python binding of compressive tracking and tested it on my Mac.&lt;/p&gt;
&lt;p&gt;Some results are as below:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Kitesurf&lt;/p&gt;
&lt;p&gt;&lt;div class="videobox"&gt;
            &lt;iframe width="640" height="390"
                src='https://www.youtube.com/embed/7fYTloE1KCc'
                frameborder='0' webkitAllowFullScreen mozallowfullscreen
                allowFullScreen&gt;
            &lt;/iframe&gt;
        &lt;/div&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Bolt&lt;/p&gt;
&lt;p&gt;&lt;div class="videobox"&gt;
            &lt;iframe width="640" height="390"
                src='https://www.youtube.com/embed/XeH4oDwVZj8'
                frameborder='0' webkitAllowFullScreen mozallowfullscreen
                allowFullScreen&gt;
            &lt;/iframe&gt;
        &lt;/div&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;and the source code can be found from &lt;a href="https://github.com/tsaith/pyct"&gt;this link&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;More details&lt;/h3&gt;
&lt;p&gt;This section will describe the main steps how I wrapped the C++ version of compressive tracking as the python binding and is not important in the aspect of usage.
In case you are interested in the procedures,
please keep reading.&lt;/p&gt;
&lt;p&gt;The class &lt;code&gt;CompressiveTracker&lt;/code&gt; in &lt;code&gt;compressive_tracker.cpp&lt;/code&gt; provides two public methods &lt;code&gt;init(Mat&amp;amp; _frame, Rect&amp;amp; _objectBox)&lt;/code&gt; and &lt;code&gt;processFrame(Mat&amp;amp; _frame, Rect&amp;amp; _objectBox)&lt;/code&gt;,
where &lt;code&gt;_frame&lt;/code&gt; and &lt;code&gt;_objectBox&lt;/code&gt; are the video frame and object box, respectively.&lt;/p&gt;
&lt;p&gt;I added two public methods &lt;code&gt;init_wrap(vector&amp;lt;vector&amp;lt;uint8&amp;gt; &amp;gt; &amp;amp;_frame, vector&amp;lt;int&amp;gt; &amp;amp;_object_box)&lt;/code&gt; and &lt;code&gt;process_frame_wrap(vector&amp;lt;vector&amp;lt;uint8&amp;gt; &amp;gt; &amp;amp;_frame, vector&amp;lt;int&amp;gt; &amp;amp;_object_box)&lt;/code&gt; to wrap the methods &lt;code&gt;init&lt;/code&gt; and &lt;code&gt;processFrame&lt;/code&gt;, which expect &lt;code&gt;vector&lt;/code&gt; array arguments instead of &lt;code&gt;Mat&lt;/code&gt; or &lt;code&gt;Rect&lt;/code&gt; ones.&lt;/p&gt;
&lt;p&gt;Next, the cython files &lt;code&gt;wrap.pxd&lt;/code&gt; and &lt;code&gt;wrap.pyx&lt;/code&gt; were created to wrap the C++ class &lt;code&gt;CompressiveTracker&lt;/code&gt; into the Python class &lt;code&gt;CyCompressiveTracker&lt;/code&gt;.
Besides, &lt;code&gt;setup.py&lt;/code&gt; was added for compilation.&lt;/p&gt;
&lt;p&gt;Finally, &lt;code&gt;run.py&lt;/code&gt; is the testing code which will load the python binding for object tracking.&lt;/p&gt;
&lt;p&gt;Frankly speaking, the existences of &lt;code&gt;init_wrap&lt;/code&gt; and &lt;code&gt;process_frame_wrap&lt;/code&gt; come from that I don't know how to use cython to directly convert &lt;code&gt;numpy&lt;/code&gt; array into &lt;code&gt;Mat&lt;/code&gt; or &lt;code&gt;Rect&lt;/code&gt; instances of OpenCv.
I will grateful if someone can show me how to do that : )&lt;/p&gt;</summary><category term="cv"></category><category term="python"></category></entry><entry><title>Combine images into a video with Python 3 and OpenCv 3</title><link href="http://tsaith.github.io/combine-images-into-a-video-with-python-3-and-opencv-3.html" rel="alternate"></link><updated>2015-09-30T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-09-30:combine-images-into-a-video-with-python-3-and-opencv-3.html</id><summary type="html">&lt;p&gt;Here, we will inspect a python script (named &lt;code&gt;tk-img2video&lt;/code&gt;) which will combine images into a video.&lt;/p&gt;
&lt;p&gt;tk-img2video:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;#!/usr/local/bin/python3&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;cv2&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;argparse&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;

&lt;span class="c"&gt;# Construct the argument parser and parse the arguments&lt;/span&gt;
&lt;span class="n"&gt;ap&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;argparse&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ArgumentParser&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;ap&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_argument&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;-ext&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;--extension&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;required&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;png&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;help&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;extension name. default is &amp;#39;png&amp;#39;.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ap&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_argument&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;-o&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;--output&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;required&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;output.mp4&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;help&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;output video file&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;args&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;vars&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ap&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse_args&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;

&lt;span class="c"&gt;# Arguments&lt;/span&gt;
&lt;span class="n"&gt;dir_path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;ext&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;extension&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;output&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="n"&gt;images&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listdir&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dir_path&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;endswith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ext&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;images&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c"&gt;# Determine the width and height from the first image&lt;/span&gt;
&lt;span class="n"&gt;image_path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dir_path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;images&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="n"&gt;frame&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imread&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image_path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;video&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;height&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;channels&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;

&lt;span class="c"&gt;# Define the codec and create VideoWriter object&lt;/span&gt;
&lt;span class="n"&gt;fourcc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;VideoWriter_fourcc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;mp4v&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c"&gt;# Be sure to use lower case&lt;/span&gt;
&lt;span class="n"&gt;out&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;VideoWriter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fourcc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;20.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;height&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;images&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;

    &lt;span class="n"&gt;image_path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dir_path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;frame&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imread&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image_path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;out&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c"&gt;# Write out frame to video&lt;/span&gt;

    &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;video&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;waitKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="mh"&gt;0xFF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;q&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt; &lt;span class="c"&gt;# Hit `q` to exit&lt;/span&gt;
        &lt;span class="k"&gt;break&lt;/span&gt;

&lt;span class="c"&gt;# Release everything if job is finished&lt;/span&gt;
&lt;span class="n"&gt;out&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;release&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;destroyAllWindows&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;The output video is {}&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Sample usage:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;tk-img2video -ext png -o output.mp4
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;It will combine all images with &lt;code&gt;png&lt;/code&gt; file extension into a video file named &lt;code&gt;output.mp4&lt;/code&gt;.&lt;/p&gt;</summary><category term="cv"></category><category term="python"></category></entry><entry><title>Write a python script to define the detecting region by clicking and dragging mouse</title><link href="http://tsaith.github.io/write-a-python-script-to-define-the-detecting-region-by-clicking-and-dragging-mouse.html" rel="alternate"></link><updated>2015-09-30T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-09-30:write-a-python-script-to-define-the-detecting-region-by-clicking-and-dragging-mouse.html</id><summary type="html">&lt;p&gt;In object tracking, usually,
we need to define a rectangular box which contains the object of interest and obtain the box information as follows.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm1.staticflickr.com/565/21640517650_2ae383659d_z.jpg"&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;Box: (80, 86, 263, 312)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;where (80, 86) is the upper-left point of box.
The 263 and 312 are the width and height, respectively.&lt;/p&gt;
&lt;p&gt;And this work can be done by writing a simple script (named &lt;code&gt;tk-detect-box&lt;/code&gt;) as below.&lt;/p&gt;
&lt;p&gt;tk-detect-box:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;#!/usr/local/bin/python3&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;cv2&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;argparse&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Rect&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;height&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;  &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;width&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;height&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;height&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;detect_box&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;win_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;window (hit q to exit)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c"&gt;# Return a box for detection&lt;/span&gt;

    &lt;span class="n"&gt;box_defined&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
    &lt;span class="n"&gt;box&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Rect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;define_box&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;

        &lt;span class="n"&gt;nonlocal&lt;/span&gt; &lt;span class="n"&gt;box_defined&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;box&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;EVENT_LBUTTONDOWN&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;box_defined&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
            &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;
            &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;
            &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;  &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
            &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;height&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;

        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;EVENT_MOUSEMOVE&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;box_defined&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;  &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;
                &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;height&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;

        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;EVENT_LBUTTONUP&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;box_defined&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;do_nothing&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;pass&lt;/span&gt;

    &lt;span class="c"&gt;# set mouse callback&lt;/span&gt;
    &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setMouseCallback&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;win_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;define_box&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="c"&gt;# display the frame from video capture&lt;/span&gt;
        &lt;span class="n"&gt;clone&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="c"&gt;# Starting and ending point of the rectangle&lt;/span&gt;
            &lt;span class="n"&gt;p0&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;p1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;height&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rectangle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clone&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;p0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;p1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;thickness&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;win_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;clone&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;waitKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="mh"&gt;0xFF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;q&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt; &lt;span class="c"&gt;# Hit `q` to exit&lt;/span&gt;
            &lt;span class="k"&gt;break&lt;/span&gt;

    &lt;span class="c"&gt;# Set a mouse callback which does nothing&lt;/span&gt;
    &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setMouseCallback&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;win_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;do_nothing&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;box&lt;/span&gt;


&lt;span class="c"&gt;# Construct the argument parser and parse the arguments&lt;/span&gt;
&lt;span class="n"&gt;ap&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;argparse&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ArgumentParser&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;ap&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_argument&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;-i&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;--image&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;required&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;help&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;image path.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;args&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;vars&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ap&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse_args&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;

&lt;span class="c"&gt;# Arguments&lt;/span&gt;
&lt;span class="n"&gt;image_path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;image&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="c"&gt;# Determine the width and height from the first image&lt;/span&gt;
&lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imread&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image_path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c"&gt;# Create a window&lt;/span&gt;
&lt;span class="n"&gt;win_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;window (hit q to exit)&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;namedWindow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;win_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c"&gt;# Define the detecting box&lt;/span&gt;
&lt;span class="n"&gt;box&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;detect_box&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;win_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c"&gt;# Output box information&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Box: ({}, {}, {}, {}) &amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;box&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;height&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;destroyAllWindows&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;endcodeblock&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The usage of this script is like&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;tk-detect-box -i girl.png
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;It will open the image and let you define a rectangular box by clicking and dragging the mouse.
After hitting &lt;code&gt;q&lt;/code&gt; and it will show out the box information.&lt;/p&gt;</summary><category term="cv"></category><category term="python"></category></entry><entry><title>Define a detection window on image with mouse through Python 3 and OpenCV 3</title><link href="http://tsaith.github.io/define-a-detection-window-on-image-with-mouse-through-python-3-and-opencv-3.html" rel="alternate"></link><updated>2015-09-09T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-09-09:define-a-detection-window-on-image-with-mouse-through-python-3-and-opencv-3.html</id><summary type="html">&lt;p&gt;For image recognition or object tracking, we often need to define a target window to locate the area interested as below.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm1.staticflickr.com/730/21273170171_6f668f25d2_z.jpg"&gt;&lt;/p&gt;
&lt;p&gt;In this post, I would like to demonstrate how to use a mouse to define a rectangular window on the image with python 3 and OpenCV 3.&lt;/p&gt;
&lt;p&gt;The following sample code named &lt;code&gt;target_win.py&lt;/code&gt;, which is slightly modified from the code in a great &lt;a href="http://www.pyimagesearch.com/2015/03/09/capturing-mouse-click-events-with-python-and-opencv/"&gt;post&lt;/a&gt; written by Adrian Rosebrock.
It shows an image for you to define a rectangular region as the target window with your mouse.
After hitting the key &lt;code&gt;c&lt;/code&gt; to confirm your selection, it will write out the starting and ending points of the target window.&lt;/p&gt;
&lt;p&gt;target_win.py:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;cv2&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;skimage&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;define_rect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;    Define a rectangular window by click and drag your mouse.&lt;/span&gt;

&lt;span class="sd"&gt;    Parameters&lt;/span&gt;
&lt;span class="sd"&gt;    ----------&lt;/span&gt;
&lt;span class="sd"&gt;    image: Input image.&lt;/span&gt;
&lt;span class="sd"&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;

    &lt;span class="n"&gt;clone&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;rect_pts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt; &lt;span class="c"&gt;# Starting and ending points&lt;/span&gt;
    &lt;span class="n"&gt;win_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;image&amp;quot;&lt;/span&gt; &lt;span class="c"&gt;# Window name&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;select_points&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;

        &lt;span class="n"&gt;nonlocal&lt;/span&gt; &lt;span class="n"&gt;rect_pts&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;EVENT_LBUTTONDOWN&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;rect_pts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;

        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;EVENT_LBUTTONUP&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;rect_pts&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

            &lt;span class="c"&gt;# draw a rectangle around the region of interest&lt;/span&gt;
            &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rectangle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clone&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;rect_pts&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;rect_pts&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;win_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;clone&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;namedWindow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;win_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setMouseCallback&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;win_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;select_points&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="c"&gt;# display the image and wait for a keypress&lt;/span&gt;
        &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;win_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;clone&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;waitKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="mh"&gt;0xFF&lt;/span&gt;

        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;r&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt; &lt;span class="c"&gt;# Hit &amp;#39;r&amp;#39; to replot the image&lt;/span&gt;
            &lt;span class="n"&gt;clone&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

        &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt; &lt;span class="c"&gt;# Hit &amp;#39;c&amp;#39; to confirm the selection&lt;/span&gt;
            &lt;span class="k"&gt;break&lt;/span&gt;

    &lt;span class="c"&gt;# close the open windows&lt;/span&gt;
    &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;destroyWindow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;win_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;rect_pts&lt;/span&gt;


&lt;span class="c"&gt;# Prepare an image for testing&lt;/span&gt;
&lt;span class="n"&gt;lena&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lena&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="c"&gt;# A image array with RGB color channels&lt;/span&gt;
&lt;span class="n"&gt;lena&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cvtColor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lena&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;COLOR_BGR2RGB&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c"&gt;# Convert RGB to BGR&lt;/span&gt;

&lt;span class="c"&gt;# Points of the target window&lt;/span&gt;
&lt;span class="n"&gt;points&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;define_rect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lena&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;--- target window ---&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Starting point is &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;points&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Ending   point is &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;points&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;In case you haven't installed &lt;a href="http://scikit-image.org/"&gt;skimage&lt;/a&gt; which is a useful library for image processing in python, it can be installed by executing&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;pip3 install scikit-image
&lt;/pre&gt;&lt;/div&gt;</summary><category term="cv"></category><category term="python"></category></entry><entry><title>Record video with Python 3 + OpenCV 3 on OSX</title><link href="http://tsaith.github.io/record-video-with-python-3-opencv-3-on-osx.html" rel="alternate"></link><updated>2015-09-02T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-09-02:record-video-with-python-3-opencv-3-on-osx.html</id><summary type="html">&lt;p&gt;This simple example will demonstrate how to use &lt;code&gt;python&lt;/code&gt; + &lt;code&gt;OpenCV 3&lt;/code&gt; to capture frames from the webcam and save them as a video file of &lt;code&gt;mp4&lt;/code&gt; format on your Mac.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;cv2&lt;/span&gt;

&lt;span class="n"&gt;cap&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;VideoCapture&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c"&gt;# Capture video from camera&lt;/span&gt;

&lt;span class="c"&gt;# Get the width and height of frame&lt;/span&gt;
&lt;span class="n"&gt;width&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cap&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CAP_PROP_FRAME_WIDTH&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;height&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cap&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CAP_PROP_FRAME_HEIGHT&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c"&gt;# Define the codec and create VideoWriter object&lt;/span&gt;
&lt;span class="n"&gt;fourcc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;VideoWriter_fourcc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;mp4v&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c"&gt;# Be sure to use the lower case&lt;/span&gt;
&lt;span class="n"&gt;out&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;VideoWriter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;output.mp4&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fourcc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;20.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;height&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cap&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;isOpened&lt;/span&gt;&lt;span class="p"&gt;()):&lt;/span&gt;
    &lt;span class="n"&gt;ret&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cap&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;ret&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;frame&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;flip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="c"&gt;# write the flipped frame&lt;/span&gt;
        &lt;span class="n"&gt;out&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;frame&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;waitKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="mh"&gt;0xFF&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;q&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt; &lt;span class="c"&gt;# Hit `q` to exit&lt;/span&gt;
            &lt;span class="k"&gt;break&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;break&lt;/span&gt;

&lt;span class="c"&gt;# Release everything if job is finished&lt;/span&gt;
&lt;span class="n"&gt;out&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;release&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;cap&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;release&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;destroyAllWindows&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;After running the code, you should see a pop-up window displaying the flipped video captured by your webcam.
Just hit the key &lt;code&gt;q&lt;/code&gt; to terminate the execution.&lt;/p&gt;</summary><category term="cv"></category></entry><entry><title>Manage project packages with virtualenv</title><link href="http://tsaith.github.io/manage-project-packages-with-virtualenv.html" rel="alternate"></link><updated>2015-09-01T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-09-01:manage-project-packages-with-virtualenv.html</id><summary type="html">&lt;p&gt;While developing two or more projects at the same time,
it is unavoidable to switch among projects which may use the same python package of different version.
In order to resolve the headache of package management,
&lt;a href="https://virtualenv.pypa.io/en/latest/"&gt;virtualenv&lt;/a&gt; is designed to create isolated python environments.&lt;/p&gt;
&lt;h3&gt;Install virtualenv&lt;/h3&gt;
&lt;p&gt;Open your terminal and execute&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;pip3 install virtualenv virtualenvwrapper
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;where &lt;a href="https://virtualenvwrapper.readthedocs.org/en/latest/"&gt;virtualenvwrapper&lt;/a&gt; is a set of extension of &lt;code&gt;virtualenv&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Set environment variables&lt;/h3&gt;
&lt;p&gt;In &lt;code&gt;~/.profile&lt;/code&gt;, add the lines below :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="x"&gt;export VIRTUALENVWRAPPER_PYTHON=/usr/local/bin/python3&lt;/span&gt;
&lt;span class="x"&gt;export WORKON_HOME=&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;HOME&lt;/span&gt;&lt;span class="x"&gt;/.virtualenvs&lt;/span&gt;
&lt;span class="x"&gt;source /usr/local/bin/virtualenvwrapper.sh&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Followed by reloading &lt;code&gt;~/.profile&lt;/code&gt; :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;source ~/.profile
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Some examples of usage&lt;/h3&gt;
&lt;p&gt;To create a new project environment named &lt;code&gt;vision&lt;/code&gt; with python 3.4 support :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;mkvirtualenv -p /usr/local/bin/python3.4 vision
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;In case we want to install &lt;a href="http://ipython.org/"&gt;ipython&lt;/a&gt; under &lt;code&gt;vision&lt;/code&gt; environment :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;pip install ipython[notebook]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;To leave the environment of current project :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;deactivate
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;To work on a existed project :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;workon project_name
&lt;/pre&gt;&lt;/div&gt;</summary><category term="python"></category></entry><entry><title>Install OpenCV 3 for Python 3 on OSX</title><link href="http://tsaith.github.io/install-opencv-3-for-python-3-on-osx.html" rel="alternate"></link><updated>2015-08-31T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-08-31:install-opencv-3-for-python-3-on-osx.html</id><summary type="html">&lt;p&gt;First, install OpenCV 3 with homebrew as&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;brew install opencv3 --with-python3 --with-contrib
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;with &lt;code&gt;--with-contrib&lt;/code&gt; flag,
&lt;a href="https://github.com/itseez/opencv_contrib"&gt;opencv_contrib&lt;/a&gt; packages containing algorithms that are either patented or in experimental development will also be installed.&lt;/p&gt;
&lt;p&gt;Second, set the environment variable &lt;code&gt;PYTHONPATH&lt;/code&gt; to include the path of &lt;code&gt;cv2.so&lt;/code&gt; which is a python binding to OpenCV.&lt;/p&gt;
&lt;p&gt;There are several ways to set &lt;code&gt;PYTHONPATH&lt;/code&gt;, one way is to add the following line to &lt;code&gt;~/.profile&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="x"&gt;export PYTHONPATH=&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;PYTHONPATH&lt;/span&gt;&lt;span class="x"&gt;:/usr/local/Cellar/opencv3/3.0.0/lib/python3.4/site-packages&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Please note that the name of python directry depends on which python version you use, in my case is &lt;code&gt;python3.4&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Be sure to execute &lt;code&gt;source ~/.profile&lt;/code&gt; or restart your terminal to update &lt;code&gt;PYTHONPATH&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now, let's check if our python 3 can import the module of OpenCV in the terminal.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;python3&lt;/span&gt;
&lt;span class="n"&gt;Python&lt;/span&gt; &lt;span class="mf"&gt;3.4&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;default&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Jun&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt; &lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;19&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;57&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;GCC&lt;/span&gt; &lt;span class="mf"&gt;4.2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;Compatible&lt;/span&gt; &lt;span class="n"&gt;Apple&lt;/span&gt; &lt;span class="n"&gt;LLVM&lt;/span&gt; &lt;span class="mf"&gt;6.0&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clang&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;600.0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;57&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="n"&gt;darwin&lt;/span&gt;
&lt;span class="n"&gt;Type&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;help&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;copyright&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;credits&amp;quot;&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;license&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;more&lt;/span&gt; &lt;span class="n"&gt;information&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;cv2&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;cv2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__version__&lt;/span&gt;
&lt;span class="s"&gt;&amp;#39;3.0.0&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="cv"></category></entry><entry><title>A quick demo to recognizing hand-written digits with logistic regression</title><link href="http://tsaith.github.io/a-quick-demo-to-recognizing-hand-written-digits-with-logistic-regression.html" rel="alternate"></link><updated>2015-08-23T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-08-23:a-quick-demo-to-recognizing-hand-written-digits-with-logistic-regression.html</id><summary type="html">&lt;p&gt;This article will quickly demonstrate how to use the &lt;a href="http://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html#sklearn.linear_model.LogisticRegression"&gt;Logistic regression&lt;/a&gt; to recognize hand-written digits.&lt;/p&gt;
&lt;p&gt;The &lt;a href="http://scikit-learn.org/stable/index.html"&gt;scikit-learn&lt;/a&gt; package is required in the example shown later. If you haven't installed it, please executing&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;pip install scikit-learn
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and make sure that your IPython is ready to go.&lt;/p&gt;
&lt;p&gt;In this example, we want to fit a model of logistic regression with training data and labels.
After that, the model can be used to predict the label corresponding to each instance of testing data.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;matplotlib&lt;/span&gt; &lt;span class="n"&gt;inline&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;matplotlib.pyplot&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;plt&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;sklearn&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;datasets&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;linear_model&lt;/span&gt;

&lt;span class="n"&gt;digits&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datasets&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;load_digits&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;train_set_x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;:]&lt;/span&gt;      &lt;span class="c"&gt;# Training set x&lt;/span&gt;
&lt;span class="n"&gt;train_set_y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="p"&gt;[:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;       &lt;span class="c"&gt;# Training set y (labels)&lt;/span&gt;
&lt;span class="n"&gt;test_set_x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;:,&lt;/span&gt; &lt;span class="p"&gt;:]&lt;/span&gt;       &lt;span class="c"&gt;# Test set x&lt;/span&gt;
&lt;span class="n"&gt;test_set_y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;:]&lt;/span&gt;        &lt;span class="c"&gt;# Test set y (labels)&lt;/span&gt;
&lt;span class="n"&gt;test_set_images&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;images&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;:]&lt;/span&gt;   &lt;span class="c"&gt;# Test set images&lt;/span&gt;

&lt;span class="n"&gt;clf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;linear_model&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;LogisticRegression&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="c"&gt;# Logistic regression&lt;/span&gt;
&lt;span class="n"&gt;clf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;train_set_x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;train_set_y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;       &lt;span class="c"&gt;# Fitting model&lt;/span&gt;

&lt;span class="n"&gt;predicted_y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;clf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;predict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;test_set_x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Predicted y = &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;predicted_y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c"&gt;# Predicted labels&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Test set  y = &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;test_set_y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="c"&gt;# Expected labels&lt;/span&gt;

&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;test_set_images&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;cmap&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gray&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c"&gt;# Show the last image in the test set&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and the output is as&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm1.staticflickr.com/634/20189529253_c63a2b993d_c.jpg"&gt;&lt;/p&gt;
&lt;p&gt;As observed, the predicted labels are consistent with the expected ones.
The last label is 8 as we see.&lt;/p&gt;</summary><category term="cv"></category><category term="python"></category></entry><entry><title>Automatically reload modules in IPython</title><link href="http://tsaith.github.io/automatically-reload-modules-in-ipython.html" rel="alternate"></link><updated>2015-08-23T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-08-23:automatically-reload-modules-in-ipython.html</id><summary type="html">&lt;p&gt;IPython provides an extension &lt;a href="https://ipython.org/ipython-doc/dev/config/extensions/autoreload.html"&gt;autoreload&lt;/a&gt; to reload the modules automatically.
This is especially useful because we don't want to manually reload modules for testing when developing new functions.&lt;/p&gt;
&lt;p&gt;Just execute the following lines within IPython, all modules will be automatically reloaded before executing your code.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;load_ext&lt;/span&gt; &lt;span class="n"&gt;autoreload&lt;/span&gt;
&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;autoreload&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="python"></category></entry><entry><title>Visualize data with IPython</title><link href="http://tsaith.github.io/visualize-data-with-ipython.html" rel="alternate"></link><updated>2015-08-23T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-08-23:visualize-data-with-ipython.html</id><summary type="html">&lt;p&gt;This post will show how to visualize data with ipython.&lt;/p&gt;
&lt;h3&gt;matplotlib&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;install: &lt;code&gt;pip install matplotlib&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With &lt;a href="http://matplotlib.org/"&gt;matplotlib&lt;/a&gt;,
we are able to make inline plots by setting&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;matplotlib&lt;/span&gt; &lt;span class="n"&gt;inline&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;matplotlib.pyplot&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;plt&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;e.g.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm6.staticflickr.com/5769/20180189424_94f41513fe_c.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;mpld3&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;install: &lt;code&gt;pip install matplotlib&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With &lt;a href="http://mpld3.github.io/"&gt;mpld3&lt;/a&gt;, it is handy to zoom in/out or shift the plot through the lower left icons.&lt;/p&gt;
&lt;p&gt;To use mpld3, the following lines are required.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;mpld3&lt;/span&gt;
&lt;span class="n"&gt;mpld3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;enable_notebook&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;e.g.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm6.staticflickr.com/5750/20802774815_feb20ff153_c.jpg"&gt;&lt;/p&gt;</summary><category term="python"></category></entry><entry><title>Set up the python environment for computer vision</title><link href="http://tsaith.github.io/set-up-the-python-environment-for-computer-vision.html" rel="alternate"></link><updated>2015-08-01T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-08-01:set-up-the-python-environment-for-computer-vision.html</id><summary type="html">&lt;p&gt;Please install the following packages to set up the python
environment for computer vision.&lt;/p&gt;
&lt;h3&gt;&lt;a href="https://www.python.org/"&gt;Python&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;The compiler of Python 3.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;brew install python3&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;&lt;a href="http://www.numpy.org/"&gt;Numpy&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;A library for numerical calculation.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pip install numpy&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;&lt;a href="http://www.scipy.org/index.html"&gt;Scipy&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;A library for scientific computing.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pip install scipy&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;&lt;a href="http://matplotlib.org/"&gt;Matplotlib&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Powerful library to make plots.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pip install matplotlib&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;&lt;a href="http://ipython.org/"&gt;Ipython&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;A browser-based notebook for interactive computing.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pip install ipython[notebook]&lt;/li&gt;
&lt;li&gt;pip install pyzmq jinja2 tornado jsonschema mpld3&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;&lt;a href="https://pypi.python.org/pypi/ipdb"&gt;Ipdb&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;IPython-enabled python debuger.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pip install ipdb&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;&lt;a href="http://scikit-learn.org/stable/"&gt;Scikit-learn&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Machine Learning library.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pip install scikit-learn&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;&lt;a href="http://scikit-image.org/"&gt;Scikit-image&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Image processing library.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pip install scikit-image&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;&lt;a href="http://pandas.pydata.org/"&gt;Pandas&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;A library for data analysis.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pip install pandas&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;&lt;a href="http://pytest.org/latest/index.html"&gt;pytest&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;A mature full-featured Python testing tool.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pip install pytest&lt;/li&gt;
&lt;/ul&gt;</summary><category term="cv"></category><category term="python"></category></entry><entry><title>Create an IAM user for ElasticBeanstalk</title><link href="http://tsaith.github.io/create-an-iam-user-for-elasticbeanstalk.html" rel="alternate"></link><updated>2015-05-11T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-05-11:create-an-iam-user-for-elasticbeanstalk.html</id><summary type="html">&lt;p&gt;To use AWS &lt;a href="http://docs.aws.amazon.com/elasticbeanstalk"&gt;ElasticBeanstalk&lt;/a&gt;,
we have to create a &lt;a href="http://aws.amazon.com/iam/"&gt;IAM&lt;/a&gt; user first.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;After logging in AWS, go to &lt;code&gt;IAM&lt;/code&gt; under &lt;code&gt;Services&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Click &lt;code&gt;Create New Group&lt;/code&gt; under &lt;code&gt;Groups&lt;/code&gt; and specify a group name (here, assumed as &lt;code&gt;ElasticBeanstalkFullAccess&lt;/code&gt;).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Attach policy &lt;code&gt;AWSElasticBeanstalkFullAccess&lt;/code&gt; to the group &lt;code&gt;ElasticBeanstalkFullAccess&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Click &lt;code&gt;Create New Users&lt;/code&gt; under &lt;code&gt;Users&lt;/code&gt; to create a new user supposed to use ElasticBeanstalk. During the process, it will prompt you to download security credentials composed by &lt;code&gt;AWS_ACCESS_KEY_ID&lt;/code&gt; and &lt;code&gt;AWS_SECRET_ACCESS_KEY&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Under &lt;code&gt;Users&lt;/code&gt;, add the user to the group &lt;code&gt;ElasticBeanstalkFullAccess&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;From now on, you should be able to use ElasticBeanstalk with the security credentials downloaded.&lt;/p&gt;</summary><category term="aws"></category></entry><entry><title>Set up a postgres-backed rails app with ElasticBeanstalk</title><link href="http://tsaith.github.io/set-up-a-postgres-backed-rails-app-with-elasticbeanstalk.html" rel="alternate"></link><updated>2015-05-11T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-05-11:set-up-a-postgres-backed-rails-app-with-elasticbeanstalk.html</id><summary type="html">&lt;p&gt;This article will describe the way I set up a Rails app with ElasticBeanstalk and PostgresSQL.
Here Rails 4.1 based on &lt;a href="https://github.com/puma/puma"&gt;Puma&lt;/a&gt; 2.10.2 and &lt;a href="http://nginx.org/"&gt;Nginx&lt;/a&gt; 1.6.2 is demonstrated.&lt;/p&gt;
&lt;h3&gt;Install ElasticBeanstalk CLI&lt;/h3&gt;
&lt;p&gt;AWS provides both &lt;a href="http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/GettingStarted.UsingAEB.html#GettingStarted.UsingAEB.console"&gt;Management Console&lt;/a&gt; and &lt;a href="http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/command-reference-get-started.html"&gt;EB CLI&lt;/a&gt; to work with ElasticBeanstalk.&lt;/p&gt;
&lt;p&gt;The CLI requires python and is easier to perform some features of ElasticBeanstalk.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;pip install awsebcli
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Create an IAM user&lt;/h3&gt;
&lt;p&gt;ElasticBeanstalk will require an IAM user to create app environment.
In case you have no idea how to create an IAM user,
please view this &lt;a href="create-an-iam-user-for-elasticbeanstalk.markdown"&gt;post&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Initialize a git repository&lt;/h3&gt;
&lt;p&gt;Here &lt;code&gt;agileorder&lt;/code&gt; is the name of my app.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd &lt;/span&gt;agileorder
&lt;span class="nv"&gt;$ &lt;/span&gt;git init
&lt;span class="nv"&gt;$ &lt;/span&gt;git add -A
&lt;span class="nv"&gt;$ &lt;/span&gt;git commit -m &lt;span class="s2"&gt;&amp;quot;Initial commit&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Initialize EB environment&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;eb init

Select a default region
1&lt;span class="o"&gt;)&lt;/span&gt; us-east-1 : US East &lt;span class="o"&gt;(&lt;/span&gt;N. Virginia&lt;span class="o"&gt;)&lt;/span&gt;
2&lt;span class="o"&gt;)&lt;/span&gt; us-west-1 : US West &lt;span class="o"&gt;(&lt;/span&gt;N. California&lt;span class="o"&gt;)&lt;/span&gt;
3&lt;span class="o"&gt;)&lt;/span&gt; us-west-2 : US West &lt;span class="o"&gt;(&lt;/span&gt;Oregon&lt;span class="o"&gt;)&lt;/span&gt;
4&lt;span class="o"&gt;)&lt;/span&gt; eu-west-1 : EU &lt;span class="o"&gt;(&lt;/span&gt;Ireland&lt;span class="o"&gt;)&lt;/span&gt;
5&lt;span class="o"&gt;)&lt;/span&gt; eu-central-1 : EU &lt;span class="o"&gt;(&lt;/span&gt;Frankfurt&lt;span class="o"&gt;)&lt;/span&gt;
6&lt;span class="o"&gt;)&lt;/span&gt; ap-southeast-1 : Asia Pacific &lt;span class="o"&gt;(&lt;/span&gt;Singapore&lt;span class="o"&gt;)&lt;/span&gt;
7&lt;span class="o"&gt;)&lt;/span&gt; ap-southeast-2 : Asia Pacific &lt;span class="o"&gt;(&lt;/span&gt;Sydney&lt;span class="o"&gt;)&lt;/span&gt;
8&lt;span class="o"&gt;)&lt;/span&gt; ap-northeast-1 : Asia Pacific &lt;span class="o"&gt;(&lt;/span&gt;Tokyo&lt;span class="o"&gt;)&lt;/span&gt;
9&lt;span class="o"&gt;)&lt;/span&gt; sa-east-1 : South America &lt;span class="o"&gt;(&lt;/span&gt;Sao Paulo&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;(&lt;/span&gt;default is 3&lt;span class="o"&gt;)&lt;/span&gt;: 8

Select an application to use
1&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; Create new Application &lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;(&lt;/span&gt;default is 1&lt;span class="o"&gt;)&lt;/span&gt;: 1

Enter Application Name: agileorder

It appears you are using Ruby. Is this correct?
&lt;span class="o"&gt;(&lt;/span&gt;y/n&lt;span class="o"&gt;)&lt;/span&gt;: y

Select a platform version.
1&lt;span class="o"&gt;)&lt;/span&gt; Ruby 2.2 &lt;span class="o"&gt;(&lt;/span&gt;Puma&lt;span class="o"&gt;)&lt;/span&gt;
2&lt;span class="o"&gt;)&lt;/span&gt; Ruby 2.1 &lt;span class="o"&gt;(&lt;/span&gt;Puma&lt;span class="o"&gt;)&lt;/span&gt;
3&lt;span class="o"&gt;)&lt;/span&gt; Ruby 2.0 &lt;span class="o"&gt;(&lt;/span&gt;Puma&lt;span class="o"&gt;)&lt;/span&gt;
4&lt;span class="o"&gt;)&lt;/span&gt; Ruby 2.2 &lt;span class="o"&gt;(&lt;/span&gt;Passenger Standalone&lt;span class="o"&gt;)&lt;/span&gt;
5&lt;span class="o"&gt;)&lt;/span&gt; Ruby 2.1 &lt;span class="o"&gt;(&lt;/span&gt;Passenger Standalone&lt;span class="o"&gt;)&lt;/span&gt;
6&lt;span class="o"&gt;)&lt;/span&gt; Ruby 2.0 &lt;span class="o"&gt;(&lt;/span&gt;Passenger Standalone&lt;span class="o"&gt;)&lt;/span&gt;
7&lt;span class="o"&gt;)&lt;/span&gt; Ruby 1.9.3
&lt;span class="o"&gt;(&lt;/span&gt;default is 1&lt;span class="o"&gt;)&lt;/span&gt;: 2
Do you want to &lt;span class="nb"&gt;set &lt;/span&gt;up SSH &lt;span class="k"&gt;for&lt;/span&gt; your instances?
&lt;span class="o"&gt;(&lt;/span&gt;y/n&lt;span class="o"&gt;)&lt;/span&gt;: n
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Please note that &lt;code&gt;eb init&lt;/code&gt; will add &lt;code&gt;.elasticbeanstalk&lt;/code&gt; to the &lt;code&gt;.gitignore&lt;/code&gt;.
Be sure to commit &lt;code&gt;.gitignore&lt;/code&gt; once again.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;git add .gitignore
&lt;span class="nv"&gt;$ &lt;/span&gt;git commit -m &lt;span class="s2"&gt;&amp;quot;Update .gitignore&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Configure EB to install postgresql-devel&lt;/h1&gt;
&lt;p&gt;Under project directory, create &lt;code&gt;.ebextensions/packages.config&lt;/code&gt; with following content.&lt;/p&gt;
&lt;p _="%" endcodeblock="endcodeblock"&gt;{% codeblock .ebextensions/packages.config lang:yaml %}
packages:
  yum:
    postgresql93-devel: []&lt;/p&gt;
&lt;p&gt;Then add the &lt;code&gt;.ebextensions&lt;/code&gt; to repository&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git add .ebextensions
git commit -m &amp;quot;Add .ebextensions&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Create environment&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;eb create agileorder-env
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;After waiting for a while, the last part of output messages are shown as&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;INFO&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Application&lt;/span&gt; &lt;span class="n"&gt;available&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;agileorder&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;jmcrf7dbdr&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;elasticbeanstalk&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;com&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;span class="n"&gt;ERROR&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Create&lt;/span&gt; &lt;span class="n"&gt;environment&lt;/span&gt; &lt;span class="n"&gt;operation&lt;/span&gt; &lt;span class="k"&gt;is&lt;/span&gt; &lt;span class="n"&gt;complete&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;but&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;errors&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;For&lt;/span&gt; &lt;span class="n"&gt;more&lt;/span&gt; &lt;span class="n"&gt;information&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;see&lt;/span&gt; &lt;span class="n"&gt;troubleshooting&lt;/span&gt; &lt;span class="n"&gt;documentation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;span class="n"&gt;INFO&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Adding&lt;/span&gt; &lt;span class="n"&gt;instance&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;i-72db7287&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;your&lt;/span&gt; &lt;span class="n"&gt;environment&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;After checking logs, I figured out the errors come from the missing environment variables used in my app.&lt;/p&gt;
&lt;h3&gt;Set up environment variables&lt;/h3&gt;
&lt;p&gt;Under &lt;code&gt;Software Configuration&lt;/code&gt; of &lt;code&gt;Elastic Beanstalk&lt;/code&gt; of &lt;code&gt;AWS Management Console&lt;/code&gt;,
add essential environments used in app like &lt;code&gt;SECRET_KEY_BASE&lt;/code&gt;, &lt;code&gt;SENTRY_DSN&lt;/code&gt;, ...etc.&lt;/p&gt;
&lt;h3&gt;Create a RDS instance&lt;/h3&gt;
&lt;p&gt;Under &lt;code&gt;Data Tier&lt;/code&gt; of &lt;code&gt;Elastic Beanstalk&lt;/code&gt; of &lt;code&gt;AWS Management Console&lt;/code&gt;,
create a new &lt;a href="http://aws.amazon.com/rds/"&gt;RDS&lt;/a&gt; database and set the DB engine to &lt;code&gt;postgres&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://c1.staticflickr.com/9/8693/17514909495_6704f394e1_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;After setting &lt;code&gt;Master Username&lt;/code&gt; and &lt;code&gt;Master Password&lt;/code&gt;, then click &lt;code&gt;Save&lt;/code&gt;, environment variables will have been added to EB environment automatically.&lt;/p&gt;
&lt;h3&gt;Configure database.yml to work with RDS instance&lt;/h3&gt;
&lt;p&gt;Under project directory, modify the &lt;code&gt;database.yml&lt;/code&gt; as&lt;/p&gt;
&lt;p&gt;config/database.yml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nn"&gt;...&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;skip the parts of development and test modes ...&lt;/span&gt;

&lt;span class="l-Scalar-Plain"&gt;production&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;adapter&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;postgresql&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;encoding&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;unicode&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;database&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;&amp;lt;%= ENV[&amp;#39;RDS_DB_NAME&amp;#39;] %&amp;gt;&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;username&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;&amp;lt;%= ENV[&amp;#39;RDS_USERNAME&amp;#39;] %&amp;gt;&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;password&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;&amp;lt;%= ENV[&amp;#39;RDS_PASSWORD&amp;#39;] %&amp;gt;&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;host&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;&amp;lt;%= ENV[&amp;#39;RDS_HOSTNAME&amp;#39;] %&amp;gt;&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;port&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;&amp;lt;%= ENV[&amp;#39;RDS_PORT&amp;#39;] %&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Commit the &lt;code&gt;database.yml&lt;/code&gt; to repository&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git add -A
git commit -m &amp;quot;Update database.yml&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Finally, deploy the app to AWS.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;eb deploy
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;To open the app URL in a browser, simply execute&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;eb open
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>Wait for Ajax with Capybara Automatically</title><link href="http://tsaith.github.io/wait-for-ajax-with-capybara-automatically.html" rel="alternate"></link><updated>2015-05-06T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-05-06:wait-for-ajax-with-capybara-automatically.html</id><summary type="html">&lt;p&gt;While writing feature tests involved in Ajax, we have to resolve race condition from time to time. Let's see the following code as an example.&lt;/p&gt;
&lt;p&gt;spec/features/admin_deletes_product_spec.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;spec_helper.rb&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;feature&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Admin deletes product category&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="ss"&gt;js&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;allow_url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fonts.googleapis.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;clear_email&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="n"&gt;scenario&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;when the action is successful&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;category&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:product_category&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;product&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:product&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;category&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;category&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;cloud&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:admin&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;sign_in&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cloud&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;visit&lt;/span&gt; &lt;span class="n"&gt;admin_products_path&lt;/span&gt;
    &lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;a[id=&amp;#39;delete_product_&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;product&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;#39;]&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;click&lt;/span&gt;

    &lt;span class="c1"&gt;# Without this line, there will be a race condition between deleting product and database query&lt;/span&gt;
    &lt;span class="n"&gt;wait_for_ajax&lt;/span&gt;

    &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;Product&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;eq&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;where the function &lt;code&gt;wait_for_ajax&lt;/code&gt; is used to make sure the product has been deleted before querying the count of products in database.&lt;/p&gt;
&lt;p&gt;spec/support/wait_for_ajax.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;module&lt;/span&gt; &lt;span class="nn"&gt;WaitForAjax&lt;/span&gt;
  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;wait_for_ajax&lt;/span&gt;
    &lt;span class="no"&gt;Timeout&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;Capybara&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;default_wait_time&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="kp"&gt;loop&lt;/span&gt; &lt;span class="k"&gt;until&lt;/span&gt; &lt;span class="n"&gt;finished_all_ajax_requests?&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;finished_all_ajax_requests?&lt;/span&gt;
    &lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;evaluate_script&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;jQuery.active&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;zero?&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;More discussion about this issue can be found in Thoughtbot's &lt;a href="https://robots.thoughtbot.com/automatically-wait-for-ajax-with-capybara"&gt;post&lt;/a&gt;.&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>Create a user account to deploy production on ubuntu</title><link href="http://tsaith.github.io/create-a-user-account-to-deploy-production-on-ubuntu.html" rel="alternate"></link><updated>2015-03-30T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-03-30:create-a-user-account-to-deploy-production-on-ubuntu.html</id><summary type="html">&lt;p&gt;On production server, it is a good practice to create a user account (named &lt;code&gt;deployer&lt;/code&gt;) which is supposed to take care jobs of deployment. The steps are described as following.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Log in the server as &lt;code&gt;root&lt;/code&gt; via &lt;code&gt;ssh&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;ssh SERVER_IP
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Add new user named &lt;code&gt;deployer&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;adduser deployer
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Add &lt;code&gt;deployer&lt;/code&gt; to group &lt;code&gt;sudo&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;gpasswd -a deployer sudo
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Switch from &lt;code&gt;root&lt;/code&gt; to &lt;code&gt;deployer&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;su -l deployer
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Create &lt;code&gt;.ssh&lt;/code&gt; directory and set proper access permission&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;mkdir ~/.ssh
chmod 700 ~/.ssh
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Copy the content of &lt;code&gt;id_rsa.pub&lt;/code&gt; and paste it to &lt;code&gt;authorized_keys&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;On local computer:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;cat ~/.ssh/id_rsa.pub | pbcopy
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;On remote server:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;vi ~/.ssh/authorized_keys
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and paste the content of public key.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Set proper access permission on &lt;code&gt;authorized_keys&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;chmod 600 .ssh/authorized_keys
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Return to &lt;code&gt;root&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;exit
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Disable &lt;code&gt;root&lt;/code&gt; login through SSH&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;vi /etc/ssh/sshd_config
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and modify the line of &lt;code&gt;PermitRootLogin&lt;/code&gt; as&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;PermitRootLogin no
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Restart SSH&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;service ssh restart
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Open a new terminal on local computer and log in the server as &lt;code&gt;deployer&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;ssh deployer@SERVER_IP
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Let &lt;code&gt;deployer&lt;/code&gt; can use &lt;code&gt;sudo&lt;/code&gt; without password&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo visudo
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Add following line at the end of file&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;deployer ALL=(ALL) NOPASSWD: ALL
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Execute &lt;code&gt;Ctrl-x&lt;/code&gt; -&amp;gt; &lt;code&gt;Y&lt;/code&gt; -&amp;gt; &lt;code&gt;Enter&lt;/code&gt; to save and exit file.&lt;/p&gt;</summary><category term="linux"></category></entry><entry><title>Install rbenv and rails on ubuntu</title><link href="http://tsaith.github.io/install-rbenv-and-rails-on-ubuntu.html" rel="alternate"></link><updated>2015-03-30T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-03-30:install-rbenv-and-rails-on-ubuntu.html</id><summary type="html">&lt;p&gt;This article will describe how to install &lt;a href="https://github.com/sstephenson/rbenv"&gt;rbenv&lt;/a&gt;, &lt;a href="http://rubyonrails.org/"&gt;rails&lt;/a&gt; and some useful libraries on a production server of &lt;a href="http://www.ubuntu.com/"&gt;ubuntu&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Assuming that, on a fresh ubuntu, we have just built and logged in with a user account named &lt;code&gt;deployer&lt;/code&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Update apt-get&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo apt-get update
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Install gcc, make and curl&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo apt-get install gcc make curl
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Install git&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo apt-get install git git-core
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Configure git&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git config --global user.name &amp;quot;Your Name&amp;quot;
git config --global user.email &amp;quot;Your Email Address&amp;quot;
git config --global core.editor vi
git config --global color.ui true
git config --global color.branch auto
git config --global color.diff auto
git config --global color.status auto
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Install libraries required by rbenv&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo apt-get install autoconf bison build-essential libssl-dev libyaml-dev libreadline6-dev zlib1g-dev libncurses5-dev libffi-dev libgdbm3 libgdbm-dev
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Install rbenv and the ruby versions builder&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="x"&gt;git clone git://github.com/sstephenson/rbenv.git .rbenv&lt;/span&gt;
&lt;span class="x"&gt;echo &amp;#39;export PATH=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;HOME&lt;/span&gt;&lt;span class="x"&gt;/.rbenv/bin:&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="x"&gt;&amp;quot;&amp;#39; &amp;gt;&amp;gt; ~/.bashrc&lt;/span&gt;
&lt;span class="x"&gt;echo &amp;#39;eval &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;$(&lt;/span&gt;&lt;span class="err"&gt;rbenv&lt;/span&gt; &lt;span class="err"&gt;init&lt;/span&gt; &lt;span class="err"&gt;-&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="x"&gt;&amp;quot;&amp;#39; &amp;gt;&amp;gt; ~/.bashrc&lt;/span&gt;
&lt;span class="x"&gt;git clone git://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build&lt;/span&gt;
&lt;span class="x"&gt;echo &amp;#39;export PATH=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;HOME&lt;/span&gt;&lt;span class="x"&gt;/.rbenv/plugins/ruby-build/bin:&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="x"&gt;&amp;quot;&amp;#39; &amp;gt;&amp;gt; ~/.bashrc&lt;/span&gt;
&lt;span class="x"&gt;git clone https://github.com/sstephenson/rbenv-gem-rehash.git ~/.rbenv/plugins/rbenv-gem-rehash&lt;/span&gt;
&lt;span class="x"&gt;git clone https://github.com/ianheggie/rbenv-binstubs.git ~/.rbenv/plugins/rbenv-binstubs&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Add path for binstubs&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="x"&gt;echo &amp;#39;PATH=&amp;quot;./bin:&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="x"&gt;&amp;quot;&amp;#39; &amp;gt;&amp;gt; ~/.bashrc&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Relogin the server&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;exit
ssh deployer@SERVER_IP
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Install Ruby version&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;rbenv install 2.1.5
rbenv global 2.1.5
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Install bundler&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;gem install bundler
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Install gems without documents&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;echo &amp;#39;gem: --no-rdoc --no-ri&amp;#39; &amp;gt;&amp;gt; ~/.gemrc
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Install rails&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;gem install rails -v 4.1.1
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Install &lt;a href="https://nodejs.org/"&gt;Node.js&lt;/a&gt; (javascript runtime) which is required to compile assests of rails&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo apt-add-repository -y ppa:chris-lea/node.js
sudo apt-get -y update
sudo apt-get -y install nodejs
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Install qt lib for &lt;code&gt;capybara-webkit&lt;/code&gt;[https://github.com/thoughtbot/capybara-webkit]&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo apt-get install libqt4-dev
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Install &lt;a href="http://www.imagemagick.org/"&gt;ImageMagick&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo apt-get install imagemagick
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Install &lt;a href="http://www.postgresql.org/"&gt;PostgreSQL&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo apt-get install postgresql libpq-dev
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Execute the following command under project directory to make binstubs work&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;bundle install --binstubs .bundle/bin
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Set environment variables&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo vi /etc/environment
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and add the following lines:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;RAILS_ENV=production
RACK_ENV=production
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Create a new user named &lt;code&gt;deployer&lt;/code&gt; as superuser within PostgreSQL&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo su -l postgres
createuser deployer --pwprompt
psql
ALTER USER deployer WITH SUPERUSER;
\q
exit
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>Install Sidekiq and Redis on Ubuntu</title><link href="http://tsaith.github.io/install-sidekiq-and-redis-on-ubuntu.html" rel="alternate"></link><updated>2015-03-30T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-03-30:install-sidekiq-and-redis-on-ubuntu.html</id><summary type="html">&lt;p&gt;&lt;a href="http://sidekiq.org/"&gt;Sidekiq&lt;/a&gt; is a efficient tool to take care backgroud jobs of rails and reuired the support of &lt;a href="http://redis.io/"&gt;Redis&lt;/a&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Switch to &lt;code&gt;root&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo su -l
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Install Redis&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;apt-get install redis-server
service redis-server restart
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Write a init script for Sidekiq&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Create &lt;code&gt;/etc/init.d/sidekiq&lt;/code&gt; with following content:&lt;/p&gt;
&lt;p&gt;/etc/init.d/sidekiq:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="c"&gt;# File: /etc/init.d/sidekiq&lt;/span&gt;

&lt;span class="c"&gt;### BEGIN INIT INFO&lt;/span&gt;
&lt;span class="c"&gt;# Provides:          unicorn&lt;/span&gt;
&lt;span class="c"&gt;# Required-Start:    $local_fs $remote_fs $network $syslog&lt;/span&gt;
&lt;span class="c"&gt;# Required-Stop:     $local_fs $remote_fs $network $syslog&lt;/span&gt;
&lt;span class="c"&gt;# Default-Start:     2 3 4 5&lt;/span&gt;
&lt;span class="c"&gt;# Default-Stop:      0 1 6&lt;/span&gt;
&lt;span class="c"&gt;# Short-Description: starts the sidekiq&lt;/span&gt;
&lt;span class="c"&gt;# Description:       starts sidekiq&lt;/span&gt;
&lt;span class="c"&gt;### END INIT INFO&lt;/span&gt;

&lt;span class="c"&gt;# Feel free to change any of the following variables for your app:&lt;/span&gt;

&lt;span class="c"&gt;# Set user&lt;/span&gt;
&lt;span class="nv"&gt;USER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;deployer
&lt;span class="c"&gt;# Set app name&lt;/span&gt;
&lt;span class="nv"&gt;APP_NAME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;myflix

&lt;span class="c"&gt;# R.eplace [PATH_TO_RAILS_ROOT_FOLDER] with your application&amp;#39;s path.&lt;/span&gt;
&lt;span class="nv"&gt;APP_ROOT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/home/&lt;span class="nv"&gt;$USER&lt;/span&gt;/apps/&lt;span class="nv"&gt;$APP_NAME&lt;/span&gt;/current
&lt;span class="c"&gt;# Set the environment. This can be changed to staging or development for staging&lt;/span&gt;
&lt;span class="c"&gt;# servers.&lt;/span&gt;
&lt;span class="nv"&gt;RAILS_ENV&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;production
&lt;span class="nv"&gt;PID_FILE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$APP_ROOT&lt;/span&gt;/tmp/sidekiq.pid
&lt;span class="nv"&gt;LOG_FILE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$APP_ROOT&lt;/span&gt;/log/sidekiq.log
&lt;span class="c"&gt;# A simple description for service output.&lt;/span&gt;
&lt;span class="nv"&gt;DESC&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Sidekiq - &lt;/span&gt;&lt;span class="nv"&gt;$RAILS_ENV&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="nv"&gt;SIDEKIQ&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/home/&lt;/span&gt;&lt;span class="nv"&gt;$USER&lt;/span&gt;&lt;span class="s2"&gt;/.rbenv/shims/sidekiq&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;SIDEKIQ_OPTS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;--pidfile &lt;/span&gt;&lt;span class="nv"&gt;$PID_FILE&lt;/span&gt;&lt;span class="s2"&gt; --logfile &lt;/span&gt;&lt;span class="nv"&gt;$LOG_FILE&lt;/span&gt;&lt;span class="s2"&gt; --environment &lt;/span&gt;&lt;span class="nv"&gt;$RAILS_ENV&lt;/span&gt;&lt;span class="s2"&gt; --daemon&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;CMD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;cd &lt;/span&gt;&lt;span class="nv"&gt;$APP_ROOT&lt;/span&gt;&lt;span class="s2"&gt;; &lt;/span&gt;&lt;span class="nv"&gt;$SIDEKIQ&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$SIDEKIQ_OPTS&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;REMOVE_PID_FILE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rm -f &lt;/span&gt;&lt;span class="nv"&gt;$PID_FILE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="c"&gt;# Give your upgrade action a timeout of 60 seconds.&lt;/span&gt;
&lt;span class="nv"&gt;TIMEOUT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;60

&lt;span class="c"&gt;# Store the action that we should take from the service command&amp;#39;s first&lt;/span&gt;
&lt;span class="c"&gt;# argument (e.g. start, stop, upgrade).&lt;/span&gt;
&lt;span class="nv"&gt;action&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="c"&gt;# Make sure the script exits if any variables are unset. This is short for&lt;/span&gt;
&lt;span class="c"&gt;# set -o nounset.&lt;/span&gt;
&lt;span class="nb"&gt;set&lt;/span&gt; -u

&lt;span class="c"&gt;# Set the location of the old pid. The old pid is the process that is getting&lt;/span&gt;
&lt;span class="c"&gt;# replaced.&lt;/span&gt;
&lt;span class="nv"&gt;old_pid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$PID_FILE&lt;/span&gt;&lt;span class="s2"&gt;.oldbin&amp;quot;&lt;/span&gt;

&lt;span class="c"&gt;# Make sure the APP_ROOT is actually a folder that exists. An error message from&lt;/span&gt;
&lt;span class="c"&gt;# the cd command will be displayed if it fails.&lt;/span&gt;
&lt;span class="nb"&gt;cd&lt;/span&gt; &lt;span class="nv"&gt;$APP_ROOT&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="nb"&gt;exit &lt;/span&gt;1

&lt;span class="c"&gt;# A function to send a signal to the current unicorn master process.&lt;/span&gt;
sig &lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
  &lt;span class="nb"&gt;test&lt;/span&gt; -s &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$PID_FILE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;kill&lt;/span&gt; -&lt;span class="nv"&gt;$1&lt;/span&gt; &lt;span class="sb"&gt;`&lt;/span&gt;cat &lt;span class="nv"&gt;$PID_FILE&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c"&gt;# Send a signal to the old process.&lt;/span&gt;
oldsig &lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
  &lt;span class="nb"&gt;test&lt;/span&gt; -s &lt;span class="nv"&gt;$old_pid&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;kill&lt;/span&gt; -&lt;span class="nv"&gt;$1&lt;/span&gt; &lt;span class="sb"&gt;`&lt;/span&gt;cat &lt;span class="nv"&gt;$old_pid&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c"&gt;# A switch for handling the possible actions to take on the unicorn process.&lt;/span&gt;
&lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="nv"&gt;$action&lt;/span&gt; in
  &lt;span class="c"&gt;# Start the process by testing if it&amp;#39;s there (sig 0), failing if it is,&lt;/span&gt;
  &lt;span class="c"&gt;# otherwise running the command as specified above.&lt;/span&gt;
  start&lt;span class="o"&gt;)&lt;/span&gt;
    sig &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$DESC&lt;/span&gt;&lt;span class="s2"&gt; is already running&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit &lt;/span&gt;0
    su - &lt;span class="nv"&gt;$USER&lt;/span&gt; -c &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$CMD&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;;;&lt;/span&gt;

  &lt;span class="c"&gt;# Graceful shutdown. Send QUIT signal to the process. Requests will be&lt;/span&gt;
  &lt;span class="c"&gt;# completed before the processes are terminated.&lt;/span&gt;
  stop&lt;span class="o"&gt;)&lt;/span&gt;
    sig QUIT &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Stopping &lt;/span&gt;&lt;span class="nv"&gt;$DESC&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="nb"&gt;exit &lt;/span&gt;0
    su - &lt;span class="nv"&gt;$USER&lt;/span&gt; -c &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$REMOVE_PID_FILE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Not running&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;;;&lt;/span&gt;

  &lt;span class="c"&gt;# Quick shutdown - kills all workers immediately.&lt;/span&gt;
  force-stop&lt;span class="o"&gt;)&lt;/span&gt;
    sig TERM &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Force-stopping &lt;/span&gt;&lt;span class="nv"&gt;$DESC&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit &lt;/span&gt;0
    &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Not running&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;;;&lt;/span&gt;

  &lt;span class="c"&gt;# Graceful shutdown and then start.&lt;/span&gt;
  restart&lt;span class="o"&gt;)&lt;/span&gt;
    sig QUIT &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Restarting &lt;/span&gt;&lt;span class="nv"&gt;$DESC&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep &lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
      &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; su - &lt;span class="nv"&gt;$USER&lt;/span&gt; -c &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$CMD&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit &lt;/span&gt;0
    &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Couldn&amp;#39;t restart.&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;;;&lt;/span&gt;

  &lt;span class="c"&gt;# Reloads config file (unicorn.rb) and gracefully restarts all workers. This&lt;/span&gt;
  &lt;span class="c"&gt;# command won&amp;#39;t pick up application code changes if you have `preload_app&lt;/span&gt;
  &lt;span class="c"&gt;# true` in your unicorn.rb config file.&lt;/span&gt;
  reload&lt;span class="o"&gt;)&lt;/span&gt;
    sig HUP &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Reloading configuration for &lt;/span&gt;&lt;span class="nv"&gt;$DESC&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit &lt;/span&gt;0
    &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Couldn&amp;#39;t reload configuration.&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;;;&lt;/span&gt;

  &lt;span class="c"&gt;# Re-execute the running binary, then gracefully shutdown old process. This&lt;/span&gt;
  &lt;span class="c"&gt;# command allows you to have zero-downtime deployments. The application may&lt;/span&gt;
  &lt;span class="c"&gt;# spin for a minute, but at least the user doesn&amp;#39;t get a 500 error page or&lt;/span&gt;
  &lt;span class="c"&gt;# the like. Unicorn interprets the USR2 signal as a request to start a new&lt;/span&gt;
  &lt;span class="c"&gt;# master process and phase out the old worker processes. If the upgrade fails&lt;/span&gt;
  &lt;span class="c"&gt;# for some reason, a new process is started.&lt;/span&gt;
  upgrade&lt;span class="o"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; sig USR2 &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Upgrading &lt;/span&gt;&lt;span class="nv"&gt;$DESC&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep &lt;span class="m"&gt;10&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
      &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; sig &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; oldsig QUIT
    &lt;span class="k"&gt;then&lt;/span&gt;
      &lt;span class="nv"&gt;n&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$TIMEOUT&lt;/span&gt;
      &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="nb"&gt;test&lt;/span&gt; -s &lt;span class="nv"&gt;$old_pid&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;test&lt;/span&gt; &lt;span class="nv"&gt;$n&lt;/span&gt; -ge 0
      &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="nb"&gt;printf&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nv"&gt;n&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$((&lt;/span&gt; &lt;span class="nv"&gt;$n&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="k"&gt;))&lt;/span&gt;
      &lt;span class="k"&gt;done&lt;/span&gt;
      &lt;span class="nb"&gt;echo&lt;/span&gt;

&lt;span class="nb"&gt;      &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;test&lt;/span&gt; &lt;span class="nv"&gt;$n&lt;/span&gt; -lt &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;test&lt;/span&gt; -s &lt;span class="nv"&gt;$old_pid&lt;/span&gt;
      &lt;span class="k"&gt;then&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$old_pid&lt;/span&gt;&lt;span class="s2"&gt; still exists after &lt;/span&gt;&lt;span class="nv"&gt;$TIMEOUT&lt;/span&gt;&lt;span class="s2"&gt; seconds&amp;quot;&lt;/span&gt;
        &lt;span class="nb"&gt;exit &lt;/span&gt;1
      &lt;span class="k"&gt;fi&lt;/span&gt;
      &lt;span class="nb"&gt;exit &lt;/span&gt;0
    &lt;span class="k"&gt;fi&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Couldn&amp;#39;t upgrade, starting &amp;#39;su - &lt;/span&gt;&lt;span class="nv"&gt;$USER&lt;/span&gt;&lt;span class="s2"&gt; -c \&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$CMD&lt;/span&gt;&lt;span class="s2"&gt;\&amp;quot;&amp;#39; instead&amp;quot;&lt;/span&gt;
    su - &lt;span class="nv"&gt;$USER&lt;/span&gt; -c &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$CMD&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;;;&lt;/span&gt;

  &lt;span class="c"&gt;# A basic status checker. Just checks if the master process is responding to&lt;/span&gt;
  &lt;span class="c"&gt;# the `kill` command.&lt;/span&gt;
  status&lt;span class="o"&gt;)&lt;/span&gt;
    sig &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$DESC&lt;/span&gt;&lt;span class="s2"&gt; is running.&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit &lt;/span&gt;0
    &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$DESC&lt;/span&gt;&lt;span class="s2"&gt; is not running.&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;;;&lt;/span&gt;

  &lt;span class="c"&gt;# Reopen all logs owned by the master and all workers.&lt;/span&gt;
  reopen-logs&lt;span class="o"&gt;)&lt;/span&gt;
    sig USR1
    &lt;span class="p"&gt;;;&lt;/span&gt;

  &lt;span class="c"&gt;# Any other action gets the usage message.&lt;/span&gt;
  *&lt;span class="o"&gt;)&lt;/span&gt;
    &lt;span class="c"&gt;# Usage&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Usage: &lt;/span&gt;&lt;span class="nv"&gt;$0&lt;/span&gt;&lt;span class="s2"&gt; &amp;lt;start|stop|restart|reload|upgrade|force-stop|reopen-logs&amp;gt;&amp;quot;&lt;/span&gt;
    &lt;span class="nb"&gt;exit &lt;/span&gt;1
    &lt;span class="p"&gt;;;&lt;/span&gt;
&lt;span class="k"&gt;esac&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and execute the commands below.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;chmod 755 sidekiq
update-rc.d sidekiq defaults 99
service sidekiq restart
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>Setting up a rails production server on Ubuntu</title><link href="http://tsaith.github.io/setting-up-a-rails-production-server-on-ubuntu.html" rel="alternate"></link><updated>2015-03-30T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-03-30:setting-up-a-rails-production-server-on-ubuntu.html</id><summary type="html">&lt;p&gt;In this article, the steps to set up a rails production server based on &lt;a href="https://www.digitalocean.com/"&gt;DigitalOcean&lt;/a&gt; VPS of Ubuntu 14.04 x64 are recorded as following.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="create-a-user-account-to-deploy-production-on-ubuntu"&gt;Create a user account to deploy production&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="install-rbenv-and-rails-on-ubuntu"&gt;Install Rbenv and Rails&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="setting-up-nginx-plus-unicorn-production-server"&gt;Setting up Nginx+Unicorn&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="installing-sidekiq-and-redis-on-ubuntu"&gt;Install Sidekiq and Redis&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="setting-up-logrotate-for-production-server"&gt;Setting up Logrotate&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary><category term="rails"></category></entry><entry><title>Setting up logrotate for production server</title><link href="http://tsaith.github.io/setting-up-logrotate-for-production-server.html" rel="alternate"></link><updated>2015-03-30T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-03-30:setting-up-logrotate-for-production-server.html</id><summary type="html">&lt;p&gt;This article will demonstrate how to use &lt;a href="http://manpages.ubuntu.com/manpages/utopic/man8/logrotate.8.html"&gt;logrotate&lt;/a&gt; to maintain log files of rails.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Switch to &lt;code&gt;root&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo su -l
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Define a file to maintain log files of rails&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Assuming your app name is &lt;code&gt;myflix&lt;/code&gt;,
create &lt;code&gt;/etc/logrotate.d/rails&lt;/code&gt; with following content:&lt;/p&gt;
&lt;p&gt;/etc/logrotate.d/rails:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;/home/deployer/apps/myflix/current/log/*.log &lt;span class="o"&gt;{&lt;/span&gt;
  daily
  missingok
  rotate 7
  compress
  delaycompress
  notifempty
  copytruncate
  sharedscripts
  postrotate
    service sidekiq restart
    service unicorn restart
  endscript
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;You may execute the command below for testing&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;logrotate -vf /etc/logrotate.conf
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>Setting up Nginx+Unicorn production server</title><link href="http://tsaith.github.io/setting-up-nginxunicorn-production-server.html" rel="alternate"></link><updated>2015-03-30T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-03-30:setting-up-nginxunicorn-production-server.html</id><summary type="html">&lt;p&gt;This article will describe how to install and configure &lt;a href="http://nginx.org/"&gt;Nginx&lt;/a&gt; with &lt;a href="http://unicorn.bogomips.org/"&gt;Unicorn&lt;/a&gt; to build a concurrent rails server based on Ubuntu.&lt;/p&gt;
&lt;p&gt;Assume that we have logged in with a user account named &lt;code&gt;deployer&lt;/code&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Install Unicorn&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Adding the following line to your &lt;code&gt;Gemfile&lt;/code&gt; and execute &lt;code&gt;bundle install&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;gem &amp;#39;unicorn&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Switch to &lt;code&gt;root&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo su -l
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Write a init script for Unicorn&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Asuming the name of your app is &lt;code&gt;myflix&lt;/code&gt;,
create &lt;code&gt;/etc/init.d/unicorn&lt;/code&gt; with the following content:&lt;/p&gt;
&lt;p&gt;/etc/init.d/unicorn:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="c"&gt;# File: /etc/init.d/unicorn&lt;/span&gt;

&lt;span class="c"&gt;### BEGIN INIT INFO&lt;/span&gt;
&lt;span class="c"&gt;# Provides:          unicorn&lt;/span&gt;
&lt;span class="c"&gt;# Required-Start:    $local_fs $remote_fs $network $syslog&lt;/span&gt;
&lt;span class="c"&gt;# Required-Stop:     $local_fs $remote_fs $network $syslog&lt;/span&gt;
&lt;span class="c"&gt;# Default-Start:     2 3 4 5&lt;/span&gt;
&lt;span class="c"&gt;# Default-Stop:      0 1 6&lt;/span&gt;
&lt;span class="c"&gt;# Short-Description: starts the unicorn web server&lt;/span&gt;
&lt;span class="c"&gt;# Description:       starts unicorn&lt;/span&gt;
&lt;span class="c"&gt;### END INIT INFO&lt;/span&gt;

&lt;span class="c"&gt;# Feel free to change any of the following variables for your app:&lt;/span&gt;

&lt;span class="c"&gt;# Set user&lt;/span&gt;
&lt;span class="nv"&gt;USER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;deployer
&lt;span class="c"&gt;# Set app name&lt;/span&gt;
&lt;span class="nv"&gt;APP_NAME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;myflix

&lt;span class="c"&gt;# Replace [PATH_TO_RAILS_ROOT_FOLDER] with your application&amp;#39;s path.&lt;/span&gt;
&lt;span class="nv"&gt;APP_ROOT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/home/&lt;span class="nv"&gt;$USER&lt;/span&gt;/apps/&lt;span class="nv"&gt;$APP_NAME&lt;/span&gt;/current
&lt;span class="c"&gt;# Set the environment. This can be changed to staging or development for staging&lt;/span&gt;
&lt;span class="c"&gt;# servers.&lt;/span&gt;
&lt;span class="nv"&gt;RAILS_ENV&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;production
&lt;span class="c"&gt;# This should match the pid setting in $APP_ROOT/config/unicorn.rb.&lt;/span&gt;
&lt;span class="nv"&gt;PID_FILE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$APP_ROOT&lt;/span&gt;/tmp/unicorn.pid
&lt;span class="c"&gt;# A simple description for service output.&lt;/span&gt;
&lt;span class="nv"&gt;DESC&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Unicorn app - &lt;/span&gt;&lt;span class="nv"&gt;$RAILS_ENV&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="c"&gt;# If you&amp;#39;re using rbenv, you may need to use the following setup to get things&lt;/span&gt;
&lt;span class="c"&gt;# working properly:&lt;/span&gt;
&lt;span class="nv"&gt;RBENV_RUBY_VERSION&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;cat &lt;span class="nv"&gt;$APP_ROOT&lt;/span&gt;/.ruby-version&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="nv"&gt;RBENV_ROOT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/home/&lt;/span&gt;&lt;span class="nv"&gt;$USER&lt;/span&gt;&lt;span class="s2"&gt;/.rbenv&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;RBENV&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$RBENV_ROOT&lt;/span&gt;&lt;span class="s2"&gt;/bin/rbenv&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$RBENV_ROOT&lt;/span&gt;&lt;span class="s2"&gt;/bin:&lt;/span&gt;&lt;span class="nv"&gt;$PATH&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;SET_PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;cd &lt;/span&gt;&lt;span class="nv"&gt;$APP_ROOT&lt;/span&gt;&lt;span class="s2"&gt; &amp;amp;&amp;amp; &lt;/span&gt;&lt;span class="nv"&gt;$RBENV&lt;/span&gt;&lt;span class="s2"&gt; rehash &amp;amp;&amp;amp; &lt;/span&gt;&lt;span class="nv"&gt;$RBENV&lt;/span&gt;&lt;span class="s2"&gt; local &lt;/span&gt;&lt;span class="nv"&gt;$RBENV_RUBY_VERSION&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="c"&gt;# Unicorn can be run using `bundle exec unicorn` or `bin/unicorn`.&lt;/span&gt;
&lt;span class="nv"&gt;UNICORN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$RBENV_ROOT&lt;/span&gt;&lt;span class="s2"&gt;/shims/unicorn&amp;quot;&lt;/span&gt;
&lt;span class="c"&gt;# Execute the unicorn executable as a daemon, with the appropriate configuration&lt;/span&gt;
&lt;span class="c"&gt;# and in the appropriate environment.&lt;/span&gt;
&lt;span class="nv"&gt;UNICORN_OPTS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;-c &lt;/span&gt;&lt;span class="nv"&gt;$APP_ROOT&lt;/span&gt;&lt;span class="s2"&gt;/config/unicorn.rb -E &lt;/span&gt;&lt;span class="nv"&gt;$RAILS_ENV&lt;/span&gt;&lt;span class="s2"&gt; -D&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;CMD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$UNICORN&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$UNICORN_OPTS&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="c"&gt;# Give your upgrade action a timeout of 60 seconds.&lt;/span&gt;
&lt;span class="nv"&gt;TIMEOUT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;60

&lt;span class="c"&gt;# Store the action that we should take from the service command&amp;#39;s first&lt;/span&gt;
&lt;span class="c"&gt;# argument (e.g. start, stop, upgrade).&lt;/span&gt;
&lt;span class="nv"&gt;action&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="c"&gt;# Make sure the script exits if any variables are unset. This is short for&lt;/span&gt;
&lt;span class="c"&gt;# set -o nounset.&lt;/span&gt;
&lt;span class="nb"&gt;set&lt;/span&gt; -u

&lt;span class="c"&gt;# Set the location of the old pid. The old pid is the process that is getting&lt;/span&gt;
&lt;span class="c"&gt;# replaced.&lt;/span&gt;
&lt;span class="nv"&gt;old_pid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$PID_FILE&lt;/span&gt;&lt;span class="s2"&gt;.oldbin&amp;quot;&lt;/span&gt;

&lt;span class="c"&gt;# Make sure the APP_ROOT is actually a folder that exists. An error message from&lt;/span&gt;
&lt;span class="c"&gt;# the cd command will be displayed if it fails.&lt;/span&gt;
&lt;span class="nb"&gt;cd&lt;/span&gt; &lt;span class="nv"&gt;$APP_ROOT&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="nb"&gt;exit &lt;/span&gt;1

&lt;span class="c"&gt;# A function to send a signal to the current unicorn master process.&lt;/span&gt;
sig &lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
  &lt;span class="nb"&gt;test&lt;/span&gt; -s &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$PID_FILE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;kill&lt;/span&gt; -&lt;span class="nv"&gt;$1&lt;/span&gt; &lt;span class="sb"&gt;`&lt;/span&gt;cat &lt;span class="nv"&gt;$PID_FILE&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c"&gt;# Send a signal to the old process.&lt;/span&gt;
oldsig &lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
  &lt;span class="nb"&gt;test&lt;/span&gt; -s &lt;span class="nv"&gt;$old_pid&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;kill&lt;/span&gt; -&lt;span class="nv"&gt;$1&lt;/span&gt; &lt;span class="sb"&gt;`&lt;/span&gt;cat &lt;span class="nv"&gt;$old_pid&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c"&gt;# A switch for handling the possible actions to take on the unicorn process.&lt;/span&gt;
&lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="nv"&gt;$action&lt;/span&gt; in
  &lt;span class="c"&gt;# Start the process by testing if it&amp;#39;s there (sig 0), failing if it is,&lt;/span&gt;
  &lt;span class="c"&gt;# otherwise running the command as specified above.&lt;/span&gt;
  start&lt;span class="o"&gt;)&lt;/span&gt;
    sig &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$DESC&lt;/span&gt;&lt;span class="s2"&gt; is already running&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit &lt;/span&gt;0
    su - &lt;span class="nv"&gt;$USER&lt;/span&gt; -c &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$CMD&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;;;&lt;/span&gt;

  &lt;span class="c"&gt;# Graceful shutdown. Send QUIT signal to the process. Requests will be&lt;/span&gt;
  &lt;span class="c"&gt;# completed before the processes are terminated.&lt;/span&gt;
  stop&lt;span class="o"&gt;)&lt;/span&gt;
    sig QUIT &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Stopping &lt;/span&gt;&lt;span class="nv"&gt;$DESC&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="nb"&gt;exit &lt;/span&gt;0
    &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Not running&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;;;&lt;/span&gt;

  &lt;span class="c"&gt;# Quick shutdown - kills all workers immediately.&lt;/span&gt;
  force-stop&lt;span class="o"&gt;)&lt;/span&gt;
    sig TERM &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Force-stopping &lt;/span&gt;&lt;span class="nv"&gt;$DESC&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit &lt;/span&gt;0
    &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Not running&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;;;&lt;/span&gt;

  &lt;span class="c"&gt;# Graceful shutdown and then start.&lt;/span&gt;
  restart&lt;span class="o"&gt;)&lt;/span&gt;
    sig QUIT &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Restarting &lt;/span&gt;&lt;span class="nv"&gt;$DESC&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep &lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
      &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; su - &lt;span class="nv"&gt;$USER&lt;/span&gt; -c &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$CMD&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit &lt;/span&gt;0
    &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Couldn&amp;#39;t restart.&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;;;&lt;/span&gt;

  &lt;span class="c"&gt;# Reloads config file (unicorn.rb) and gracefully restarts all workers. This&lt;/span&gt;
  &lt;span class="c"&gt;# command won&amp;#39;t pick up application code changes if you have `preload_app&lt;/span&gt;
  &lt;span class="c"&gt;# true` in your unicorn.rb config file.&lt;/span&gt;
  reload&lt;span class="o"&gt;)&lt;/span&gt;
    sig HUP &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Reloading configuration for &lt;/span&gt;&lt;span class="nv"&gt;$DESC&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit &lt;/span&gt;0
    &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Couldn&amp;#39;t reload configuration.&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;;;&lt;/span&gt;

  &lt;span class="c"&gt;# Re-execute the running binary, then gracefully shutdown old process. This&lt;/span&gt;
  &lt;span class="c"&gt;# command allows you to have zero-downtime deployments. The application may&lt;/span&gt;
  &lt;span class="c"&gt;# spin for a minute, but at least the user doesn&amp;#39;t get a 500 error page or&lt;/span&gt;
  &lt;span class="c"&gt;# the like. Unicorn interprets the USR2 signal as a request to start a new&lt;/span&gt;
  &lt;span class="c"&gt;# master process and phase out the old worker processes. If the upgrade fails&lt;/span&gt;
  &lt;span class="c"&gt;# for some reason, a new process is started.&lt;/span&gt;
  upgrade&lt;span class="o"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; sig USR2 &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Upgrading &lt;/span&gt;&lt;span class="nv"&gt;$DESC&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep &lt;span class="m"&gt;10&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
      &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; sig &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; oldsig QUIT
    &lt;span class="k"&gt;then&lt;/span&gt;
      &lt;span class="nv"&gt;n&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$TIMEOUT&lt;/span&gt;
      &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="nb"&gt;test&lt;/span&gt; -s &lt;span class="nv"&gt;$old_pid&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;test&lt;/span&gt; &lt;span class="nv"&gt;$n&lt;/span&gt; -ge 0
      &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="nb"&gt;printf&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; sleep &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nv"&gt;n&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$((&lt;/span&gt; &lt;span class="nv"&gt;$n&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="k"&gt;))&lt;/span&gt;
      &lt;span class="k"&gt;done&lt;/span&gt;
      &lt;span class="nb"&gt;echo&lt;/span&gt;

&lt;span class="nb"&gt;      &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;test&lt;/span&gt; &lt;span class="nv"&gt;$n&lt;/span&gt; -lt &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;test&lt;/span&gt; -s &lt;span class="nv"&gt;$old_pid&lt;/span&gt;
      &lt;span class="k"&gt;then&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$old_pid&lt;/span&gt;&lt;span class="s2"&gt; still exists after &lt;/span&gt;&lt;span class="nv"&gt;$TIMEOUT&lt;/span&gt;&lt;span class="s2"&gt; seconds&amp;quot;&lt;/span&gt;
        &lt;span class="nb"&gt;exit &lt;/span&gt;1
      &lt;span class="k"&gt;fi&lt;/span&gt;
      &lt;span class="nb"&gt;exit &lt;/span&gt;0
    &lt;span class="k"&gt;fi&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Couldn&amp;#39;t upgrade, starting &amp;#39;su - &lt;/span&gt;&lt;span class="nv"&gt;$USER&lt;/span&gt;&lt;span class="s2"&gt; -c \&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$CMD&lt;/span&gt;&lt;span class="s2"&gt;\&amp;quot;&amp;#39; instead&amp;quot;&lt;/span&gt;
    su - &lt;span class="nv"&gt;$USER&lt;/span&gt; -c &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$CMD&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;;;&lt;/span&gt;

  &lt;span class="c"&gt;# A basic status checker. Just checks if the master process is responding to&lt;/span&gt;
  &lt;span class="c"&gt;# the `kill` command.&lt;/span&gt;
  status&lt;span class="o"&gt;)&lt;/span&gt;
    sig &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$DESC&lt;/span&gt;&lt;span class="s2"&gt; is running.&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit &lt;/span&gt;0
    &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$DESC&lt;/span&gt;&lt;span class="s2"&gt; is not running.&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;;;&lt;/span&gt;

  &lt;span class="c"&gt;# Reopen all logs owned by the master and all workers.&lt;/span&gt;
  reopen-logs&lt;span class="o"&gt;)&lt;/span&gt;
    sig USR1
    &lt;span class="p"&gt;;;&lt;/span&gt;

  &lt;span class="c"&gt;# Any other action gets the usage message.&lt;/span&gt;
  *&lt;span class="o"&gt;)&lt;/span&gt;
    &lt;span class="c"&gt;# Usage&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Usage: &lt;/span&gt;&lt;span class="nv"&gt;$0&lt;/span&gt;&lt;span class="s2"&gt; &amp;lt;start|stop|restart|reload|upgrade|force-stop|reopen-logs&amp;gt;&amp;quot;&lt;/span&gt;
    &lt;span class="nb"&gt;exit &lt;/span&gt;1
    &lt;span class="p"&gt;;;&lt;/span&gt;
&lt;span class="k"&gt;esac&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Then, execute&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;chmod +x /etc/init.d/unicorn
update-rc.d unicorn defaults
service unicorn restart
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Prepare the configuration file of Unicorn under project directory&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Create &lt;code&gt;config/unicorn.rb&lt;/code&gt; with content as&lt;/p&gt;
&lt;p&gt;config/unicorn.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;# Set the current app&amp;#39;s path for later reference. Rails.root isn&amp;#39;t available at&lt;/span&gt;
&lt;span class="c1"&gt;# this point, so we have to point up a directory.&lt;/span&gt;
&lt;span class="n"&gt;app_path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;File&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;expand_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;File&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dirname&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;__FILE__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/..&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# The number of worker processes you have here should equal the number of CPU cores your server has.&lt;/span&gt;
&lt;span class="n"&gt;worker_processes&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;RAILS_ENV&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;production&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;?&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# You can listen on a port or a socket. Listening on a socket is good in a&lt;/span&gt;
&lt;span class="c1"&gt;# production environment, but listening on a port can be useful for local&lt;/span&gt;
&lt;span class="c1"&gt;# debugging purposes.&lt;/span&gt;
&lt;span class="n"&gt;listen&lt;/span&gt; &lt;span class="n"&gt;app_path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/tmp/unicorn.sock&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;backlog&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;64&lt;/span&gt;

&lt;span class="c1"&gt;# For development, you may want to listen on port 3000 so that you can make sure&lt;/span&gt;
&lt;span class="c1"&gt;# your unicorn.rb file is soundly configured.&lt;/span&gt;
&lt;span class="n"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;backlog&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;RAILS_ENV&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;development&amp;#39;&lt;/span&gt;
&lt;span class="c1"&gt;# After the timeout is exhausted, the unicorn worker will be killed and a new&lt;/span&gt;
&lt;span class="c1"&gt;# one brought up in its place. Adjust this to your application&amp;#39;s needs. The&lt;/span&gt;
&lt;span class="c1"&gt;# default timeout is 60. Anything under 3 seconds won&amp;#39;t work properly.&lt;/span&gt;
&lt;span class="n"&gt;timeout&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt;

&lt;span class="c1"&gt;# Set the working directory of this unicorn instance.&lt;/span&gt;
&lt;span class="n"&gt;working_directory&lt;/span&gt; &lt;span class="n"&gt;app_path&lt;/span&gt;

&lt;span class="c1"&gt;# Set the location of the unicorn pid file. This should match what we put in the&lt;/span&gt;
&lt;span class="c1"&gt;# unicorn init script later.&lt;/span&gt;
&lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="n"&gt;app_path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/tmp/unicorn.pid&amp;#39;&lt;/span&gt;

&lt;span class="c1"&gt;# You should define your stderr and stdout here. If you don&amp;#39;t, stderr defaults&lt;/span&gt;
&lt;span class="c1"&gt;# to /dev/null and you&amp;#39;ll lose any error logging when in daemon mode.&lt;/span&gt;
&lt;span class="n"&gt;stderr_path&lt;/span&gt; &lt;span class="n"&gt;app_path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/log/unicorn.log&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;stdout_path&lt;/span&gt; &lt;span class="n"&gt;app_path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/log/unicorn.log&amp;#39;&lt;/span&gt;

&lt;span class="c1"&gt;# Load the app up before forking.&lt;/span&gt;
&lt;span class="n"&gt;preload_app&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;

&lt;span class="c1"&gt;# Garbage collection settings.&lt;/span&gt;
&lt;span class="no"&gt;GC&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;respond_to?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:copy_on_write_friendly&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  &lt;span class="no"&gt;GC&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;copy_on_write_friendly&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;

&lt;span class="c1"&gt;# If using ActiveRecord, disconnect (from the database) before forking.&lt;/span&gt;
&lt;span class="n"&gt;before_fork&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;defined?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;
    &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;disconnect!&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="c1"&gt;# After forking, restore your ActiveRecord connection.&lt;/span&gt;
&lt;span class="n"&gt;after_fork&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;defined?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;
    &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;establish_connection&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Install and configure Nginx&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;apt-get install nginx
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Edit &lt;code&gt;/etc/nginx/nginx.conf&lt;/code&gt; as below&lt;/p&gt;
&lt;p&gt;/etc/nginx/nginx.conf:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Run nginx as www-data.&lt;/span&gt;
user www-data&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="c"&gt;# One worker process per CPU core is a good guideline.&lt;/span&gt;
worker_processes 1&lt;span class="p"&gt;;&lt;/span&gt;

pid /var/run/nginx.pid&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="c"&gt;# For a single core server, 1024 is a good starting point. Use `ulimit -n` to&lt;/span&gt;
&lt;span class="c"&gt;# determine if your server can handle more.&lt;/span&gt;
events &lt;span class="o"&gt;{&lt;/span&gt;
    worker_connections 1024&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

http &lt;span class="o"&gt;{&lt;/span&gt;

  &lt;span class="c"&gt;##&lt;/span&gt;
  &lt;span class="c"&gt;# Basic Settings&lt;/span&gt;
  &lt;span class="c"&gt;##&lt;/span&gt;

  sendfile on&lt;span class="p"&gt;;&lt;/span&gt;
  tcp_nopush on&lt;span class="p"&gt;;&lt;/span&gt;
  tcp_nodelay off&lt;span class="p"&gt;;&lt;/span&gt;
  keepalive_timeout 65&lt;span class="p"&gt;;&lt;/span&gt;
  types_hash_max_size 2048&lt;span class="p"&gt;;&lt;/span&gt;
  server_tokens off&lt;span class="p"&gt;;&lt;/span&gt;

  include /etc/nginx/mime.types&lt;span class="p"&gt;;&lt;/span&gt;
  default_type application/octet-stream&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="c"&gt;##&lt;/span&gt;
  &lt;span class="c"&gt;# Logging Settings&lt;/span&gt;
  &lt;span class="c"&gt;##&lt;/span&gt;

  access_log /var/log/nginx/access.log&lt;span class="p"&gt;;&lt;/span&gt;
  error_log /var/log/nginx/error.log&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="c"&gt;##&lt;/span&gt;
  &lt;span class="c"&gt;# Gzip Settings&lt;/span&gt;
  &lt;span class="c"&gt;##&lt;/span&gt;

  gzip on&lt;span class="p"&gt;;&lt;/span&gt;
  gzip_disable &lt;span class="s2"&gt;&amp;quot;msie6&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  gzip_http_version 1.1&lt;span class="p"&gt;;&lt;/span&gt;
  gzip_proxied any&lt;span class="p"&gt;;&lt;/span&gt;
  gzip_min_length 500&lt;span class="p"&gt;;&lt;/span&gt;
  gzip_types text/plain text/xml text/css
    text/comma-separated-values text/javascript
    application/x-javascript application/atom+xml&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="c"&gt;##&lt;/span&gt;
  &lt;span class="c"&gt;# Unicorn Rails&lt;/span&gt;
  &lt;span class="c"&gt;##&lt;/span&gt;

  &lt;span class="c"&gt;# The socket here must match the socket path that you set up in unicorn.rb.&lt;/span&gt;
  upstream unicorn &lt;span class="o"&gt;{&lt;/span&gt;
    server unix:/home/deployer/apps/myflix/current/tmp/unicorn.sock &lt;span class="nv"&gt;fail_timeout&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;0&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="o"&gt;}&lt;/span&gt;

  &lt;span class="c"&gt;##&lt;/span&gt;
  &lt;span class="c"&gt;# Virtual Host Configs&lt;/span&gt;
  &lt;span class="c"&gt;##&lt;/span&gt;

  include /etc/nginx/conf.d/*.conf&lt;span class="p"&gt;;&lt;/span&gt;
  include /etc/nginx/sites-enabled/*&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Create &lt;code&gt;/etc/nginx/sites-available/myflix&lt;/code&gt; with content:&lt;/p&gt;
&lt;p&gt;/etc/nginx/sites-available/myflix:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;server &lt;span class="o"&gt;{&lt;/span&gt;
  listen 80&lt;span class="p"&gt;;&lt;/span&gt;
  server_name myflix.com&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c"&gt;# Set server name&lt;/span&gt;

  keepalive_timeout 300&lt;span class="p"&gt;;&lt;/span&gt;

  client_max_body_size 4G&lt;span class="p"&gt;;&lt;/span&gt;

  root /home/deployer/apps/myflix/current/public&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c"&gt;# Set this to the public folder location of your Rails application.&lt;/span&gt;

  try_files &lt;span class="nv"&gt;$uri&lt;/span&gt;/index.html &lt;span class="nv"&gt;$uri&lt;/span&gt;.html &lt;span class="nv"&gt;$uri&lt;/span&gt; @unicorn&lt;span class="p"&gt;;&lt;/span&gt;

  location @unicorn &lt;span class="o"&gt;{&lt;/span&gt;
          proxy_set_header X-Forwarded-For &lt;span class="nv"&gt;$proxy_add_x_forwarded_for&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
          proxy_set_header Host &lt;span class="nv"&gt;$http_host&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
          proxy_set_header X-Forwarded_Proto &lt;span class="nv"&gt;$scheme&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
          proxy_redirect off&lt;span class="p"&gt;;&lt;/span&gt;
          &lt;span class="c"&gt;# This passes requests to unicorn, as defined in /etc/nginx/nginx.conf&lt;/span&gt;
          proxy_pass http://unicorn&lt;span class="p"&gt;;&lt;/span&gt;
          proxy_read_timeout 300s&lt;span class="p"&gt;;&lt;/span&gt;
          proxy_send_timeout 300s&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="o"&gt;}&lt;/span&gt;

  &lt;span class="c"&gt;# You can override error pages by redirecting the requests to a file in your&lt;/span&gt;
  &lt;span class="c"&gt;# application&amp;#39;s public folder, if you so desire:&lt;/span&gt;
  error_page &lt;span class="m"&gt;500&lt;/span&gt; &lt;span class="m"&gt;502&lt;/span&gt; &lt;span class="m"&gt;503&lt;/span&gt; &lt;span class="m"&gt;504&lt;/span&gt; /500.html&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="nv"&gt;location&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; /500.html &lt;span class="o"&gt;{&lt;/span&gt;
          root /home/deployer/apps/myflix/current/public&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="o"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Finally, execute the following commands:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;cd /etc/nginx/sites-enabled
rm default
ln -s ../sites-available/myflix myflix
service nginx restart
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>Deploy production with Capistrano</title><link href="http://tsaith.github.io/deploy-production-with-capistrano.html" rel="alternate"></link><updated>2015-03-19T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-03-19:deploy-production-with-capistrano.html</id><summary type="html">&lt;p&gt;This article will describe how to deploy production with &lt;a href="https://github.com/capistrano/rails/"&gt;Capistrano&lt;/a&gt;.
The &lt;a href="http://capistranorb.com/"&gt;official site&lt;/a&gt; provides useful explanations on the usage and structure of capistrano.&lt;/p&gt;
&lt;p&gt;Here we assume that you are already able to login your production server with SSH key.&lt;/p&gt;
&lt;h3&gt;Installation&lt;/h3&gt;
&lt;p&gt;Add the lines to Gemfile:&lt;/p&gt;
&lt;p&gt;Gemfile:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;capistrano-rails&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;1.1.2&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;capistrano-rbenv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2.0.3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;require&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;false&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Install and initialize capistrano:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;bundle install
cap install
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Add the followings lines to &lt;code&gt;Capfile&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;capistrano/setup&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;capistrano/deploy&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;capistrano/rbenv&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;capistrano/bundler&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;capistrano/rails/migrations&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;capistrano/rails/assets&amp;#39;&lt;/span&gt;

&lt;span class="no"&gt;Dir&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;glob&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;lib/capistrano/tasks/*.rake&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;import&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Configuration&lt;/h3&gt;
&lt;p&gt;Set up global configuration in &lt;code&gt;config/deploy.rb&lt;/code&gt; as following sample.&lt;/p&gt;
&lt;p&gt;config/deploy.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;# config valid only for current version of Capistrano&lt;/span&gt;
&lt;span class="n"&gt;lock&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;3.4.0&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="ss"&gt;:application&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;YOUR_APP_Name&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="ss"&gt;:domain&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;fetch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:application&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;.com&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;deployer&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="ss"&gt;:repo_url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;git@bitbucket.org:YOUR_ACCOUNT_NAME/&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;fetch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:application&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;.git&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="ss"&gt;:deploy_to&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/home/deployer/apps/&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;fetch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:application&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="ss"&gt;:current_path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;fetch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:deploy_to&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/current&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="ss"&gt;:shared_path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;fetch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:deploy_to&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/shared&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="ss"&gt;:releases_path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;fetch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:deploy_to&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/releases&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="ss"&gt;:default_env&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="ss"&gt;path&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;~/.rbenv/shims:~/.rbenv/bin:$PATH&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="ss"&gt;:rbenv_ruby&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2.1.5&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="ss"&gt;:deploy_via&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:remote_cache&lt;/span&gt;

&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="ss"&gt;:linked_files&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fetch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:linked_files&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;push&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;config/application.yml&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;config/database.yml&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;config/secrets.yml&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="ss"&gt;:linked_dirs&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fetch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:linked_dirs&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;push&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;log&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;tmp&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Next, set up the IP of your production server in &lt;code&gt;config/deploy/production.rb&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;config/deploy/production.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;server&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;162.233.120.172&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;deployer&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;roles&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="sx"&gt;%w{web app db}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Be sure that &lt;code&gt;db&lt;/code&gt; is added for database migration will be executed.&lt;/p&gt;
&lt;h3&gt;Start to deploy&lt;/h3&gt;
&lt;p&gt;All you have to do is execute this command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;cap production deploy
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;List all tasks&lt;/h3&gt;
&lt;p&gt;To view all available tasks in capistrano:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;cap -T
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Define your own tasks&lt;/h3&gt;
&lt;p&gt;You can write your own tasks and put them under &lt;code&gt;lib/capistrano/tasks/&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;For example, assume we have wrote a task named &lt;code&gt;access_check.rake&lt;/code&gt; with following content:&lt;/p&gt;
&lt;p&gt;lib/capistrano/tasks/access_check.rake:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;desc&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Check that we can access everything&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;task&lt;/span&gt; &lt;span class="ss"&gt;:check_write_permissions&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="n"&gt;roles&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:all&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;test&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;[ -w &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;fetch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:deploy_to&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; ]&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;info&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;fetch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:deploy_to&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; is writable on &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;error&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;fetch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:deploy_to&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; is not writable on &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now, we can check if we have enough writing permissions on the production server by executing:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;cap production check_write_permissions
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>Is your site accessible from China?</title><link href="http://tsaith.github.io/is-your-site-accessible-from-china.html" rel="alternate"></link><updated>2015-02-28T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-02-28:is-your-site-accessible-from-china.html</id><summary type="html">&lt;p&gt;The following sites provide conivient tools to detect if your site is blocked from the firewall of China.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="http://www.websitepulse.com/help/testtools.china-test.html"&gt;WebSitePulse&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://zh.greatfire.org/"&gt;GreatFire&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary><category term="utils"></category></entry><entry><title>Vi-mode in command-line and Rails Console</title><link href="http://tsaith.github.io/vi-mode-in-command-line-and-rails-console.html" rel="alternate"></link><updated>2015-02-19T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-02-19:vi-mode-in-command-line-and-rails-console.html</id><summary type="html">&lt;p&gt;Since both command-line and rails console treat characters with &lt;code&gt;readline&lt;/code&gt;,
we can add the line below in &lt;code&gt;~/.inputrc&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;set editing-mode vi
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;to switch from the default &lt;code&gt;emacs-mode&lt;/code&gt; to &lt;code&gt;vi-mode&lt;/code&gt;.&lt;/p&gt;</summary><category term="rails"></category><category term="vim"></category><category term="emacs"></category></entry><entry><title>Custom domain for your app on Heroku</title><link href="http://tsaith.github.io/custom-domain-for-your-app-on-heroku.html" rel="alternate"></link><updated>2015-02-18T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-02-18:custom-domain-for-your-app-on-heroku.html</id><summary type="html">&lt;p&gt;First of all, apply a domain from any DNS provider like &lt;a href="http://www.godaddy.com"&gt;Godaddy&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;To add a domain to your app, please execute the following command under the project directory.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;heroku domains:add www.example.com
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;To remove the domain from your app, please execute&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;heroku domains:remove www.example.com
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category><category term="heroku"></category></entry><entry><title>Adding google analytics to octopress</title><link href="http://tsaith.github.io/adding-google-analytics-to-octopress.html" rel="alternate"></link><updated>2015-02-16T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-02-16:adding-google-analytics-to-octopress.html</id><summary type="html">&lt;p&gt;Go to Google Analytics to get the tracking id.
Then, set the valud of &lt;code&gt;google_analytics_tracking_id&lt;/code&gt; in the &lt;code&gt;_config.yml&lt;/code&gt; of Octopress.&lt;/p&gt;
&lt;p&gt;_config.yml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;# Google Analytics
google_analytics_tracking_id: UA-59891323-1
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;使用 Github Pages&lt;/h3&gt;
&lt;p&gt;In case you use Github Pages for Octopress,
please also add one line in the &lt;code&gt;source/_includes/google_analytics.html&lt;/code&gt; as below.&lt;/p&gt;
&lt;p&gt;source/_includes/google_analytics.html:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;{% if site.google_analytics_tracking_id %}
  &lt;span class="nt"&gt;&amp;lt;script &lt;/span&gt;&lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text/javascript&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;_gaq&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;_gaq&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="p"&gt;[];&lt;/span&gt;
    &lt;span class="nx"&gt;_gaq&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;push&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;_setAccount&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;{{ site.google_analytics_tracking_id }}&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
    &lt;span class="nx"&gt;_gaq&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;push&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;_setDomainName&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;github.io&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt; &lt;span class="c1"&gt;// add this line for Github Pages&lt;/span&gt;
    &lt;span class="nx"&gt;_gaq&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;push&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;_trackPageview&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;

    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;ga&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;createElement&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;script&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="nx"&gt;ga&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;text/javascript&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;ga&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;async&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="nx"&gt;ga&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;src&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;https:&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;protocol&lt;/span&gt; &lt;span class="o"&gt;?&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;https://ssl&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;http://www&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.google-analytics.com/ga.js&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementsByTagName&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;script&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt; &lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;parentNode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;insertBefore&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;ga&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;})();&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
{% endif %}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;After publishing above settings, you are ready to view the traffic status in google analytics.&lt;/p&gt;</summary><category term="utils"></category></entry><entry><title>在 Rails 中安裝與設定 Bootstrap</title><link href="http://tsaith.github.io/zai-rails-zhong-an-zhuang-yu-she-ding-bootstrap.html" rel="alternate"></link><updated>2015-02-13T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-02-13:zai-rails-zhong-an-zhuang-yu-she-ding-bootstrap.html</id><summary type="html">&lt;p&gt;&lt;a href="http://getbootstrap.com/"&gt;Bootstrap&lt;/a&gt; 是目前相當受歡迎的前端開發框架，提供了許多現成的元件，幫助人們可以快速設計網站頁面，
此外還提供 Responsive Web Design 的功能，
讓網頁可以自動在不同尺寸的裝置上縮放;
以下將介紹如何在 Rails 中進行 Bootstrap 的安裝與設定。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;在 Gemfile 中加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;bootstrap-sass&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;autoprefixer-rails&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;sass-rails&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;sprockets-rails&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:require&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;sprockets/railtie&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 &lt;code&gt;bundle install&lt;/code&gt; 安裝套件。&lt;/p&gt;
&lt;h3&gt;載入 Bootstrap 函式庫&lt;/h3&gt;
&lt;p&gt;進入 app/assets/stylesheets/，
將原有的 &lt;code&gt;application.css&lt;/code&gt; 移除，
然後新增檔案 &lt;code&gt;application.css.sass&lt;/code&gt; 並加入以下的內容&lt;/p&gt;
&lt;p&gt;app/assets/stylesheets/application.css.sass:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;@import&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;bootstrap-sprockets&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;@import&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;bootstrap&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;請注意 &lt;code&gt;bootstrap-sprockets&lt;/code&gt; 的載入順序必須在 &lt;code&gt;bootstrap&lt;/code&gt; 之前。&lt;/p&gt;
&lt;p&gt;編輯 &lt;code&gt;app/assets/javascripts/application.js&lt;/code&gt;，
在檔案中加入 &lt;code&gt;//= require bootstrap-sprockets&lt;/code&gt; 如下&lt;/p&gt;
&lt;p&gt;app/assets/javascripts/application.js:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;// This is a manifest file that&amp;#39;ll be compiled into application.js, which will include all the files&lt;/span&gt;
&lt;span class="c1"&gt;// listed below.&lt;/span&gt;
&lt;span class="c1"&gt;//&lt;/span&gt;
&lt;span class="c1"&gt;// Any JavaScript/Coffee file within this directory, lib/assets/javascripts, vendor/assets/javascripts,&lt;/span&gt;
&lt;span class="c1"&gt;// or vendor/assets/javascripts of plugins, if any, can be referenced here using a relative path.&lt;/span&gt;
&lt;span class="c1"&gt;//&lt;/span&gt;
&lt;span class="c1"&gt;// It&amp;#39;s not advisable to add code directly here, but if you do, it&amp;#39;ll appear at the bottom of the&lt;/span&gt;
&lt;span class="c1"&gt;// compiled file.&lt;/span&gt;
&lt;span class="c1"&gt;//&lt;/span&gt;
&lt;span class="c1"&gt;// Read Sprockets README (https://github.com/sstephenson/sprockets#sprockets-directives) for details&lt;/span&gt;
&lt;span class="c1"&gt;// about supported directives.&lt;/span&gt;
&lt;span class="c1"&gt;//&lt;/span&gt;
&lt;span class="c1"&gt;//= require jquery&lt;/span&gt;
&lt;span class="c1"&gt;//= require jquery_ujs&lt;/span&gt;
&lt;span class="c1"&gt;//= require turbolinks&lt;/span&gt;
&lt;span class="c1"&gt;//= require bootstrap-sprockets&lt;/span&gt;
&lt;span class="c1"&gt;//= require_tree .&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;最後，請確定在 &lt;code&gt;app/views/layouts/application.html.haml&lt;/code&gt;
裡面有個別載入 Stylesheet 和 Javascript&lt;/p&gt;
&lt;p&gt;app/views/layouts/application.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nn"&gt;!!! 5&lt;/span&gt;
&lt;span class="nt"&gt;%html&lt;/span&gt;(&lt;span class="na"&gt;lang=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;en-US&amp;quot;&lt;/span&gt;)
  &lt;span class="nt"&gt;%head&lt;/span&gt;
    &lt;span class="nt"&gt;%title&lt;/span&gt; Bed &amp;amp; Breakfast
    &lt;span class="nt"&gt;%meta&lt;/span&gt;(&lt;span class="na"&gt;charset=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;)
    &lt;span class="nt"&gt;%meta&lt;/span&gt;(&lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;viewport&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;content=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;width=device-width, initial-scale=1.0&amp;quot;&lt;/span&gt;)
    &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;csrf_meta_tag&lt;/span&gt;
    &lt;span class="cp"&gt;-# 載入 Stylesheet&lt;/span&gt;
    &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stylesheet_link_tag&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;application&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:media&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;all&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;data-turbolinks-track&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
    &lt;span class="cp"&gt;-# 載入 Javascript&lt;/span&gt;
    &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;javascript_include_tag&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;application&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;data-turbolinks-track&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
  &lt;span class="nt"&gt;%body&lt;/span&gt;
    &lt;span class="nt"&gt;%header&lt;/span&gt;
      &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;render&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;shared/header&amp;#39;&lt;/span&gt;
    &lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.content.clearfix&lt;/span&gt;
      &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;render&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;shared/messages&amp;#39;&lt;/span&gt;
      &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="k"&gt;yield&lt;/span&gt;
    &lt;span class="nt"&gt;%footer&lt;/span&gt;
      &amp;amp;copy 2015 Bed &amp;amp; Breakfast
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;完成以上的設定後，我們就可以開始使用 &lt;code&gt;Bootstrap&lt;/code&gt; 的各種功能來進行網頁的設計。&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>在 Rails 中處理信用卡付款失敗</title><link href="http://tsaith.github.io/zai-rails-zhong-chu-li-xin-yong-qia-fu-kuan-shi-bai.html" rel="alternate"></link><updated>2015-02-10T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-02-10:zai-rails-zhong-chu-li-xin-yong-qia-fu-kuan-shi-bai.html</id><summary type="html">&lt;p&gt;這篇文章將以 &lt;a href="/blog/2015/01/17/use-stripe-checkout-to-charge-credit-card"&gt;Stripe&lt;/a&gt; 金流服務為例，
示範當付款失敗時，如何暫停使用者帳號。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;在 Gemfile 裡面加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stripe_event&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 &lt;code&gt;bundle install&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;新增 active 欄位&lt;/h3&gt;
&lt;p&gt;在 &lt;code&gt;users&lt;/code&gt; table 中新增 &lt;code&gt;active&lt;/code&gt; 欄位，
預設值為 &lt;code&gt;true&lt;/code&gt;，如下&lt;/p&gt;
&lt;p&gt;db/schema.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;users&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;force&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;full_name&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;email&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;password_digest&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;slug&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;token&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;boolean&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;customer_token&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;boolean&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;active&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;          &lt;span class="ss"&gt;default&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="c1"&gt;# 新增此欄位&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;設定 initializer&lt;/h3&gt;
&lt;p&gt;在 &lt;code&gt;config/initializers/stripe.rb&lt;/code&gt; 裡面敘述付款失敗時將使帳號無效&lt;/p&gt;
&lt;p&gt;config/initializers/stripe.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;Stripe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;api_key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;STRIPE_SECRET_KEY&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;

&lt;span class="no"&gt;StripeEvent&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;configure&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;events&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="c1"&gt;# 付款成功&lt;/span&gt;
  &lt;span class="n"&gt;events&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subscribe&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;charge.succeeded&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;customer_token&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;
    &lt;span class="no"&gt;Payment&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                   &lt;span class="ss"&gt;reference_id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="c1"&gt;# 付款失敗&lt;/span&gt;
  &lt;span class="n"&gt;events&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subscribe&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;charge.failed&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;customer_token&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;
    &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deactivate!&lt;/span&gt; &lt;span class="c1"&gt;# 使帳號無效&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;修改 Model 和 Controller&lt;/h3&gt;
&lt;p&gt;在 &lt;code&gt;User&lt;/code&gt; model 裡面，新增 &lt;code&gt;deactivate!&lt;/code&gt; 方法&lt;/p&gt;
&lt;p&gt;app/models/user.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;省略程式碼&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;deactivate!&lt;/span&gt;
    &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update_column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:active&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kp"&gt;false&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在處理登入的 &lt;code&gt;SessionController&lt;/code&gt; 裡面，
判斷使用者帳號是否有效，如下&lt;/p&gt;
&lt;p&gt;app/controllers/sessions_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SessionsController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;省略程式碼&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;
    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;email&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:email&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;authenticate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:password&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="c1"&gt;# 判斷帳號是否有效&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;active?&lt;/span&gt;
        &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;
        &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:success&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Your&amp;#39;ve signed in, enjoy!&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;home_path&lt;/span&gt;
      &lt;span class="k"&gt;else&lt;/span&gt;
        &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:success&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Your account has been suspended, please contact customer service.&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:danger&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Invalid email or password.&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;設定 Stripe webhook requests&lt;/h3&gt;
&lt;p&gt;最後在 Stripe 的 &lt;a href="https://dashboard.stripe.com/account/webhooks"&gt;Webhook Settings&lt;/a&gt; 新增欲接收 webhook requests 的 URL;
詳細的說明可以參考&lt;a href="/blog/2015/02/07/admin-views-payments"&gt;先前的文章&lt;/a&gt;。&lt;/p&gt;</summary><category term="rails"></category><category term="stripe"></category></entry><entry><title>查看交易記錄的後台功能</title><link href="http://tsaith.github.io/cha-kan-jiao-yi-ji-lu-de-hou-tai-gong-neng.html" rel="alternate"></link><updated>2015-02-07T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-02-07:cha-kan-jiao-yi-ji-lu-de-hou-tai-gong-neng.html</id><summary type="html">&lt;p&gt;這裡將以 &lt;a href="/blog/2015/01/17/use-stripe-checkout-to-charge-credit-card"&gt;Stripe&lt;/a&gt; 金流服務為例，
介紹如何為網站後台新增查看交易記錄的功能。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;在 Gemfile 裡面加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stripe_event&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 &lt;code&gt;bundle install&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;設定 routes&lt;/h3&gt;
&lt;p&gt;在 &lt;code&gt;routes.rb&lt;/code&gt; 加入&lt;/p&gt;
&lt;p&gt;config/routes.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;namespace&lt;/span&gt; &lt;span class="ss"&gt;:admin&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;resources&lt;/span&gt; &lt;span class="ss"&gt;:payments&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;only&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:index&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="n"&gt;mount&lt;/span&gt; &lt;span class="no"&gt;StripeEvent&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Engine&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;at&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/stripe_events&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;新增 payments table&lt;/h3&gt;
&lt;p&gt;在資料庫中新增 &lt;code&gt;payments&lt;/code&gt; table 如下&lt;/p&gt;
&lt;p&gt;db/schema.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;payments&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;force&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;integer&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;user_id&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;integer&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;amount&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;reference_id&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;設定 initializer&lt;/h3&gt;
&lt;p&gt;在 &lt;code&gt;config/initializers/stripe.rb&lt;/code&gt; 裡面處理付款成功的事件&lt;/p&gt;
&lt;p&gt;config/initializers/stripe.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;Stripe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;api_key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;STRIPE_SECRET_KEY&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;

&lt;span class="no"&gt;StripeEvent&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;configure&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;events&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;

  &lt;span class="c1"&gt;# 付款成功&lt;/span&gt;
  &lt;span class="n"&gt;events&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subscribe&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;charge.succeeded&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;customer_token&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;
    &lt;span class="c1"&gt;# 產生交易記錄&lt;/span&gt;
    &lt;span class="no"&gt;Payment&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                   &lt;span class="ss"&gt;reference_id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;倘若不清楚如何使用 Stripe 提供交易機制，
可以參考&lt;a href="/blog/2015/02/06/create-subscriptions-in-stripe/"&gt;這裡&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;新增 Model/View/Controller&lt;/h3&gt;
&lt;p&gt;新增 &lt;code&gt;Payment&lt;/code&gt; model&lt;/p&gt;
&lt;p&gt;app/models/payment.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Payment&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:user&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;新增 PaymentsController&lt;/p&gt;
&lt;p&gt;app/controllers/admin/payments_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Admin&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;PaymentsController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;AdminsController&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;index&lt;/span&gt;
    &lt;span class="vi"&gt;@payments&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Payment&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;新增 view 以查看交易記錄，如下&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm8.staticflickr.com/7374/16463279546_8c9e4a86d2_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;app/views/admin/payments/index.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.admin_payments&lt;/span&gt;
  &lt;span class="nc"&gt;.container&lt;/span&gt;
    &lt;span class="nc"&gt;.row&lt;/span&gt;
      &lt;span class="nc"&gt;.col-sm-10.col-sm-offset-1&lt;/span&gt;
        &lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.payment_history&lt;/span&gt;
          &lt;span class="nt"&gt;%ul&lt;/span&gt;&lt;span class="nc"&gt;.nav.nav-tabs&lt;/span&gt;
            &lt;span class="nt"&gt;%li&lt;/span&gt;&lt;span class="nc"&gt;.active&lt;/span&gt;
              &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Recent Payments&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;admin_payments_path&lt;/span&gt;
            &lt;span class="nt"&gt;%li&lt;/span&gt;
              &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Add a New Video&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;new_admin_video_path&lt;/span&gt;

          &lt;span class="nt"&gt;%table&lt;/span&gt;&lt;span class="nc"&gt;.table&lt;/span&gt;
            &lt;span class="nt"&gt;%thead&lt;/span&gt;
              &lt;span class="nt"&gt;%tr&lt;/span&gt;
                &lt;span class="nt"&gt;%th&lt;/span&gt; Name
                &lt;span class="nt"&gt;%th&lt;/span&gt; Email
                &lt;span class="nt"&gt;%th&lt;/span&gt; Amount
                &lt;span class="nt"&gt;%th&lt;/span&gt; Reference ID
            &lt;span class="nt"&gt;%tbody&lt;/span&gt;
              &lt;span class="p"&gt;-&lt;/span&gt; &lt;span class="vi"&gt;@payments&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;payment&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
                &lt;span class="nt"&gt;%tr&lt;/span&gt;
                  &lt;span class="nt"&gt;%td&lt;/span&gt;
                    &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;payment&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;full_name&lt;/span&gt;
                  &lt;span class="nt"&gt;%td&lt;/span&gt;
                    &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;payment&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;
                  &lt;span class="nt"&gt;%td&lt;/span&gt;
                    &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;$&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;payment&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;amount&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
                  &lt;span class="nt"&gt;%td&lt;/span&gt;
                    &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;payment&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reference_id&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;設定 Stripe Webhooks&lt;/h3&gt;
&lt;p&gt;最後，在 Stripe 的 &lt;a href="https://dashboard.stripe.com/account/webhooks"&gt;Webhook Settings&lt;/a&gt; 裡面，
新增要接收 webhook requests 的 URL;
例如，倘若我們的網站位址是 th-myflix.herokuapp.com，
那麼新增的 URL 即為 &lt;code&gt;th-myflix.herokuapp.com/stripe_events&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm8.staticflickr.com/7324/15871057173_cc829aee26_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;在本機開發時，
可以使用免費的 &lt;a href="https://ngrok.com/"&gt;ngrok&lt;/a&gt; 服務產生 public 位址，
以接收 webhook requests 進行測試。&lt;/p&gt;</summary><category term="rails"></category><category term="stripe"></category></entry><entry><title>依照簽署方案進行收費</title><link href="http://tsaith.github.io/yi-zhao-qian-shu-fang-an-jin-xing-shou-fei.html" rel="alternate"></link><updated>2015-02-06T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-02-06:yi-zhao-qian-shu-fang-an-jin-xing-shou-fei.html</id><summary type="html">&lt;p&gt;假設我們現在想為網站開發收費機制，
使用者註冊後會立刻索取第一個月的服務費用，
之後每過一個月，
系統都會自動向客戶的信用卡帳戶請款。
下面將以 &lt;a href="/blog/2015/01/17/use-stripe-checkout-to-charge-credit-card"&gt;Stripe&lt;/a&gt; 金流服務為例，
敘述如何在 Rails 中實作這項功能。&lt;/p&gt;
&lt;h3&gt;設定 Plans&lt;/h3&gt;
&lt;p&gt;請先在 &lt;a href="https://dashboard.stripe.com/test/plans"&gt;Stripe Plans&lt;/a&gt;
新增一個 ID 為 &lt;code&gt;base&lt;/code&gt; 的收費方案，如下&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm8.staticflickr.com/7408/16301555708_62a8f3a01c_b.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;新增 customer_token&lt;/h3&gt;
&lt;p&gt;然後在 Rails 的 &lt;code&gt;users&lt;/code&gt; table 裡面，
新增 &lt;code&gt;customer_token&lt;/code&gt; 欄位，如下&lt;/p&gt;
&lt;p&gt;db/schema.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;users&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;force&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;full_name&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;email&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;password_digest&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;slug&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;token&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;boolean&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;customer_token&amp;quot;&lt;/span&gt;   &lt;span class="c1"&gt;# 新增 customer_token&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;boolean&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;active&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;          &lt;span class="ss"&gt;default&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;設定 Stripe API Key&lt;/h3&gt;
&lt;p&gt;在 config/initializers/stripe.rb，
裡面設定 Stripe 的 API Key&lt;/p&gt;
&lt;p&gt;config/initializers/stripe.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;Stripe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;api_key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;STRIPE_SECRET_KEY&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;產生 Stripe customer&lt;/h3&gt;
&lt;p&gt;在處理註冊的&lt;a href="/blog/2015/02/02/write-a-sign-up-service-with-service-objects-pattern"&gt;服務&lt;/a&gt; 裡面，
產生 Stripe customer，
並將 customer token 儲存下來&lt;/p&gt;
&lt;p&gt;app/services/user_signup.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserSignup&lt;/span&gt;

  &lt;span class="kp"&gt;attr_reader&lt;/span&gt; &lt;span class="ss"&gt;:error_message&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="vi"&gt;@user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;sign_up&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stripe_token&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;valid?&lt;/span&gt;
      &lt;span class="c1"&gt;# 產生 Stripe customer&lt;/span&gt;
      &lt;span class="n"&gt;customer&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;StripeWrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Customer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="ss"&gt;:user&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;:card&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stripe_token&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;:description&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sign up for &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
      &lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;customer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;successful?&lt;/span&gt;
        &lt;span class="c1"&gt;# 儲存 customer token&lt;/span&gt;
        &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer_token&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;customer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer_token&lt;/span&gt;
        &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;
        &lt;span class="no"&gt;AppMailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_welcome_email&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="vi"&gt;@status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:success&lt;/span&gt;
        &lt;span class="nb"&gt;self&lt;/span&gt;
      &lt;span class="k"&gt;else&lt;/span&gt;
        &lt;span class="vi"&gt;@status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:failed&lt;/span&gt;
        &lt;span class="vi"&gt;@error_message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;customer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;error_message&lt;/span&gt;
        &lt;span class="nb"&gt;self&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="vi"&gt;@status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:failed&lt;/span&gt;
      &lt;span class="vi"&gt;@error_message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Invalid user information. Please check the errors below.&amp;quot;&lt;/span&gt;
      &lt;span class="nb"&gt;self&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;successful?&lt;/span&gt;
    &lt;span class="vi"&gt;@status&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="ss"&gt;:success&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserSignup&lt;/span&gt;

  &lt;span class="kp"&gt;attr_reader&lt;/span&gt; &lt;span class="ss"&gt;:error_message&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="vi"&gt;@user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;sign_up&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stripe_token&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;valid?&lt;/span&gt;
      &lt;span class="c1"&gt;# 產生 Stripe customer&lt;/span&gt;
      &lt;span class="n"&gt;customer&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;StripeWrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Customer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="ss"&gt;:user&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;:card&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stripe_token&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;:description&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sign up for &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
      &lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;customer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;successful?&lt;/span&gt;
        &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;
        &lt;span class="no"&gt;AppMailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_welcome_email&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="vi"&gt;@status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:success&lt;/span&gt;
        &lt;span class="nb"&gt;self&lt;/span&gt;
      &lt;span class="k"&gt;else&lt;/span&gt;
        &lt;span class="vi"&gt;@status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:failed&lt;/span&gt;
        &lt;span class="vi"&gt;@error_message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;customer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;error_message&lt;/span&gt;
        &lt;span class="nb"&gt;self&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="vi"&gt;@status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:failed&lt;/span&gt;
      &lt;span class="vi"&gt;@error_message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Invalid user information. Please check the errors below.&amp;quot;&lt;/span&gt;
      &lt;span class="nb"&gt;self&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;successful?&lt;/span&gt;
    &lt;span class="vi"&gt;@status&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="ss"&gt;:success&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;StripeWrapper&lt;/code&gt; 定義了產生 Stripe customer 的動作，
並且將預設方案設為 &lt;code&gt;base&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;app/models/stripe_wrapper.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;module&lt;/span&gt; &lt;span class="nn"&gt;StripeWrapper&lt;/span&gt;
  &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Customer&lt;/span&gt;
    &lt;span class="kp"&gt;attr_reader&lt;/span&gt; &lt;span class="ss"&gt;:response&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:error_message&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;options&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{})&lt;/span&gt;
      &lt;span class="vi"&gt;@response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;options&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:response&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
      &lt;span class="vi"&gt;@error_message&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;options&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:error_message&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nc"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;options&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{})&lt;/span&gt;
      &lt;span class="k"&gt;begin&lt;/span&gt;
        &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Stripe&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Customer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
          &lt;span class="ss"&gt;:card&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;options&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:card&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="ss"&gt;:plan&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;options&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:plan&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;base&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="c1"&gt;# 預設為 base 方案&lt;/span&gt;
          &lt;span class="ss"&gt;:email&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;options&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="o"&gt;].&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="kp"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;response&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="k"&gt;rescue&lt;/span&gt; &lt;span class="no"&gt;Stripe&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;CardError&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;
        &lt;span class="kp"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;error_message&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;successful?&lt;/span&gt;
      &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;present?&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;customer_token&lt;/span&gt;
      &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category><category term="stripe"></category></entry><entry><title>使用 Service Objects 編寫註冊服務</title><link href="http://tsaith.github.io/shi-yong-service-objects-bian-xie-zhu-ce-fu-wu.html" rel="alternate"></link><updated>2015-02-02T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-02-02:shi-yong-service-objects-bian-xie-zhu-ce-fu-wu.html</id><summary type="html">&lt;p&gt;開發專案時，我們常常會遇到一種情況，
隨著功能不斷地加入，
Controller 也變得越來越肥胖;
例如，在下面的 &lt;code&gt;create&lt;/code&gt; 方法中，
包含了使用者資料的檢驗、進行信用卡交易以及發送歡迎信件等動作。&lt;/p&gt;
&lt;p&gt;app/controllers/users_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UsersController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;程式碼省略&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;
    &lt;span class="vi"&gt;@user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user_params&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;valid?&lt;/span&gt; &lt;span class="c1"&gt;# 檢驗使用者資料&lt;/span&gt;
      &lt;span class="c1"&gt;# 信用卡交易&lt;/span&gt;
      &lt;span class="n"&gt;charge&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;StripeWrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Charge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="ss"&gt;:amount&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;999&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="c1"&gt;# in cents&lt;/span&gt;
        &lt;span class="ss"&gt;:currency&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;usd&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;:card&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:stripeToken&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;:description&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sign up for &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
      &lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;charge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;successful?&lt;/span&gt;
        &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;
        &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;
        &lt;span class="no"&gt;AppMailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_welcome_email&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# 發送歡迎信件&lt;/span&gt;
        &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:success&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Thank you for registering with MyFlix.&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;home_path&lt;/span&gt;
      &lt;span class="k"&gt;else&lt;/span&gt;
        &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:danger&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;charge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;error_message&lt;/span&gt;
        &lt;span class="n"&gt;render&lt;/span&gt; &lt;span class="ss"&gt;:new&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:danger&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Invalid user information. Please check the errors below.&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;render&lt;/span&gt; &lt;span class="ss"&gt;:new&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;因為描述物件之間交互作用的邏輯，
並不適合放進單一模型中，
此時可以考慮使用 &lt;a href="http://en.wikipedia.org/wiki/Service_Data_Objects"&gt;Service Objects&lt;/a&gt; 為 Controller 瘦身。&lt;/p&gt;
&lt;h3&gt;編寫註冊服務&lt;/h3&gt;
&lt;p&gt;在 app/services 目錄下，
新增檔案 user_signup.rb，加入註冊相關的動作&lt;/p&gt;
&lt;p&gt;app/services/user_signup.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserSignup&lt;/span&gt;

  &lt;span class="kp"&gt;attr_reader&lt;/span&gt; &lt;span class="ss"&gt;:error_message&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="vi"&gt;@user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;sign_up&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stripe_token&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;valid?&lt;/span&gt; &lt;span class="c1"&gt;# 檢驗使用者資料&lt;/span&gt;
      &lt;span class="c1"&gt;# 信用卡交易&lt;/span&gt;
      &lt;span class="n"&gt;charge&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;StripeWrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Charge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="ss"&gt;:amount&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;999&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="c1"&gt;# in cents&lt;/span&gt;
        &lt;span class="ss"&gt;:currency&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;usd&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;:card&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stripe_token&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;:description&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sign up for &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
      &lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;charge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;successful?&lt;/span&gt;
        &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;
        &lt;span class="no"&gt;AppMailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_welcome_email&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# 發送歡迎信件&lt;/span&gt;
        &lt;span class="vi"&gt;@status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:success&lt;/span&gt;
        &lt;span class="nb"&gt;self&lt;/span&gt;
      &lt;span class="k"&gt;else&lt;/span&gt;
        &lt;span class="vi"&gt;@status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:failed&lt;/span&gt;
        &lt;span class="vi"&gt;@error_message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;charge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;error_message&lt;/span&gt;
        &lt;span class="nb"&gt;self&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="vi"&gt;@status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:failed&lt;/span&gt;
      &lt;span class="vi"&gt;@error_message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Invalid user information. Please check the errors below.&amp;quot;&lt;/span&gt;
      &lt;span class="nb"&gt;self&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;successful?&lt;/span&gt;
    &lt;span class="vi"&gt;@status&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="ss"&gt;:success&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後原先的 &lt;code&gt;create&lt;/code&gt; 方法就可以進行重構，如下&lt;/p&gt;
&lt;p&gt;app/controllers/users_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UsersController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;程式碼省略&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;
    &lt;span class="vi"&gt;@user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user_params&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="c1"&gt;# 使用者註冊&lt;/span&gt;
    &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;UserSignup&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sign_up&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:stripeToken&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;successful?&lt;/span&gt;
      &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:success&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Thank you for registering with MyFlix.&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;home_path&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:danger&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;error_message&lt;/span&gt;
      &lt;span class="n"&gt;render&lt;/span&gt; &lt;span class="ss"&gt;:new&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如此一來，除了 Controller 變得簡潔，
也更容易對 &lt;code&gt;create&lt;/code&gt; 和 &lt;code&gt;UserSignup&lt;/code&gt; 編寫測試。&lt;/p&gt;</summary><category term="rails"></category><category term="design pattern"></category></entry><entry><title>使用 Decorator 作為物件的表達層</title><link href="http://tsaith.github.io/shi-yong-decorator-zuo-wei-wu-jian-de-biao-da-ceng.html" rel="alternate"></link><updated>2015-02-01T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-02-01:shi-yong-decorator-zuo-wei-wu-jian-de-biao-da-ceng.html</id><summary type="html">&lt;p&gt;這篇文章將介紹如何使用 &lt;a href="http://en.wikipedia.org/wiki/Decorator_pattern"&gt;Decorator Pattern&lt;/a&gt; 的技巧來封裝物件的表達邏輯。&lt;/p&gt;
&lt;p&gt;假設有個頁面的部分程式碼如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;header&lt;/span&gt;
  &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;h3&lt;/span&gt; &lt;span class="c1"&gt;#{@video.title}&lt;/span&gt;
  &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;span&lt;/span&gt; &lt;span class="ss"&gt;Rating&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vi"&gt;@video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rating&lt;/span&gt;
    &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="vi"&gt;@video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rating&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/5.0&amp;quot;&lt;/span&gt;
  &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt;
    &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;
&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt; &lt;span class="c1"&gt;#{@video.description}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;若想將上面的程式碼簡化成&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;header&lt;/span&gt;
  &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;h3&lt;/span&gt; &lt;span class="c1"&gt;#{@video.title}&lt;/span&gt;
  &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;span&lt;/span&gt; &lt;span class="ss"&gt;Rating&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="vi"&gt;@video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rating&lt;/span&gt;
&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt; &lt;span class="c1"&gt;#{@video.description}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;一種做法是將顯示 video rating 相關的邏輯放到 Video model 裡面，
但這卻會造成物件的表達邏輯與基本方法混合在一起;
這時候比較好的做法是使用 decorator 來封裝物件的表達邏輯。
下面我們將示範如何透過 &lt;a href="https://github.com/drapergem/draper"&gt;Draper gem&lt;/a&gt; 來編寫 decorator。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;在 Gemfile 加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draper&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 &lt;code&gt;bundle install&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;使用範例&lt;/h3&gt;
&lt;p&gt;請在 &lt;code&gt;app/decorators/&lt;/code&gt; 下面新增檔案 &lt;code&gt;video_decorator.rb&lt;/code&gt; 並加入內容如下&lt;/p&gt;
&lt;p&gt;app/decorators/video_decorator.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;VideoDecorator&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;Draper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Decorator&lt;/span&gt;
  &lt;span class="n"&gt;delegate_all&lt;/span&gt; &lt;span class="c1"&gt;# 引入 Video model 的所有方法&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;rating&lt;/span&gt;
    &lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rating&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;present?&lt;/span&gt; &lt;span class="p"&gt;?&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rating&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/5.0&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;N/A&amp;quot;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在 VideoController 裡面，使用 &lt;code&gt;decorate&lt;/code&gt; 來設定 &lt;code&gt;@video&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;app/controllers/videos_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;VideosController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;省略程式碼&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;show&lt;/span&gt;
    &lt;span class="vi"&gt;@video&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;slug&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decorate&lt;/span&gt;
    &lt;span class="c1"&gt;#@video = Video.find_by(slug: params[:id])&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;之後就可以在 view 裡面使用 &lt;code&gt;@video.rating&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;header&lt;/span&gt;
  &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;h3&lt;/span&gt; &lt;span class="c1"&gt;#{@video.title}&lt;/span&gt;
  &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;span&lt;/span&gt; &lt;span class="ss"&gt;Rating&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="vi"&gt;@video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rating&lt;/span&gt;
&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt; &lt;span class="c1"&gt;#{@video.description}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category><category term="design pattern"></category></entry><entry><title>在整合測試中執行 Javascript</title><link href="http://tsaith.github.io/zai-zheng-he-ce-shi-zhong-zhi-xing-javascript.html" rel="alternate"></link><updated>2015-01-30T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-30:zai-zheng-he-ce-shi-zhong-zhi-xing-javascript.html</id><summary type="html">&lt;p&gt;這篇文章將介紹如何使用 &lt;a href="https://github.com/jnicklas/capybara"&gt;Capybara&lt;/a&gt;
來測試內含 &lt;code&gt;javascript&lt;/code&gt; 的頁面。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;在 Gemfile 加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;  &lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;capybara&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;selenium-webdriver&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;capybara-webkit&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 &lt;code&gt;bundle install&lt;/code&gt; 安裝套件。&lt;/p&gt;
&lt;h3&gt;設定 port&lt;/h3&gt;
&lt;p&gt;請在 &lt;code&gt;spec_helper.rb&lt;/code&gt;裡面設定 Capybara 所使用的 port&lt;/p&gt;
&lt;p&gt;spec/spec_helper.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;Capybara&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;server_port&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;52662&lt;/span&gt; &lt;span class="c1"&gt;# this line is required by Selenium&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;使用說明&lt;/h3&gt;
&lt;p&gt;撰寫&lt;a href="blog/2014/12/07/feature-testing-with-rspec"&gt;整合測試&lt;/a&gt;時，
只要加入 &lt;code&gt;js: true&lt;/code&gt;，
Capybara 就會自動使用預設的 Selenium 開啓 &lt;a href="https://www.mozilla.org/en-US/firefox/new/"&gt;Firefox&lt;/a&gt; 進行測試，
如下面的範例&lt;/p&gt;
&lt;p&gt;spec/features/user_registers_spec.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;spec_helper.rb&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;feature&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;User registers&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="ss"&gt;js&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;vcr&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="c1"&gt;# 請加入 js: true&lt;/span&gt;

  &lt;span class="n"&gt;background&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;allow_url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;js.stripe.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;allow_url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;api.stripe.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;allow_url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;www.gravatar.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;visit&lt;/span&gt; &lt;span class="n"&gt;sign_up_path&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;clear_email&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="n"&gt;scenario&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;with valid user info and valid card&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;fill_in_valid_user_info&lt;/span&gt;
    &lt;span class="n"&gt;fill_in_valid_card&lt;/span&gt;
    &lt;span class="n"&gt;click_button&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sign Up&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;expect_to_see_welcome_message&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="n"&gt;scenario&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;with valid user info and invalid card&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;fill_in_valid_user_info&lt;/span&gt;
    &lt;span class="n"&gt;fill_in_invalid_card&lt;/span&gt;
    &lt;span class="n"&gt;click_button&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sign Up&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;expect_to_see_invalid_card_message&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fill_in_valid_user_info&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Email Address&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;cloud@example.com&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;password&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Full Name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Cloud Strife&amp;quot;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fill_in_valid_card&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Credit Card Number&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;4242424242424242&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Security Code&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;123&amp;quot;&lt;/span&gt;
    &lt;span class="nb"&gt;select&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;4 - April&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;from&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;date_month&amp;quot;&lt;/span&gt;
    &lt;span class="nb"&gt;select&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2018&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;from&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;date_year&amp;quot;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fill_in_invalid_card&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Credit Card Number&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;4242424242424242&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Security Code&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="nb"&gt;select&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;4 - April&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;from&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;date_month&amp;quot;&lt;/span&gt;
    &lt;span class="nb"&gt;select&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2018&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;from&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;date_year&amp;quot;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;expect_to_see_welcome_message&lt;/span&gt;
    &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;have_content&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Welcome, Cloud Strife&amp;quot;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;expect_to_see_invalid_card_message&lt;/span&gt;
    &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;have_content&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Your card&amp;#39;s security code is invalid.&amp;quot;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;使用 Selenium 的優點是可以看到瀏覽器執行測試的過程，
方便偵錯，
而缺點是比較花時間。
倘若希望加快測試速度，
則可以在 &lt;code&gt;spec_helper.rb&lt;/code&gt;裡面將預設改成 &lt;code&gt;:webkit&lt;/code&gt;，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;Capybara&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;javascript_driver&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:webkit&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;此外，我們可以使用 &lt;code&gt;:driver&lt;/code&gt; 以指定某個測試希望使用的驅動引擎&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;some stuff which requires js&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:js&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;will use the default js driver&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;will switch to one specific driver&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:driver&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="ss"&gt;:selenium&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category><category term="testing"></category></entry><entry><title>在測試中模擬物件行為</title><link href="http://tsaith.github.io/zai-ce-shi-zhong-mo-ni-wu-jian-xing-wei.html" rel="alternate"></link><updated>2015-01-27T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-27:zai-ce-shi-zhong-mo-ni-wu-jian-xing-wei.html</id><summary type="html">&lt;p&gt;當我們希望對某個開發中的功能進行測試，
而那個功能需要其他物件的支援才能工作的話，
此時可以使用 &lt;code&gt;double&lt;/code&gt; 來&lt;a href="https://relishapp.com/rspec/rspec-mocks/v/2-99/docs/"&gt;模擬&lt;/a&gt;
週邊物件並定義行為;
如此一來，
我們就能將精神完全投入在開發中的功能，
而不用同時兼顧其他地方。&lt;/p&gt;
&lt;p&gt;假設我們現在想設計一個網站，
使用者在註冊時必須刷卡付費來使用內部服務。
倘若我們剛編寫了創造使用者的 &lt;code&gt;create&lt;/code&gt; 方法，如下&lt;/p&gt;
&lt;p&gt;users_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UsersController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;程式碼省略&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;
    &lt;span class="vi"&gt;@user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user_params&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;valid?&lt;/span&gt;
      &lt;span class="c1"&gt;# 信用卡交易&lt;/span&gt;
      &lt;span class="n"&gt;charge&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;StripeWrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Charge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="ss"&gt;:amount&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;999&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="c1"&gt;# in cents&lt;/span&gt;
        &lt;span class="ss"&gt;:currency&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;usd&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;:card&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:stripeToken&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;:description&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sign up for &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
      &lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;charge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;successful?&lt;/span&gt;
        &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;
        &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;
        &lt;span class="no"&gt;AppMailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_welcome_email&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:success&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;You are registered.&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;home_path&lt;/span&gt;
      &lt;span class="k"&gt;else&lt;/span&gt;
        &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:danger&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;charge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;error_message&lt;/span&gt;
        &lt;span class="n"&gt;render&lt;/span&gt; &lt;span class="ss"&gt;:new&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:danger&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;There&amp;#39;s something wrong during registration.&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;render&lt;/span&gt; &lt;span class="ss"&gt;:new&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;程式碼省略&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;這個方法裡面，
使用了信用卡服務來索取註冊費用;
而當編寫測試時，
我們會希望單純地測試 &lt;code&gt;create&lt;/code&gt; 方法的邏輯是否正確，
這時候就可以考慮使用 &lt;code&gt;double&lt;/code&gt; 來模擬信用卡交易的行為&lt;/p&gt;
&lt;p&gt;users_controller_spec.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;spec_helper&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="no"&gt;UsersController&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;POST create&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

    &lt;span class="n"&gt;context&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;with valid personal info and valid card&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="c1"&gt;# 當交易成功時 successful? 方法將回傳 true&lt;/span&gt;
      &lt;span class="n"&gt;let&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:charge&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;double&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:charge&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;successful?&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
      &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="c1"&gt;# 預期將會呼叫到 StripeWrapper::Charge.create 方法，並回傳 charge 物件&lt;/span&gt;
        &lt;span class="no"&gt;StripeWrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Charge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;charge&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="no"&gt;ActionMailer&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliveries&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;clear&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;creates the user&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;stripeToken&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;123&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;eq&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sets flash success message&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;stripeToken&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;123&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:success&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be_present&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;redirects to the home page&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;stripeToken&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;123&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;home_path&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sends out email to the user&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="ss"&gt;email&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;alice@example.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;full_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Alice Liddel&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;ActionMailer&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliveries&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;last&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;eq&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;alice@example.com&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;context&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;with valid personal info and declined card&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="c1"&gt;# 交易失敗時，successful? 方法回傳 false， error_message 回傳錯誤訊息&lt;/span&gt;
      &lt;span class="n"&gt;let&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:charge&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;double&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:charge&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;successful?&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;error_message&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Your card was declined.&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
      &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="c1"&gt;# 預期將會呼叫到 StripeWrapper::Charge.create 方法，並回傳 charge 物件&lt;/span&gt;
        &lt;span class="no"&gt;StripeWrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Charge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;charge&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="no"&gt;ActionMailer&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliveries&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;clear&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;does not create the user&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;stripeToken&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;123&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;eq&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;renders the :new template&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;stripeToken&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;123&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;render_template&lt;/span&gt; &lt;span class="ss"&gt;:new&lt;/span&gt;

      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sets @user&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;stripeToken&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;123&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;assigns&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be_instance_of&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sets the flash danger message&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;stripeToken&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;123&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:danger&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be_present&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;does not send out email&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;stripeToken&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;123&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;ActionMailer&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliveries&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be_empty&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;context&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;with invalid personal info&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="no"&gt;ActionMailer&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliveries&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;clear&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;does not create the user&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;eq&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;renders the :new template&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;render_template&lt;/span&gt; &lt;span class="ss"&gt;:new&lt;/span&gt;

      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sets @user&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;assigns&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be_instance_of&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sets the flash danger message&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:danger&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be_present&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;does not send out email&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="ss"&gt;email&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;alice@example.com&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;ActionMailer&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliveries&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be_empty&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在測試中模擬物件的技巧，
一方面讓我們可以專心地測試正在開發的功能，
另一方面，也可以縮短呼叫物件時等候回應的時間，
以提升測試效率。&lt;/p&gt;</summary><category term="rails"></category><category term="testing"></category></entry><entry><title>獨立的 API 測試</title><link href="http://tsaith.github.io/du-li-de-api-ce-shi.html" rel="alternate"></link><updated>2015-01-26T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-26:du-li-de-api-ce-shi.html</id><summary type="html">&lt;p&gt;撰寫測試時，
如果需要透過網路來呼叫外部服務的 API (例如信用卡的交易服務)，
因為 API 的回應通常需要一陣子，
這將大幅延長測試所需的等候時間;
此時可以考慮使用 &lt;a href="http://www.relishapp.com/vcr/vcr/v/2-9-3/docs/"&gt;VCR&lt;/a&gt; (Video Cassette Recorder) 先將服務的回應記錄下來，
往後當呼叫到此服務的 API 時就自動播放，
以縮短測試時間。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;在 Gemfile 中加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;group&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;vcr&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;webmock&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 &lt;code&gt;bundle install&lt;/code&gt;&lt;/p&gt;
&lt;h3&gt;設定 VCR&lt;/h3&gt;
&lt;p&gt;在 &lt;code&gt;spec_helper.rb&lt;/code&gt; 裡面設定 VCR 如下，
若想了解更多細節可參考 Relish 的&lt;a href="https://www.relishapp.com/vcr/vcr/v/2-9-3/docs/test-frameworks/usage-with-rspec-metadata"&gt;文件&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;spec/spec_helper.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;vcr&amp;#39;&lt;/span&gt;

&lt;span class="no"&gt;VCR&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;configure&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cassette_library_dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;spec/cassettes&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hook_into&lt;/span&gt; &lt;span class="ss"&gt;:webmock&lt;/span&gt;
  &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;configure_rspec_metadata!&lt;/span&gt;
  &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ignore_localhost&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="c1"&gt;# 忽略本地端的 request&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="no"&gt;RSpec&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;configure&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;

  &lt;span class="c1"&gt;# 在 RSpec 3 不再需要此行&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;treat_symbols_as_metadata_keys_with_true_values&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;程式碼省略&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;加入 :vcr&lt;/h3&gt;
&lt;p&gt;現在，
只要在測試中加入 &lt;code&gt;:vcr&lt;/code&gt; 就會自動記錄 API 的回應，
請參考下面的範例&lt;/p&gt;
&lt;p&gt;stripe_wrapper_sepc.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;spec_helper&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="no"&gt;StripeWrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Charge&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;let&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:token&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="no"&gt;Stripe&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Token&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
      &lt;span class="ss"&gt;:card&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="ss"&gt;:number&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;card_number&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;:exp_month&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;:exp_year&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;:cvc&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;314&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;:description&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;some description&amp;quot;&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;context&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;with valid card&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;let&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:card_number&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;4242424242424242&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;charges the card successfully&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:vcr&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="c1"&gt;# 加入 :vcr&lt;/span&gt;
      &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;StripeWrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Charge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;card&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be_successful&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;context&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;with invalid card&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;let&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:card_number&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;4000000000000002&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;does not charge the card successfully&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:vcr&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="c1"&gt;# 加入 :vcr&lt;/span&gt;
      &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;StripeWrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Charge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;card&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;not_to&lt;/span&gt; &lt;span class="n"&gt;be_successful&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;contains an error message&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:vcr&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="c1"&gt;# 加入 :vcr&lt;/span&gt;
      &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;StripeWrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Charge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;card&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;error_message&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be_present&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;請注意，加入 &lt;code&gt;:vcr&lt;/code&gt; 後的第一次測試，
仍會呼叫到外部服務，並記錄服務的回應;
之後的測試，才會直接使用先前的記錄。&lt;/p&gt;
&lt;p&gt;在 &lt;code&gt;spec/cassettes&lt;/code&gt; 裡面可以找到有哪些回應被記錄下來，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;tree spec/cassettes
spec/cassettes
└── StripeWrapper_Charge
    ├── with_invalid_card
    │   ├── contains_an_error_message.yml
    │   └── does_not_charge_the_card_successfully.yml
    └── with_valid_card
        └── charges_the_card_successfully.yml

&lt;span class="m"&gt;3&lt;/span&gt; directories, &lt;span class="m"&gt;3&lt;/span&gt; files
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>在測試中使用 Database Cleaner</title><link href="http://tsaith.github.io/zai-ce-shi-zhong-shi-yong-database-cleaner.html" rel="alternate"></link><updated>2015-01-22T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-22:zai-ce-shi-zhong-shi-yong-database-cleaner.html</id><summary type="html">&lt;p&gt;通常，我們在執行自動測試時，
會希望資料庫裡面沒有之前剩餘的記錄，
不然很容易導致難以發現的錯誤。
這裡將介紹如何使用 &lt;a href="https://github.com/DatabaseCleaner/database_cleaner/"&gt;Database Cleaner&lt;/a&gt;，
讓每次測試前可以自動完成資料庫的清理。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;在 Gemfile 裡面加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;database_cleaner&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 &lt;code&gt;bundle install&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;進行設定&lt;/h3&gt;
&lt;p&gt;若是用 &lt;a href="http://rspec.info/"&gt;RSpec&lt;/a&gt; 編寫測試，
請先將 &lt;code&gt;spec_helper.rb&lt;/code&gt; 裡面的這一行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;use_transactional_fixtures&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;修改成&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;use_transactional_fixtures&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kp"&gt;false&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後在 &lt;code&gt;spec/support/&lt;/code&gt; 裡面新增 &lt;code&gt;database_cleaner.rb&lt;/code&gt;，
內容如下&lt;/p&gt;
&lt;p&gt;spec/support/database_cleaner.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;RSpec&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;configure&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;

  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;before&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:suite&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="no"&gt;DatabaseCleaner&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;clean_with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:truncation&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;before&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:each&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="no"&gt;DatabaseCleaner&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strategy&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:transaction&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;before&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:each&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:js&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="no"&gt;DatabaseCleaner&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strategy&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:truncation&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;before&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:each&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="no"&gt;DatabaseCleaner&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;after&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:each&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="no"&gt;DatabaseCleaner&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;clean&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;endcodeblock&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;若不清楚上述設定的意義，
可以參考 Avdi Grimm 的&lt;a href="http://devblog.avdi.org/2012/08/31/configuring-database_cleaner-with-rails-rspec-capybara-and-selenium/"&gt;原文&lt;/a&gt;，其中有詳細的說明。&lt;/p&gt;</summary><category term="rails"></category><category term="testing"></category></entry><entry><title>信用卡交易服務: Stripe</title><link href="http://tsaith.github.io/xin-yong-qia-jiao-yi-fu-wu-stripe.html" rel="alternate"></link><updated>2015-01-17T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-17:xin-yong-qia-jiao-yi-fu-wu-stripe.html</id><summary type="html">&lt;p&gt;這篇文章將介紹如何在 Rails 中使用 &lt;a href="https://stripe.com/"&gt;Stripe&lt;/a&gt; 來處理信用卡交易;
Stripe 相較於 &lt;a href="https://developer.paypal.com/"&gt;Paypal&lt;/a&gt; 的優點除了設定簡單、安全性高、費用較低，同時還為您處理了繁雜的 merchant account 交易問題。
基於上述理由，Stripe 在國外已經成為相當受到矚目的金流明星，
並且支援大陸的&lt;a href="http://overseas.alipay.com/home/"&gt;支付寶&lt;/a&gt;，
然而在台灣尚未開放使用，希望這家公司能早日進軍台灣的市場。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;在 Gemfile 中加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stripe&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:git&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;https://github.com/stripe/stripe-ruby&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;figaro&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 &lt;code&gt;bundle install&lt;/code&gt; 進行安裝。&lt;/p&gt;
&lt;h3&gt;註冊帳號&lt;/h3&gt;
&lt;p&gt;先到 &lt;a href="https://stripe.com/"&gt;Stripe&lt;/a&gt; 進行註冊，
註冊後，請在您帳號下取得 &lt;a href="https://dashboard.stripe.com/account/apikeys"&gt;API Keys&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;設定 API Keys&lt;/h3&gt;
&lt;p&gt;這裡我們使用 &lt;a href="https://github.com/laserlemon/figaro"&gt;figaro&lt;/a&gt;
來儲存不同環境(開發、測試或上線)下的 API keys。&lt;/p&gt;
&lt;p&gt;請在專案目錄下，執行 &lt;code&gt;figaro install&lt;/code&gt;，這命令將&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;自動產生 &lt;code&gt;config/application.yml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;將此檔案加到 &lt;code&gt;.gitignore&lt;/code&gt; 裡面&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;然後在 &lt;code&gt;application.yml&lt;/code&gt; 裡面加入 keys&lt;/p&gt;
&lt;p&gt;config/application.yml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="l-Scalar-Plain"&gt;development&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;STRIPE_PUBLISHABLE_KEY&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;您的 test publishable key&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;STRIPE_SECRET_KEY&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;您的 test secret key&lt;/span&gt;

&lt;span class="l-Scalar-Plain"&gt;test&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;STRIPE_PUBLISHABLE_KEY&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;您的 test publishable key&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;STRIPE_SECRET_KEY&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;您的 test secret key&lt;/span&gt;

&lt;span class="l-Scalar-Plain"&gt;production&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;STRIPE_PUBLISHABLE_KEY&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;您的 live publishable key&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;STRIPE_SECRET_KEY&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;您的 live secret key&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;處理交易&lt;/h3&gt;
&lt;p&gt;倘若我們想設計一個網站，
讓使用者可以刷卡來支付網站的註冊費用。
參考 Stripe 的&lt;a href="https://stripe.com/docs/tutorials/charges"&gt;說明&lt;/a&gt;，
然後在處理註冊行為的 controller 中，
加入對應的程式碼&lt;/p&gt;
&lt;p&gt;users_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UsersController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;省略程式碼&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;
    &lt;span class="vi"&gt;@user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user_params&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;
      &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;
      &lt;span class="n"&gt;handle_invitation&lt;/span&gt;
      &lt;span class="no"&gt;AppMailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_welcome_email&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:success&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Your are registered.&amp;quot;&lt;/span&gt;

      &lt;span class="c1"&gt;# 使用 Stripe 服務&lt;/span&gt;
      &lt;span class="no"&gt;Stripe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;api_key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;STRIPE_SECRET_KEY&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
      &lt;span class="n"&gt;token&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:stripeToken&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
      &lt;span class="k"&gt;begin&lt;/span&gt;
        &lt;span class="no"&gt;Stripe&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Charge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
          &lt;span class="ss"&gt;:amount&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;999&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="c1"&gt;# in cents&lt;/span&gt;
          &lt;span class="ss"&gt;:currency&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;usd&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="ss"&gt;:card&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="ss"&gt;:description&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sign up for &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="k"&gt;rescue&lt;/span&gt; &lt;span class="no"&gt;Stripe&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;CardError&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;
        &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:danger&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;

      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;home_path&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:danger&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;There&amp;#39;s something wrong during registration.&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;render&lt;/span&gt; &lt;span class="ss"&gt;:new&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;省略程式碼&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;內嵌表格&lt;/h3&gt;
&lt;p&gt;使用 Stripe 所提供 &lt;a href="https://stripe.com/docs/checkout"&gt;Checkout&lt;/a&gt;，
可以簡單地地加入交易按鈕，如下所示&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm9.staticflickr.com/8595/15693999563_cc74045d0c_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;點選按鈕後，使用者可以在跳出的表格內輸入信用卡資訊，然後送出&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm9.staticflickr.com/8621/16126499500_bbf6655cae_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;對應的程式碼如下&lt;/p&gt;
&lt;p&gt;app/views/users/new.html.haml&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.register.container&lt;/span&gt;
  &lt;span class="nc"&gt;.row&lt;/span&gt;
    &lt;span class="nc"&gt;.col-sm-10.col-sm-offset-1&lt;/span&gt;
      &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bootstrap_form_for&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;layout&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;:horizontal&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;lablel_col&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;col-sm-2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;control_col&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;col-sm-6&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
        &lt;span class="nt"&gt;%header&lt;/span&gt;
          &lt;span class="nt"&gt;%h1&lt;/span&gt; Register
        &lt;span class="nt"&gt;%fieldset&lt;/span&gt;
          &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email_field&lt;/span&gt; &lt;span class="ss"&gt;:email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;label&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Email Address&amp;quot;&lt;/span&gt;
          &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password_field&lt;/span&gt; &lt;span class="ss"&gt;:password&lt;/span&gt;
          &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text_field&lt;/span&gt; &lt;span class="ss"&gt;:full_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;label&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Full Name&amp;quot;&lt;/span&gt;
          &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hidden_field_tag&lt;/span&gt; &lt;span class="ss"&gt;:invitation_token&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="vi"&gt;@invitation_token&lt;/span&gt;
        &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;form_group&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
          &lt;span class="cp"&gt;-# Stripe 提供的 javascript&lt;/span&gt;
          &amp;lt;script src=&amp;quot;https://checkout.stripe.com/checkout.js&amp;quot; class=&amp;quot;stripe-button&amp;quot; data-key=&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;STRIPE_PUBLISHABLE_KEY&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; data-amount=&amp;quot;999&amp;quot; data-name=&amp;quot;MyFlix Sign Up Charge&amp;quot; data-description=&amp;quot;$9.99 for the best video service&amp;quot;&amp;gt; &amp;lt;/script&amp;gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;自定表格&lt;/h3&gt;
&lt;p&gt;假設我們希望自定信用卡的交易表格，
那可以參考 &lt;a href="https://stripe.com/docs/tutorials/forms"&gt;Stripe Custom Forms&lt;/a&gt;
的流程，
直接在 view 中使用 &lt;a href="https://stripe.com/docs/stripe.js"&gt;Stripe.js&lt;/a&gt;，
如以下範例&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm8.staticflickr.com/7508/16130916849_626d320a8b_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;app/views/users/new.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot; src=&amp;quot;https://js.stripe.com/v2/&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;
Stripe.setPublishableKey(&amp;quot;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;STRIPE_PUBLISHABLE_KEY&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&amp;quot;);
&amp;lt;/script&amp;gt;

&lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;javascript_include_tag&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;payment&amp;#39;&lt;/span&gt;

&lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.register.container&lt;/span&gt;
  &lt;span class="nc"&gt;.row&lt;/span&gt;
    &lt;span class="nc"&gt;.col-sm-10.col-sm-offset-1&lt;/span&gt;
      &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bootstrap_form_for&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;layout&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;:horizontal&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;lablel_col&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;col-sm-2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;control_col&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;col-sm-6&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;html&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;payment-form&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
        &lt;span class="nt"&gt;%header&lt;/span&gt;
          &lt;span class="nt"&gt;%h1&lt;/span&gt; Register
        &lt;span class="nt"&gt;%fieldset&lt;/span&gt;
          &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email_field&lt;/span&gt; &lt;span class="ss"&gt;:email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;label&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Email Address&amp;quot;&lt;/span&gt;
          &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password_field&lt;/span&gt; &lt;span class="ss"&gt;:password&lt;/span&gt;
          &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text_field&lt;/span&gt; &lt;span class="ss"&gt;:full_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;label&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Full Name&amp;quot;&lt;/span&gt;
          &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hidden_field_tag&lt;/span&gt; &lt;span class="ss"&gt;:invitation_token&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="vi"&gt;@invitation_token&lt;/span&gt;
        &lt;span class="nt"&gt;%fieldset&lt;/span&gt;&lt;span class="nc"&gt;.credit_card&lt;/span&gt;
          &lt;span class="nt"&gt;%span&lt;/span&gt;&lt;span class="nc"&gt;.payment-errors&lt;/span&gt;
          &lt;span class="nc"&gt;.form-group&lt;/span&gt;
            &lt;span class="nt"&gt;%label&lt;/span&gt;&lt;span class="nc"&gt;.control-label.col-sm-2&lt;/span&gt; Credit Card Number
            &lt;span class="nc"&gt;.col-sm-6&lt;/span&gt;
              &lt;span class="nt"&gt;%input&lt;/span&gt;&lt;span class="nc"&gt;.form-control&lt;/span&gt;(&lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;data-stripe=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;number&amp;quot;&lt;/span&gt;)
          &lt;span class="nc"&gt;.form-group&lt;/span&gt;
            &lt;span class="nt"&gt;%label&lt;/span&gt;&lt;span class="nc"&gt;.control-label.col-sm-2&lt;/span&gt; Security Code
            &lt;span class="nc"&gt;.col-sm-6&lt;/span&gt;
              &lt;span class="nt"&gt;%input&lt;/span&gt;&lt;span class="nc"&gt;.form-control&lt;/span&gt;(&lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;data-stripe=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;cvc&amp;quot;&lt;/span&gt;)
          &lt;span class="nc"&gt;.form-group&lt;/span&gt;
            &lt;span class="nt"&gt;%label&lt;/span&gt;&lt;span class="nc"&gt;.control-label.col-sm-2&lt;/span&gt; Expiration
            &lt;span class="nc"&gt;.col-sm-3&lt;/span&gt;
              &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;select_month&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;Date&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;today&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="ss"&gt;add_month_numbers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;  &lt;span class="ss"&gt;class&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;form-control&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;data&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="ss"&gt;stripe&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;exp-month&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
            &lt;span class="nc"&gt;.col-sm-2&lt;/span&gt;
              &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;select_year&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;Date&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;today&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;year&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="ss"&gt;start_year&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;Date&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;today&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;year&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;end_year&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;Date&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;today&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;year&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="ss"&gt;class&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;form-control&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;data&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="ss"&gt;stripe&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;exp-year&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
        &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;form_group&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
          &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;submit&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sign up&amp;quot;&lt;/span&gt;
{% endcodeblock %}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;上面程式碼所用到的 &lt;code&gt;payment.js&lt;/code&gt; 內容如下&lt;/p&gt;
&lt;p&gt;app/assets/javascripts/payment.js:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nx"&gt;jQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;#payment-form&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;submit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;event&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;$form&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="c1"&gt;// Disable the submit button to prevent repeated clicks&lt;/span&gt;
    &lt;span class="nx"&gt;$form&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;button&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;prop&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;disabled&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="nx"&gt;Stripe&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;card&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;createToken&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;$form&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;stripeResponseHandler&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="c1"&gt;// Prevent the form from submitting with the default action&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;

  &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;stripeResponseHandler&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;status&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;$form&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;#payment-form&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;error&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="c1"&gt;// Show the errors on the form&lt;/span&gt;
      &lt;span class="nx"&gt;$form&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.payment-errors&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;error&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="nx"&gt;$form&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;button&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;prop&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;disabled&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="c1"&gt;// response contains id and card, which contains additional card details&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;token&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="c1"&gt;// Insert the token into the form so it gets submitted to the server&lt;/span&gt;
      &lt;span class="nx"&gt;$form&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;lt;input type=&amp;quot;hidden&amp;quot; name=&amp;quot;stripeToken&amp;quot; /&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;val&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;token&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
      &lt;span class="c1"&gt;// and submit&lt;/span&gt;
      &lt;span class="nx"&gt;$form&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;submit&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category><category term="stripe"></category></entry><entry><title>使用 Figaro 設定環境變數</title><link href="http://tsaith.github.io/shi-yong-figaro-she-ding-huan-jing-bian-shu.html" rel="alternate"></link><updated>2015-01-16T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-16:shi-yong-figaro-she-ding-huan-jing-bian-shu.html</id><summary type="html">&lt;p&gt;開發專案時，
我們常常需要在不同的環境下(例如 development、test 或 production)為環境變數設定不同的值，
倘若每次都要手動設定，
不僅浪費時間而且很容易發生錯誤;
對於這個問題，
&lt;a href="https://github.com/laserlemon/figaro"&gt;Figaro&lt;/a&gt;
提供了一個簡潔的方法來處理。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;在 Gemfile 中加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;figaro&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 &lt;code&gt;bundle install&lt;/code&gt; 進行安裝。&lt;/p&gt;
&lt;h3&gt;設定環境變數&lt;/h3&gt;
&lt;p&gt;請在專案目錄下，執行 &lt;code&gt;figaro install&lt;/code&gt;，這命令將&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;自動產生 &lt;code&gt;config/application.yml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;將此檔案加到 &lt;code&gt;.gitignore&lt;/code&gt; 裡面&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;然後就可以在 &lt;code&gt;application.yml&lt;/code&gt; 裡面針對不同環境來設定變數，
如下&lt;/p&gt;
&lt;p&gt;config/application.yml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="l-Scalar-Plain"&gt;development&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;SMTP_USER_NAME&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;test@example.com&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;SMTP_PASSWORD&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;test_password&lt;/span&gt;

&lt;span class="l-Scalar-Plain"&gt;test&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;SMTP_USER_NAME&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;test@example.com&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;SMTP_PASSWORD&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;test_password&lt;/span&gt;

&lt;span class="l-Scalar-Plain"&gt;staging&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;SMTP_USER_NAME&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;test@example.com&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;SMTP_PASSWORD&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;test_password&lt;/span&gt;

&lt;span class="l-Scalar-Plain"&gt;production&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;SMTP_USER_NAME&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;live@example.com&lt;/span&gt;
  &lt;span class="l-Scalar-Plain"&gt;SMTP_PASSWORD&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;live_password&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;設定後，請記得重新啟動伺服器以載入變數。&lt;/p&gt;
&lt;h3&gt;設定 Heroku 環境變數&lt;/h3&gt;
&lt;p&gt;Figaro 還提供了方便的指令可以一次將設定檔的環境變數輸出到 Heroku 上，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;figaro heroku:set -e production
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>管理者登入機制</title><link href="http://tsaith.github.io/guan-li-zhe-deng-ru-ji-zhi.html" rel="alternate"></link><updated>2015-01-14T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-14:guan-li-zhe-deng-ru-ji-zhi.html</id><summary type="html">&lt;p&gt;後台管理系統是網站的一項重要功能，
使用者必須擁有管理者權限才可以在後台進行一些特定操作
(例如，新增商品、下架、查看交易記錄 ... 等);
這篇文章將敘述如何在使用者&lt;a href="/blog/2014/11/09/how-to-implement-user-authentication-in-rails"&gt;驗證機制&lt;/a&gt;
中加入管理者權限，並在登入後可以訪問後台的工作頁面。&lt;/p&gt;
&lt;h3&gt;新增欄位&lt;/h3&gt;
&lt;p&gt;在 &lt;code&gt;users&lt;/code&gt; table 加入 &lt;code&gt;admin&lt;/code&gt; 欄位&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;rails g migration add_admin_to_users admin:boolean
&lt;span class="nv"&gt;$ &lt;/span&gt;rake db:migrate
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;查看 &lt;code&gt;admin&lt;/code&gt; 欄位是否已成功加入&lt;/p&gt;
&lt;p&gt;db/schema.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;users&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;force&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;full_name&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;email&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;password_digest&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;slug&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;token&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;boolean&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;admin&amp;quot;&lt;/span&gt; &lt;span class="c1"&gt;# 新增的欄位&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;設定 routes&lt;/h3&gt;
&lt;p&gt;加入管理者新增影片的路徑&lt;/p&gt;
&lt;p&gt;config/routes.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;省略程式碼&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

&lt;span class="n"&gt;namespace&lt;/span&gt; &lt;span class="ss"&gt;:admin&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;resources&lt;/span&gt; &lt;span class="ss"&gt;:videos&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;only&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:new&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Controllers&lt;/h3&gt;
&lt;p&gt;在 app/controllers/admin 目錄下，
新增 &lt;code&gt;VideosController&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;app/controllers/admin/videos_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Admin&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;VideosController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;AdminsController&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;new&lt;/span&gt;
    &lt;span class="vi"&gt;@video&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;
    &lt;span class="c1"&gt;# ... 省略程式碼 ...&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;app/controllers/admin_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;AdminsController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;AuthenticatedController&lt;/span&gt;
  &lt;span class="n"&gt;before_action&lt;/span&gt; &lt;span class="ss"&gt;:require_admin&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;app/controllers/authenticated_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;AuthenticatedController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;
  &lt;span class="n"&gt;before_action&lt;/span&gt; &lt;span class="ss"&gt;:require_user&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Views&lt;/h3&gt;
&lt;p&gt;在網頁中加入連結，導向新增影片的頁面
app/views/shared/_header.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;%li&lt;/span&gt;
  &lt;span class="cp"&gt;-# 新增影片&lt;/span&gt;
  &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Add Video&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;new_admin_video_path&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;current_user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;admin?&lt;/span&gt;
  &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Invite a friend&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;new_invitation_path&lt;/span&gt;
  &lt;span class="nt"&gt;%a&lt;/span&gt;(&lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;#&amp;quot;&lt;/span&gt;) Account
  &lt;span class="nt"&gt;%a&lt;/span&gt;(&lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;#&amp;quot;&lt;/span&gt;) Plan and Billing
  &lt;span class="nt"&gt;%a&lt;/span&gt;(&lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/sign_out&amp;quot;&lt;/span&gt;) Sign Out
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在 app/views/admin/videos/ 下面加入新增影片的頁面&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm8.staticflickr.com/7544/16297530732_85cd796652_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;app/views/admin/videos/new.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.admin_add_video&lt;/span&gt;
  &lt;span class="nc"&gt;.container&lt;/span&gt;
    &lt;span class="nc"&gt;.row&lt;/span&gt;
      &lt;span class="nc"&gt;.col-md-10.col-md-offset-1&lt;/span&gt;
        &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bootstrap_form_for&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:admin&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="vi"&gt;@video&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;layout&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;:horizontal&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;label_col&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;col-sm-3&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;control_col&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;col-sm-6&amp;quot;&lt;/span&gt;  &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
          &lt;span class="nt"&gt;%ul&lt;/span&gt;&lt;span class="nc"&gt;.nav.nav-tabs&lt;/span&gt;
            &lt;span class="nt"&gt;%li&lt;/span&gt;
              &lt;span class="nt"&gt;%a&lt;/span&gt;(&lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;) Recent Payments
            &lt;span class="nt"&gt;%li&lt;/span&gt;&lt;span class="nc"&gt;.active&lt;/span&gt;
              &lt;span class="nt"&gt;%a&lt;/span&gt;(&lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;) Add a New Video
          &lt;span class="nt"&gt;%br&lt;/span&gt;
          &lt;span class="nt"&gt;%fieldset&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text_field&lt;/span&gt; &lt;span class="ss"&gt;:title&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;control_col&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;col-sm-3&amp;quot;&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;select&lt;/span&gt; &lt;span class="ss"&gt;:category_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;options_from_collection_for_select&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;Category&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text_area&lt;/span&gt; &lt;span class="ss"&gt;:description&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;rows&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;
            &lt;span class="nc"&gt;.form-group&lt;/span&gt;
              &lt;span class="nt"&gt;%label&lt;/span&gt;&lt;span class="nc"&gt;.control-label.col-sm-3&lt;/span&gt; Large Cover
              &lt;span class="nc"&gt;.col-sm-6&lt;/span&gt;
                &lt;span class="nt"&gt;%col&lt;/span&gt;&lt;span class="nc"&gt;.btn.btn-file&lt;/span&gt;
                  &lt;span class="nt"&gt;%input&lt;/span&gt;&lt;span class="nc"&gt;.form-control&lt;/span&gt;(&lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;file&amp;quot;&lt;/span&gt;)
            &lt;span class="nc"&gt;.form-group&lt;/span&gt;
              &lt;span class="nt"&gt;%label&lt;/span&gt;&lt;span class="nc"&gt;.control-label.col-sm-3&lt;/span&gt; Small Cover
              &lt;span class="nc"&gt;.col-sm-6&lt;/span&gt;
                &lt;span class="nt"&gt;%col&lt;/span&gt;&lt;span class="nc"&gt;.btn.btn-file&lt;/span&gt;
                  &lt;span class="nt"&gt;%input&lt;/span&gt;&lt;span class="nc"&gt;.form-control&lt;/span&gt;(&lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;file&amp;quot;&lt;/span&gt;)
          &lt;span class="nt"&gt;%fieldset&lt;/span&gt;&lt;span class="nc"&gt;.actions.form-group&lt;/span&gt;
            &lt;span class="nc"&gt;.col-sm-6.col-md-offset-3&lt;/span&gt;
              &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;submit&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Add Video&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;btn btn-default&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>使用 CarrierWave 上傳檔案到 AWS S3</title><link href="http://tsaith.github.io/shi-yong-carrierwave-shang-chuan-dang-an-dao-aws-s3.html" rel="alternate"></link><updated>2015-01-14T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-14:shi-yong-carrierwave-shang-chuan-dang-an-dao-aws-s3.html</id><summary type="html">&lt;p&gt;在網路應用中，將檔案上傳到雲端儲存服務是個常見並且重要的功能，
這篇文章將示範如何在 Rails 專案中使用 &lt;a href="https://github.com/carrierwaveuploader/carrierwave"&gt;CarrierWave&lt;/a&gt; 將檔案上傳到
&lt;a href="http://aws.amazon.com/s3/"&gt;AWS S3&lt;/a&gt;的實作流程。&lt;/p&gt;
&lt;h3&gt;申請 AWS S3&lt;/h3&gt;
&lt;p&gt;先在 AWS 的官網進行&lt;a href="http://aws.amazon.com/"&gt;註冊&lt;/a&gt;，
若是第一次使用 AWS，在登入帳號後，
需要先到 &lt;a href="https://console.aws.amazon.com/iam/home?region=ap-northeast-1#home"&gt;IAM&lt;/a&gt; 新增使用者群組並選擇適當的權限(例如 Amazon S3 Full Access)，
然後再新增一位使用者，
將使用者加入到剛剛新增的群組中，
確保該使用者有存取 S3 的權限。
最後，再到 &lt;a href="https://console.aws.amazon.com/s3/home?region=ap-northeast-1"&gt;S3&lt;/a&gt; 的服務下，
為專案新增 &lt;a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/UsingBucket.html"&gt;buckets&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;因為 CarrierWave 需要使用到 &lt;a href="http://www.imagemagick.org/"&gt;ImageMagic&lt;/a&gt;，
若您的開發環境是 Mac，可以使用 Homebrew 進行安裝&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;brew install imagemagick
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;接著在 Gemfile 中加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;gem &amp;#39;carrierwave&amp;#39;
gem &amp;#39;mini_magick&amp;#39;
gem &amp;#39;fog&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 &lt;code&gt;bundle install&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;請注意，因為 &lt;code&gt;MiniMagick&lt;/code&gt; 是 &lt;code&gt;ImageMagick&lt;/code&gt; 的 Ruby 界面，
所以它的安裝順序需要在 &lt;code&gt;ImageMagick&lt;/code&gt; 之後。&lt;/p&gt;
&lt;h3&gt;開發目標&lt;/h3&gt;
&lt;p&gt;假設我們現在希望為網站開發一個上傳影片的功能，
每部影片有兩種尺寸的封面圖片，以及影片的連結;
下面將敘述實作的流程。&lt;/p&gt;
&lt;h3&gt;新增欄位&lt;/h3&gt;
&lt;p&gt;先在資料庫的 &lt;code&gt;videos&lt;/code&gt; table 裡面新增
&lt;code&gt;large_cover&lt;/code&gt;、 &lt;code&gt;small_cover&lt;/code&gt; 以及 &lt;code&gt;video_url&lt;/code&gt; 三個欄位，如下&lt;/p&gt;
&lt;p&gt;db/schema.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;videos&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;force&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;title&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;integer&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;category_id&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;large_cover&amp;quot;&lt;/span&gt; &lt;span class="c1"&gt;# 大尺寸的封面&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;small_cover&amp;quot;&lt;/span&gt; &lt;span class="c1"&gt;# 小尺寸的封面&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;video_url&amp;quot;&lt;/span&gt;   &lt;span class="c1"&gt;# 影片連結&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;     &lt;span class="s2"&gt;&amp;quot;description&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;slug&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;產生 uploader&lt;/h3&gt;
&lt;p&gt;在專案目錄下執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;rails generate uploader large_cover
rails generate uploader small_cover
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後編輯剛產生出來的兩個 uploader 檔案，內容如下&lt;/p&gt;
&lt;p&gt;app/uploaders/large_cover.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;# encoding: utf-8&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;LargeCoverUploader&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;CarrierWave&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Uploader&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="kp"&gt;include&lt;/span&gt; &lt;span class="no"&gt;CarrierWave&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;MiniMagick&lt;/span&gt;

  &lt;span class="n"&gt;process&lt;/span&gt; &lt;span class="ss"&gt;:resize_to_fill&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;665&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;375&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="c1"&gt;# 圖片大小&lt;/span&gt;

  &lt;span class="c1"&gt;# Override the directory where uploaded files will be stored.&lt;/span&gt;
  &lt;span class="c1"&gt;# This is a sensible default for uploaders that are meant to be mounted:&lt;/span&gt;
  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;store_dir&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;uploads/&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;class&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;underscore&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;mounted_as&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;app/uploaders/small_cover.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;# encoding: utf-8&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SmallCoverUploader&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;CarrierWave&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Uploader&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="kp"&gt;include&lt;/span&gt; &lt;span class="no"&gt;CarrierWave&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;MiniMagick&lt;/span&gt;

  &lt;span class="n"&gt;process&lt;/span&gt; &lt;span class="ss"&gt;:resize_to_fill&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;166&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;236&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="c1"&gt;# 圖片大小&lt;/span&gt;

  &lt;span class="c1"&gt;# Override the directory where uploaded files will be stored.&lt;/span&gt;
  &lt;span class="c1"&gt;# This is a sensible default for uploaders that are meant to be mounted:&lt;/span&gt;
  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;store_dir&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;uploads/&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;class&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;underscore&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;mounted_as&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;掛載 uploader&lt;/h3&gt;
&lt;p&gt;在 Video model 掛載上面產生的 uploaders，如下&lt;/p&gt;
&lt;p&gt;app/models/video.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Video&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="n"&gt;mount_uploader&lt;/span&gt; &lt;span class="ss"&gt;:large_cover&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;LargeCoverUploader&lt;/span&gt;
  &lt;span class="n"&gt;mount_uploader&lt;/span&gt; &lt;span class="ss"&gt;:small_cover&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;SmallCoverUploader&lt;/span&gt;

      &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;程式碼省略&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

    &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="c1"&gt;### 設定雲端檔案服務&lt;/span&gt;

&lt;span class="err"&gt;在&lt;/span&gt; &lt;span class="sb"&gt;`config/initializers`&lt;/span&gt; &lt;span class="err"&gt;目錄下新增檔案&lt;/span&gt; &lt;span class="sb"&gt;`carrierwave.rb`&lt;/span&gt; &lt;span class="err"&gt;設定如下&lt;/span&gt;

&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;initializers&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;carrierwave&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rb&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;

&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="ss"&gt;:ruby&lt;/span&gt;
&lt;span class="no"&gt;CarrierWave&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;configure&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="no"&gt;Rails&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;staging?&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="no"&gt;Rails&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;production?&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;storage&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:fog&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fog_credentials&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="ss"&gt;:provider&lt;/span&gt;               &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;AWS&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="ss"&gt;:aws_access_key_id&lt;/span&gt;      &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;AWS_ACCESS_KEY_ID&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="ss"&gt;:aws_secret_access_key&lt;/span&gt;  &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;AWS_SECRET_ACCESS_KEY&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="ss"&gt;:region&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;S3_BUCKET_REGION&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fog_directory&lt;/span&gt;  &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;S3_BUCKET_NAME&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
  &lt;span class="k"&gt;else&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;storage&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:file&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;enable_processing&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Rails&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;development?&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;若在 &lt;code&gt;staging&lt;/code&gt; 或 &lt;code&gt;production&lt;/code&gt; 環境下，
將會透過 &lt;code&gt;fog&lt;/code&gt; 上傳檔案到 AWS 的 bucket;
若是開發環境，
則會將檔案放在本地端的 &lt;code&gt;public&lt;/code&gt; 目錄下。&lt;/p&gt;
&lt;p&gt;設定 &lt;code&gt;:aws_access_key_id&lt;/code&gt; 和 &lt;code&gt;:aws_secret_access_key&lt;/code&gt; 時，
請使用 &lt;code&gt;IAM&lt;/code&gt; 的使用者驗証資訊。&lt;/p&gt;
&lt;h3&gt;View 與 Controller&lt;/h3&gt;
&lt;p&gt;最後再編寫上傳檔案的界面，如下&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm8.staticflickr.com/7312/16175096728_04b1014aa4_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;新增影片時將會自動上傳封面圖片到遠端。
通常，我們不會直接上傳影片(因為檔案較大)到 S3，
而會使用專業的影片服務進行上傳，再儲存網址。
若是公開的影片，可以使用 &lt;a href="https://www.youtube.com/"&gt;YouTube&lt;/a&gt;;
不公開的影片，可以考慮 &lt;a href="https://vimeo.com/"&gt;Vimeo&lt;/a&gt; 或 &lt;a href="http://wistia.com/"&gt;Wistia&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;以下是 view 的程式碼&lt;/p&gt;
&lt;p&gt;app/views/admin/videos/new.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.admin_add_video&lt;/span&gt;
  &lt;span class="nc"&gt;.container&lt;/span&gt;
    &lt;span class="nc"&gt;.row&lt;/span&gt;
      &lt;span class="nc"&gt;.col-md-10.col-md-offset-1&lt;/span&gt;
        &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bootstrap_form_for&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:admin&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="vi"&gt;@video&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;layout&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;:horizontal&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="ss"&gt;label_col&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;col-sm-3&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;control_col&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;col-sm-6&amp;quot;&lt;/span&gt;  &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
          &lt;span class="nt"&gt;%ul&lt;/span&gt;&lt;span class="nc"&gt;.nav.nav-tabs&lt;/span&gt;
            &lt;span class="nt"&gt;%li&lt;/span&gt;
              &lt;span class="nt"&gt;%a&lt;/span&gt;(&lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;) Recent Payments
            &lt;span class="nt"&gt;%li&lt;/span&gt;&lt;span class="nc"&gt;.active&lt;/span&gt;
              &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Add a New Video&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;new_admin_video_path&lt;/span&gt;
          &lt;span class="nt"&gt;%br&lt;/span&gt;
          &lt;span class="nt"&gt;%fieldset&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text_field&lt;/span&gt; &lt;span class="ss"&gt;:title&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;control_col&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;col-sm-3&amp;quot;&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;select&lt;/span&gt; &lt;span class="ss"&gt;:category_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
              &lt;span class="n"&gt;options_from_collection_for_select&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;Category&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text_area&lt;/span&gt; &lt;span class="ss"&gt;:description&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;rows&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;file_field&lt;/span&gt; &lt;span class="ss"&gt;:large_cover&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;btn btn-default btn-file&amp;quot;&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;file_field&lt;/span&gt; &lt;span class="ss"&gt;:small_cover&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;btn btn-default btn-file&amp;quot;&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text_field&lt;/span&gt; &lt;span class="ss"&gt;:video_url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;label&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Video URL&amp;quot;&lt;/span&gt;
          &lt;span class="nt"&gt;%fieldset&lt;/span&gt;&lt;span class="nc"&gt;.actions.form-group&lt;/span&gt;
            &lt;span class="nc"&gt;.col-sm-6.col-md-offset-3&lt;/span&gt;
              &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;submit&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Add Video&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;btn btn-default&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;對應的 controller 如下&lt;/p&gt;
&lt;p&gt;app/controllers/admin/video_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Admin&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;VideosController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;AdminsController&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;new&lt;/span&gt;
    &lt;span class="vi"&gt;@video&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;
    &lt;span class="vi"&gt;@video&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;video_params&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vi"&gt;@video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:success&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;You have successfully added the video &amp;#39;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="vi"&gt;@video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;#39;.&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;new_admin_video_path&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:danger&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;You cannot add this video. Please check the errors.&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;render&lt;/span&gt; &lt;span class="ss"&gt;:new&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="kp"&gt;private&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;video_params&lt;/span&gt;
    &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;require&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:video&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;permit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:title&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:category_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:description&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                                  &lt;span class="ss"&gt;:large_cover&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:small_cover&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:video_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category><category term="aws"></category></entry><entry><title>監視產品錯誤: Sentry</title><link href="http://tsaith.github.io/jian-shi-chan-pin-cuo-wu-sentry.html" rel="alternate"></link><updated>2015-01-13T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-13:jian-shi-chan-pin-cuo-wu-sentry.html</id><summary type="html">&lt;p&gt;當產品在線上工作時，如果發生意外的錯誤，
為了保持好的使用者體驗，
我們必須盡可能地在第一時間發現問題並迅速解決;
這裡要介紹一項好用的服務 &lt;a href="https://getsentry.com"&gt;Sentry&lt;/a&gt;，
它可以為我們監控產品的運作狀況，
當錯誤發生時自動寄信通知我們並且記錄 log 中的錯誤訊息。&lt;/p&gt;
&lt;h3&gt;申請帳號&lt;/h3&gt;
&lt;p&gt;Sentry 有提供 &lt;a href="https://www.getsentry.com/register/"&gt;Trial plan&lt;/a&gt; 只要註冊就可以免費使用;
註冊後，請先新增 &lt;code&gt;Team&lt;/code&gt; 然後再新增 &lt;code&gt;Project&lt;/code&gt;，
在 &lt;code&gt;Project&lt;/code&gt; 的設定裡面可以取得 &lt;code&gt;API Key&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;在 Gemfile 加入 Sentry 的 Ruby 客戶端套件，
&lt;a href="https://github.com/getsentry/raven-ruby"&gt;raven-ruby&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;group&lt;/span&gt; &lt;span class="ss"&gt;:production&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:staging&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sentry-raven&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 &lt;code&gt;bundle install&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;接下來，請為 &lt;code&gt;production&lt;/code&gt; 和 &lt;code&gt;staging&lt;/code&gt; 環境，
設定 &lt;code&gt;SENTRY_DSN&lt;/code&gt; 環境變數，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;# 請填入專案的 API Key
export SENTRY_DSN=http://public:secret@example.com/project-id
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;設定完成並且部署到遠端後，
以後只要產品的運作出現錯誤，
Sentry 就會自動將錯誤訊息寄送到我們的信箱。&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>使用 paratropper 自動化部署流程</title><link href="http://tsaith.github.io/shi-yong-paratropper-zi-dong-hua-bu-shu-liu-cheng.html" rel="alternate"></link><updated>2015-01-13T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-13:shi-yong-paratropper-zi-dong-hua-bu-shu-liu-cheng.html</id><summary type="html">&lt;p&gt;假設我們已經在 Heroku 上面架設了 staging 和 production servers，
倘若每次修改完程式都要手動地處理部署的工作，
這不僅沒有效率，而且很容易發生錯誤;
所以這裡將介紹如何使用 &lt;a href="https://github.com/mattpolito/paratrooper"&gt;paratrooper&lt;/a&gt;，將部署的流程自動化。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;在 Gemfile 加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;gem &amp;#39;paratrooper&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 &lt;code&gt;bundle install&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;設定流程&lt;/h3&gt;
&lt;p&gt;在 lib/tasks/ 裡面新增一個檔案 deploy.rake 內容如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;paratrooper&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;namespace&lt;/span&gt; &lt;span class="ss"&gt;:deploy&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;desc&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Deploy app in staging environment&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;task&lt;/span&gt; &lt;span class="ss"&gt;:staging&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;deployment&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Paratrooper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Deploy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;amazing-staging-app&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;tag&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;staging&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;deployment&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deploy&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;desc&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Deploy app in production environment&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;task&lt;/span&gt; &lt;span class="ss"&gt;:production&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;deployment&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Paratrooper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Deploy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;amazing-production-app&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;deploy&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
      &lt;span class="n"&gt;deploy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tag&lt;/span&gt;              &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;production&amp;#39;&lt;/span&gt;
      &lt;span class="n"&gt;deploy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;match_tag&lt;/span&gt;        &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;staging&amp;#39;&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;deployment&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deploy&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;注意，上面程式中的 &lt;code&gt;amazing-staging-app&lt;/code&gt; 和 &lt;code&gt;amazing-production-app&lt;/code&gt;，需要修改成你的 staging 和 production 名稱。&lt;/p&gt;
&lt;p&gt;現在，若要 deploy 到 staging 請執行 &lt;code&gt;rake deploy:staging&lt;/code&gt;;
倘若想 deploy 到 production 則執行 &lt;code&gt;rake deploy:production&lt;/code&gt;。&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>在 Heroku 上架設 staging server</title><link href="http://tsaith.github.io/zai-heroku-shang-jia-she-staging-server.html" rel="alternate"></link><updated>2015-01-13T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-13:zai-heroku-shang-jia-she-staging-server.html</id><summary type="html">&lt;p&gt;開發專案時，
有時候我們會遇到在本地端測試過的功能無法在上線時正常運作，
這往往是因為開發環境(通常是我們的個人電腦)，
與上線的環境並不相同;
為了解決這問題，
我們將程式更新到 production 之前，
需要先在 staging server 上測試過。
簡單地說，staging 所扮演的角色就是在模擬 production;
所以，我們應該盡可能地讓 staging 環境與 production 所在的環境一致。
這裡將介紹如何在 Heroku 平台上架設 staging server。&lt;/p&gt;
&lt;p&gt;假設，我們在 Heroku 上有一個 production 名字叫 &lt;code&gt;myflix&lt;/code&gt;，
而希望的 staging 名稱為 &lt;code&gt;myflix-staging&lt;/code&gt;;
那麼只要執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;heroku fork -a myflix myflix-staging
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Heroku 就會 fork 出 &lt;code&gt;myflix-staging&lt;/code&gt;，並且自動複製 &lt;code&gt;myflix&lt;/code&gt; 的資料庫與 add-ons，讓 staging 與 production 有相同的運作環境。&lt;/p&gt;
&lt;p&gt;此外，我們還需要在 git 中設定 &lt;code&gt;myflix-staging&lt;/code&gt; 的 repository，之後才能將程式也 push 到 staging 中。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;git remote add myflix-staging git@heroku.com:myflix-staging.git
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category><category term="heroku"></category></entry><entry><title>使用 Percol 進行模糊搜尋</title><link href="http://tsaith.github.io/shi-yong-percol-jin-xing-mo-hu-sou-xun.html" rel="alternate"></link><updated>2015-01-12T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-12:shi-yong-percol-jin-xing-mo-hu-sou-xun.html</id><summary type="html">&lt;p&gt;在開發專案時，我們常常需要在眾多資料夾下搜尋某個檔案，
可是往往卻無法記得完整的檔案名稱，或是找到檔案後，
希望能快速地將檔案路徑貼到其他應用程式上面。
針對以上的問題，
網路上有篇&lt;a href="http://blog.binchen.org/posts/how-to-do-the-file-navigation-efficiently.html"&gt;文章&lt;/a&gt;提出了使用
&lt;a href="https://github.com/mooz/percol"&gt;percol&lt;/a&gt;
結合 shell 命令的解決方案。
我稍微修改了一些流程，並記錄如下。&lt;/p&gt;
&lt;h3&gt;安裝 percol&lt;/h3&gt;
&lt;p&gt;因為 percol 是用 python 開發的工具，
所以我們需要先安裝 python 環境&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;brew install python
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;接著安裝 percol&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;pip install percol
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;設定 percol 快捷鍵&lt;/h3&gt;
&lt;p&gt;在 ~/.percol.d/rc.py 裡面定義常用的快捷鍵&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;# X / _ / X&lt;/span&gt;
&lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;view&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PROMPT&lt;/span&gt;  &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;lt;bold&amp;gt;&amp;lt;yellow&amp;gt;X / _ / X&amp;lt;/yellow&amp;gt;&amp;lt;/bold&amp;gt; %q&amp;quot;&lt;/span&gt;

&lt;span class="c"&gt;# Emacs like&lt;/span&gt;
&lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;import_keymap&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;C-h&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delete_backward_char&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;C-d&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delete_forward_char&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;C-k&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;kill_end_of_line&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;C-y&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;yank&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;C-t&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;transpose_chars&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;C-a&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;beginning_of_line&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;C-e&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;end_of_line&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;C-b&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;backward_char&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;C-f&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;forward_char&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;M-f&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;forward_word&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;M-b&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;backward_word&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;M-d&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delete_forward_word&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;M-h&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delete_backward_word&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;C-n&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;select_next&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;C-p&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;select_previous&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;C-v&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;select_next_page&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;M-v&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;select_previous_page&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;M-&amp;lt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;select_top&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;M-&amp;gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;select_bottom&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;C-m&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;finish&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;C-j&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;finish&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;C-g&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;percol&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cancel&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;定義 shell 命令&lt;/h3&gt;
&lt;p&gt;在 ~/.bash_profile 裡面自定常用的命令，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;# file navigation with percol
[ $(uname -s | grep -c CYGWIN) -eq 1 ] &lt;span class="err"&gt;&amp;amp;&amp;amp;&lt;/span&gt; OS_NAME=&amp;quot;CYGWIN&amp;quot; || OS_NAME=`uname -s`
function pclip() {
    if [ &lt;span class="nv"&gt;$OS_NAME&lt;/span&gt; == CYGWIN ]; then
        putclip $@;
    elif [ &lt;span class="nv"&gt;$OS_NAME&lt;/span&gt; == Darwin ]; then
        pbcopy $@;
    else
        if [ -x /usr/bin/xsel ]; then
            xsel -ib $@;
        else
            if [ -x /usr/bin/xclip ]; then
                xclip -selection c $@;
            else
                echo &amp;quot;Neither xsel or xclip is installed!&amp;quot;
            fi
        fi
    fi
}

function ff()
{
    local fullpath=$*
    local filename=&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;fullpath&lt;/span&gt;&lt;span class="c"&gt;##*/&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt; # remove &amp;quot;/&amp;quot; from the beginning
    filename=&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;filename&lt;/span&gt;&lt;span class="c"&gt;##*./&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt; # remove  &amp;quot;.../&amp;quot; from the beginning
    echo file=&lt;span class="nv"&gt;$filename&lt;/span&gt;
    #  only the filename without path is needed
    # filename should be reasonable
    local cli=`find &lt;span class="nv"&gt;$PWD&lt;/span&gt; -not -iwholename &amp;#39;*/target/*&amp;#39; -not -iwholename &amp;#39;*.svn*&amp;#39; -not -iwholename &amp;#39;*.git*&amp;#39; -not -iwholename &amp;#39;*.sass-cache*&amp;#39; -not -iwholename &amp;#39;*.hg*&amp;#39; -type f -iwholename &amp;#39;*&amp;#39;&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;filename&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;&amp;#39;*&amp;#39; -print | percol`
    echo &lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;cli&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;
    echo -n &lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;cli&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt; |pclip;
}

function h () {
    # reverse history, pick up one line, remove new line characters and put it into clipboard
    if [ -z &amp;quot;$1&amp;quot; ]; then
        history | sed &amp;#39;1!G;h;$!d&amp;#39; | percol | sed -n &amp;#39;s/^ *[0-9][0-9]* *\(.*\)$/\1/p&amp;#39;| tr -d &amp;#39;\n&amp;#39; | pclip
    else
        history | grep &amp;quot;$1&amp;quot; | sed &amp;#39;1!G;h;$!d&amp;#39; | percol | sed -n &amp;#39;s/^ *[0-9][0-9]* *\(.*\)$/\1/p&amp;#39;| tr -d &amp;#39;\n&amp;#39; | pclip
    fi
}

function glsf () {
    local str=`git --no-pager log --oneline --stat $* |  percol`
    if [[ &lt;span class="nv"&gt;$str&lt;/span&gt; =~ ^[[:space:]]*([a-z0-9A-Z_.\/-]*).*$ ]]; then
        echo -n &lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;BASH_REMATCH&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt; | pclip;
        echo &lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;BASH_REMATCH&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;
    fi
}

function ppgrep() {
    if [[ $1 == &amp;quot;&amp;quot; ]]; then
        PERCOL=percol
    else
        PERCOL=&amp;quot;percol --query $1&amp;quot;
    fi
    ps aux | eval &lt;span class="nv"&gt;$PERCOL&lt;/span&gt; | awk &amp;#39;{ print $2 }&amp;#39;
}

function ppkill() {
    if [[ $1 =~ &amp;quot;^-&amp;quot; ]]; then
        QUERY=&amp;quot;&amp;quot;            # options only
    else
        QUERY=$1            # with a query
        [[ $# &amp;gt; 0 ]] &lt;span class="err"&gt;&amp;amp;&amp;amp;&lt;/span&gt; shift
    fi
    ppgrep &lt;span class="nv"&gt;$QUERY&lt;/span&gt; | xargs kill $*
}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;存檔後，若不想重開 terminal 可直接執行
&lt;code&gt;source ~/.bash_profile&lt;/code&gt;
就可以立刻使用上面定義的命令。&lt;/p&gt;
&lt;h3&gt;使用範例&lt;/h3&gt;
&lt;p&gt;在專案下執行 &lt;code&gt;ff&lt;/code&gt;，可以使用片段的檔名進行搜尋，
選擇檔案後按 &lt;code&gt;Return&lt;/code&gt; 就會自動將檔名拷貝到系統的剪貼簿上。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm9.staticflickr.com/8659/16260930815_87c4d30484_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;直接執行 &lt;code&gt;h&lt;/code&gt;，可搜尋並拷貝歷史命令。
&lt;img src="https://farm9.staticflickr.com/8644/15641025303_2ca6346fb7_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;如果想強制離開搜尋畫面，請按 &lt;code&gt;Ctrl&lt;/code&gt;+ &lt;code&gt;c&lt;/code&gt;。&lt;/p&gt;</summary><category term="utils"></category></entry><entry><title>使用 Procfile 和 Foreman</title><link href="http://tsaith.github.io/shi-yong-procfile-he-foreman.html" rel="alternate"></link><updated>2015-01-12T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-12:shi-yong-procfile-he-foreman.html</id><summary type="html">&lt;p&gt;架設在 Heroku 上面的 app，
會使用一個檔案 &lt;code&gt;Procfile&lt;/code&gt; 來宣告有哪些命令將被 &lt;a href="https://devcenter.heroku.com/articles/dynos"&gt;dynos&lt;/a&gt; 所執行。
&lt;code&gt;Procfile&lt;/code&gt; 是位於專案下的一個文字檔，
在檔案的內容中，
左側指定 process type，而右側是要執行的命令，
如以下的範例&lt;/p&gt;
&lt;p&gt;{% codeblock Procfile %}
web: bundle exec rails server -p $PORT
{% endcodeblock %}
在 Heroku 上 &lt;code&gt;$PORT&lt;/code&gt; 的預設值是 &lt;code&gt;5000&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;使用 Foreman&lt;/h3&gt;
&lt;p&gt;在本地端開發或偵錯應用程式時，
應該與遠端採用同樣的執行步驟，
以避免因為步驟的不同而造成難以發現的錯誤。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://toolbelt.heroku.com/"&gt;Heroku Toolbelt&lt;/a&gt; 提供了一個命令 &lt;code&gt;foreman&lt;/code&gt;，
讓我們可以在本地端按照 &lt;code&gt;Procfile&lt;/code&gt; 的內容來啟動 app。&lt;/p&gt;
&lt;p&gt;假設我們使用的 &lt;code&gt;Profile&lt;/code&gt; 內容為&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;web&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;bundle&lt;/span&gt; &lt;span class="n"&gt;exec&lt;/span&gt; &lt;span class="n"&gt;rails&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="n"&gt;$PORT&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;執行 &lt;code&gt;foreman start&lt;/code&gt; 後，將可以看到訊息如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;foreman start
09:09:59 web.1  &lt;span class="p"&gt;|&lt;/span&gt; started with pid 3111
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;這時候連到 &lt;code&gt;http://localhost:5000/&lt;/code&gt; 就可以看到已啟動的服務。&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>在 Heroku 上架設 concurrent server</title><link href="http://tsaith.github.io/zai-heroku-shang-jia-she-concurrent-server.html" rel="alternate"></link><updated>2015-01-12T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-12:zai-heroku-shang-jia-she-concurrent-server.html</id><summary type="html">&lt;p&gt;這篇文章將介紹如何使用
&lt;a href="http://unicorn.bogomips.org/"&gt;Unicorn&lt;/a&gt; 和
&lt;a href="http://sidekiq.org/"&gt;Sidekiq&lt;/a&gt;
在 Heroku 上架設能夠處理 concurrent requests 的伺服器。&lt;/p&gt;
&lt;h3&gt;申請 Redis To Go&lt;/h3&gt;
&lt;p&gt;因為 Sidekiq 需要用到 &lt;a href="http://redis.io/"&gt;Redis&lt;/a&gt;，
所以需要先在 Heroku 為你的 app 申請免費的
&lt;a href="https://addons.heroku.com/redistogo"&gt;Redis To Go&lt;/a&gt; 服務。&lt;/p&gt;
&lt;h3&gt;安裝 gems&lt;/h3&gt;
&lt;p&gt;在專案目錄下的 Gemfile 中加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;gem &amp;#39;unicorn&amp;#39;
gem &amp;#39;sidekiq&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 &lt;code&gt;bundle install&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;設定 Unicorn&lt;/h3&gt;
&lt;p&gt;在 config/ 下新增檔案 &lt;code&gt;unicorn.rb&lt;/code&gt;，內容如下&lt;/p&gt;
&lt;p&gt;config/unicorn.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;worker_processes&lt;/span&gt; &lt;span class="nb"&gt;Integer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;WEB_CONCURRENCY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;timeout&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;
&lt;span class="n"&gt;preload_app&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;

&lt;span class="n"&gt;before_fork&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="no"&gt;Signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;trap&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;TERM&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="nb"&gt;puts&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Unicorn master intercepting TERM and sending myself QUIT instead&amp;#39;&lt;/span&gt;
    &lt;span class="no"&gt;Process&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;kill&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;QUIT&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;Process&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;defined?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt;
    &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;disconnect!&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="n"&gt;after_fork&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="no"&gt;Signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;trap&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;TERM&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="nb"&gt;puts&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Unicorn worker intercepting TERM and doing nothing. Wait for master to send QUIT&amp;#39;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;defined?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt;
    &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;establish_connection&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;關於 Unicorn 的設定，Heroku 有提供詳細的&lt;a href="https://devcenter.heroku.com/articles/rails-unicorn"&gt;說明&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;設定 Procfile&lt;/h3&gt;
&lt;p&gt;在專案目錄下設定 &lt;code&gt;Procfile&lt;/code&gt;，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;web&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;bundle&lt;/span&gt; &lt;span class="n"&gt;exec&lt;/span&gt; &lt;span class="n"&gt;unicorn&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="n"&gt;$PORT&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="o"&gt;./&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;unicorn&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;rb&lt;/span&gt;
&lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;bundle&lt;/span&gt; &lt;span class="n"&gt;exec&lt;/span&gt; &lt;span class="n"&gt;sidekiq&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;最後，再將專案部署到 Heroku 就完成了;
倘若想檢查目前有幾個 dynos 正在運行，
可以執行 &lt;code&gt;heroku ps&lt;/code&gt; 來查看狀態。&lt;/p&gt;
&lt;h3&gt;同場加映&lt;/h3&gt;
&lt;p&gt;在上面的設定中，一共會使用到兩個 dynos;
一個給 web，另一個給 Sidekiq。
但 Heroku 的免費方案只提供一個 dyno，
倘若只是想要練習，
我們可以修改 &lt;code&gt;unicorn.rb&lt;/code&gt;，
要求 unicorn 的 worker 來跑 Sidekiq&lt;/p&gt;
&lt;p&gt;config/unicorn.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;worker_processes&lt;/span&gt; &lt;span class="nb"&gt;Integer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;WEB_CONCURRENCY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;timeout&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;
&lt;span class="n"&gt;preload_app&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;

&lt;span class="n"&gt;before_fork&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="no"&gt;Signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;trap&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;TERM&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="nb"&gt;puts&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Unicorn master intercepting TERM and sending myself QUIT instead&amp;#39;&lt;/span&gt;
    &lt;span class="no"&gt;Process&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;kill&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;QUIT&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;Process&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;defined?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt;
    &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;disconnect!&lt;/span&gt;

  &lt;span class="c1"&gt;# 加入這一行&lt;/span&gt;
  &lt;span class="vi"&gt;@sidekiq_pid&lt;/span&gt; &lt;span class="o"&gt;||=&lt;/span&gt; &lt;span class="n"&gt;spawn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bundle exec sidekiq -c 2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="n"&gt;after_fork&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="no"&gt;Signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;trap&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;TERM&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="nb"&gt;puts&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Unicorn worker intercepting TERM and doing nothing. Wait for master to send QUIT&amp;#39;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;defined?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt;
    &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;establish_connection&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後再修改 &lt;code&gt;Procfile&lt;/code&gt;，保留 web dyno 即可。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;web&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;bundle&lt;/span&gt; &lt;span class="n"&gt;exec&lt;/span&gt; &lt;span class="n"&gt;unicorn&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="n"&gt;$PORT&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="o"&gt;./&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;unicorn&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;rb&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category><category term="heroku"></category></entry><entry><title>使用 Sidekiq 處理背景工作</title><link href="http://tsaith.github.io/shi-yong-sidekiq-chu-li-bei-jing-gong-zuo.html" rel="alternate"></link><updated>2015-01-11T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-11:shi-yong-sidekiq-chu-li-bei-jing-gong-zuo.html</id><summary type="html">&lt;p&gt;這裡將介紹如何使用 &lt;a href="https://github.com/mperham/sidekiq"&gt;Sidekiq&lt;/a&gt;
透過 threads 同時處理多項工作;
例如我們將比較花費時間的動作放到背景處理，
以提升使用者的操作體驗。&lt;/p&gt;
&lt;h3&gt;安裝 Sidekiq&lt;/h3&gt;
&lt;p&gt;在 Gemfile 中加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;gem &amp;#39;sidekiq&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 &lt;code&gt;bundle&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;安裝 redis&lt;/h3&gt;
&lt;p&gt;Sidekiq 執行時需要使用到 &lt;a href="http://redis.io/"&gt;redis&lt;/a&gt;，
倘若開發環境是 Mac 的話，
可以使用 Homebrew 進行安裝&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;brew install redis
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;啟動 redis 和 sidekiq servers&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;redis: 執行 &lt;code&gt;redis-server&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;sidekiq: 在 Rails 專案下，執行 &lt;code&gt;bundle exec sidekiq&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;程式範例&lt;/h3&gt;
&lt;p&gt;假設我們有一個寄送信件的動作如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;AppMailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_welcome_email&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliver&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;只要使用 Sidekiq 的 &lt;a href="https://github.com/mperham/sidekiq/wiki/Delayed-extensions"&gt;delay&lt;/a&gt; method 就可以很容易地將動作放到背景處理&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;AppMailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_welcome_email&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;在 Heroku 上設定 Redis 路徑&lt;/h3&gt;
&lt;p&gt;倘若您的網站架設在 Heroku 上，
並且使用 &lt;a href="https://addons.heroku.com/redistogo"&gt;Redis to Go&lt;/a&gt;，
由於 Sidekiq 是以 &lt;code&gt;REDIS_PROVIDER&lt;/code&gt; 環境變數來設定 Redis 的路徑，
然而 Heroku 所提供的環境變數是 &lt;code&gt;REDISTOGO&lt;/code&gt;;
所以我們可以執行下面的指令來連接這兩個環境變數&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;heroku config:set REDIS_PROVIDER=REDISTOGO
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;之後，
可以執行 &lt;code&gt;heroku config&lt;/code&gt; 確認環境變數是否已設定成功，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;heroku &lt;span class="nv"&gt;config&lt;/span&gt;
&lt;span class="o"&gt;===&lt;/span&gt; chlin-conifer Config Vars
RACK_ENV:                   production
RAILS_ENV:                  production
REDISTOGO_URL:              redis://redistogo:42528ab79e9e15ef9693733239b2d2c6@ray.redistogo.com:9795/
REDIS_PROVIDER:             REDISTOGO_URL
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>Heroku 上的郵件服務: Mailgun</title><link href="http://tsaith.github.io/heroku-shang-de-you-jian-fu-wu-mailgun.html" rel="alternate"></link><updated>2015-01-10T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-10:heroku-shang-de-you-jian-fu-wu-mailgun.html</id><summary type="html">&lt;p&gt;信件服務對許多網路應用都是相當重要的一環，
雖然我們可以使用免費的 gmail 帳號來寄送郵件，
但因為 gmail 每天可寄送的郵件數量有一定的上限(目前是每天 2,000 封)以及其他&lt;a href="https://support.google.com/a/answer/166852"&gt;限制&lt;/a&gt;，
所以在正式上線的環境，
我們還是會使用專業的郵件服務，例如 &lt;a href="http://www.mailgun.com/"&gt;Mailgun&lt;/a&gt;;
接下來將介紹如何在 Heroku 上使用 &lt;a href="https://addons.heroku.com/mailgun"&gt;Mailgun add-on&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;申請 Mailgun add-on&lt;/h3&gt;
&lt;p&gt;登入 Heroku 後填寫信用卡資料，
然後就可以申請免費的 &lt;a href="https://addons.heroku.com/mailgun"&gt;Mailgun starter plan&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;設定郵件環境&lt;/h3&gt;
&lt;p&gt;在 config/environments/production.rb 裡面加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;# Mailer&lt;/span&gt;
&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action_mailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;default_url_options&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="ss"&gt;:host&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;yourapp.herokuapp.com&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="c1"&gt;# 修改為您的 host&lt;/span&gt;
&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action_mailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delivery_method&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:smtp&lt;/span&gt;
&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action_mailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;smtp_settings&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="ss"&gt;address&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;MAILGUN_SMTP_SERVER&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="ss"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;MAILGUN_SMTP_PORT&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="ss"&gt;user_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;MAILGUN_SMTP_LOGIN&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="ss"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;MAILGUN_SMTP_PASSWORD&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="ss"&gt;domain&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;yourapp.herokuapp.com&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="c1"&gt;# 修改為您的 domain&lt;/span&gt;
  &lt;span class="ss"&gt;authentication&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;:plain&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;設定完後，將專案部署到 Heroku 上面即可開始工作。&lt;/p&gt;</summary><category term="rails"></category><category term="heroku"></category></entry><entry><title>使用 Concerns 幫 Model 瘦身</title><link href="http://tsaith.github.io/shi-yong-concerns-bang-model-shou-shen.html" rel="alternate"></link><updated>2015-01-09T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-09:shi-yong-concerns-bang-model-shou-shen.html</id><summary type="html">&lt;h3&gt;設定模組路徑&lt;/h3&gt;
&lt;p&gt;在 config/application.rb 加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;autoload_paths&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="sx"&gt;%W(&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="no"&gt;Rails&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sx"&gt;/lib)&lt;/span&gt; &lt;span class="c1"&gt;# module paths&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;來告訴 Rails 自動載入專案 lib 下的 module files&lt;/p&gt;
&lt;h3&gt;抽出可共用的邏輯&lt;/h3&gt;
&lt;p&gt;假設我們有一個 Invitation model，
裡面定義了 token 的產生和清除&lt;/p&gt;
&lt;p&gt;app/models/invitation.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Invitation&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="n"&gt;before_create&lt;/span&gt; &lt;span class="ss"&gt;:generate_token&lt;/span&gt; &lt;span class="c1"&gt;# 在 create 前自動產生 token&lt;/span&gt;

  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:inviter&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;User&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;validates_presence_of&lt;/span&gt; &lt;span class="ss"&gt;:recipient_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:recipient_email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:message&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;generate_token&lt;/span&gt; &lt;span class="c1"&gt;# 產生 token&lt;/span&gt;
    &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;SecureRandom&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;urlsafe_base64&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;clear_token&lt;/span&gt; &lt;span class="c1"&gt;# 清除 token&lt;/span&gt;
    &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update_column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:token&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kp"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;這時候我們可以考慮使用 ActiveSupport::Concern
將 token 處理的相關邏輯抽離出來並封裝成一個模組，如下&lt;/p&gt;
&lt;p&gt;lib/tokenable.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;module&lt;/span&gt; &lt;span class="nn"&gt;Tokenable&lt;/span&gt;
  &lt;span class="kp"&gt;extend&lt;/span&gt; &lt;span class="no"&gt;ActiveSupport&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt; &lt;span class="no"&gt;Concern&lt;/span&gt;

  &lt;span class="n"&gt;included&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;before_create&lt;/span&gt; &lt;span class="ss"&gt;:generate_token&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;generate_token&lt;/span&gt;
    &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;SecureRandom&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;urlsafe_base64&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;clear_token&lt;/span&gt;
    &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update_column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:token&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kp"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後，原先的 model 就可以改寫成&lt;/p&gt;
&lt;p&gt;app/models/invitation.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Invitation&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="kp"&gt;include&lt;/span&gt; &lt;span class="no"&gt;Tokenable&lt;/span&gt; &lt;span class="c1"&gt;# 處理 token&lt;/span&gt;

  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:inviter&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;User&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;validates_presence_of&lt;/span&gt; &lt;span class="ss"&gt;:recipient_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:recipient_email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:message&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;正如所見，改寫後的 model 變得更加簡潔;
此外，倘若其他 model 需要同樣功能時，也可以很方便地調用已封裝好的模組。
對於此議題，在 DHH 的&lt;a href="https://signalvnoise.com/posts/3372-put-chubby-models-on-a-diet-with-concerns"&gt;文章&lt;/a&gt;中有更詳細的討論。&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>在網站中加入 Invite 功能</title><link href="http://tsaith.github.io/zai-wang-zhan-zhong-jia-ru-invite-gong-neng.html" rel="alternate"></link><updated>2015-01-08T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-08:zai-wang-zhan-zhong-jia-ru-invite-gong-neng.html</id><summary type="html">&lt;p&gt;這裡將介紹如何實作邀請朋友來網站註冊的功能。&lt;/p&gt;
&lt;h3&gt;操作流程&lt;/h3&gt;
&lt;p&gt;使用者可在邀請頁面填寫朋友的名字、郵件地址以及邀請訊息，
然後送出
&lt;img src="https://farm8.staticflickr.com/7550/16039561348_62a3888225_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;然後，被邀請者將會收到邀請信，
內附連結可導向網站的註冊頁面
&lt;img src="https://farm8.staticflickr.com/7567/16225203211_cbd263957b_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;被邀請者進行註冊，然後登入
&lt;img src="https://farm9.staticflickr.com/8608/16201176056_50250a830c_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;網站自動為邀請人與被邀請者設定互相跟隨的關係
(若想知道如何開發跟隨功能，請參考另一篇&lt;a href="/blog/2014/12/31/implement-user-following"&gt;文章&lt;/a&gt;)
&lt;img src="https://farm8.staticflickr.com/7544/15607220283_a001dc64ba_b.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;設定路徑&lt;/h3&gt;
&lt;p&gt;在 routes.rb 中加入&lt;/p&gt;
&lt;p&gt;config/routes.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;省略程式碼&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

&lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;sign_up&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;users#new&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;sign_up/:token&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;users#new_with_invitation_token&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                      &lt;span class="ss"&gt;as&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;sign_up_with_invitation_token&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;resources&lt;/span&gt; &lt;span class="ss"&gt;:invitations&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;only&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:new&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;expired_token&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;pages#expired_token&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Database&lt;/h3&gt;
&lt;p&gt;在資料庫新增 invitaions table&lt;/p&gt;
&lt;p&gt;db/schema.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;省略程式碼&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

&lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;invitations&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;force&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;integer&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;inviter_id&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;recipient_name&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;recipient_email&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;     &lt;span class="s2"&gt;&amp;quot;message&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;token&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Controllers&lt;/h3&gt;
&lt;p&gt;使用者可以藉由 invitation token 進行註冊&lt;/p&gt;
&lt;p&gt;app/controllers/users_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UsersController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;
  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;省略程式碼&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;new&lt;/span&gt;
    &lt;span class="vi"&gt;@user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;new_with_invitation_token&lt;/span&gt; &lt;span class="c1"&gt;# 使用 invitation token 註冊&lt;/span&gt;
    &lt;span class="n"&gt;invitation&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Invitation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;token&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:token&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;invitation&lt;/span&gt;
      &lt;span class="vi"&gt;@invitation_token&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;invitation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;
      &lt;span class="vi"&gt;@user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;email&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;invitation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recipient_email&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;render&lt;/span&gt; &lt;span class="ss"&gt;:new&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;expired_token_path&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;
    &lt;span class="vi"&gt;@user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user_params&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;
      &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;
      &lt;span class="n"&gt;handle_invitation&lt;/span&gt; &lt;span class="c1"&gt;# 自動設定邀請者與被邀請者互相跟隨的關係&lt;/span&gt;
      &lt;span class="no"&gt;AppMailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_welcome_email&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliver&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:notice&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Your are registered.&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;home_path&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:error&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;There&amp;#39;s something wrong during registration.&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;render&lt;/span&gt; &lt;span class="ss"&gt;:new&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="kp"&gt;private&lt;/span&gt;

  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;省略程式碼&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;handle_invitation&lt;/span&gt;
    &lt;span class="n"&gt;invitation&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Invitation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;token&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:invitation_token&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;invitation&lt;/span&gt;
      &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;follow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;invitation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;inviter&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;invitation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;inviter&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;follow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;invitation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;clear_token&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;處理邀請記錄&lt;/p&gt;
&lt;p&gt;app/controllers/invitations_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;InvitationsController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="n"&gt;before_action&lt;/span&gt; &lt;span class="ss"&gt;:require_user&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;new&lt;/span&gt;
    &lt;span class="vi"&gt;@invitation&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Invitation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;
    &lt;span class="vi"&gt;@invitation&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;current_user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;invitations&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;build&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;invitation_params&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vi"&gt;@invitation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt; &lt;span class="c1"&gt;# 成功新增邀請&lt;/span&gt;
      &lt;span class="no"&gt;AppMailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_invitation_email&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@invitation&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliver&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:success&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;You have successfully invited &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="vi"&gt;@invitation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recipient_name&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;.&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;new_invitation_path&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="vi"&gt;@invitation&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Invitation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:error&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Failed to invite your friend.&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;render&lt;/span&gt; &lt;span class="ss"&gt;:new&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="kp"&gt;private&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;invitation_params&lt;/span&gt;
    &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;require&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:invitation&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;permit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:recipient_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:recipient_email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:message&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Views&lt;/h3&gt;
&lt;p&gt;先在適當的頁面加入邀請連結&lt;/p&gt;
&lt;p&gt;app/views/shared/_header.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;... 省略程式碼 ...

&lt;span class="nt"&gt;%li&lt;/span&gt;
  &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Invite a friend&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;new_invitation_path&lt;/span&gt; &lt;span class="c1"&gt;# 邀請連結&lt;/span&gt;
  &lt;span class="nt"&gt;%a&lt;/span&gt;(&lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;#&amp;quot;&lt;/span&gt;) Account
  &lt;span class="nt"&gt;%a&lt;/span&gt;(&lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;#&amp;quot;&lt;/span&gt;) Plan and Billing
  &lt;span class="nt"&gt;%a&lt;/span&gt;(&lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/sign_out&amp;quot;&lt;/span&gt;) Sign Out
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;新增邀請頁面&lt;/p&gt;
&lt;p&gt;app/views/invitations/new.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.invite.container&lt;/span&gt;
  &lt;span class="nc"&gt;.row&lt;/span&gt;
    &lt;span class="nc"&gt;.col-sm-10.col-sm-offset-1&lt;/span&gt;
      &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bootstrap_form_for&lt;/span&gt; &lt;span class="vi"&gt;@invitation&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
        &lt;span class="nt"&gt;%header&lt;/span&gt;
          &lt;span class="nt"&gt;%h1&lt;/span&gt; Invite a friend to join MyFlix!
        &lt;span class="nt"&gt;%fieldset&lt;/span&gt;
          &lt;span class="nc"&gt;.row&lt;/span&gt;
            &lt;span class="nc"&gt;.col-sm-4&lt;/span&gt;
              &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text_field&lt;/span&gt; &lt;span class="ss"&gt;:recipient_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;label&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Friend&amp;#39;s Name&amp;quot;&lt;/span&gt;
              &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email_field&lt;/span&gt; &lt;span class="ss"&gt;:recipient_email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;label&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Friend&amp;#39;s Email Address&amp;quot;&lt;/span&gt;
              &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text_area&lt;/span&gt; &lt;span class="ss"&gt;:message&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;label&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Message&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;value&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Please join this really cool site!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;rows&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;
        &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;submit&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Send Invitation&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在註冊頁面加入隱藏的 invitation token&lt;/p&gt;
&lt;p&gt;app/views/users/new.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.register.container&lt;/span&gt;
  &lt;span class="nc"&gt;.row&lt;/span&gt;
    &lt;span class="nc"&gt;.col-sm-10.col-sm-offset-1&lt;/span&gt;
      &lt;span class="cp"&gt;-#%form.form-horizontal&lt;/span&gt;
      &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bootstrap_form_for&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
        &lt;span class="nt"&gt;%header&lt;/span&gt;
          &lt;span class="nt"&gt;%h1&lt;/span&gt; Register
        &lt;span class="nc"&gt;.row&lt;/span&gt;
          &lt;span class="nc"&gt;.col-sm-4&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email_field&lt;/span&gt; &lt;span class="ss"&gt;:email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;label&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Email Address&amp;quot;&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password_field&lt;/span&gt; &lt;span class="ss"&gt;:password&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text_field&lt;/span&gt; &lt;span class="ss"&gt;:full_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;label&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Full Name&amp;quot;&lt;/span&gt;
            &lt;span class="cp"&gt;-# 隱藏的 invitation token&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hidden_field_tag&lt;/span&gt; &lt;span class="ss"&gt;:invitation_token&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="vi"&gt;@invitation_token&lt;/span&gt;
        &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;submit&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sign up&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;顯示連結過期的頁面&lt;/p&gt;
&lt;p&gt;app/views/pages/expired_token.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.invalid_token.container&lt;/span&gt;
  &lt;span class="nc"&gt;.row&lt;/span&gt;
    &lt;span class="nc"&gt;.col-sm-10.col-sm-offset-1&lt;/span&gt;
      &lt;span class="nt"&gt;%p&lt;/span&gt; Your link is expired.
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Models&lt;/h3&gt;
&lt;p&gt;app/models/invitation.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Invitation&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="n"&gt;before_create&lt;/span&gt; &lt;span class="ss"&gt;:generate_token&lt;/span&gt;

  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:inviter&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;User&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;validates_presence_of&lt;/span&gt; &lt;span class="ss"&gt;:recipient_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:recipient_email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:message&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;generate_token&lt;/span&gt;
    &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;SecureRandom&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;urlsafe_base64&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;clear_token&lt;/span&gt;
    &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update_column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:token&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kp"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;app/models/user.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;省略程式碼&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

  &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:invitations&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;foreign_key&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;inviter_id&amp;quot;&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;follow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;another_user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;following_relationships&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;leader&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;another_user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;can_follow?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;another_user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;follows?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;another_user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;following_relationships&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="ss"&gt;:leader&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;include?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;another_user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;can_follow?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;another_user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;another_user&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;follows?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;another_user&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Mailer&lt;/h3&gt;
&lt;p&gt;新增寄送邀請信的方法&lt;/p&gt;
&lt;p&gt;app/mailers/app_mailer.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;AppMailer&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActionMailer&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="n"&gt;default&lt;/span&gt; &lt;span class="ss"&gt;from&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;MYFLIX_SMTP_USER_NAME&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;

  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;省略程式碼&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;send_invitation_email&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;invitation&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="vi"&gt;@invitation&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;invitation&lt;/span&gt;
    &lt;span class="n"&gt;mail&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="vi"&gt;@invitation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recipient_email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;subject&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Invitation to join MyFlix!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;信件內容如下&lt;/p&gt;
&lt;p&gt;app/views/app_mailer/send_invitation_email.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nn"&gt;!!! 5&lt;/span&gt;
&lt;span class="nt"&gt;%html&lt;/span&gt;(&lt;span class="na"&gt;lang=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;en-US&amp;quot;&lt;/span&gt;)
  &lt;span class="nt"&gt;%body&lt;/span&gt;
    &lt;span class="nt"&gt;%p&lt;/span&gt; You are invited by &lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="vi"&gt;@invitation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;inviter&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;full_name&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; to join MyFlix!
    &lt;span class="nt"&gt;%p&lt;/span&gt; &lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="vi"&gt;@invitation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
    &lt;span class="nt"&gt;%p&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Accept this invitation&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sign_up_with_invitation_token_url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@invitation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>在 Emacs 中使用 Vim: Evil</title><link href="http://tsaith.github.io/zai-emacs-zhong-shi-yong-vim-evil.html" rel="alternate"></link><updated>2015-01-05T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-05:zai-emacs-zhong-shi-yong-vim-evil.html</id><summary type="html">&lt;p&gt;過去十多年來，
Vim 一直都是筆者最喜愛的文字編輯器，
然而就像其他許多資深的 Vim 使用者，
我也總是對另一套神器 Emacs 感到好奇;
於是前陣子，
終於下定決心花些時間去了解 Emacs 的使用方式。
而在體驗之後只能說，果然盛名之下無虛士，
難怪有人會講，
Emacs 根本就是偽裝成編輯器的作業系統!&lt;/p&gt;
&lt;p&gt;就我個人主觀的看法，
Vim 因為支援許多單鍵的編輯功能，
所以在文本編輯上比較快速，
而 Emacs 因為使用 Lisp 語言，
所以在擴展性上相對強大。&lt;/p&gt;
&lt;p&gt;那我們最後應該使用哪一套工具呢?
因為 &lt;a href="https://gitorious.org/evil/pages/Home"&gt;Evil&lt;/a&gt; 的出現，
我們現在可以直接在 Emacs 中使用 Vim，魚與熊掌兼得！&lt;/p&gt;
&lt;h3&gt;安裝 Evil&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; package-install &lt;code&gt;Ret&lt;/code&gt; evil &lt;code&gt;Ret&lt;/code&gt;&lt;/p&gt;
&lt;h3&gt;設定配置&lt;/h3&gt;
&lt;p&gt;在 ~/.emacs/init.el 裡面加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;(require &amp;#39;evil)
(evil-mode 1)
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;使用方法&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;z&lt;/code&gt;: 在 Emacs 和 Vim 之間切接&lt;/p&gt;</summary><category term="emacs"></category></entry><entry><title>整合測試的郵件工具: capybara-email</title><link href="http://tsaith.github.io/zheng-he-ce-shi-de-you-jian-gong-ju-capybara-email.html" rel="alternate"></link><updated>2015-01-05T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-05:zheng-he-ce-shi-de-you-jian-gong-ju-capybara-email.html</id><summary type="html">&lt;p&gt;撰寫整合測試時，倘若需要模擬點選郵件內容的連結，
進而訪問某個網頁時，
可以使用 &lt;a href="https://github.com/dockyard/capybara-email"&gt;capybara-email&lt;/a&gt; 這個 gem。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;在 Gemfile 裡面加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;capybara-email&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 &lt;code&gt;bundle&lt;/code&gt; 進行安裝。&lt;/p&gt;
&lt;h3&gt;設定郵件主機&lt;/h3&gt;
&lt;p&gt;在 config/environmnets/test.rb 加入本地端的 host，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action_mailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;default_url_options&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="ss"&gt;:host&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;localhost:3000&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;設定套件路徑&lt;/h3&gt;
&lt;p&gt;在 spec/spec_helper.rb 裡面加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;capybara/email/rspec&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;撰寫測試&lt;/h3&gt;
&lt;p&gt;下面的範例是用來測試使用者重設密碼的流程，
當使用者點選了郵件的連結後，將會被導向重設密碼的網頁&lt;/p&gt;
&lt;p&gt;spec/features/user_resets_password_spec.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;spec_helper.rb&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;feature&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;User resets password&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;scenario&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;user sucessfully resets the password&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

    &lt;span class="c1"&gt;# 在資料庫先產生一個使用者 alice&lt;/span&gt;
    &lt;span class="n"&gt;alice&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;old_password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="c1"&gt;# 訪問登入頁面，並點選 Forgot Password? 連結&lt;/span&gt;
    &lt;span class="c1"&gt;# (然後會被導向填寫郵件地址的頁面)&lt;/span&gt;
    &lt;span class="n"&gt;visit&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt;
    &lt;span class="n"&gt;click_link&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Forgot Password?&amp;quot;&lt;/span&gt;

    &lt;span class="c1"&gt;# 填寫郵件地址並送出&lt;/span&gt;
    &lt;span class="c1"&gt;# (這時候網站將自動寄信給使用者，內含變更密碼的網頁連結)&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Email Address&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;
    &lt;span class="n"&gt;click_button&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Send Email&amp;quot;&lt;/span&gt;

    &lt;span class="c1"&gt;# 開啓寄給使用者的郵件，並點選信件內容中的連結&lt;/span&gt;
    &lt;span class="c1"&gt;# (然後使用者會被導向設定新密碼的網頁)&lt;/span&gt;
    &lt;span class="n"&gt;open_email&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;current_email&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;click_link&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Reset My Password&amp;quot;&lt;/span&gt;

    &lt;span class="c1"&gt;# 填寫新密碼，並送出&lt;/span&gt;
    &lt;span class="c1"&gt;# (然後會自動回到登入頁面)&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;New Password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;new_password&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;click_button&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Reset Password&amp;quot;&lt;/span&gt;

    &lt;span class="c1"&gt;# 在登入頁面中，填寫使用者郵件地址和新密碼，然後送出&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Email Address&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;new_password&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;click_button&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sign in&amp;quot;&lt;/span&gt;

    &lt;span class="c1"&gt;# 預期在更新後的網頁看到歡迎使用者的訊息&lt;/span&gt;
    &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;have_content&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Welcome, &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;full_name&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;endcodeblock&lt;/span&gt; &lt;span class="sx"&gt;%}&lt;/span&gt;

&lt;span class="sx"&gt;{% blockquote Bill Gates %}&lt;/span&gt;
&lt;span class="no"&gt;Measuring&lt;/span&gt; &lt;span class="n"&gt;programming&lt;/span&gt; &lt;span class="n"&gt;progress&lt;/span&gt; &lt;span class="n"&gt;by&lt;/span&gt; &lt;span class="n"&gt;lines&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;code&lt;/span&gt; &lt;span class="n"&gt;is&lt;/span&gt; &lt;span class="n"&gt;like&lt;/span&gt; &lt;span class="n"&gt;measuring&lt;/span&gt; &lt;span class="n"&gt;aircraft&lt;/span&gt; &lt;span class="n"&gt;building&lt;/span&gt; &lt;span class="n"&gt;progress&lt;/span&gt; &lt;span class="n"&gt;by&lt;/span&gt; &lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category><category term="testing"></category></entry><entry><title>編輯器: Emacs</title><link href="http://tsaith.github.io/bian-ji-qi-emacs.html" rel="alternate"></link><updated>2015-01-03T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-03:bian-ji-qi-emacs.html</id><summary type="html">&lt;p&gt;GNU 計劃創始人 &lt;a href="http://zh.wikipedia.org/wiki/%E7%90%86%E6%9F%A5%E5%BE%B7%C2%B7%E6%96%AF%E6%89%98%E6%9B%BC"&gt;Richard Stallman&lt;/a&gt; 和 &lt;a href="http://zh.wikipedia.org/wiki/%E8%93%8B%E4%BC%8A%C2%B7%E5%8F%B2%E6%8F%90%E7%88%BE%E4%BA%8C%E4%B8%96"&gt;Guy Lewis Steele Jr.&lt;/a&gt; 在1975 年共同打造了 &lt;a href="http://zh.wikipedia.org/wiki/Emacs"&gt;Emacs&lt;/a&gt; (Editor MACroS)，
Emacs 使用 &lt;a href="http://zh.wikipedia.org/wiki/LISP"&gt;Lisp&lt;/a&gt; 作為功能擴充語言，
具有強大的擴展性，與可客製性，
還有各式各樣好用的套件，
所以也有人稱它是神的編輯器，或是偽裝成編輯器的作業系統 @_@;
如果想知道更多對於 Emcas 特性的敘述，
可以參考另一篇&lt;a href="http://blog.csdn.net/redguardtoo/article/details/7222501#sec-13"&gt;文章&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;安裝 Emacs&lt;/h3&gt;
&lt;p&gt;在 Mac 下可透過 Homebrew 進行安裝&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;brew install emacs
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;建議配置&lt;/h3&gt;
&lt;p&gt;Emacs 的目錄位於 ~/.emacs.d，
若希望自定個人的專屬配置，可在 ~/.emacs.d/init.el 裡面設定。&lt;/p&gt;
&lt;p&gt;建議一開始可直接使用高手們的配置，
因為他們的配置都經過了多年的磨練，
在深思熟慮後才決定出最佳的按鍵定義並也解決了許多套件相容性問題;
我個人偏好 &lt;a href="http://www.sanityinc.com/"&gt;Steve Purcell&lt;/a&gt; 的&lt;a href="https://github.com/purcell/emacs.d"&gt;配置&lt;/a&gt;，
因為他是一位頂尖的 Rails 開發者，
所以使用他的配置可以大量減少自己打造 Rails 開發環境的時間。&lt;/p&gt;
&lt;h3&gt;符號與按鍵&lt;/h3&gt;
&lt;p&gt;為方便之後的說明，在這邊先定義一些符號和按鍵的對應關係&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;: 代表 Ctrl&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;: 代表 Alt&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ret&lt;/code&gt;: 代表 Return&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;安裝 Packages&lt;/h3&gt;
&lt;p&gt;在 Emacs 最簡單安裝套件的兩個方式分別為&lt;/p&gt;
&lt;p&gt;使用 package-install 命令&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; package-install &lt;code&gt;Ret&lt;/code&gt; Package Name &lt;code&gt;Ret&lt;/code&gt; : 安裝套件&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;透過 &lt;a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Package-Menu.html#Package-Menu"&gt;Package Menu&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; list-packages : 進入套件安裝目錄&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;s&lt;/code&gt;: 尋找套件名稱&lt;/li&gt;
&lt;li&gt;&lt;code&gt;i&lt;/code&gt;: 標記為即將安裝的套件&lt;/li&gt;
&lt;li&gt;&lt;code&gt;u&lt;/code&gt;: 解除標記&lt;/li&gt;
&lt;li&gt;&lt;code&gt;d&lt;/code&gt;: 標記為刪除的套件&lt;/li&gt;
&lt;li&gt;&lt;code&gt;x&lt;/code&gt;: 開始安裝/反安裝 以標記的套件&lt;/li&gt;
&lt;li&gt;&lt;code&gt;r&lt;/code&gt;: 刷新列表&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;基本操作&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; &lt;code&gt;C&lt;/code&gt;-&lt;code&gt;c&lt;/code&gt;: 離開 Emacs&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;z&lt;/code&gt;: 暫停 Emcas，並將它放到背景&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;h&lt;/code&gt; &lt;code&gt;C&lt;/code&gt;-&lt;code&gt;h&lt;/code&gt;: Help for Help&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;存取檔案&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; &lt;code&gt;C&lt;/code&gt;-&lt;code&gt;f&lt;/code&gt;: 尋找檔案並開啟&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; &lt;code&gt;C&lt;/code&gt;-&lt;code&gt;s&lt;/code&gt;: 存檔&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;字元操作&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;d&lt;/code&gt;: 向前刪除字元&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Del&lt;/code&gt;: 向後刪除字元&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;拷貝和貼上&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;w&lt;/code&gt;: 拷貝游標所在行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;u&lt;/code&gt; &lt;code&gt;3&lt;/code&gt; &lt;code&gt;M&lt;/code&gt;-&lt;code&gt;w&lt;/code&gt;: 拷貝連續三行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;w&lt;/code&gt;: 剪下游標所在行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;u&lt;/code&gt; &lt;code&gt;3&lt;/code&gt; &lt;code&gt;C&lt;/code&gt;-&lt;code&gt;w&lt;/code&gt;: 剪下連續三行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;y&lt;/code&gt;: 貼上暫存區資料&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;暫存區操作&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; &lt;code&gt;r&lt;/code&gt; &lt;code&gt;s&lt;/code&gt; (#): 拷貝標記區域到數字暫存區&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; &lt;code&gt;r&lt;/code&gt; &lt;code&gt;i&lt;/code&gt; (#): 從數字暫存區將資料插入游標所在處&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Buffer 操作&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; &lt;code&gt;b&lt;/code&gt;: 切換 buffer&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; &lt;code&gt;Left&lt;/code&gt;: 切換到上一個 buffer&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; &lt;code&gt;Right&lt;/code&gt;: 切換到下一個 buffer&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;區段操作&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;Space&lt;/code&gt;: 開始標記區域&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;k&lt;/code&gt;: 從游標所在刪除到本行結尾&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;0&lt;/code&gt; &lt;code&gt;C&lt;/code&gt;-&lt;code&gt;k&lt;/code&gt;: 從游標所在刪除到本行開頭&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; &lt;code&gt;h&lt;/code&gt;: 標記整個檔案內容&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;視窗操作&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; 1: 單一視窗&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; 2: 水平分割&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; 3: 垂直分割&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; 0: 關閉選擇的視窗&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; windmove-up: 向上切換視窗&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; windmove-down: 向下切換視窗&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; windmove-left: 向左切換視窗&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; windmove-right: 向右切換視窗&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;移動游標&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;a&lt;/code&gt;: 移到游標所在行的開頭&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;e&lt;/code&gt;: 移到游標所在行的結尾&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;a&lt;/code&gt;: 移到段落開頭&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;e&lt;/code&gt;: 移到段落結尾&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;g&lt;/code&gt; &lt;code&gt;g&lt;/code&gt;: 移到指定行數&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Esc&lt;/code&gt; &lt;code&gt;&amp;lt;&lt;/code&gt;: 移到檔案開頭&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Esc&lt;/code&gt; &lt;code&gt;&amp;gt;&lt;/code&gt;: 移到檔案結尾&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;v&lt;/code&gt;: 移到下一頁&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;v&lt;/code&gt;: 移到上一頁&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; &lt;code&gt;r&lt;/code&gt; &lt;code&gt;Space&lt;/code&gt; &lt;code&gt;a&lt;/code&gt;: 記錄目前游標位置到 register a&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; &lt;code&gt;r&lt;/code&gt; &lt;code&gt;j&lt;/code&gt; &lt;code&gt;a&lt;/code&gt;: 跳到 register a 所儲存的位置&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;字串取代&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;%&lt;/code&gt; old_string &lt;code&gt;Ret&lt;/code&gt; new_string &lt;code&gt;Ret&lt;/code&gt;: 取代字串&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; replace-regexp &lt;code&gt;Ret&lt;/code&gt; regexp &lt;code&gt;Ret&lt;/code&gt; newstring &lt;code&gt;Ret&lt;/code&gt;: 以正規表示法取代字串&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;程式碼操作&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;;&lt;/code&gt;: 將程式碼加上註解符號&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;u&lt;/code&gt; &lt;code&gt;M&lt;/code&gt;-&lt;code&gt;;&lt;/code&gt;: 移除程式碼前的註解符號&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Tab&lt;/code&gt;: 縮行對齊&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; linum-mode: 開啟/關閉 行號顯示&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;其他操作&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;_&lt;/code&gt;: 回到上一步&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;_&lt;/code&gt;: 回到下一步&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;g&lt;/code&gt;: 取消目前操作&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; &lt;code&gt;z&lt;/code&gt;: 重複上一次的操作&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;!&lt;/code&gt;: 執行外部命令&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;好用的 Packages&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://www.gnu.org/software/emacs/manual/html_node/emacs/Dired.html"&gt;Dired&lt;/a&gt;: 檔案管理&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; &lt;code&gt;d&lt;/code&gt; 開啟目錄&lt;/li&gt;
&lt;li&gt;&lt;code&gt;c&lt;/code&gt; 拷貝檔案&lt;/li&gt;
&lt;li&gt;&lt;code&gt;r&lt;/code&gt; 將檔案重新命名&lt;/li&gt;
&lt;li&gt;&lt;code&gt;d&lt;/code&gt; 刪除檔案&lt;/li&gt;
&lt;li&gt;&lt;code&gt;+&lt;/code&gt; 新增目錄&lt;/li&gt;
&lt;li&gt;&lt;code&gt;z&lt;/code&gt; 使用 gzip 進行壓縮/解壓縮&lt;/li&gt;
&lt;li&gt;&lt;code&gt;m&lt;/code&gt; 標記檔案&lt;/li&gt;
&lt;li&gt;&lt;code&gt;u&lt;/code&gt; 反標記檔案&lt;/li&gt;
&lt;li&gt;&lt;code&gt;U&lt;/code&gt; 取消所有標記&lt;/li&gt;
&lt;li&gt;&lt;code&gt;g&lt;/code&gt; 刷新列表&lt;/li&gt;
&lt;li&gt;&lt;code&gt;^&lt;/code&gt; 到上一層目錄&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://github.com/joddie/osx-clipboard-mode"&gt;osx-cliboard&lt;/a&gt;: 使用 OSX 的剪貼板&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; osx-clipboard-mode: 進入 osx-clipboard-mode&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="http://www.gnu.org/software/emacs/manual/html_mono/eshell.html"&gt;Eshell&lt;/a&gt;: Emacs Shell&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;-&lt;code&gt;x&lt;/code&gt; eshell: 啟動 eshell&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://github.com/eschulte/rinari/tree/master"&gt;Rinari&lt;/a&gt;: Rails 的開發環境&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;c&lt;/code&gt; &lt;code&gt;;&lt;/code&gt; &lt;code&gt;f&lt;/code&gt; &lt;code&gt;m&lt;/code&gt; 尋找 model&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;c&lt;/code&gt; &lt;code&gt;;&lt;/code&gt; &lt;code&gt;f&lt;/code&gt; &lt;code&gt;v&lt;/code&gt; 尋找 view&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;c&lt;/code&gt; &lt;code&gt;;&lt;/code&gt; &lt;code&gt;f&lt;/code&gt; &lt;code&gt;c&lt;/code&gt; 尋找 controller&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;c&lt;/code&gt; &lt;code&gt;;&lt;/code&gt; &lt;code&gt;f&lt;/code&gt; &lt;code&gt;r&lt;/code&gt; 尋找 rspec&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;c&lt;/code&gt; &lt;code&gt;;&lt;/code&gt; &lt;code&gt;f&lt;/code&gt; &lt;code&gt;M&lt;/code&gt; 尋找 mailer&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;c&lt;/code&gt; &lt;code&gt;;&lt;/code&gt; &lt;code&gt;f&lt;/code&gt; &lt;code&gt;i&lt;/code&gt; 尋找 migration&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;c&lt;/code&gt; &lt;code&gt;;&lt;/code&gt; &lt;code&gt;f&lt;/code&gt; &lt;code&gt;l&lt;/code&gt; 尋找 lib&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;c&lt;/code&gt; &lt;code&gt;;&lt;/code&gt; &lt;code&gt;f&lt;/code&gt; &lt;code&gt;j&lt;/code&gt; 尋找 javascript&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;c&lt;/code&gt; &lt;code&gt;;&lt;/code&gt; &lt;code&gt;f&lt;/code&gt; &lt;code&gt;o&lt;/code&gt; 尋找 log&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;c&lt;/code&gt; &lt;code&gt;;&lt;/code&gt; &lt;code&gt;c&lt;/code&gt; 啟動 console&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;-&lt;code&gt;c&lt;/code&gt; &lt;code&gt;;&lt;/code&gt; &lt;code&gt;w&lt;/code&gt; 啟動 web-server&lt;/li&gt;
&lt;/ul&gt;</summary><category term="emacs"></category></entry><entry><title>編輯器: Vim</title><link href="http://tsaith.github.io/bian-ji-qi-vim.html" rel="alternate"></link><updated>2015-01-03T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-03:bian-ji-qi-vim.html</id><summary type="html">&lt;p&gt;在編程領域中，
&lt;a href="http://zh.wikipedia.org/wiki/%E7%BC%96%E8%BE%91%E5%99%A8%E4%B9%8B%E6%88%98"&gt;編輯器之戰&lt;/a&gt;的兩位主角
&lt;a href="http://zh.wikipedia.org/wiki/Vi"&gt;Vi&lt;/a&gt; 和
&lt;a href="http://zh.wikipedia.org/wiki/Emacs"&gt;Emacs&lt;/a&gt; 經歷幾十年的歲月後，
直到現在依然擁有許多信徒;
而隨著時間的過去，
Vi (Visual，&lt;a href="http://zh.wikipedia.org/wiki/%E6%AF%94%E5%B0%94%C2%B7%E4%B9%94%E4%BC%8A"&gt;Bill Joy&lt;/a&gt; 於 1976 年發表 ) 的功能不斷地被增強，
最後演化出目前受歡迎的 &lt;a href="http://zh.wikipedia.org/wiki/Vim"&gt;Vim&lt;/a&gt;;
Vim 不管是可擴展性或高效的編輯速度，
都讓一般的編輯器難以望其項背，
也因此有了&lt;a href="http://os.51cto.com/art/201101/242518.htm"&gt;編輯器之神&lt;/a&gt;的封號!
不過 GNU 計劃的創始人
&lt;a href="http://zh.wikipedia.org/wiki/%E7%90%86%E6%9F%A5%E5%BE%B7%C2%B7%E6%96%AF%E6%89%98%E6%9B%BC"&gt;RMS&lt;/a&gt;
說它比較像魔鬼的編輯器
(因為 vi-vi-vi 是&lt;a href="http://zh.wikipedia.org/wiki/%E7%8D%B8%E5%90%8D%E6%95%B8%E7%9B%AE"&gt;獸名數目&lt;/a&gt; XD )&lt;/p&gt;
&lt;p&gt;關於 Vim 的詳細使用方法請查詢&lt;a href="http://vimdoc.sourceforge.net/htmldoc/usr_toc.html"&gt;官方文件&lt;/a&gt;，
這裡只介紹我自己常用的一些操作。&lt;/p&gt;
&lt;h3&gt;環境設定&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;~/.vimrc 環境設定檔&lt;/li&gt;
&lt;li&gt;~/.vim  Vim 專屬的資料夾&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;符號定義&lt;/h3&gt;
&lt;p&gt;為方便之後的說明，先在此定義兩個按鍵符號&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt; 表示 Ctrl&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt; 表示 Alt&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;常用模式&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;command mode 按 &lt;code&gt;Esc&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;insert mode 在 command mode 中，按 &lt;code&gt;i&lt;/code&gt; 或 &lt;code&gt;a&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;plain visual mode 在 command mode 中，按 &lt;code&gt;v&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;block visual mode 在 command mode 中，按 &lt;code&gt;C&lt;/code&gt;+ &lt;code&gt;v&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;command line 在 command mode 中，按 &lt;code&gt;:&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;存取檔案&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;vi file_name&lt;/code&gt; 開啟檔案&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:w&lt;/code&gt; 存檔&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:q&lt;/code&gt; 離開&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:q!&lt;/code&gt; 強制離開(不須先存檔)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:e file_name&lt;/code&gt; 編輯其它檔案&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;字元操作&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;i&lt;/code&gt; 在游標所在處開始輸入&lt;/li&gt;
&lt;li&gt;&lt;code&gt;a&lt;/code&gt; 從下個字元開始輸入&lt;/li&gt;
&lt;li&gt;&lt;code&gt;x&lt;/code&gt; 刪除一個字元&lt;/li&gt;
&lt;li&gt;&lt;code&gt;o&lt;/code&gt; 插入空白行並開始輸入&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;字元操作&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;d&lt;/code&gt; &lt;code&gt;w&lt;/code&gt; 刪除一個單字&lt;/li&gt;
&lt;li&gt;&lt;code&gt;d&lt;/code&gt; &lt;code&gt;W&lt;/code&gt; 刪除一個單字(忽略特殊字元)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;拷貝和貼上&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;yy&lt;/code&gt; 拷貝游標所在的那一行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;3&lt;/code&gt; &lt;code&gt;yy&lt;/code&gt; 拷貝連續三行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;dd&lt;/code&gt; 剪下游標所在的那一行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;3&lt;/code&gt; &lt;code&gt;dd&lt;/code&gt; 剪下連續三行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;y&lt;/code&gt; 將標記區域 yank 到剪貼簿&lt;/li&gt;
&lt;li&gt;&lt;code&gt;p&lt;/code&gt; 將剪貼簿的資料貼上&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;段落操作&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;J&lt;/code&gt; 連接下一行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;d&lt;/code&gt; &lt;code&gt;$&lt;/code&gt; 從游標所在刪除到本行結尾&lt;/li&gt;
&lt;li&gt;&lt;code&gt;d&lt;/code&gt; &lt;code&gt;^&lt;/code&gt; 從游標所在刪除到本行開頭&lt;/li&gt;
&lt;li&gt;&lt;code&gt;D&lt;/code&gt; 從游標所在刪除到本行結尾&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;暫存區操作&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ma&lt;/code&gt; &lt;code&gt;"c&lt;/code&gt; &lt;code&gt;y&lt;/code&gt; &lt;code&gt;'a&lt;/code&gt; 將選擇區段拷貝到 register c&lt;/li&gt;
&lt;li&gt;&lt;code&gt;"c&lt;/code&gt; &lt;code&gt;p&lt;/code&gt; 將 register c 的資料貼上&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ma&lt;/code&gt; &lt;code&gt;"+&lt;/code&gt; &lt;code&gt;y&lt;/code&gt; &lt;code&gt;'a&lt;/code&gt; 選擇區塊並拷貝到系統的剪貼板&lt;/li&gt;
&lt;li&gt;&lt;code&gt;3&lt;/code&gt; &lt;code&gt;"+&lt;/code&gt; &lt;code&gt;yy&lt;/code&gt; 將連續三行 yank 到系統的剪貼板&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:%y+&lt;/code&gt; 將檔案內容 yank 到剪貼板&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;移動游標&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;gg&lt;/code&gt; 第一行開頭&lt;/li&gt;
&lt;li&gt;&lt;code&gt;G&lt;/code&gt; 最後一行的開頭&lt;/li&gt;
&lt;li&gt;&lt;code&gt;^&lt;/code&gt; 移到游標所在行的開頭&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$&lt;/code&gt; 移到游標所在行的結尾&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;+&lt;code&gt;f&lt;/code&gt; 下一頁&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;+&lt;code&gt;b&lt;/code&gt; 上一頁&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;+&lt;code&gt;f&lt;/code&gt; 往後移到一個單字&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;+&lt;code&gt;b&lt;/code&gt; 往前移到一個單字&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;+&lt;code&gt;F&lt;/code&gt; 往後移到一個單字並且標記&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;+&lt;code&gt;b&lt;/code&gt; 往前移到一個單字並且標記&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;切換目錄&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;:cd %:h&lt;/code&gt; 將工作目錄改變到編輯的檔案下&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:lcd %:h&lt;/code&gt; 僅將目前視窗的工作目錄改變到編輯的檔案下&lt;/li&gt;
&lt;li&gt;&lt;code&gt;autocmd BufEnter * silent! lcd %:p:h&lt;/code&gt; 自動改變工作目錄到編輯的檔案下&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;切換檔案&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;gf&lt;/code&gt; 跳到關聯檔 ( goto file )&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;+&lt;code&gt;^&lt;/code&gt; 回到上一個檔案&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;分頁操作&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;:tab_new&lt;/code&gt; 新分頁&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:tabprevious&lt;/code&gt; 上一個分頁&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:tabnext&lt;/code&gt; 下一個分頁&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:ab tn tab_new&lt;/code&gt; 將 tab_new 縮寫為 tn&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;視窗操作&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;:vs&lt;/code&gt;       垂直分割&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:sp&lt;/code&gt;       水平分割&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;+&lt;code&gt;w&lt;/code&gt; &lt;code&gt;v&lt;/code&gt; 垂直分割&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;C&lt;/code&gt;+&lt;code&gt;w&lt;/code&gt; &lt;code&gt;s&lt;/code&gt; 水平分割&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;C&lt;/code&gt;+&lt;code&gt;w&lt;/code&gt; &lt;code&gt;left[right] arrow&lt;/code&gt; 左[右]切換視窗&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;+&lt;code&gt;w&lt;/code&gt; &lt;code&gt;up[down] arrow&lt;/code&gt;    上[下]切換視窗&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;+&lt;code&gt;w&lt;/code&gt; &lt;code&gt;h[l]&lt;/code&gt; 左[右]切換視窗&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;+&lt;code&gt;w&lt;/code&gt; &lt;code&gt;k[j]&lt;/code&gt; 上[下]切換視窗&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;其他操作&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;u&lt;/code&gt;: 回到上一步&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;C&lt;/code&gt;+&lt;code&gt;r&lt;/code&gt;: 回到下一步&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;:set nu&lt;/code&gt; 顯示行數&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:set nonu&lt;/code&gt; 不顯示行數&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:syntax enable&lt;/code&gt; 語法顏色&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;:set ai&lt;/code&gt; 自動縮行&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;:!外部命令&lt;/code&gt; 執行外部命令，例如 &lt;code&gt;:!ls&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;C&lt;/code&gt;+&lt;code&gt;r&lt;/code&gt; &lt;code&gt;%&lt;/code&gt; 在 insert mode 下貼上檔案路徑&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;自定按鍵&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;map &amp;lt;C-k&amp;gt; :tabprevious &amp;lt;CR&amp;gt;&lt;/code&gt; 用 &lt;code&gt;C&lt;/code&gt;+&lt;code&gt;k&lt;/code&gt; 映射 &lt;code&gt;:tabpreview&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;map &amp;lt;C-j&amp;gt; :tabnext &amp;lt;CR&amp;gt;&lt;/code&gt; 用 &lt;code&gt;C&lt;/code&gt;+&lt;code&gt;j&lt;/code&gt; 映射 &lt;code&gt;:tabnext&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;好用的 plugins&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://www.vim.org/scripts/script.php?script_id=1567"&gt;rails.vim&lt;/a&gt;:
Rails 套件(語法顏色，快速切換檔案... 等)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;:Rcd 目錄&lt;/code&gt; 切換目錄(從專案目錄出發)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;:Rmodel 檔案&lt;/code&gt;      編輯 model 檔案&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;:Rview 檔案&lt;/code&gt;       編輯 view 檔案&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;:Rcontroller 檔案&lt;/code&gt; 編輯 controller 檔案&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="http://www.vim.org/scripts/script.php?script_id=2540"&gt;snipMate&lt;/a&gt;: 加入程式片段&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Tab&lt;/code&gt; 加入程式片段&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://github.com/kien/ctrlp.vim"&gt;ctrp&lt;/a&gt;: 模糊搜尋&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;C&lt;/code&gt;+&lt;code&gt;p&lt;/code&gt; 啟動模糊搜尋&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="http://www.vim.org/scripts/script.php?script_id=1708"&gt;fencview.vim&lt;/a&gt;: 自動偵測多國編碼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;:FencAutoDetect&lt;/code&gt; 啟動偵測&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="http://www.vim.org/scripts/script.php?script_id=1658"&gt;nerdtree.vim&lt;/a&gt;: 檔案瀏覽器&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;:e .&lt;/code&gt; 瀏覽工作目錄&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="http://www.vim.org/scripts/script.php?script_id=1643"&gt;supertab.vmb&lt;/a&gt;: 補全程式碼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Tab&lt;/code&gt; 補全程式碼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;雖然 Vim 對初學者而言需要投入多一些的時間來熟悉，
但只要上手後， 就會大幅提升你的編程效率。&lt;/p&gt;</summary><category term="vim"></category></entry><entry><title>從 rvm 遷移到 rbenv</title><link href="http://tsaith.github.io/cong-rvm-qian-yi-dao-rbenv.html" rel="alternate"></link><updated>2015-01-03T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2015-01-03:cong-rvm-qian-yi-dao-rbenv.html</id><summary type="html">&lt;p&gt;之前一直使用 rvm 來管理 ruby 的版本切換，
但因為 rvm 還提供了 gem 的安裝，
而這部分與 bundler 的職務重疊，
於是我決定採用功能更單純的 &lt;a href="https://github.com/sstephenson/rbenv"&gt;rbev&lt;/a&gt; 專職 ruby 版本的管理。&lt;/p&gt;
&lt;h3&gt;移除 rvm&lt;/h3&gt;
&lt;p&gt;先執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;rvm implode
Are you SURE you wish &lt;span class="k"&gt;for&lt;/span&gt; rvm to implode?
This will recursively remove /Users/tsaith/.rvm and other rvm traces?
&lt;span class="o"&gt;(&lt;/span&gt;anything other than &lt;span class="s1"&gt;&amp;#39;yes&amp;#39;&lt;/span&gt; will cancel&lt;span class="o"&gt;)&lt;/span&gt; &amp;gt; yes
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後再移除使用者目錄下的 .bashrc、.bash_profile、.profile 以及 .zshrc 裡面的這一行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="x"&gt;PATH=&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="x"&gt;:&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;HOME&lt;/span&gt;&lt;span class="x"&gt;/.rvm/bin &lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="x"&gt; Add RVM to PATH for scripting&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;安裝 rbenv&lt;/h3&gt;
&lt;p&gt;執行 &lt;code&gt;exec $SHELL -l&lt;/code&gt; 以重新啟動 shell 環境&lt;/p&gt;
&lt;p&gt;加入 &lt;code&gt;rbenv init -&lt;/code&gt; 到 shell 以使用 &lt;a href="https://github.com/sstephenson/rbenv#understanding-shims"&gt;shims&lt;/a&gt; 和自動完成命令的功能&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;echo &amp;#39;eval &amp;quot;$(rbenv init -)&amp;quot;&amp;#39; &amp;gt;&amp;gt; ~/.bash_profile
source ~/.bash_profile
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;接著使用 Homebrew 安裝套件&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;brew update
brew install rbenv
brew install rbenv-gem-rehash
brew install ruby-build
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;安裝 ruby&lt;/h3&gt;
&lt;p&gt;先查詢有哪些版本的 ruby 可供安裝&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;rbenv install -l
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;接著安裝指定的套件，下面以 ruby 2.1.5 的版本為例&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;rbenv install 2.1.5
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;假設在安裝 ruby 時遇到下面的錯誤訊息&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;BUILD FAILED (OS X 10.9.5 using ruby-build 20141225)

Inspect or clean up the working tree at /var/folders/2v/wtshnx5x4294fvlxyrk9t8kh0000gn/T/ruby-build.20150111114536.6196
Results logged to /var/folders/2v/wtshnx5x4294fvlxyrk9t8kh0000gn/T/ruby-build.20150111114536.6196.log

Last 10 log lines:
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking whether we are using the GNU C++ compiler... yes
checking whether g++ accepts -g... yes
checking how to run the C preprocessor... g++
configure: error: in `/var/folders/2v/wtshnx5x4294fvlxyrk9t8kh0000gn/T/ruby-build.20150111114536.6196/ruby-2.2.0&amp;#39;:
configure: error: C preprocessor &amp;quot;g++&amp;quot; fails sanity check
See `config.log&amp;#39; for more details
make: *** No targets specified and no makefile found.  Stop.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;執行 &lt;code&gt;xcode-select --install&lt;/code&gt; 更新 Xcode;
若在 Maverick 10.9.x 上遇到 &lt;code&gt;Can't install the software because it is not currently available from the Software Update server.&lt;/code&gt;
這樣的錯誤訊息，可以直接到 &lt;a href="https://developer.apple.com/downloads/index.action?name=Command%20Line%20Tools"&gt;Apple Developer&lt;/a&gt; 下載。&lt;/p&gt;</summary><category term="utils"></category></entry><entry><title>使用 letter_opener 檢視郵件</title><link href="http://tsaith.github.io/shi-yong-letter_opener-jian-shi-you-jian.html" rel="alternate"></link><updated>2014-12-31T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-12-31:shi-yong-letter_opener-jian-shi-you-jian.html</id><summary type="html">&lt;p&gt;在建構 Rails 應用時，
開發者常常需要反覆修改以及檢查欲寄送的 Email 內容是否正確，
&lt;a href="https://github.com/ryanb/letter_opener"&gt;letter_opener&lt;/a&gt; 可以讓這工作變得更有效率。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;在 Gemfile 裡面加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;group&lt;/span&gt; &lt;span class="ss"&gt;:development&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;letter_opener&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;接著執行 &lt;code&gt;bundle&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;郵件設定&lt;/h3&gt;
&lt;p&gt;在 config/environments/development.rb 裡面加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action_mailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delivery_method&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:letter_opener&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在開發模式下，當信件被寄出時，其內容會直接顯示在瀏覽器裡面。&lt;/p&gt;
&lt;h3&gt;操作範例&lt;/h3&gt;
&lt;p&gt;開啓 rails console，寄送一封測試郵件。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;rails c
Loading development environment &lt;span class="o"&gt;(&lt;/span&gt;Rails 4.1.1&lt;span class="o"&gt;)&lt;/span&gt;
2.1.5 :001 &amp;gt; AppMailer.send_welcome_email&lt;span class="o"&gt;(&lt;/span&gt;User.last&lt;span class="o"&gt;)&lt;/span&gt;.deliver
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;這時候 letter_opener 就會自動將信件內容傳送到瀏覽器的新分頁，如下
&lt;img src="https://farm9.staticflickr.com/8563/15996168469_b9f26d2f26_b.jpg"&gt;&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>使用 RSpec 在 Functional Tests 裡面測試郵件</title><link href="http://tsaith.github.io/shi-yong-rspec-zai-functional-tests-li-mian-ce-shi-you-jian.html" rel="alternate"></link><updated>2014-12-31T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-12-31:shi-yong-rspec-zai-functional-tests-li-mian-ce-shi-you-jian.html</id><summary type="html">&lt;p&gt;這篇文章將舉一些簡單的範例來說明如何使用
&lt;a href="http://rspec.info/"&gt;RSpec&lt;/a&gt; 對郵件的寄送進行測試。&lt;/p&gt;
&lt;p&gt;假設有一個 UsersController，
它的 create action 會寄送歡迎信給註冊的新使用者&lt;/p&gt;
&lt;p&gt;app/controllers/users_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UsersController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;其他程式碼&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;
    &lt;span class="vi"&gt;@user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user_params&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;
      &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:notice&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Your are registered.&amp;quot;&lt;/span&gt;
      &lt;span class="c1"&gt;# 寄送歡迎信&lt;/span&gt;
      &lt;span class="no"&gt;AppMailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_welcome_email&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliver&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;home_path&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:error&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;There&amp;#39;s something wrong during registration.&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;render&lt;/span&gt; &lt;span class="ss"&gt;:new&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果想要測試 create action 裡面的信件寄送，
可以撰寫 functional tests 如下&lt;/p&gt;
&lt;p&gt;spec/controllers/users_controller_spec.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;spec_helper&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="no"&gt;UsersController&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;POST create&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

    &lt;span class="n"&gt;context&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sending emails&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

      &lt;span class="c1"&gt;# 在每個測試結束後，清除所有郵件&lt;/span&gt;
      &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="no"&gt;ActionMailer&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliveries&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;clear&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

      &lt;span class="c1"&gt;# 若 inputs 有效，則寄出信件&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sends out email to the user with valid inputs&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="ss"&gt;email&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;alice@example.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;full_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Alice Liddel&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;ActionMailer&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliveries&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;not_to&lt;/span&gt; &lt;span class="n"&gt;be_empty&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;

      &lt;span class="c1"&gt;# 檢查收件人是否正確&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sends out email to the right recipient&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="ss"&gt;email&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;alice@example.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;full_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Alice Liddel&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;ActionMailer&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliveries&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;last&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;eq&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;alice@example.com&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;

      &lt;span class="c1"&gt;# 檢查信件內容是否包含使用者的名字&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sends out email containing the user&amp;#39;s name with valid inputs&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="ss"&gt;email&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;alice@example.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;full_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Alice Liddel&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;ActionMailer&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliveries&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;last&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="kp"&gt;include&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Alice Liddel&amp;quot;&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;

      &lt;span class="c1"&gt;# 若 inputs 無效，則不寄出信件&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;does not send out email with invalid inputs&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="ss"&gt;email&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;alice@example.com&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;ActionMailer&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliveries&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be_empty&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;倘若不熟悉如何撰寫 functional tests 的話，
可以參考&lt;a href="/blog/2014/12/07/functional-testing-with-rspec"&gt;這裡&lt;/a&gt;。&lt;/p&gt;</summary><category term="rails"></category><category term="testing"></category></entry><entry><title>實作 Follow 社交功能</title><link href="http://tsaith.github.io/shi-zuo-follow-she-jiao-gong-neng.html" rel="alternate"></link><updated>2014-12-31T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-12-31:shi-zuo-follow-she-jiao-gong-neng.html</id><summary type="html">&lt;p&gt;有使用過 Facebook 或 Twitter 的使用者們一定都不會對 Follow
這項功能感到陌生，
這裡將介紹如何實作這個機制。&lt;/p&gt;
&lt;h3&gt;Routes&lt;/h3&gt;
&lt;p&gt;在 routes.rb 中加入下列路徑&lt;/p&gt;
&lt;p&gt;app/config/routes.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;Myflix&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Applation&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;routes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;draw&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;其他程式碼&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

  &lt;span class="n"&gt;resources&lt;/span&gt; &lt;span class="ss"&gt;:relationships&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;only&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:destroy&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
  &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;people&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;relationships#index&amp;#39;&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Models&lt;/h3&gt;
&lt;p&gt;新增 Relationship 模型&lt;/p&gt;
&lt;p&gt;app/models/relationship.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Relationship&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:leader&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;User&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:follower&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;User&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;User 透過 following_relationships 和 leading_relationships
來記錄跟隨的關係;並定義 follow? 和 can_follow? 方法。&lt;/p&gt;
&lt;p&gt;app/models/user.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;其他程式碼&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

  &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:relationships&lt;/span&gt;
  &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:following_relationships&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Relationship&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;foreign_key&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;follower_id&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:leading_relationships&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Relationship&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;foreign_key&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;leader_id&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:leaders&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;User&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;through&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;:relationships&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;follows?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;another_user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;following_relationships&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="ss"&gt;:leader&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;include?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;another_user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;can_follow?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;another_user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;another_user&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;follows?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;another_user&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Controllers&lt;/h3&gt;
&lt;p&gt;新增 RelationshipsController&lt;/p&gt;
&lt;p&gt;app/controllers/relationships_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;RelationshipsController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="n"&gt;before_action&lt;/span&gt; &lt;span class="ss"&gt;:require_user&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;index&lt;/span&gt; &lt;span class="c1"&gt;# 顯示所有 following 關係&lt;/span&gt;
    &lt;span class="vi"&gt;@relationships&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;current_user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;following_relationships&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt; &lt;span class="c1"&gt;# 建立 following 關係&lt;/span&gt;
    &lt;span class="n"&gt;leader&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:leader_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="no"&gt;Relationship&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;leader&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;leader&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;follower&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;current_user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;current_user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;can_follow?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;leader&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;people_path&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;destroy&lt;/span&gt; &lt;span class="c1"&gt;# 移除 following 關係&lt;/span&gt;
    &lt;span class="n"&gt;relationship&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Relationship&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;relationship&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;destroy&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;relationship&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;follower&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;current_user&lt;/span&gt;
    &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;people_path&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Views&lt;/h3&gt;
&lt;p&gt;按下 Follow 連結可跟隨使用者&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm9.staticflickr.com/8591/16181912915_c991d8d5ba_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;app/views/users/show.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.user.container&lt;/span&gt;
  &lt;span class="nc"&gt;.row&lt;/span&gt;
    &lt;span class="nc"&gt;.col-sm-10.col-sm-offset-1&lt;/span&gt;
      &lt;span class="nt"&gt;%article&lt;/span&gt;
        &lt;span class="nt"&gt;%header&lt;/span&gt;
          &lt;span class="nt"&gt;%img&lt;/span&gt;(&lt;span class="na"&gt;src=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;http://www.gravatar.com/avatar/#{Digest::MD5.hexdigest(@user.email.downcase)}?s=40&amp;quot;&lt;/span&gt;)
          &lt;span class="nt"&gt;%h2&lt;/span&gt; &lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;full_name&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&amp;#39;s video collections (&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;queue_items&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;)
          &lt;span class="cp"&gt;-# 顯示 Follow 連結&lt;/span&gt;
          &lt;span class="p"&gt;-&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;current_user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;can_follow?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Follow&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;relationships_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;leader_id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="nb"&gt;method&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;:post&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;btn btn-default&amp;#39;&lt;/span&gt;

        &lt;span class="nt"&gt;%table&lt;/span&gt;&lt;span class="nc"&gt;.table&lt;/span&gt;
          &lt;span class="nt"&gt;%thead&lt;/span&gt;
            &lt;span class="nt"&gt;%tr&lt;/span&gt;
              &lt;span class="nt"&gt;%th&lt;/span&gt;(&lt;span class="na"&gt;width=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;30%&amp;quot;&lt;/span&gt;) Video Title
              &lt;span class="nt"&gt;%th&lt;/span&gt;(&lt;span class="na"&gt;width=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;15%&amp;quot;&lt;/span&gt;) Genre
          &lt;span class="nt"&gt;%tbody&lt;/span&gt;
            &lt;span class="p"&gt;-&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;queue_items&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;queue_item&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
              &lt;span class="nt"&gt;%tr&lt;/span&gt;
                &lt;span class="nt"&gt;%td&lt;/span&gt;
                  &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="n"&gt;queue_item&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;video_title&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;queue_item&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;video&lt;/span&gt;
                &lt;span class="nt"&gt;%td&lt;/span&gt;
                  &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="n"&gt;queue_item&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;category_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;queue_item&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;category&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;顯示所有 Following 關係&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm8.staticflickr.com/7513/15994591660_c722835f08_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;app/views/relationships/index.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.people&lt;/span&gt;
  &lt;span class="nt"&gt;%header&lt;/span&gt;
    &lt;span class="nt"&gt;%h2&lt;/span&gt; People I Follow
  &lt;span class="nt"&gt;%table&lt;/span&gt;&lt;span class="nc"&gt;.table&lt;/span&gt;
    &lt;span class="nt"&gt;%thead&lt;/span&gt;
      &lt;span class="nt"&gt;%tr&lt;/span&gt;
        &lt;span class="nt"&gt;%th&lt;/span&gt;(&lt;span class="na"&gt;width=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;30%&amp;quot;&lt;/span&gt;)
        &lt;span class="nt"&gt;%th&lt;/span&gt;(&lt;span class="na"&gt;width=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;20%&amp;quot;&lt;/span&gt;) Videos in Queue
        &lt;span class="nt"&gt;%th&lt;/span&gt;(&lt;span class="na"&gt;width=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;20%&amp;quot;&lt;/span&gt;) Followers
        &lt;span class="nt"&gt;%th&lt;/span&gt;(&lt;span class="na"&gt;width=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;30%&amp;quot;&lt;/span&gt;) Unfollow
    &lt;span class="nt"&gt;%tbody&lt;/span&gt;
      &lt;span class="p"&gt;-&lt;/span&gt; &lt;span class="vi"&gt;@relationships&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;relationship&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="c1"&gt;# following 關係&lt;/span&gt;
        &lt;span class="nt"&gt;%tr&lt;/span&gt;
          &lt;span class="nt"&gt;%td&lt;/span&gt;
            &lt;span class="nt"&gt;%img&lt;/span&gt;(&lt;span class="na"&gt;src=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;http://www.gravatar.com/avatar/#{Digest::MD5.hexdigest(relationship.leader.email.downcase)}?s=40&amp;quot;&lt;/span&gt;)
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="n"&gt;relationship&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;leader&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;full_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;relationship&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;leader&lt;/span&gt;
          &lt;span class="nt"&gt;%td&lt;/span&gt;&lt;span class="nc"&gt;.extra-padding&lt;/span&gt; &lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;relationship&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;leader&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;queue_items&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
          &lt;span class="nt"&gt;%td&lt;/span&gt;&lt;span class="nc"&gt;.extra-padding&lt;/span&gt; &lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;relationship&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;leader&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;leading_relationships&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
          &lt;span class="nt"&gt;%td&lt;/span&gt;&lt;span class="nc"&gt;.extra-padding&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="n"&gt;relationship&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;method&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;:delete&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="c1"&gt;# 移除 following 關係&lt;/span&gt;
              &lt;span class="nt"&gt;%i&lt;/span&gt;&lt;span class="nc"&gt;.glyphicon.glyphicon-remove&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>透過郵件允許使用者重設密碼</title><link href="http://tsaith.github.io/tou-guo-you-jian-yun-xu-shi-yong-zhe-zhong-she-mi-ma.html" rel="alternate"></link><updated>2014-12-31T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-12-31:tou-guo-you-jian-yun-xu-shi-yong-zhe-zhong-she-mi-ma.html</id><summary type="html">&lt;p&gt;在許多網站的使用者登入頁面中，
通常會伴隨一個處理忘記密碼的連結，
點選後，將會寄出一封電子郵件讓使用者可以藉此重設個人密碼;
而這篇文章將介紹如何實做這項功能。&lt;/p&gt;
&lt;h3&gt;操作流程&lt;/h3&gt;
&lt;p&gt;讓我們先預覽一次整個操作流程，當訪問登入頁面時，
可以看到最下方有個 Forgot Password? 的連結&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm9.staticflickr.com/8563/15549305854_4fc7a19b13_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;點選此連結後，會被導向新頁面，
在此可以寄送郵件到使用者的信箱&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm9.staticflickr.com/8602/15985772059_f5beaccf89_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;按下寄信後，將顯示信件已寄出的提示&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm8.staticflickr.com/7524/15984997938_e127612ea6_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;接下來，使用者將會收到一封郵件，內含網頁連結，
點選後，將會被引導至變更密碼的頁面&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm8.staticflickr.com/7466/16145868716_66b3c7b0db_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;最後，使用者可以在這個頁面中重新設定新的密碼&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm9.staticflickr.com/8575/15984342530_3d82f8865a_b.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;Routes&lt;/h3&gt;
&lt;p&gt;新增以下 routes
config/routes.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;forgot_password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;forgot_passwords#new&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;resources&lt;/span&gt; &lt;span class="ss"&gt;:forgot_passwords&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;only&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;forgot_password_confirmation&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;forgot_passwords#confirm&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;resources&lt;/span&gt; &lt;span class="ss"&gt;:password_resets&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;only&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:show&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;

&lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;expired_token&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;password_resets#expired_token&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Database&lt;/h3&gt;
&lt;p&gt;在 users table 裡面加入 token 欄位&lt;/p&gt;
&lt;p&gt;db/schema.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;users&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;force&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;full_name&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;email&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;password_digest&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;role&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;slug&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;token&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Views&lt;/h3&gt;
&lt;p&gt;在登入頁面新增 Forgot Password? 連結&lt;/p&gt;
&lt;p&gt;app/views/sessions/new.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.sign_in.container&lt;/span&gt;
  &lt;span class="nc"&gt;.row&lt;/span&gt;
    &lt;span class="nc"&gt;.col-sm-10.col-sm-offset-1&lt;/span&gt;
      &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bootstrap_form_tag&lt;/span&gt; &lt;span class="ss"&gt;url&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
        &lt;span class="nt"&gt;%header&lt;/span&gt;
          &lt;span class="nt"&gt;%h1&lt;/span&gt; Sign in
        &lt;span class="nc"&gt;.row&lt;/span&gt;
          &lt;span class="nc"&gt;.col-sm-4&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email_field&lt;/span&gt; &lt;span class="ss"&gt;:email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;label&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Email Address&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;placeholder&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;user_name@example.com&amp;#39;&lt;/span&gt;
        &lt;span class="nc"&gt;.row&lt;/span&gt;
          &lt;span class="nc"&gt;.col-sm-4&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password_field&lt;/span&gt; &lt;span class="ss"&gt;:password&lt;/span&gt;
        &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;submit&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sign in&amp;quot;&lt;/span&gt;
        &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Forgot Password?&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;forgot_password_path&lt;/span&gt; &lt;span class="c1"&gt;# 加入這一行&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;新增寄信頁面&lt;/p&gt;
&lt;p&gt;app/views/forgot_passwords/new.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.forgot_password.container&lt;/span&gt;
  &lt;span class="nc"&gt;.row&lt;/span&gt;
    &lt;span class="nc"&gt;.col-sm-10.col-bg-offset-1&lt;/span&gt;
      &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bootstrap_form_tag&lt;/span&gt; &lt;span class="ss"&gt;url&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;forgot_passwords_path&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
        &lt;span class="nt"&gt;%header&lt;/span&gt;
          &lt;span class="nt"&gt;%h1&lt;/span&gt; Forgot Password?
          &lt;span class="nt"&gt;%p&lt;/span&gt; We will send you an email with a link that you can use to reset your password.
        &lt;span class="nc"&gt;.row&lt;/span&gt;
          &lt;span class="nc"&gt;.col-sm-4&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email_field&lt;/span&gt; &lt;span class="ss"&gt;:email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;label&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Email Address&amp;quot;&lt;/span&gt;
        &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;submit&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Send Email&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;順便一提，這邊使用了 &lt;a href="https://github.com/bootstrap-ruby/rails-bootstrap-forms"&gt;rails-bootstrap-forms&lt;/a&gt; 來快速建構具有
&lt;a href="http://getbootstrap.com/"&gt;twitter bootstrap-style&lt;/a&gt; 的表格。&lt;/p&gt;
&lt;p&gt;新增確認頁面&lt;/p&gt;
&lt;p&gt;app/views/forgot_passwords/confirm.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.confirm_password_reset.container&lt;/span&gt;
  &lt;span class="nc"&gt;.row&lt;/span&gt;
    &lt;span class="nc"&gt;.col-sm-10.col-sm-offset-1&lt;/span&gt;
      &lt;span class="nt"&gt;%p&lt;/span&gt; We have sent an email with instruction to reset your password.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;新增修改密碼頁面&lt;/p&gt;
&lt;p&gt;app/views/password_resets/show.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.reset_password.container&lt;/span&gt;
  &lt;span class="nc"&gt;.row&lt;/span&gt;
    &lt;span class="nc"&gt;.col-sm-10.col-sm-offset-1&lt;/span&gt;
      &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bootstrap_form_tag&lt;/span&gt; &lt;span class="ss"&gt;url&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;password_resets_path&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
        &lt;span class="nt"&gt;%header&lt;/span&gt;
          &lt;span class="nt"&gt;%h1&lt;/span&gt; Reset Your Password
        &lt;span class="nc"&gt;.row&lt;/span&gt;
          &lt;span class="nc"&gt;.col-sm-4&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password_field&lt;/span&gt; &lt;span class="ss"&gt;:password&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;label&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;New Password&amp;quot;&lt;/span&gt;
            &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hidden_field&lt;/span&gt; &lt;span class="ss"&gt;:token&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;value&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="vi"&gt;@token&lt;/span&gt;
        &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;submit&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Reset Password&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;新增 token 已經過期的頁面&lt;/p&gt;
&lt;p&gt;app/views/password_resets/expired_token.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;%section&lt;/span&gt;&lt;span class="nc"&gt;.invalid_token.container&lt;/span&gt;
  &lt;span class="nc"&gt;.row&lt;/span&gt;
    &lt;span class="nc"&gt;.col-sm-10.col-sm-offset-1&lt;/span&gt;
      &lt;span class="nt"&gt;%p&lt;/span&gt; Your reset password link is expired.
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Controllers&lt;/h3&gt;
&lt;p&gt;新增 ForgotPasswordsController&lt;/p&gt;
&lt;p&gt;app/controllers/forgot_passwords_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ForgotPasswordsController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;new&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;
    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;email&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:email&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;
      &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;generate_token&lt;/span&gt;
      &lt;span class="no"&gt;AppMailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_password_reset&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliver&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;forgot_password_confirmation_path&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:error&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:email&lt;/span&gt;&lt;span class="o"&gt;].&lt;/span&gt;&lt;span class="n"&gt;blank?&lt;/span&gt; &lt;span class="p"&gt;?&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Email cannot be blank.&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;There is no user with that email in the system.&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;forgot_password_path&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;confirm&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;新增 PasswordResetsController&lt;/p&gt;
&lt;p&gt;app/controllers/password_resets_controller.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;PasswordResetsController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;show&lt;/span&gt;
    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;token&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;
      &lt;span class="vi"&gt;@token&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;expired_token_path&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;
    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;token&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:token&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;
      &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:password&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;
        &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;clear_token&lt;/span&gt;
        &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:success&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Your password has been changed. Please sign in.&amp;quot;&lt;/span&gt;
      &lt;span class="k"&gt;else&lt;/span&gt;
        &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:error&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Invalid new password. Password did not change.&amp;quot;&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;expired_token_path&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;expired_token&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Models&lt;/h3&gt;
&lt;p&gt;上面使用的 &lt;code&gt;generate_token&lt;/code&gt; 和 &lt;code&gt;clear_token&lt;/code&gt; methods
定義在 User class 裡面&lt;/p&gt;
&lt;p&gt;app/models/user.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="err"&gt;其他程式碼&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;generate_token&lt;/span&gt;
    &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update_column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:token&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;SecureRandom&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;urlsafe_base64&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;clear_token&lt;/span&gt;
    &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update_column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:token&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kp"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Mailer&lt;/h3&gt;
&lt;p&gt;在 development.rb 和 production.rb 裡面設定 :host 如下&lt;/p&gt;
&lt;p&gt;config/environments/development.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;# Mailer host&lt;/span&gt;
&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action_mailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;default_url_options&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="ss"&gt;:host&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;localhost:3000&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;config/environments/production.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;# Mailer host&lt;/span&gt;
&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action_mailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;default_url_options&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="ss"&gt;:host&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;你的主機&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後新增 AppMailer&lt;/p&gt;
&lt;p&gt;app/mailers/app_mailer.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;AppMailer&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActionMailer&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="n"&gt;default&lt;/span&gt; &lt;span class="ss"&gt;from&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;MYFLIX_SMTP_USER_NAME&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;send_password_reset&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="vi"&gt;@user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;
    &lt;span class="n"&gt;mail&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;subject&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Please reset your password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;MYFLIX_SMTP_USER_NAME 是我們自定的環境變數，
倘若不清楚如何使用環境變數來設定郵件的帳號或密碼，
可參考&lt;a href="/blog/2014/11/26/how-to-set-up-email-password-securely"&gt;這篇文章&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;最後，新增信件內容&lt;/p&gt;
&lt;p&gt;app/views/app_mailer/send_password_reset.html.haml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nn"&gt;!!! 5&lt;/span&gt;
&lt;span class="nt"&gt;%html&lt;/span&gt;(&lt;span class="na"&gt;lang=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;en-US&amp;quot;&lt;/span&gt;)
  &lt;span class="nt"&gt;%body&lt;/span&gt;
    &lt;span class="nt"&gt;%p&lt;/span&gt; Please click on the link below to reset your password:
    &lt;span class="nt"&gt;%p&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Reset My Password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password_reset_url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>使用單一抽象層撰寫測試</title><link href="http://tsaith.github.io/shi-yong-dan-yi-chou-xiang-ceng-zhuan-xie-ce-shi.html" rel="alternate"></link><updated>2014-12-23T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-12-23:shi-yong-dan-yi-chou-xiang-ceng-zhuan-xie-ce-shi.html</id><summary type="html">&lt;p&gt;當撰寫測試時，使用單一抽象層的技巧可以讓程式更容易閱讀，
也避免開發者必須將思維在不同抽象層級中切換。&lt;/p&gt;
&lt;p&gt;假設我們使用 &lt;a href="https://github.com/jnicklas/capybara"&gt;Capybara&lt;/a&gt;
來測試網站的登入流程&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;spec_helper&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;feature&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;User signs in&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;scenario&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;with valid email and password&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

    &lt;span class="n"&gt;alice&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="c1"&gt;# 使用者登入&lt;/span&gt;
    &lt;span class="n"&gt;visit&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Email&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:with&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:with&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;
    &lt;span class="n"&gt;click_button&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Sign in&amp;#39;&lt;/span&gt;

    &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;have_content&lt;/span&gt; &lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;full_name&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在上述的範例中，開發者必須將思緒切換到底層考慮
Capybara 該如何處理欄位的填寫和按鈕，
然後再回到更高階層以預期使用者名稱將會出現在新的頁面。&lt;/p&gt;
&lt;p&gt;但我們可以將底層的細節封裝起來，
讓每個步驟儘可能位於同一個抽象層面&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;feature&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;User signs in&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;scenario&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;with valid email and password&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;alice&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="c1"&gt;# 使用者登入&lt;/span&gt;
    &lt;span class="n"&gt;sign_in&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;have_content&lt;/span&gt; &lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;full_name&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;sign_in&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;visit&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Email&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:with&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:with&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;
    &lt;span class="n"&gt;click_button&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Sign in&amp;#39;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如此一來，開發者在閱讀程式時，就更能專注於思考整體的邏輯，
程式碼所顯示的內聚性也大幅提升;
更多的相關討論可參考&lt;a href="http://robots.thoughtbot.com/acceptance-tests-at-a-single-level-of-abstraction"&gt;這裡&lt;/a&gt;。&lt;/p&gt;</summary><category term="rails"></category><category term="testing"></category></entry><entry><title>在 RSpec 中使用 Macros</title><link href="http://tsaith.github.io/zai-rspec-zhong-shi-yong-macros.html" rel="alternate"></link><updated>2014-12-22T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-12-22:zai-rspec-zhong-shi-yong-macros.html</id><summary type="html">&lt;p&gt;撰寫測試時，常常會遇到不同地方需要做相同或類似的事，
這時候可以考慮將共用的邏輯抽出並寫成 macros，
避免讓相同的程式區塊散佈於各處，
以方便閱讀和日後的維護。&lt;/p&gt;
&lt;p&gt;假設我們有份程式用來測試使用者的登入流程，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;spec_helper&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;feature&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;User signs in&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;scenario&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;with valid email and password&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;alice&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;visit&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Email&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:with&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:with&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;
    &lt;span class="n"&gt;click_button&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Sign in&amp;#39;&lt;/span&gt;

    &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;have_content&lt;/span&gt; &lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;full_name&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;中間部分的程式碼敘述了使用者的登入步驟;
這時候我們可以將此處抽出並在 spec/support/macros.rb
裡面定義一個新函數 sign_in&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;sign_in&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a_user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kp"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;a_user&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;visit&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt;
  &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Email&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:with&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;
  &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:with&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;
  &lt;span class="n"&gt;click_button&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Sign in&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後將原先的測試程式改寫如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;spec_helper&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;feature&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;User signs in&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;scenario&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;with valid email and password&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;alice&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;sign_in&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;have_content&lt;/span&gt; &lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;full_name&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;除了程式碼的可讀性明顯提升之外，
日後編寫其他測試時若牽涉到使用者登入，
也只要簡單地引用 sign_in 這個 macro 即可。&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>在 RSpec 中使用 shared examples</title><link href="http://tsaith.github.io/zai-rspec-zhong-shi-yong-shared-examples.html" rel="alternate"></link><updated>2014-12-22T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-12-22:zai-rspec-zhong-shi-yong-shared-examples.html</id><summary type="html">&lt;p&gt;使用 RSpec 撰寫測試時，
我們可以使用 &lt;a href="http://www.relishapp.com/rspec/rspec-core/v/3-1/docs/example-groups/shared-examples"&gt;shared examples&lt;/a&gt; 將
常用的測試範例封裝起來，方便隨時調用。&lt;/p&gt;
&lt;p&gt;假設我們撰寫了一些測試，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;spec_helper&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="no"&gt;VideosController&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;GET index&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sets @categories for authenticated users&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;set_current_user&lt;/span&gt;
      &lt;span class="n"&gt;category&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:category&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="ss"&gt;:index&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;assigns&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:categories&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;eq&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;category&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;redirects to the sign in page&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="ss"&gt;:index&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sets the flash error message&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="ss"&gt;:index&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:error&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be_present&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;GET show&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sets @video for authenticated user&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;set_current_user&lt;/span&gt;
      &lt;span class="n"&gt;video&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:video&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="ss"&gt;:show&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;slug&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;assigns&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:video&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;eq&lt;/span&gt; &lt;span class="n"&gt;video&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;redirects to the sign in page&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;video&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:video&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="ss"&gt;:show&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;slug&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sets the flash error message&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;video&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:video&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="ss"&gt;:show&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;slug&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:error&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be_present&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;正如所見，&lt;code&gt;GET index&lt;/code&gt; 和 &lt;code&gt;GET show&lt;/code&gt; 裡面存在著類似的測試，
我們可以此部分放到 spec/support/shared_examples.rb 裡面&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;shared_examples&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;requires sign in&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;redirects to the sign in page&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;action&lt;/span&gt;
    &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sets the flash error message&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;action&lt;/span&gt;
    &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:error&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be_present&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;於是原先的測試程式就可以 refactor 成&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;spec_helper&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="no"&gt;VideosController&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;GET index&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sets @categories for authenticated users&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;set_current_user&lt;/span&gt;
      &lt;span class="n"&gt;category&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:category&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="ss"&gt;:index&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;assigns&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:categories&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;eq&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;category&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;it_behaves_like&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;requires sign in&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;video&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:video&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;let&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:action&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="ss"&gt;:index&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;GET show&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sets @video for authenticated user&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;set_current_user&lt;/span&gt;
      &lt;span class="n"&gt;video&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:video&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="ss"&gt;:show&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;slug&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;assigns&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:video&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;eq&lt;/span&gt; &lt;span class="n"&gt;video&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;it_behaves_like&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;requires sign in&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;video&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:video&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;let&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:action&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="ss"&gt;:show&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;slug&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;除了程式碼變得簡潔之外，
日後我們也更容易對封裝的部分進行功能的擴充或修改。&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>Bash 中常用的快捷鍵</title><link href="http://tsaith.github.io/bash-zhong-chang-yong-de-kuai-jie-jian.html" rel="alternate"></link><updated>2014-12-16T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-12-16:bash-zhong-chang-yong-de-kuai-jie-jian.html</id><summary type="html">&lt;p&gt;目前 Mac 預設的 shell 是 Bash，這裡列出一些常用的快捷鍵。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ctrl&lt;/code&gt; + &lt;code&gt;a&lt;/code&gt;: 將游標移到開頭&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ctrl&lt;/code&gt; + &lt;code&gt;e&lt;/code&gt;: 將游標移到結尾&lt;/li&gt;
&lt;li&gt;&lt;code&gt;alt&lt;/code&gt; + &lt;code&gt;f&lt;/code&gt;: 將游標向前移動一個單字&lt;/li&gt;
&lt;li&gt;&lt;code&gt;alt&lt;/code&gt; + &lt;code&gt;b&lt;/code&gt;: 將游標向後移動一個單字&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ctrl&lt;/code&gt; + &lt;code&gt;k&lt;/code&gt;: 刪除游標後面的所有字元&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ctrl&lt;/code&gt; + &lt;code&gt;u&lt;/code&gt;: 刪除游標前面的所有字元&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ctrl&lt;/code&gt; + &lt;code&gt;w&lt;/code&gt;: 刪除游標前面的一個單字&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ctrl&lt;/code&gt; + &lt;code&gt;t&lt;/code&gt;: 將游標前的兩個字母對調&lt;/li&gt;
&lt;li&gt;&lt;code&gt;esc&lt;/code&gt; + &lt;code&gt;t&lt;/code&gt;: 將游標前的兩個單字對調&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tab&lt;/code&gt;: 自動完成檔案或目錄名稱&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ctrl&lt;/code&gt; + &lt;code&gt;d&lt;/code&gt;: 刪除游標後的一個字元&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ctrl&lt;/code&gt; + &lt;code&gt;c&lt;/code&gt;: 中斷執行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ctrl&lt;/code&gt; + &lt;code&gt;z&lt;/code&gt;: 暫停程序並將它丟到背景&lt;/li&gt;
&lt;/ul&gt;</summary><category term="utils"></category></entry><entry><title>好用的 Debug 工具: Pry</title><link href="http://tsaith.github.io/hao-yong-de-debug-gong-ju-pry.html" rel="alternate"></link><updated>2014-12-15T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-12-15:hao-yong-de-debug-gong-ju-pry.html</id><summary type="html">&lt;p&gt;開發 Rails 或 Ruby 應用時，我們可以使用 &lt;a href="https://github.com/pry/pry"&gt;pry&lt;/a&gt; 和 &lt;a href="https://github.com/nixme/pry-nav"&gt;pry-nav&lt;/a&gt; 來大幅提高 debug 效率。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;在 Gemfile 中加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;group&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;development&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;pry&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;pry-nav&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 &lt;code&gt;bundle&lt;/code&gt;&lt;/p&gt;
&lt;h3&gt;使用方法&lt;/h3&gt;
&lt;p&gt;在想要 debug 的地方加入 binding.pry，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SessionsController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;new&lt;/span&gt;
    &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;home_path&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;current_user&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;
    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;email&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:email&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;authenticate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:password&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;

      &lt;span class="nb"&gt;binding&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pry&lt;/span&gt; &lt;span class="c1"&gt;# 設定中斷點&lt;/span&gt;

      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:notice&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Your&amp;#39;ve signed in, enjoy!&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;home_path&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:error&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Invalid email or password.&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;destroy&lt;/span&gt;
    &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kp"&gt;nil&lt;/span&gt;
    &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;home_path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;notice&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;You are signed out!&amp;quot;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;當 server 執行到 binding.pry 所在的地方，
將會暫停並且進入互動模式，這時後就可以開始進行偵錯&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="ss"&gt;From&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="sr"&gt;/Users/&lt;/span&gt;&lt;span class="n"&gt;tsaith&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;projects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;myflix&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;controllers&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sessions_controller&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rb&lt;/span&gt; &lt;span class="err"&gt;@&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;11&lt;/span&gt; &lt;span class="no"&gt;SessionsController&lt;/span&gt;&lt;span class="c1"&gt;#create:&lt;/span&gt;

     &lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;
     &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;   &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;email&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:email&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;
     &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;   &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;authenticate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:password&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;
 &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="nb"&gt;binding&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pry&lt;/span&gt;
    &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:notice&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Your&amp;#39;ve signed in, enjoy!&amp;quot;&lt;/span&gt;
    &lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;home_path&lt;/span&gt;
    &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;   &lt;span class="k"&gt;else&lt;/span&gt;
    &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:error&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Invalid email or password.&amp;quot;&lt;/span&gt;
    &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt;
    &lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;   &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="n"&gt;pry&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="c1"&gt;#&amp;lt;SessionsController&amp;gt;)&amp;gt; params&lt;/span&gt;
&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;utf8&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;✓&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="s2"&gt;&amp;quot;authenticity_token&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Is1jphXlmnK8fRfJT2YdJqMcBFTNxuzn1bIum1o9D3U=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="s2"&gt;&amp;quot;email&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;user@gmail.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="s2"&gt;&amp;quot;password&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;user_password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="s2"&gt;&amp;quot;commit&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Sign in&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="s2"&gt;&amp;quot;controller&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sessions&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="s2"&gt;&amp;quot;action&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;create&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="n"&gt;pry&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="c1"&gt;#&amp;lt;SessionsController&amp;gt;)&amp;gt; user.id&lt;/span&gt;
&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="n"&gt;pry&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="c1"&gt;#&amp;lt;SessionsController&amp;gt;)&amp;gt; next&lt;/span&gt;

&lt;span class="ss"&gt;From&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="sr"&gt;/Users/&lt;/span&gt;&lt;span class="n"&gt;tsaith&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;projects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;myflix&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;controllers&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sessions_controller&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rb&lt;/span&gt; &lt;span class="err"&gt;@&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt; &lt;span class="no"&gt;SessionsController&lt;/span&gt;&lt;span class="c1"&gt;#create:&lt;/span&gt;

     &lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;
     &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;   &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;email&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:email&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;
     &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;   &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;authenticate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:password&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;
    &lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="nb"&gt;binding&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pry&lt;/span&gt;
 &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:notice&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Your&amp;#39;ve signed in, enjoy!&amp;quot;&lt;/span&gt;
    &lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;home_path&lt;/span&gt;
    &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;   &lt;span class="k"&gt;else&lt;/span&gt;
    &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:error&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Invalid email or password.&amp;quot;&lt;/span&gt;
    &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt;
    &lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;   &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="n"&gt;pry&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="c1"&gt;#&amp;lt;SessionsController&amp;gt;)&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;倘若希望離開偵錯模式，請執行 &lt;code&gt;Ctrl&lt;/code&gt; + &lt;code&gt;d&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;最後，如果想對常用的命令新增 alias 可以在 ~/.pryrc 裡面定義&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;Pry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commands&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;alias_command&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;continue&amp;#39;&lt;/span&gt;
&lt;span class="no"&gt;Pry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commands&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;alias_command&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;s&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;step&amp;#39;&lt;/span&gt;
&lt;span class="no"&gt;Pry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commands&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;alias_command&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;n&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;next&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>快速啟動 rails: pow</title><link href="http://tsaith.github.io/kuai-su-qi-dong-rails-pow.html" rel="alternate"></link><updated>2014-12-15T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-12-15:kuai-su-qi-dong-rails-pow.html</id><summary type="html">&lt;p&gt;許多 Rails 開發者應該都有這樣的經驗，
每次開發專案前總是得先在終端機執行 &lt;code&gt;rails server&lt;/code&gt; 才能啟動網站，
這樣實在有點麻煩;
&lt;a href="https://basecamp.com/"&gt;Basecamp&lt;/a&gt; 因此而開發了一個免費工具 &lt;a href="https://github.com/basecamp/pow"&gt;Pow&lt;/a&gt; 可以簡單地為我們解決這個困擾。&lt;/p&gt;
&lt;h3&gt;安裝 Pow&lt;/h3&gt;
&lt;p&gt;在終端機下執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;curl get.pow.cx &lt;span class="p"&gt;|&lt;/span&gt; sh
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;使用方法&lt;/h3&gt;
&lt;p&gt;進入 ~/.pow 目錄，然後創造一個專案的連結即可。
例如，假設我們有一個專案 ~/projects/myflix，
那麼可以執行下面的命令來創造對應的連結&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; ~/.pow
&lt;span class="nv"&gt;$ &lt;/span&gt;ln -s ~/projects/myflix
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;現在，
只要將瀏覽器連到 http://myflix.dev 就能看到運行的網站。&lt;/p&gt;
&lt;h3&gt;使用 RVM&lt;/h3&gt;
&lt;p&gt;因為 pow 預設只有支援 &lt;a href="https://github.com/sstephenson/rbenv"&gt;rbenv&lt;/a&gt;，
所以 &lt;a href="https://rvm.io"&gt;rvm&lt;/a&gt; 的使用者需要額外地在專案下新增 .powenv 並加入下面的內容，才能讓 pow 正常工作。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -z &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;rvm_path&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -x &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;HOME&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/.rvm/bin/rvm&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;then&lt;/span&gt; &lt;span class="nv"&gt;rvm_path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;HOME&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/.rvm&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -z &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;rvm_path&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -x &lt;span class="s2"&gt;&amp;quot;/usr/local/rvm/bin/rvm&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;then&lt;/span&gt; &lt;span class="nv"&gt;rvm_path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/usr/local/rvm&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;

&lt;span class="c"&gt;# load environment of current project ruby&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt;
  &lt;span class="o"&gt;[&lt;/span&gt; -n &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;rvm_path&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  &lt;span class="o"&gt;[&lt;/span&gt; -x &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;rvm_path&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/bin/rvm&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  &lt;span class="nv"&gt;rvm_project_environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;rvm_path&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/bin/rvm&amp;quot;&lt;/span&gt; . &lt;span class="k"&gt;do&lt;/span&gt; rvm env --path 2&amp;gt;/dev/null&lt;span class="sb"&gt;`&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  &lt;span class="o"&gt;[&lt;/span&gt; -n &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;rvm_project_environment&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  &lt;span class="o"&gt;[&lt;/span&gt; -s &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;rvm_project_environment&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;then&lt;/span&gt;
  &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;RVM loading: &lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;rvm_project_environment&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
  &lt;span class="se"&gt;\.&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;rvm_project_environment&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;else&lt;/span&gt;
  &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;RVM project not found at: &lt;/span&gt;&lt;span class="nv"&gt;$PWD&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;更方便地使用 Pow&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://github.com/Rodreegez/powder"&gt;Powder&lt;/a&gt; 可以讓 pow 的使用變得更加方便。&lt;/p&gt;
&lt;p&gt;安裝套件&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;gem install powder
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;這裡列出一些常用的操作:&lt;/p&gt;
&lt;p&gt;連結當前目錄到 ~/.pow/&amp;lt;當前目錄&amp;gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;power link
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在瀏覽器開啓專案&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;powder open
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;查看 .powenv 的內容&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;powder env
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;開啓 debug shell&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;power debug
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;重開 app&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;powder restart
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>使用 RSpec 寫 Feature Tests</title><link href="http://tsaith.github.io/shi-yong-rspec-xie-feature-tests.html" rel="alternate"></link><updated>2014-12-07T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-12-07:shi-yong-rspec-xie-feature-tests.html</id><summary type="html">&lt;p&gt;在開發 Rails 專案時，我們可使用 Feature Tests
來模擬使用者在應用程式中的操作流程;
這裡將介紹如何使用 &lt;a href="https://github.com/rspec/rspec-rails"&gt;RSpec&lt;/a&gt;
搭配 &lt;a href="https://github.com/jnicklas/capybara"&gt;Capybara&lt;/a&gt;
來撰寫這方面的測試。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;在 Gemfile 加入 &lt;code&gt;gem 'capybara'&lt;/code&gt;
然後執行 &lt;code&gt;bundle&lt;/code&gt; 安裝 Capybara。&lt;/p&gt;
&lt;p&gt;假使安裝套件時遇到 'An error occurred while installing nokogiri' 這樣的錯誤訊息&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;Gem::Ext::BuildError: ERROR: Failed to build gem native extension.

    /Users/tsaith/.rvm/rubies/ruby-2.1.1/bin/ruby -r ./siteconf20141220-15553-1vqn6mc.rb extconf.rb
checking if the C compiler accepts ... yes
checking if the C compiler accepts -Wno-error=unused-command-line-argument-hard-error-in-future... no
Building nokogiri using packaged libraries.
checking for iconv... yes
************************************************************************
IMPORTANT NOTICE:

Buidling Nokogiri with a packaged version of libxml2-2.9.2
with the following patches applied:
    - 0001-Revert-Missing-initialization-for-the-catalog-module.patch
    - 0002-Fix-missing-entities-after-CVE-2014-3660-fix.patch

Team Nokogiri will keep on doing their best to provide security
updates in a timely manner, but if this is a concern for you and want
to use the system library instead; abort this installation process and
reinstall nokogiri as follows:

    gem install nokogiri -- --use-system-libraries
        [--with-xml2-config=/path/to/xml2-config]
        [--with-xslt-config=/path/to/xslt-config]

If you are using Bundler, tell it to use the option:

    bundle config build.nokogiri --use-system-libraries
    bundle install

Note, however, that nokogiri is not fully compatible with arbitrary
versions of libxml2 provided by OS/package vendors.
************************************************************************
Extracting libxml2-2.9.2.tar.gz into tmp/x86_64-apple-darwin12.5.0/ports/libxml2/2.9.2... OK
Running patch with /Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/nokogiri-1.6.5/ports/patches/libxml2/0001-Revert-Missing-initialization-for-the-catalog-module.patch...
Running &amp;#39;patch&amp;#39; for libxml2 2.9.2... OK
Running patch with /Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/nokogiri-1.6.5/ports/patches/libxml2/0002-Fix-missing-entities-after-CVE-2014-3660-fix.patch...
Running &amp;#39;patch&amp;#39; for libxml2 2.9.2... OK
Running &amp;#39;configure&amp;#39; for libxml2 2.9.2... ERROR, review &amp;#39;/Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/nokogiri-1.6.5/ext/nokogiri/tmp/x86_64-apple-darwin12.5.0/ports/libxml2/2.9.2/configure.log&amp;#39; to see what happened.
*** extconf.rb failed ***
Could not create Makefile due to some reason, probably lack of necessary
libraries and/or headers.  Check the mkmf.log file for more details.  You may
need configuration options.

Provided configuration options:
    --with-opt-dir
    --without-opt-dir
    --with-opt-include
    --without-opt-include=&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;opt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;dir&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;/include
    --with-opt-lib
    --without-opt-lib=&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;opt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;dir&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;/lib
    --with-make-prog
    --without-make-prog
    --srcdir=.
    --curdir
    --ruby=/Users/tsaith/.rvm/rubies/ruby-2.1.1/bin/ruby
    --help
    --clean
    --use-system-libraries
    --enable-static
    --disable-static
    --with-zlib-dir
    --without-zlib-dir
    --with-zlib-include
    --without-zlib-include=&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;zlib&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;dir&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;/include
    --with-zlib-lib
    --without-zlib-lib=&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;zlib&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;dir&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;/lib
    --enable-cross-build
    --disable-cross-build
/Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/mini_portile-0.6.1/lib/mini_portile.rb:279:in `block in execute&amp;#39;: Failed to complete configure task (RuntimeError)
    from /Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/mini_portile-0.6.1/lib/mini_portile.rb:271:in `chdir&amp;#39;
    from /Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/mini_portile-0.6.1/lib/mini_portile.rb:271:in `execute&amp;#39;
    from /Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/mini_portile-0.6.1/lib/mini_portile.rb:66:in `configure&amp;#39;
    from /Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/mini_portile-0.6.1/lib/mini_portile.rb:109:in `cook&amp;#39;
    from extconf.rb:268:in `block in process_recipe&amp;#39;
    from extconf.rb:167:in `tap&amp;#39;
    from extconf.rb:167:in `process_recipe&amp;#39;
    from extconf.rb:455:in `&lt;span class="nt"&gt;&amp;lt;main&amp;gt;&lt;/span&gt;&amp;#39;

extconf failed, exit code 1

Gem files will remain installed in /Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/gems/nokogiri-1.6.5 for inspection.
Results logged to /Users/tsaith/.rvm/gems/ruby-2.1.1@myflix/extensions/x86_64-darwin-12/2.1.0-static/nokogiri-1.6.5/gem_make.out
An error occurred while installing nokogiri (1.6.5), and Bundler cannot continue.
Make sure that `gem install nokogiri -v &amp;#39;1.6.5&amp;#39;` succeeds before bundling.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以試著指定系統內建的函式庫來安裝 Nokogiri&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;bundle config build.nokogiri --use-system-libraries
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後再執行一次 &lt;code&gt;bundle&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;設定 spec_helper.rb&lt;/h3&gt;
&lt;p&gt;在 spec/spec_helper.rb 裡面加入 &lt;code&gt;require 'capybara/rails'&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;# This file is copied to spec/ when you run &amp;#39;rails generate rspec:install&amp;#39;&lt;/span&gt;
&lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;RAILS_ENV&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;||=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="no"&gt;File&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;expand_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;../../config/environment&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;__FILE__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rspec/rails&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;capybara/rails&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;編寫測試&lt;/h3&gt;
&lt;p&gt;假設我們現在想要模擬使用者的登入流程，
請新增檔案 spec/features/user_signs_in_spec.rb
並加入內容如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;spec_helper&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;feature&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;User signs in&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;scenario&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;with valid email and password&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;alice&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;                     &lt;span class="c1"&gt;# 宣告使用者&lt;/span&gt;
    &lt;span class="n"&gt;visit&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt;                           &lt;span class="c1"&gt;# 訪問登入網頁&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Email&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:with&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;        &lt;span class="c1"&gt;# 填寫 Email&lt;/span&gt;
    &lt;span class="n"&gt;fill_in&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:with&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;  &lt;span class="c1"&gt;# 填寫 Password&lt;/span&gt;
    &lt;span class="n"&gt;click_button&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Sign in&amp;#39;&lt;/span&gt;                       &lt;span class="c1"&gt;# 按下 Sign in 按鈕&lt;/span&gt;
    &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;have_content&lt;/span&gt; &lt;span class="n"&gt;alice&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;full_name&lt;/span&gt; &lt;span class="c1"&gt;# 預期網頁的內容會出現使用者的名字&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;上面的 &lt;code&gt;feature&lt;/code&gt; 和 &lt;code&gt;scenario&lt;/code&gt; 其意義等同於
RSpec 中的 &lt;code&gt;describe ..., :type =&amp;gt; :feature&lt;/code&gt; 和 &lt;code&gt;it&lt;/code&gt;;
&lt;a href="https://www.relishapp.com/rspec/rspec-rails/docs/feature-specs/feature-spec"&gt;Relish&lt;/a&gt; 提供了豐富的語法介紹。&lt;/p&gt;
&lt;p&gt;最後，執行 &lt;code&gt;rspec&lt;/code&gt; 即可看到測試結果。&lt;/p&gt;</summary><category term="rails"></category><category term="testing"></category></entry><entry><title>使用 RSpec 撰寫 Functional Tests</title><link href="http://tsaith.github.io/shi-yong-rspec-zhuan-xie-functional-tests.html" rel="alternate"></link><updated>2014-12-07T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-12-07:shi-yong-rspec-zhuan-xie-functional-tests.html</id><summary type="html">&lt;p&gt;在開發 Rails 專案時，我們可以撰寫 Functional Tests 來測試
controller 的功能是否正常工作;
例如，如果想測試使用者的登入與登出，
就可以在 spec/controllers/ 下面新增一個檔案
sessions_controller_spec.rb，內容如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;spec_helper&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="no"&gt;SessionsController&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;let&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="no"&gt;Fabricate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;GET new&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;redirects to the home page for authenticated users&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;
      &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="ss"&gt;:new&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;home_path&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;POST create&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;context&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;with valid credentials&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;email&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;

      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;puts the signed in user in the session&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;eq&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;redirects to the home page&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;home_path&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sets the notice&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:notice&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;not_to&lt;/span&gt; &lt;span class="n"&gt;be_blank&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;context&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;with invalid credentials&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;email&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sadsafds&amp;quot;&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;

      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;does not put the signed in user in the session&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be_nil&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;redirects to the sign in page&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;sign_in_path&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sets the error message&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:error&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;not_to&lt;/span&gt; &lt;span class="n"&gt;be_blank&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;GET destroy&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;
      &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="ss"&gt;:destroy&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;clears the session for the user&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be_nil&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;redirects to the home page&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;home_path&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sets the notice&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:notice&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;not_to&lt;/span&gt; &lt;span class="n"&gt;be_blank&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在上面的範例中，我們測試了 new 和 create 以及 destroy
三個動作，並使用 &lt;a href="http://www.fabricationgem.org/"&gt;Fabrication&lt;/a&gt; 來簡化產生 User 物件的過程;
其對應的程式碼則位於 spec/fabricators/
下面的 user_fabricator.rb&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;Fabricator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;email&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="no"&gt;Faker&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt; &lt;span class="no"&gt;Internet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;password&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="no"&gt;Faker&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Internet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;full_name&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="no"&gt;Faker&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Name&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在 user fabricator 裡面，進一步使用了
&lt;a href="https://github.com/stympy/faker"&gt;Faker&lt;/a&gt;
來自動產生 email 或 password 欄位的值。&lt;/p&gt;
&lt;p&gt;編寫好程式後，執行 &lt;code&gt;rspec&lt;/code&gt; 就能看到測試結果。&lt;/p&gt;</summary><category term="rails"></category><category term="testing"></category></entry><entry><title>使用 RSpec 撰寫 Unit Tests</title><link href="http://tsaith.github.io/shi-yong-rspec-zhuan-xie-unit-tests.html" rel="alternate"></link><updated>2014-12-07T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-12-07:shi-yong-rspec-zhuan-xie-unit-tests.html</id><summary type="html">&lt;p&gt;我們可以使用單元測試來檢查模型的屬性和自定方法是否正常運作;
假設有個 Category model，內容如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Category&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:videos&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;created_at DESC&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="n"&gt;validates&lt;/span&gt; &lt;span class="ss"&gt;:name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;presence&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;uniqueness&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;recent_videos&lt;/span&gt;
    &lt;span class="n"&gt;videos&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;那麼對應的測試程式 spec/models/category_spec.rb 其內容可以撰寫如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;spec_helper&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;shoulda/matchers&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="no"&gt;Category&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;is_expected&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;have_many&lt;/span&gt; &lt;span class="ss"&gt;:videos&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;is_expected&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;validate_presence_of&lt;/span&gt; &lt;span class="ss"&gt;:name&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;is_expected&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;validate_uniqueness_of&lt;/span&gt; &lt;span class="ss"&gt;:name&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;#recent_videos&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;let&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:category&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="no"&gt;Category&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create!&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Game&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;
    &lt;span class="n"&gt;subject&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;category&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recent_videos&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;returns an empty array if the category does not have any videos&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;subject&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;eq&lt;/span&gt; &lt;span class="o"&gt;[]&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;returns all videos if there are less than 6 videos&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;upto&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;  &lt;span class="n"&gt;category&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;videos&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="ss"&gt;title&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;FF&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;description&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Final Fantasy&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;subject&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;eq&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;returns 6 videos if there are more than 6 videos&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;upto&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;category&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;videos&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="ss"&gt;title&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;FF&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;description&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Final Fantasy&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;subject&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;eq&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;returns the videos in the reverse order by created_at&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;ff&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;category&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;videos&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="ss"&gt;title&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;FF&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;description&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Final Fantasy&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;created_at&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;days&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ago&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;dq&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;category&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;videos&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="ss"&gt;title&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;DQ&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;description&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Dragon Quest&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;created_at&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;day&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ago&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;subject&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;eq&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;dq&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ff&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category><category term="testing"></category></entry><entry><title>使用 RSpec 做自動測試</title><link href="http://tsaith.github.io/shi-yong-rspec-zuo-zi-dong-ce-shi.html" rel="alternate"></link><updated>2014-12-06T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-12-06:shi-yong-rspec-zuo-zi-dong-ce-shi.html</id><summary type="html">&lt;p&gt;&lt;a href="https://github.com/rspec/rspec"&gt;RSpec&lt;/a&gt; 是一套專為 Ruby
設計的 BDD (Behavior Deriven Development) 測試框架，
基於它所撰寫出的測試程式有著相當高的可讀性，
感覺就像是在閱讀產品的規格書。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;在專案的 Gemfile 中加入 rspec-rails 的 gem，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;group&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;development&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rspec-rails&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2.99&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;除了 RSpec 之外， 因為 &lt;a href="https://github.com/thoughtbot/shoulda-matchers"&gt;shoulda-matchers&lt;/a&gt;，
額外提供了許多有用的測試函式，建議一併安裝。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;group&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;shoulda-matchers&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2.7.0&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;require&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;
&lt;span class="n"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;編輯完 Gemfile 後，請執行 &lt;code&gt;bundle&lt;/code&gt; 進行套件安裝。&lt;/p&gt;
&lt;p&gt;最後，再執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;rails g rspec:install
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;以產生 RSpec 運作所需的相關檔案。&lt;/p&gt;
&lt;h3&gt;設定 spec_helper.rb&lt;/h3&gt;
&lt;p&gt;在 spec/spec_helper.rb 檔案的開頭加入以下內容&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;RAILS_ENV&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;||=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="no"&gt;File&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;expand_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;../../config/environment&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;__FILE__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rspec/rails&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;撰寫測試&lt;/h3&gt;
&lt;p&gt;假設我們在 app/models/video.rb 有個 Video model， 如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Video&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:category&lt;/span&gt;

  &lt;span class="n"&gt;validates_presence_of&lt;/span&gt; &lt;span class="ss"&gt;:title&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:description&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;這個 Video model 屬於 Category
並且要求在產生物件時需要檢驗 title 和 description 已經存在，
那麼對應的測試檔案 spec/models/video_spec.rb 的內容可以寫成&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;spec_helper&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;shoulda/matchers&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="no"&gt;Video&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;belong_to&lt;/span&gt; &lt;span class="ss"&gt;:category&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;validate_presence_of&lt;/span&gt; &lt;span class="ss"&gt;:title&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;should&lt;/span&gt; &lt;span class="n"&gt;validate_presence_of&lt;/span&gt; &lt;span class="ss"&gt;:description&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;寫好測試程式後，請在專案目錄下執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;rspec spec/models/video_spec.rb
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;就能看到測試結果。&lt;/p&gt;
&lt;p&gt;倘若要一次跑多個測試，請直接執行 &lt;code&gt;rspec&lt;/code&gt; ，
就會跑放在 spec/ 下面的所有測試程式。&lt;/p&gt;</summary><category term="rails"></category><category term="testing"></category></entry><entry><title>iTerm2 中好用的設定</title><link href="http://tsaith.github.io/iterm2-zhong-hao-yong-de-she-ding.html" rel="alternate"></link><updated>2014-12-05T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-12-05:iterm2-zhong-hao-yong-de-she-ding.html</id><summary type="html">&lt;p&gt;&lt;a href="http://iterm2.com/"&gt;iTerm2&lt;/a&gt; 被設計用來取代 Mac 內建的 Terminal;
這裡記錄了我個人的一些偏好設定。&lt;/p&gt;
&lt;h3&gt;偏好設定&lt;/h3&gt;
&lt;p&gt;以下的偏好都可以在 Preference 裡面進行設定&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;開啟新分頁時，自動進入前一個 session 的所在目錄&lt;/p&gt;
&lt;p&gt;Profile -&amp;gt; General -&amp;gt; Login shell&lt;/p&gt;
&lt;p&gt;Profile -&amp;gt; General -&amp;gt; Reuse previous session's directory&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;設定主題風格(例如背景顏色...等)&lt;/p&gt;
&lt;p&gt;Profile -&amp;gt; Colors -&amp;gt; Load Presets... -&amp;gt; Tango Dark&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;改變字型和大小&lt;/p&gt;
&lt;p&gt;Profile -&amp;gt; Text -&amp;gt; Change Font&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;讓 alt/option key 可以在 Emacs 中正常工作&lt;/p&gt;
&lt;p&gt;Profile -&amp;gt; Keys -&amp;gt; Left option key acts as: +Esc&lt;/p&gt;
&lt;p&gt;Profile -&amp;gt; Keys -&amp;gt; Right option key acts as: +Esc&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用 &lt;code&gt;alt&lt;/code&gt; + &lt;code&gt;Space&lt;/code&gt; 快速隱藏/顯示 iTerm2&lt;/p&gt;
&lt;p&gt;Profile -&amp;gt; Keys -&amp;gt; Show/hide iTerm2 with a system-wide hotkey&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary><category term="utils"></category></entry><entry><title>實作簡易的搜尋功能</title><link href="http://tsaith.github.io/shi-zuo-jian-yi-de-sou-xun-gong-neng.html" rel="alternate"></link><updated>2014-12-02T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-12-02:shi-zuo-jian-yi-de-sou-xun-gong-neng.html</id><summary type="html">&lt;p&gt;在電子商務中，商品的搜尋是很重要的一環，
這裡將介紹如何實作簡易的搜尋功能。&lt;/p&gt;
&lt;p&gt;倘若我們現在希望開發一個搜尋影片的功能;
假設影片的類別名稱是 Video，
首先在 config/routes.rb 裡面加入 search 的路徑&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;  &lt;span class="n"&gt;resources&lt;/span&gt; &lt;span class="ss"&gt;:videos&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;only&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:show&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;collection&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;search&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;videos#search&amp;#39;&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;接著在 app/controllers/videos_controller.rb 裡面加入
search action&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;search&lt;/span&gt;
    &lt;span class="vi"&gt;@videos&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;search_by_title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;search_term&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後在 app/models/video.rb 裡面新增 search_by_title 方法&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nc"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;search_by_title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="o"&gt;[]&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;blank?&lt;/span&gt;
    &lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;title LIKE ?&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;%&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;%&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;created_at DESC&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;這裡使用 &lt;a href="http://haml.info/"&gt;Haml&lt;/a&gt; 來撰寫 views;
若想為網站的 header 加入搜尋欄位，
請在 app/views/shared/_header.html.haml 裡面加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;  &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;form_tag&lt;/span&gt; &lt;span class="n"&gt;search_videos_path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;method&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;get&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;col-md-5 navbar-form&amp;#39;&lt;/span&gt;  &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;text_field_tag&lt;/span&gt; &lt;span class="ss"&gt;:search_term&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;search_term&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;||=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;form-control&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;placeholder&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Search for videos here&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;submit_tag&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Search&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;btn btn-default&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;最後，新增搜尋頁面 app/views/videos/search.html.haml&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="p"&gt;-&lt;/span&gt; &lt;span class="vi"&gt;@videos&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;video&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="nc"&gt;.video.ul&lt;/span&gt;
    &lt;span class="nc"&gt;.li&lt;/span&gt;
      &lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
    &lt;span class="nc"&gt;.li&lt;/span&gt;
      &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;image_tag&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;video&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cover_image_url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;cover_image_size&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>安全地設定 Rails 郵件密碼</title><link href="http://tsaith.github.io/an-quan-di-she-ding-rails-you-jian-mi-ma.html" rel="alternate"></link><updated>2014-11-26T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-11-26:an-quan-di-she-ding-rails-you-jian-mi-ma.html</id><summary type="html">&lt;p&gt;將密碼寫進程式通常不是個好主意，因為當我們使用版本控制系統(例如 git)
儲存程式時，密碼也將會被一併存入，如果是開源的專案，
那麼任意人都可以取得這資訊;為避免此問題，
我們可以使用環境變數讓 Rails 較安全地存取密碼資訊。&lt;/p&gt;
&lt;h3&gt;設定郵件密碼&lt;/h3&gt;
&lt;p&gt;這裡以 config/environments/ 下的 production.rb 為例子，
在 password 這裡，我們可以使用 ENV 來讀取系統的環境變數。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;  &lt;span class="c1"&gt;# Delivery method of mailer&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action_mailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delivery_method&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:smtp&lt;/span&gt;

  &lt;span class="c1"&gt;# Settings of the mailer&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action_mailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;smtp_settings&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="ss"&gt;address&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;smtp.gmail.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="ss"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;587&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="ss"&gt;domain&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;gmail.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="ss"&gt;authentication&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;plain&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="ss"&gt;user_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;thtsai&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;demo&lt;/span&gt;&lt;span class="vi"&gt;@gmail&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="ss"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;SMTP_PASSWORD&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="ss"&gt;enable_starttls_auto&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;設定環境變數&lt;/h3&gt;
&lt;p&gt;若開發環境是 Mac，可在 ~/.profile 裡面加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;export SMTP_PASSWORD=&amp;#39;My password&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;當專案上傳到遠端主機後，記得將密碼寫到遠端的環境變數;
下面以 Heroku 為例&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;heroku config:add SMTP_PASSWORD=&amp;#39;My password&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;這樣一來，Rails 就能通過環境變數來取得密碼資訊。&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>在 Rails 中使用 PostgresSQL</title><link href="http://tsaith.github.io/zai-rails-zhong-shi-yong-postgressql.html" rel="alternate"></link><updated>2014-11-26T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-11-26:zai-rails-zhong-shi-yong-postgressql.html</id><summary type="html">&lt;p&gt;&lt;a href="http://www.postgresql.org/"&gt;PostgreSQL&lt;/a&gt; 是目前相當受歡迎的一套開源資料庫，
下面將說明如何在 Rails 中使用它。&lt;/p&gt;
&lt;h3&gt;安裝套件&lt;/h3&gt;
&lt;p&gt;如若開發環境是 Mac 的話，請執行下列步驟&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;下載 &lt;a href="http://postgresapp.com/"&gt;Postgres.app&lt;/a&gt; ，放到 /Applications/ 資料夾下&lt;/li&gt;
&lt;li&gt;在 ~/.profile 加入&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="x"&gt;export PATH=&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="x"&gt;:/Applications/Postgres.app/Contents/Versions/9.3/bin&lt;/span&gt;
&lt;span class="x"&gt;export PGHOST=localhost&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;(假設版本號是 9.3)&lt;/p&gt;
&lt;h3&gt;設定 Rails 資料庫&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;編輯 config/database.yml 內容如下&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;development&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
  &lt;span class="n"&gt;adapter&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;postgresql&lt;/span&gt;
  &lt;span class="n"&gt;encoding&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;unicode&lt;/span&gt;
  &lt;span class="n"&gt;database&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;myflix_development&lt;/span&gt;
  &lt;span class="n"&gt;pool&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;
  &lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;YOUR_USERNAME&lt;/span&gt;
  &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;YOUR_PASSWORD&lt;/span&gt;

&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
  &lt;span class="n"&gt;adapter&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;postgresql&lt;/span&gt;
  &lt;span class="n"&gt;encoding&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;unicode&lt;/span&gt;
  &lt;span class="n"&gt;database&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;myflix_test&lt;/span&gt;
  &lt;span class="n"&gt;pool&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;
  &lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;YOUR_USERNAME&lt;/span&gt;
  &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;YOUR_PASSWORD&lt;/span&gt;

&lt;span class="n"&gt;production&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
  &lt;span class="n"&gt;adapter&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;postgresql&lt;/span&gt;
  &lt;span class="n"&gt;encoding&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;unicode&lt;/span&gt;
  &lt;span class="n"&gt;database&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;myflix_test&lt;/span&gt;
  &lt;span class="n"&gt;pool&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;
  &lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;YOUR_USERNAME&lt;/span&gt;
  &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;YOUR_PASSWORD&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;接著在 Gemfile 中加入 gem 'pg' 然後執行 &lt;code&gt;bundle&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;完成上述步驟後，我們就可以在 Rails 中存取 PostgreSQL 資料庫。&lt;/p&gt;
&lt;h3&gt;常用指令&lt;/h3&gt;
&lt;p&gt;這裡列出一些 PostgreSQL 常用的指令&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;建立資料庫: &lt;code&gt;createdb db_name&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;刪除資料庫: &lt;code&gt;dropdb db_name&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;列出所有資料庫: &lt;code&gt;psql -l&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;PostgreSQL 的內建命令:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;列出所有資料庫: &lt;code&gt;\l&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;連接資料庫: &lt;code&gt;\c db_name&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;顯示所有 tables: &lt;code&gt;\d&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;新增資料庫: &lt;code&gt;DROP DATABASE db_name;&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;刪除資料庫: &lt;code&gt;DROP DATABASE db_name;&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;建立 table: &lt;code&gt;CREATE TABLE db_table(id int, text VARCHAR(50));&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;刪除 table: &lt;code&gt;DROP TABLE db_table;&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;查詢記錄: &lt;code&gt;SELECT * FROM db_table WHERE id = 1;&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;插入一筆記錄: &lt;code&gt;INSERT INTO db_table(id, text) VALUES(1, 'A new record');&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;更新一筆記錄: &lt;code&gt;UPDATE db_table SET text = 'str' WHERE id = 1;&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;刪除一筆記錄: &lt;code&gt;DELETE FROM test WHERE id = 1;&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary><category term="rails"></category></entry><entry><title>在 Rails 使用 gmail 發送郵件</title><link href="http://tsaith.github.io/zai-rails-shi-yong-gmail-fa-song-you-jian.html" rel="alternate"></link><updated>2014-11-23T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-11-23:zai-rails-shi-yong-gmail-fa-song-you-jian.html</id><summary type="html">&lt;p&gt;建構網站時，發送信件往往是重要的一項功能，
例如，當使用者註冊或變更個人設定時，
這時候網站可以發送確認信函以提高安全性;
這裡將介紹如何在 Rails 中使用 gmail 發送郵件。&lt;/p&gt;
&lt;h3&gt;設定郵件環境&lt;/h3&gt;
&lt;p&gt;編輯 config/environments/ 下的 development.rb 和 production.rb 兩個檔案，
設定 &lt;code&gt;delivery_method&lt;/code&gt; 和 &lt;code&gt;smtp_settings&lt;/code&gt; 如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;  &lt;span class="c1"&gt;# Don&amp;#39;t care if the mailer can&amp;#39;t send.&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action_mailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;raise_delivery_errors&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kp"&gt;false&lt;/span&gt;

  &lt;span class="c1"&gt;# Delivery method of mailer&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action_mailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delivery_method&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:smtp&lt;/span&gt;

  &lt;span class="c1"&gt;# Settings of the mailer&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action_mailer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;smtp_settings&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="ss"&gt;address&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;smtp.gmail.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="ss"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;587&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="ss"&gt;domain&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;gmail.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="ss"&gt;authentication&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;plain&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="ss"&gt;user_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;example@gmail.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="ss"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;12345678&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="ss"&gt;enable_starttls_auto&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;產生 Mailer&lt;/h3&gt;
&lt;p&gt;新增檔案 app/mailers/user_mailer.rb，
在 UserMailer class 中定義了一個 welcome_email method&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserMailer&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActionMailer&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="n"&gt;default&lt;/span&gt; &lt;span class="ss"&gt;from&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="err"&gt;你&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="err"&gt;妳的郵件地址&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;welcome_email&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="vi"&gt;@user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;
    &lt;span class="n"&gt;mail&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;subject&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;You have sucessfully registered.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;信件的 views&lt;/h3&gt;
&lt;p&gt;接著，新增資料夾 app/views/user_mailer/，
並在裡面加入兩個檔案 welcome_email.html.erb 和 welcome_email.text.erb。&lt;/p&gt;
&lt;p&gt;.html.erb 結尾的檔案支援 HTML 格式&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cp"&gt;&amp;lt;! DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;p&amp;gt;&lt;/span&gt;
      You have successfully registered.
    &lt;span class="nt"&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;而 .text.erb 結尾的檔案支援純文字格式&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;You have successfully registered.
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;設定 gmail 帳號的安全性&lt;/h3&gt;
&lt;p&gt;因為 gmail 預設對應用程式登入的安全性要求比較高，
會擋掉單純使用密碼登入的機制;
所以我們另外得在自己的 gmail account 中啟用安全性較低的應用程式存取權&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm8.staticflickr.com/7583/15880527241_cf4c5524dd_b.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;測試郵件發送&lt;/h3&gt;
&lt;p&gt;使用 &lt;code&gt;rails console&lt;/code&gt; 測試郵件的發送&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;rails console
Loading development environment &lt;span class="o"&gt;(&lt;/span&gt;Rails 4.0.0&lt;span class="o"&gt;)&lt;/span&gt;
2.1.1 :001 &amp;gt; UserMailer.welcome_email&lt;span class="o"&gt;(&lt;/span&gt;User.last&lt;span class="o"&gt;)&lt;/span&gt;.deliver
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果 welcome_email 工作正常，
當使用者註冊成功後，就可以用它來自動發送歡迎信件。&lt;/p&gt;
&lt;p&gt;備註: 每次修改 config/environments/development.rb 後，
記得重新啓動 rails server 讓新設定生效。&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>在 Rails 中使用 module</title><link href="http://tsaith.github.io/zai-rails-zhong-shi-yong-module.html" rel="alternate"></link><updated>2014-11-21T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-11-21:zai-rails-zhong-shi-yong-module.html</id><summary type="html">&lt;p&gt;在開發 Rails 時，我們常常遇到一種情況，
不同的物件模型需要用到相同的功能，
這時候可以考慮將這功能包裝成一個模組，
以方便調用。&lt;/p&gt;
&lt;h3&gt;設定搜尋路徑&lt;/h3&gt;
&lt;p&gt;首先，在 config/application.rb 裡面加入 &lt;code&gt;config.autoload_paths += %W(#{config.root}/lib)&lt;/code&gt; 設定 lib 為 modules 的存放路徑。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="no"&gt;File&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;expand_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;../boot&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;__FILE__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rails/all&amp;#39;&lt;/span&gt;

&lt;span class="c1"&gt;# Require the gems listed in Gemfile, including any gems&lt;/span&gt;
&lt;span class="c1"&gt;# you&amp;#39;ve limited to :test, :development, or :production.&lt;/span&gt;
&lt;span class="no"&gt;Bundler&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;require&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:default&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;Rails&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;module&lt;/span&gt; &lt;span class="nn"&gt;PostitTemplate&lt;/span&gt;
  &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Application&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;Rails&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Application&lt;/span&gt;
    &lt;span class="c1"&gt;# Settings in config/environments/* take precedence over those specified here.&lt;/span&gt;
    &lt;span class="c1"&gt;# Application configuration should go into files in config/initializers&lt;/span&gt;
    &lt;span class="c1"&gt;# -- all .rb files in that directory are automatically loaded.&lt;/span&gt;

    &lt;span class="c1"&gt;# Module paths&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;autoload_paths&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="sx"&gt;%W(&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sx"&gt;/lib)&lt;/span&gt;

    &lt;span class="c1"&gt;# Set Time.zone default to the specified zone and make Active Record auto-convert to this zone.&lt;/span&gt;
    &lt;span class="c1"&gt;# Run &amp;quot;rake -D time&amp;quot; for a list of tasks for finding time zone names. Default is UTC.&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time_zone&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Taipei&amp;#39;&lt;/span&gt;

    &lt;span class="c1"&gt;# The default locale is :en and all translations from config/locales/*.rb,yml are auto loaded.&lt;/span&gt;
    &lt;span class="c1"&gt;# config.i18n.load_path += Dir[Rails.root.join(&amp;#39;my&amp;#39;, &amp;#39;locales&amp;#39;, &amp;#39;*.{rb,yml}&amp;#39;).to_s]&lt;/span&gt;
    &lt;span class="c1"&gt;# config.i18n.default_locale = :de&lt;/span&gt;

    &lt;span class="c1"&gt;# Tealeaf note: Bootstrap sass gem addition&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;assets&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;precompile&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="sx"&gt;%w(*.png *.jpg *.jpeg *.gif)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;包裝模組&lt;/h3&gt;
&lt;p&gt;然後將模組的檔案放到 lib/ 下面; 請特別注意，
檔名和模組名稱需要一致，舉例來說，
如果檔名為 voteable_th.rb，那麼模組名稱就是 VoteableTh，
不然，Rails 會找不到這模組(至少在 4.1.6 以下的版本還是如此)。
而這裡的 voteable_th.rb 內容如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;module&lt;/span&gt; &lt;span class="nn"&gt;VoteableTh&lt;/span&gt;
  &lt;span class="kp"&gt;extend&lt;/span&gt; &lt;span class="no"&gt;ActiveSupport&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt; &lt;span class="no"&gt;Concern&lt;/span&gt;

  &lt;span class="n"&gt;included&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:votes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;as&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;:voteable&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:dependent&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="ss"&gt;:destroy&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;total_votes&lt;/span&gt;
    &lt;span class="n"&gt;up_votes&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;down_votes&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;up_votes&lt;/span&gt;
    &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;votes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;vote&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;down_votes&lt;/span&gt;
    &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;votes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;vote&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;false&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;調用模組&lt;/h3&gt;
&lt;p&gt;最後，我們可以直接在物件模型中透過 &lt;code&gt;include&lt;/code&gt;來使用模組，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Post&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="kp"&gt;include&lt;/span&gt; &lt;span class="no"&gt;VoteableTh&lt;/span&gt;

  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:creator&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;User&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;foreign_key&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;user_id&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:comments&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:dependent&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="ss"&gt;:destroy&lt;/span&gt;

  &lt;span class="n"&gt;validates&lt;/span&gt; &lt;span class="ss"&gt;:title&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;presence&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;length&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="ss"&gt;minimum&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;validates&lt;/span&gt; &lt;span class="ss"&gt;:description&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;presence&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>製作和發佈 gem</title><link href="http://tsaith.github.io/zhi-zuo-he-fa-bu-gem.html" rel="alternate"></link><updated>2014-11-21T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-11-21:zhi-zuo-he-fa-bu-gem.html</id><summary type="html">&lt;p&gt;當我們在某個專案中完成了某個功能並且模組化後，
倘若其他專案也需要同樣功能，
或是希望分享給開源社群時，
這時候就可以將它製作成 gem 方便大家使用。&lt;/p&gt;
&lt;h3&gt;製作過程&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;新增一個 gem 的資料夾，假設名稱為 voteable-gem&lt;/li&gt;
&lt;li&gt;進入資料夾中，新增 lib 資料夾，並將寫好的程式檔案放進 lib/&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;ls lib
voteable_th.rb
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在上面的範例中，voteable_th.rb 是一個用來投票的模組，內容如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;module&lt;/span&gt; &lt;span class="nn"&gt;VoteableTh&lt;/span&gt;
  &lt;span class="kp"&gt;extend&lt;/span&gt; &lt;span class="no"&gt;ActiveSupport&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt; &lt;span class="no"&gt;Concern&lt;/span&gt;

  &lt;span class="n"&gt;included&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:votes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;as&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;:voteable&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:dependent&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="ss"&gt;:destroy&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;total_votes&lt;/span&gt;
    &lt;span class="n"&gt;up_votes&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;down_votes&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;up_votes&lt;/span&gt;
    &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;votes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;vote&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;down_votes&lt;/span&gt;
    &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;votes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;vote&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;false&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;在 voteable-gem 資料夾下新增檔案 voteable.gemspec 來定義
gem specification，內容如下&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;Gem&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Specification&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;        &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;voteable_th&amp;#39;&lt;/span&gt;              &lt;span class="c1"&gt;# gem 的名字&lt;/span&gt;
  &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;version&lt;/span&gt;     &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;0.0.0&amp;#39;&lt;/span&gt;                    &lt;span class="c1"&gt;# 版本號碼&lt;/span&gt;
  &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;summary&lt;/span&gt;     &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;A voting gem&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;description&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;A voting gem for Rails&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;authors&lt;/span&gt;     &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Tsung-Hua Tsai&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
  &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;tsai.tsunghua@gmail.com&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;files&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lib/voteable_th.rb&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;     &lt;span class="c1"&gt;# 檔案位置&lt;/span&gt;
  &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;homepage&lt;/span&gt;    &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;http://tsaith.github.io/&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;license&lt;/span&gt;     &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;MIT&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;使用 &lt;code&gt;gem build&lt;/code&gt; 來製作 gem&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;gem build voteable.gemspec
Successfully built RubyGem
Name: voteable_th
Version: 0.0.1
File: voteable_th-0.0.0.gem
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;發佈到開源社群&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;到 &lt;a href="https://rubygems.org/"&gt;Rubygems.org&lt;/a&gt; 上面&lt;a href="https://rubygems.org/sign_up"&gt;註冊&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用 &lt;code&gt;gem push&lt;/code&gt; 將 gem 發佈到 Rubygems.org&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;gem push voteable_th-0.0.0.gem
Pushing gem to https://rubygems.org...
Successfully registered gem: voteable_th &lt;span class="o"&gt;(&lt;/span&gt;0.0.0&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;倘若一切順利，恭喜你已經成功地將 gem 發佈出去。
如果要查詢剛剛發佈的 gem 請執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;gem search -r voteable_th

*** REMOTE GEMS ***

voteable_th &lt;span class="o"&gt;(&lt;/span&gt;0.0.0&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;假設發現已發佈的 gem 有嚴重 bug 時，
可使用 &lt;code&gt;gem yank&lt;/code&gt; 來避免以後的使用者下載&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;gem yank voteable_th -v 0.0.0
Yanking gem from https://rubygems.org...
Successfully yanked gem: voteable_th &lt;span class="o"&gt;(&lt;/span&gt;0.0.0&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;倘若想回復上面的動作，則執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;gem yank voteable_th -v 0.0.0 --undo
Unyanking gem from https://rubygems.org...
Successfully unyanked gem: voteable_th &lt;span class="o"&gt;(&lt;/span&gt;0.0.0&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;其他進階的操作說明可參考&lt;a href="http://guides.rubygems.org/"&gt;RubyGems Guides&lt;/a&gt;。&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>在 Rails 中使用 Ajax</title><link href="http://tsaith.github.io/zai-rails-zhong-shi-yong-ajax.html" rel="alternate"></link><updated>2014-11-20T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-11-20:zai-rails-zhong-shi-yong-ajax.html</id><summary type="html">&lt;p&gt;假設有一個投票功能，每次按文章左側的上下箭頭可以表示贊成或反對，
但我們不希望使用者每次投票時，瀏覽器都必須重新載入頁面，
這時候可以使用 &lt;a href="http://zh.wikipedia.org/wiki/AJAX"&gt;Ajax&lt;/a&gt; 技術來實現。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm8.staticflickr.com/7518/15646273670_3d1f14d6e4_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm8.staticflickr.com/7564/15807472506_af32ac663c_b.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;設定 routes&lt;/h3&gt;
&lt;p&gt;對應上面的範例，我們先設定 config/routes.rb，
因為投票動作本身沒有 view， 所以將動作設定為 post&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;resources&lt;/span&gt; &lt;span class="ss"&gt;:posts&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;member&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="ss"&gt;:vote&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;設定 view&lt;/h3&gt;
&lt;p&gt;接著開啟 html 檔案 app/views/posts/_post.html.erb
加入 &lt;code&gt;remote: true&lt;/code&gt;，來呼叫 javascript 動作&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;div&lt;/span&gt; &lt;span class="n"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;row&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;div&lt;/span&gt; &lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;post_vote_error_&amp;lt;%= post.to_param %&amp;gt;&amp;quot;&lt;/span&gt; &lt;span class="n"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;alert alert-error&amp;quot;&lt;/span&gt; &lt;span class="n"&gt;style&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;display:none&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="no"&gt;You&lt;/span&gt; &lt;span class="n"&gt;can&lt;/span&gt; &lt;span class="n"&gt;only&lt;/span&gt; &lt;span class="n"&gt;vote&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="n"&gt;once&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
  &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="sr"&gt;/div&amp;gt;&lt;/span&gt;
&lt;span class="sr"&gt;  &amp;lt;div class=&amp;quot;span0 well text-center&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="sr"&gt;    &amp;lt;%= link_to vote_post_path(post, vote: true), method: &amp;#39;post&amp;#39;, remote: true do %&amp;gt;&lt;/span&gt;
&lt;span class="sr"&gt;      &amp;lt;i class=&amp;#39;icon-arrow-up&amp;#39;&amp;gt;&amp;lt;/i&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="sx"&gt;% end %&amp;gt;&lt;/span&gt;
&lt;span class="sx"&gt;    &amp;lt;br/&amp;gt;&lt;/span&gt;
    &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;span&lt;/span&gt; &lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;post_&amp;lt;%= post.slug %&amp;gt;_votes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="sx"&gt;%= post.total_votes %&amp;gt; votes &amp;lt;/span&amp;gt;&lt;/span&gt;
&lt;span class="sx"&gt;    &amp;lt;br/&amp;gt;&lt;/span&gt;
&lt;span class="sx"&gt;    &amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="n"&gt;vote_post_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;vote&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;false&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="nb"&gt;method&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;post&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;remote&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="sx"&gt;%&amp;gt;&lt;/span&gt;
&lt;span class="sx"&gt;      &amp;lt;i class=&amp;#39;icon-arrow-down&amp;#39;&amp;gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="sr"&gt;/i&amp;gt;&lt;/span&gt;
&lt;span class="sr"&gt;    &amp;lt;% end %&amp;gt;&lt;/span&gt;
&lt;span class="sr"&gt;  &amp;lt;/&lt;/span&gt;&lt;span class="n"&gt;div&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="sr"&gt;/div&amp;gt;&lt;/span&gt;
&lt;span class="sr"&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後在同個資料夾下新增檔案 app/views/posts/vote.js.erb，於其中撰寫
javascript 的工作邏輯;
若投票成功，就更新投票數，如果失敗，則顯示錯誤訊息。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="sx"&gt;% if &lt;/span&gt;&lt;span class="vi"&gt;@vote&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;valid?&lt;/span&gt; &lt;span class="sx"&gt;%&amp;gt;&lt;/span&gt;
&lt;span class="sx"&gt;  $(&amp;#39;#post_&amp;lt;%= @post.slug %&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;_votes&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;).html(&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="sx"&gt;%= @post.total_votes %&amp;gt; votes&amp;#39;);&lt;/span&gt;
&lt;span class="sx"&gt;&amp;lt;% else %&amp;gt;&lt;/span&gt;
&lt;span class="sx"&gt;  $(&amp;#39;#post_vote_error_&amp;lt;%=&lt;/span&gt; &lt;span class="vi"&gt;@post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_param&lt;/span&gt; &lt;span class="sx"&gt;%&amp;gt;&amp;#39;).show().fadeOut(3000);&lt;/span&gt;
&lt;span class="sx"&gt;&amp;lt;% end %&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;因為在投票的物件模型中，使用了 &lt;code&gt;validates_uniqueness_of&lt;/code&gt;
來限定每位使用者只能投票一次&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Vote&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:user&lt;/span&gt;
  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:voteable&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;polymorphic&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;

  &lt;span class="n"&gt;validates_uniqueness_of&lt;/span&gt; &lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;scope&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:voteable_type&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:voteable_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;所以當重複投票時，將產生投票失敗，
javascript 將會搜尋 html 中 id 為&lt;code&gt;post_vote_error_&amp;lt;%= @post.to_param %&amp;gt;&lt;/code&gt; 的元件並顯示，如下&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm8.staticflickr.com/7499/15831102395_739f1b9171_b.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;設定 controller&lt;/h3&gt;
&lt;p&gt;最後，我們需要在 controller 的 vote method 中使用 &lt;code&gt;respond_to&lt;/code&gt;
來分別撰寫對應 html 和 javascript 的處理&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;vote&lt;/span&gt;
    &lt;span class="vi"&gt;@vote&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Vote&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;voteable&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="vi"&gt;@post&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;creator&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;current_user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;vote&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:vote&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;respond_to&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nb"&gt;format&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
      &lt;span class="nb"&gt;format&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;html&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vi"&gt;@vote&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;valid?&lt;/span&gt;
          &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:notice&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Your vote is counted.&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;
          &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:error&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;You can only vote on a post once.&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;end&lt;/span&gt;
        &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="ss"&gt;:back&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="nb"&gt;format&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;js&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="rails"></category></entry><entry><title>設定 polymorphic association</title><link href="http://tsaith.github.io/she-ding-polymorphic-association.html" rel="alternate"></link><updated>2014-11-15T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-11-15:she-ding-polymorphic-association.html</id><summary type="html">&lt;p&gt;假設我們有個布告版，上面可以張貼文章和留言，
如果我們希望新增一個功能讓使用者可以對文章或留言進行投票，
這時候可以透過 polymorphic association 來描述
Vote 和 Post 以及 Comment 三個物件模型之間的關係。&lt;/p&gt;
&lt;h3&gt;新增 Table&lt;/h3&gt;
&lt;p&gt;首先，在資料庫中新增一個 votes table 來儲存投票資訊;
在 votes 中，
&lt;code&gt;voteable_type&lt;/code&gt; 和 &lt;code&gt;voteable_id&lt;/code&gt; 分別代表被投票物件的名稱和 id。
新增完成後，查看 db/schema.rb 如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;votes&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;force&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;boolean&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;vote&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;integer&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;user_id&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;voteable_type&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;integer&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;voteable_id&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;posts&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;force&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;url&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;title&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;     &lt;span class="s2"&gt;&amp;quot;description&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;integer&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;user_id&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;force&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;     &lt;span class="s2"&gt;&amp;quot;body&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;integer&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;user_id&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;integer&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;post_id&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;設定 Models&lt;/h3&gt;
&lt;p&gt;新增檔案 app/models/vote.rb，
使用 &lt;code&gt;polymorphic: true&lt;/code&gt; 來指定 &lt;code&gt;voteable&lt;/code&gt; 是 polymorphic。
此外，我們進一步地規定每位使用者只能對每個 &lt;code&gt;voteable&lt;/code&gt; 物件進行一次投票。&lt;/p&gt;
&lt;p&gt;app/models/vote.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Vote&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:user&lt;/span&gt;
  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:voteable&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;polymorphic&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;

  &lt;span class="n"&gt;validates_uniqueness_of&lt;/span&gt; &lt;span class="ss"&gt;:user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;scope&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:voteable_type&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:voteable_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;接著在 post.rb 和 comment.rb 中加入 &lt;code&gt;has_many :votes, as: :voteable&lt;/code&gt;
來指定每個 post 和 comment 都可以擁有多個投票。&lt;/p&gt;
&lt;p&gt;app/models/post.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Post&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:user&lt;/span&gt;
  &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:comments&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:dependent&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="ss"&gt;:destroy&lt;/span&gt;
  &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:votes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;as&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;:voteable&lt;/span&gt;

  &lt;span class="n"&gt;validates&lt;/span&gt; &lt;span class="ss"&gt;:title&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;presence&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
  &lt;span class="n"&gt;validates&lt;/span&gt; &lt;span class="ss"&gt;:description&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;presence&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;app/models/comment.rb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Comment&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:user&lt;/span&gt;
  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:post&lt;/span&gt;
  &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:votes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;as&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;:voteable&lt;/span&gt;

  &lt;span class="n"&gt;validates&lt;/span&gt; &lt;span class="ss"&gt;:body&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;presence&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
  &lt;span class="n"&gt;validates&lt;/span&gt; &lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;presence&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
  &lt;span class="n"&gt;validates&lt;/span&gt; &lt;span class="ss"&gt;:post_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;presence&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;設定好模型之間的關係後，
我們就可以開始在 Controllers 和 Views 中使用這些物件進行開發。&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>部署專案到 Heroku</title><link href="http://tsaith.github.io/bu-shu-zhuan-an-dao-heroku.html" rel="alternate"></link><updated>2014-11-13T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-11-13:bu-shu-zhuan-an-dao-heroku.html</id><summary type="html">&lt;p&gt;&lt;a href="https://www.heroku.com"&gt;Heroku&lt;/a&gt; 是個相當受歡迎的雲端平台，
為開發者建構了網站運行所需要的環境，
原則上，使用者只要將自己的應用程式部署上去便可直接運行;
目前，它還提供了免費試用的方案，相當適合學生練習實作。
而使用方法簡介如下&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;先到 Keroku 官網進行&lt;a href="https://id.heroku.com/login"&gt;註冊&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;註冊後，登入官網然後下載 Heroku toolbelt 並且安裝&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;打開終端機，執行 &lt;code&gt;heroku login&lt;/code&gt; 來登入使用者資訊並上傳 public ssh key&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;在專案下，執行 &lt;code&gt;heroku create&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;heroku create
Creating agile-sea-7701... &lt;span class="k"&gt;done&lt;/span&gt;, stack is cedar-14
https://agile-sea-7701.herokuapp.com/ &lt;span class="p"&gt;|&lt;/span&gt; git@heroku.com:agile-sea-7701.git
Git remote heroku added
&lt;span class="nv"&gt;$ &lt;/span&gt;git remote
heroku
origin
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;執行 &lt;code&gt;git push heroku master&lt;/code&gt; 將專案部署到Heroku上，
部署結束後，會顯示專案對應的網路位址&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;執行 &lt;code&gt;heroku ps:scale web=1&lt;/code&gt; 確認至少有一個 instance 在運行&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;heroku ps:scale &lt;span class="nv"&gt;web&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;1
Scaling dynos... &lt;span class="k"&gt;done&lt;/span&gt;, now running web at 1:1X.
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;執行 &lt;code&gt;heroku run rake db:migrate&lt;/code&gt; 在 Heroku 上進行 database migration&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果希望對 app 重新命名可以執行 &lt;code&gt;heroku apps:rename 新名稱&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果一切順利，我們現在就可以執行 &lt;code&gt;heroku open&lt;/code&gt; 讓瀏覽器訪問網站的首頁&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Good Luck!&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>在 Rails 實作驗證機制</title><link href="http://tsaith.github.io/zai-rails-shi-zuo-yan-zheng-ji-zhi.html" rel="alternate"></link><updated>2014-11-09T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-11-09:zai-rails-shi-zuo-yan-zheng-ji-zhi.html</id><summary type="html">&lt;p&gt;在網路應用中，使用者驗證是一項常見的重要功能，
雖然使用現成的 gem
(例如 &lt;a href="https://github.com/plataformatec/devise"&gt;Devise&lt;/a&gt;)，
可以快速實現出功能原型，但是卻會因為對套件內部架構的不熟悉，
而無法輕易修改或擴充新功能;
所以，這裡將敘述如何單純地使用 Rails 的內建功能來實作驗證機制，
希望讓讀者對其中的工作原理有透徹的認識。&lt;/p&gt;
&lt;h3&gt;安裝 &lt;code&gt;bcrypt-ruby&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;為了支援密碼驗證，我們先在 Gemfile 中加入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;gem &amp;#39;bcrypt-ruby&amp;#39;, &amp;#39;3.0.1&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行 bundle 進行套件安裝。&lt;/p&gt;
&lt;h3&gt;設定資料庫&lt;/h3&gt;
&lt;p&gt;假設我們的使用者資料表名稱為 users，
先在 users 中新增一個 password_digest 的字串欄位，
然後在 db/schema 確認如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;  &lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;users&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;force&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;username&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;password_digest&amp;quot;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;設定 routes&lt;/h3&gt;
&lt;p&gt;在 config/routes.rb 中加入 login 和 logout 的路徑，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;  &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;login&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;sessions#new&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;login&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;sessions#create&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;logout&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;sessions#destroy&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;設定 model&lt;/h3&gt;
&lt;p&gt;編輯 User model，加入 &lt;code&gt;has_secure_password&lt;/code&gt; 來提供密碼驗證的功能;
在這裡，我關掉 &lt;code&gt;has_secure_password&lt;/code&gt; 預設的驗證機制，然後再手動地指定
使用者名稱和密碼的驗證，以確定所有行為都在我們的掌握中。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="n"&gt;has_secure_password&lt;/span&gt; &lt;span class="ss"&gt;validations&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;false&lt;/span&gt;
  &lt;span class="n"&gt;validates&lt;/span&gt; &lt;span class="ss"&gt;:username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;presence&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;uniqueness&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
  &lt;span class="n"&gt;validates&lt;/span&gt; &lt;span class="ss"&gt;:password&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;presence&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;on&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;length&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="ss"&gt;minimum&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;設定 view&lt;/h3&gt;
&lt;p _="%" app_views_sessions_new.html.erb="app/views/sessions/new.html.erb" codeblock="codeblock"&gt;新增 app/views/sessions/new.html.erb ，內容如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="sx"&gt;%= render &amp;#39;shared/content_title&amp;#39;, title: &amp;#39;Please log in&amp;#39; %&amp;gt;&lt;/span&gt;

&lt;span class="sx"&gt;&amp;lt;div class=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;well&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="sx"&gt;%= form_tag &amp;#39;/login&amp;#39; do %&amp;gt;&lt;/span&gt;
&lt;span class="sx"&gt;    &amp;lt;div class=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;control-group&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="sx"&gt;%= label_tag :username %&amp;gt;&lt;/span&gt;
&lt;span class="sx"&gt;      &amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;text_field_tag&lt;/span&gt; &lt;span class="ss"&gt;:username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:username&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; &lt;span class="sx"&gt;%&amp;gt;&lt;/span&gt;
&lt;span class="sx"&gt;    &amp;lt;/div&amp;gt;&lt;/span&gt;
    &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;div&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="sx"&gt;%= label_tag :password %&amp;gt;&lt;/span&gt;
&lt;span class="sx"&gt;      &amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;password_field_tag&lt;/span&gt; &lt;span class="ss"&gt;:password&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:password&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; &lt;span class="sx"&gt;%&amp;gt;&lt;/span&gt;
&lt;span class="sx"&gt;    &amp;lt;/div&amp;gt;&lt;/span&gt;
    &lt;span class="o"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;submit_tag&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Login&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;btn btn-success&amp;#39;&lt;/span&gt; &lt;span class="sx"&gt;%&amp;gt;&lt;/span&gt;
&lt;span class="sx"&gt;  &amp;lt;% end %&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="sr"&gt;/div&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在這個登入表單中，使用者被要求輸入 username 和 password。&lt;/p&gt;
&lt;h3&gt;設定 controller&lt;/h3&gt;
&lt;p&gt;新增 app/controllers/sessions_controller.rb，內容如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SessionsController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;new&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;
    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;username&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:username&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;authenticate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:password&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:notice&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Your&amp;#39;ve logged in!&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;root_path&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:error&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;There&amp;#39;s something wrong with username or password&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;register_path&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;destroy&lt;/span&gt;
    &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kp"&gt;nil&lt;/span&gt;
    &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:notice&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;You&amp;#39;ve logged out!&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;root_path&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在 create 中，
我們使用 &lt;code&gt;user.authenticate(params[:password])&lt;/code&gt; 來驗證使用者密碼是否正確，
如果是，再透過 &lt;code&gt;session[:user_id]&lt;/code&gt; 來貯存 user id;
而在 destroy 裡面，
則使用 &lt;code&gt;session[:user_id] = nil&lt;/code&gt; 來清除 user id。&lt;/p&gt;
&lt;p&gt;最後，我們可以在 app/controllers/application_controller.rb
加入三個常用的方法，方便隨時調用。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ApplicationController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActionController&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="c1"&gt;# Prevent CSRF attacks by raising an exception.&lt;/span&gt;
  &lt;span class="c1"&gt;# For APIs, you may want to use :null_session instead.&lt;/span&gt;
  &lt;span class="n"&gt;protect_from_forgery&lt;/span&gt; &lt;span class="ss"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;:exception&lt;/span&gt;

  &lt;span class="n"&gt;helper_method&lt;/span&gt; &lt;span class="ss"&gt;:current_user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:logged_in?&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;current_user&lt;/span&gt;
    &lt;span class="vi"&gt;@current_user&lt;/span&gt; &lt;span class="o"&gt;||=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;session&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:user_id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;logged_in?&lt;/span&gt;
    &lt;span class="o"&gt;!!&lt;/span&gt;&lt;span class="n"&gt;current_user&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;require_user&lt;/span&gt;
    &lt;span class="k"&gt;unless&lt;/span&gt; &lt;span class="n"&gt;logged_in?&lt;/span&gt;
      &lt;span class="n"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:error&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Must be logged in to do that&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;root_path&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;&lt;code&gt;current_user&lt;/code&gt;: 回傳目前的使用者&lt;/li&gt;
&lt;li&gt;&lt;code&gt;logged_in?&lt;/code&gt;: 是否已登入?&lt;/li&gt;
&lt;li&gt;&lt;code&gt;require_user&lt;/code&gt;: 檢查是否已登入，如果沒有登入，則導向根路徑&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;倘若一切順利，我們已經從無到有實作了使用者驗證機制，
並可以此為基礎加入更多進階的功能。&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>Vim 的常用指令</title><link href="http://tsaith.github.io/vim-de-chang-yong-zhi-ling.html" rel="alternate"></link><updated>2014-11-03T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-11-03:vim-de-chang-yong-zhi-ling.html</id><summary type="html">&lt;p&gt;在編程領域中，
&lt;a href="http://zh.wikipedia.org/wiki/%E7%BC%96%E8%BE%91%E5%99%A8%E4%B9%8B%E6%88%98"&gt;編輯器之戰&lt;/a&gt;的兩位主角 &lt;a href="http://zh.wikipedia.org/wiki/Vi"&gt;Vi&lt;/a&gt; 和
&lt;a href="http://zh.wikipedia.org/wiki/Emacs"&gt;Emacs&lt;/a&gt; 經歷幾十年的歲月後，
直到現在依然擁有許多信徒;
而隨著時間的過去，Vi 的功能不斷地被增強，最後演化出目前受歡迎的 &lt;a href="http://zh.wikipedia.org/wiki/Vim"&gt;Vim&lt;/a&gt; ，
關於 Vim 的詳細手冊可查詢&lt;a href="http://vimdoc.sourceforge.net/htmldoc/usr_toc.html"&gt;官方文件&lt;/a&gt;，這裡僅列出常用的一些指令。&lt;/p&gt;
&lt;h3&gt;環境設定&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;~/.vimrc: 環境設定檔&lt;/li&gt;
&lt;li&gt;~/.vim: Vim 專屬的資料夾&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;內建指令&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;vi file_name&lt;/code&gt; 開啟檔案&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ecs&lt;/code&gt; 進入命令模式&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:w&lt;/code&gt; 存檔&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:q&lt;/code&gt; 離開&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:q!&lt;/code&gt; 強制離開(不須先存檔)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:e file_name&lt;/code&gt; 編輯其它檔案&lt;/li&gt;
&lt;li&gt;&lt;code&gt;x&lt;/code&gt; 刪除一個字元&lt;/li&gt;
&lt;li&gt;&lt;code&gt;i&lt;/code&gt; 在游標所在處開始輸入文字&lt;/li&gt;
&lt;li&gt;&lt;code&gt;a&lt;/code&gt; 從下個字元開始輸入文字&lt;/li&gt;
&lt;li&gt;&lt;code&gt;p&lt;/code&gt; 將暫存區資料貼上&lt;/li&gt;
&lt;li&gt;&lt;code&gt;yy&lt;/code&gt; 拷貝游標所在的那一行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;3&lt;/code&gt; &lt;code&gt;yy&lt;/code&gt; 拷貝連續三行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;dd&lt;/code&gt; 剪下游標所在的那一行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;3&lt;/code&gt; &lt;code&gt;dd&lt;/code&gt; 剪下連續三行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;D&lt;/code&gt; 刪除游標之後的部分&lt;/li&gt;
&lt;li&gt;&lt;code&gt;J&lt;/code&gt; 連接下一行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:set nu&lt;/code&gt; 顯示行數&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:set nonu&lt;/code&gt; 不顯示行數&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ma&lt;/code&gt; &lt;code&gt;"c&lt;/code&gt; &lt;code&gt;y&lt;/code&gt; &lt;code&gt;'a&lt;/code&gt; 將選擇區段拷貝到 register c&lt;/li&gt;
&lt;li&gt;&lt;code&gt;"c&lt;/code&gt; &lt;code&gt;p&lt;/code&gt; 將 register c 的資料貼上&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ma&lt;/code&gt; &lt;code&gt;"+&lt;/code&gt; &lt;code&gt;y&lt;/code&gt; &lt;code&gt;'a&lt;/code&gt; 選擇區塊並拷貝到系統的剪貼板&lt;/li&gt;
&lt;li&gt;&lt;code&gt;3&lt;/code&gt; &lt;code&gt;"+&lt;/code&gt; &lt;code&gt;yy&lt;/code&gt; 將連續三行到系統的剪貼板&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:set ai&lt;/code&gt; 自動縮行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:tab_new&lt;/code&gt; 新分頁&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:ab tn tab_new&lt;/code&gt; 將 tab_new 縮寫為 tn&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:tabprevious&lt;/code&gt; 上一個分頁&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:tabnext&lt;/code&gt; 下一個分頁&lt;/li&gt;
&lt;li&gt;&lt;code&gt;map &amp;lt;C-k&amp;gt; :tabprevious &amp;lt;CR&amp;gt;&lt;/code&gt; 用 &lt;code&gt;Ctrl&lt;/code&gt;+&lt;code&gt;k&lt;/code&gt; 映射 &lt;code&gt;:tabpreview&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;map &amp;lt;C-j&amp;gt; :tabnext &amp;lt;CR&amp;gt;&lt;/code&gt; 用 &lt;code&gt;Ctrl&lt;/code&gt;+&lt;code&gt;j&lt;/code&gt; 映射 &lt;code&gt;:tabnext&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;gg&lt;/code&gt; 第一行開頭&lt;/li&gt;
&lt;li&gt;&lt;code&gt;G&lt;/code&gt; 最後一行的開頭&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:cd %:h&lt;/code&gt; 將工作目錄改變到編輯的檔案下&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:lcd %:h&lt;/code&gt; 僅將目前視窗的工作目錄改變到編輯的檔案下&lt;/li&gt;
&lt;li&gt;&lt;code&gt;autocmd BufEnter * silent! lcd %:p:h&lt;/code&gt; 自動改變工作目錄到編輯的檔案下&lt;/li&gt;
&lt;li&gt;&lt;code&gt;gf&lt;/code&gt; 跳到關聯檔 ( goto file )&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ctrl&lt;/code&gt;+&lt;code&gt;^&lt;/code&gt; 回到上一個檔案&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:!外部命令&lt;/code&gt; 執行外部命令，例如 &lt;code&gt;:!ls&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:syntax enable&lt;/code&gt; 語法顏色&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;視窗分割&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;:vs&lt;/code&gt;       垂直分割&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ctrl&lt;/code&gt;+&lt;code&gt;w&lt;/code&gt; &lt;code&gt;v&lt;/code&gt; 垂直分割&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:sp&lt;/code&gt;       水平分割&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ctrl&lt;/code&gt;+&lt;code&gt;w&lt;/code&gt; &lt;code&gt;s&lt;/code&gt; 水平分割&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ctrl&lt;/code&gt;+&lt;code&gt;w&lt;/code&gt; &lt;code&gt;left[right] arrow&lt;/code&gt; 左右切換視窗&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ctrl&lt;/code&gt;+&lt;code&gt;w&lt;/code&gt; &lt;code&gt;up[down] arrow&lt;/code&gt;    上下切換視窗&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;好用的 plugin&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="http://www.vim.org/scripts/script.php?script_id=1567"&gt;rails.vim&lt;/a&gt;: Rails 套件(語法顏色，快速切換檔案... 等)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Rcd 目錄&lt;/code&gt; 切換目錄(從專案目錄出發)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Rmodel 檔案&lt;/code&gt;      編輯 model 檔案&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Rview 檔案&lt;/code&gt;       編輯 view 檔案&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Rcontroller 檔案&lt;/code&gt; 編輯 controller 檔案&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="http://www.vim.org/scripts/script.php?script_id=2540"&gt;snipMate&lt;/a&gt;: 加入程式片段&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Tab&lt;/code&gt; 加入程式片段&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://github.com/kien/ctrlp.vim"&gt;ctrp&lt;/a&gt;: 模糊搜尋&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Ctrl&lt;/code&gt;+&lt;code&gt;p&lt;/code&gt; 啟動模糊搜尋&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ctrl&lt;/code&gt;+&lt;code&gt;v&lt;/code&gt; 垂直分頁開啟檔案&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="http://www.vim.org/scripts/script.php?script_id=1708"&gt;fencview.vim&lt;/a&gt;: 自動偵測多國編碼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;:FencAutoDetect&lt;/code&gt; 啟動偵測&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="http://www.vim.org/scripts/script.php?script_id=1658"&gt;nerdtree.vim&lt;/a&gt;: 檔案瀏覽器&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;:e .&lt;/code&gt; 瀏覽工作目錄&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="http://www.vim.org/scripts/script.php?script_id=1643"&gt;supertab.vmb&lt;/a&gt;: 使用 Tab 來補全程式碼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Tab&lt;/code&gt; 補全程式碼&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;雖然 Vim 對初學者而言需要投入多一些的時間來熟悉，但只要上手後，
就會大幅提升你的編程效率。&lt;/p&gt;</summary><category term="vim"></category></entry><entry><title>在 Google Chrome 中自定快捷鍵</title><link href="http://tsaith.github.io/zai-google-chrome-zhong-zi-ding-kuai-jie-jian.html" rel="alternate"></link><updated>2014-11-01T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-11-01:zai-google-chrome-zhong-zi-ding-kuai-jie-jian.html</id><summary type="html">&lt;p&gt;在開發網站時，
我們常常需要使用 &lt;a href="http://www.google.com/chrome/"&gt;Google Chrome&lt;/a&gt; 來協助測試，這裡將介紹如何透過安裝 plugin 來自定快捷鍵，以提高工作效率。&lt;/p&gt;
&lt;p&gt;先開啓 Google Chrome ，然後安裝 &lt;a href="https://chrome.google.com/webstore/detail/shortkeys/logpjaacgmcbpdkdchjiaagddngobkck"&gt;Shortkeys&lt;/a&gt;;
安裝完成後，即可開始在 Shortkeys 中自定所需的快捷鍵。
設定路徑: Chrome -&amp;gt; Preferences -&amp;gt; Extensions -&amp;gt; Shortkeys -&amp;gt; Options。&lt;/p&gt;
&lt;p&gt;設定畫面如下
&lt;img src="https://farm4.staticflickr.com/3948/15678482785_10249cd29b_b.jpg"&gt;&lt;/p&gt;
&lt;p&gt;在這個範例中，分別自定了 &lt;code&gt;command+shift+right&lt;/code&gt; 和 &lt;code&gt;command+shift+left&lt;/code&gt;
來選擇下一個和上一個瀏覽分頁。&lt;/p&gt;</summary><category term="utils"></category></entry><entry><title>在部落格中加入 Flickr 圖片</title><link href="http://tsaith.github.io/zai-bu-luo-ge-zhong-jia-ru-flickr-tu-pian.html" rel="alternate"></link><updated>2014-10-29T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-10-29:zai-bu-luo-ge-zhong-jia-ru-flickr-tu-pian.html</id><summary type="html">&lt;p&gt;編寫部落格時，適當地加入圖片可以吸引更多讀者，同時也提高了文章的可讀性。
隨著雲端相簿的流行，有許多人會傾向將圖片貯存位置和部落格平台獨立開來;
這樣的話，一方面可以集中圖片的管理，另一方面，如果日後想更換寫作平台，
就不需要去煩惱圖片的轉移工作。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.flickr.com/"&gt;Flickr&lt;/a&gt; 是目前相當受歡迎的免費雲端相簿，
這篇文章將說明如何用它將圖片加入到你的部落格中。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;首先，請先到 &lt;a href="https://www.flickr.com/"&gt;Flickr&lt;/a&gt; 上面註冊，
然後在裡面新增一份相簿，接著上傳一張測試圖片並加入到新建立的相簿中。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;先選擇圖片，接著點選 "Share this photo"，然後指定希望的圖片大小，
這時候會產生對應的 HTML code。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="https://farm8.staticflickr.com/7561/15652040191_aec65ccfbc_b.jpg"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在 HTML code 中 &lt;code&gt;&amp;lt;img src=&lt;/code&gt; 後面的部分就是圖片的網址&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&amp;lt;img src=&amp;quot;https://farm8.staticflickr.com/7563/15655510442_e9803f8335_b.jpg&amp;quot; width=&amp;quot;1024&amp;quot; height=&amp;quot;768&amp;quot; alt=&amp;quot;FF-12&amp;quot;&amp;gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;最後在你的部落格中使用圖片的網址;
舉例來說，
倘若你使用的是 &lt;a href="http://octopress.org/"&gt;Octopress&lt;/a&gt; ，
請在文章中加入&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;{% img https://farm8.staticflickr.com/7563/15655510442_e9803f8335_b.jpg %}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後就能看到被加入的圖片，如下&lt;/p&gt;
&lt;p&gt;&lt;img src="https://farm8.staticflickr.com/7563/15655510442_e9803f8335_b.jpg"&gt;&lt;/p&gt;</summary><category term="octopress"></category></entry><entry><title>在 Rails 中設定多對多關聯性</title><link href="http://tsaith.github.io/zai-rails-zhong-she-ding-duo-dui-duo-guan-lian-xing.html" rel="alternate"></link><updated>2014-10-29T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-10-29:zai-rails-zhong-she-ding-duo-dui-duo-guan-lian-xing.html</id><summary type="html">&lt;p&gt;這裡將介紹如何在 Rails 中透過 &lt;code&gt;has_many through:&lt;/code&gt; 來設定多對多關聯性。
而一對多關聯性的介紹可參考先前的&lt;a href="/blog/2014/10/29/1-m-association-in-rails/"&gt;文章&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;假設我們有兩種模型 Post 和 Category，
倘若每個 post 可擁有多個 categories，
而每個 Category 也可以擁有多個 posts，
於是 Post 和 Category 之間就存在著多對多的關係;
以下將敘述如何實作這樣的關聯性。&lt;/p&gt;
&lt;h3&gt;建立 tables&lt;/h3&gt;
&lt;p&gt;首先我們需要在資料庫中新增三個 tables，
分別是 posts、categories 和 post_categories;
在 post_categories 中應包含 post_id 和 category_id 這兩個 column。
(如果不清楚如何新增 table 可參考&lt;a href="/blog/2014/10/29/1-m-association-in-rails/"&gt;這裡&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;新增完 tables 後，請檢查 db/schema.rb 以確定 table 的格式的確如你所預期的&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Schema&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;define&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;version&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;20141031042824&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;posts&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;force&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; 
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;title&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;url&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;     &lt;span class="s2"&gt;&amp;quot;description&amp;quot;&lt;/span&gt;

    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;categories&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;force&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; 
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;

    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt; 

  &lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;post_categories&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;force&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;integer&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;post_id&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;integer&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;category_id&amp;quot;&lt;/span&gt;

    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt; 

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;設定 models&lt;/h3&gt;
&lt;p&gt;最後，我們需要指定 Post 和 Category 以及 PostCategory 三個模型之間的關係。&lt;/p&gt;
&lt;p&gt;編輯 app/models/post.rb，如下 &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Post&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:post_categories&lt;/span&gt;
  &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:categories&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;through&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;:post_categories&lt;/span&gt; 
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;編輯 app/models/category.rb，如下 &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Category&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:post_categories&lt;/span&gt;
  &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:posts&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;through&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;:post_categories&lt;/span&gt; 
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;編輯 app/models/post_category.rb，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;PostCategory&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:post&lt;/span&gt;
  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:category&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;以上，就是在 Rails 中多對多關聯性的實作步驟。&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>在 Rails 中設定 routes</title><link href="http://tsaith.github.io/zai-rails-zhong-she-ding-routes.html" rel="alternate"></link><updated>2014-10-29T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-10-29:zai-rails-zhong-she-ding-routes.html</id><summary type="html">&lt;p&gt;在 Rails 中，當伺服器接受到 http request 時將會根據路由中的設定，
來決定這個 request 將會送往 controller 的哪個 action 進行處理;
這裡將介紹如何設定路由的路徑表。&lt;/p&gt;
&lt;p&gt;在 config/routes.rb 可使用 &lt;code&gt;root to:&lt;/code&gt; 來設定當使用者存取網站根目錄時的伺服器將會將 request 導向哪裡;假設我們設定如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;PostitTemplate&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Application&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;routes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;draw&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;root&lt;/span&gt; &lt;span class="ss"&gt;to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;posts#index&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;接著使用 &lt;code&gt;bundle exec rake routes&lt;/code&gt; 來查詢路徑表&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;bundle &lt;span class="nb"&gt;exec &lt;/span&gt;rake routes
Prefix Verb URI Pattern Controller#Action
root   GET  /   posts#index
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在上面的範例中，當 http verb 為 GET 而存取路徑是 / 時，伺服器會將 request
導向 posts controller 的 index action。&lt;/p&gt;
&lt;p&gt;倘若我們有個物件模型 Post，這時可以使用 &lt;code&gt;resources&lt;/code&gt; 簡潔地來設定對這類物件的一些常用存取路徑&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;PostitTemplate&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Application&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;routes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;draw&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;resources&lt;/span&gt; &lt;span class="ss"&gt;:posts&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;這時候的路徑表為&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;bundle &lt;span class="nb"&gt;exec &lt;/span&gt;rake routes
   Prefix Verb   URI Pattern               Controller#Action
    posts GET    /posts&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;          posts#index
          POST   /posts&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;          posts#create
 new_post GET    /posts/new&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;      posts#new
edit_post GET    /posts/:id/edit&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt; posts#edit
     post GET    /posts/:id&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;      posts#show
          PATCH  /posts/:id&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;      posts#update
          PUT    /posts/:id&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;      posts#update
          DELETE /posts/:id&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;      posts#destroy
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果我們只想使用其中幾個路徑，可以用 &lt;code&gt;only:&lt;/code&gt; 來達成&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;PostitTemplate&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Application&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;routes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;draw&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;resources&lt;/span&gt; &lt;span class="ss"&gt;:posts&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;only&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:new&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;上面只允許加入 &lt;code&gt;new&lt;/code&gt; 和 &lt;code&gt;create&lt;/code&gt; 兩個對應的路徑&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;bundle &lt;span class="nb"&gt;exec &lt;/span&gt;rake routes
  Prefix Verb URI Pattern          Controller#Action
   posts POST /posts&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;     posts#create
new_post GET  /posts/new&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt; posts#new
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果要排除一些路徑，則使用 &lt;code&gt;except:&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;PostitTemplate&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Application&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;routes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;draw&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;resources&lt;/span&gt; &lt;span class="ss"&gt;:posts&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;except&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:new&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;這時將加入除了 &lt;code&gt;new&lt;/code&gt; 和 &lt;code&gt;create&lt;/code&gt; 之外的其他路徑&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;bundle &lt;span class="nb"&gt;exec &lt;/span&gt;rake routes
   Prefix Verb   URI Pattern               Controller#Action
    posts GET    /posts&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;          posts#index
edit_post GET    /posts/:id/edit&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt; posts#edit
     post GET    /posts/:id&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;      posts#show
          PATCH  /posts/:id&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;      posts#update
          PUT    /posts/:id&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;      posts#update
          DELETE /posts/:id&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;      posts#destroy
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;倘若需要多層的路徑組合，例如每個 post 下面可以 create comment，
這時候可以寫成&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;PostitTemplate&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Application&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;routes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;draw&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;resources&lt;/span&gt; &lt;span class="ss"&gt;:posts&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;resources&lt;/span&gt; &lt;span class="ss"&gt;:comments&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;only&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:create&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;這樣一來，路徑表就會新增一個 comments controller 的 create action 對應的路徑&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;bundle &lt;span class="nb"&gt;exec &lt;/span&gt;rake routes
       Prefix Verb   URI Pattern                        Controller#Action
post_comments POST   /posts/:post_id/comments&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt; comments#create
        posts GET    /posts&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;                   posts#index
              POST   /posts&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;                   posts#create
     new_post GET    /posts/new&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;               posts#new
    edit_post GET    /posts/:id/edit&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;          posts#edit
         post GET    /posts/:id&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;               posts#show
              PATCH  /posts/:id&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;               posts#update
              PUT    /posts/:id&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;               posts#update
              DELETE /posts/:id&lt;span class="o"&gt;(&lt;/span&gt;.:format&lt;span class="o"&gt;)&lt;/span&gt;               posts#destroy
&lt;/pre&gt;&lt;/div&gt;


&lt;p _="%" endblockquote="endblockquote"&gt;{% blockquote Rick Cook %}
Programming today is a race between software engineers striving to build bigger and better idiot-proof programs, and the universe trying to build bigger and better idiots. So far, the universe is winning.&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>在 Rails 中設定一對多關聯性</title><link href="http://tsaith.github.io/zai-rails-zhong-she-ding-yi-dui-duo-guan-lian-xing.html" rel="alternate"></link><updated>2014-10-29T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-10-29:zai-rails-zhong-she-ding-yi-dui-duo-guan-lian-xing.html</id><summary type="html">&lt;p&gt;物件與物件之間的關係,可以是一對一、一對多或多對多;
這裡將介紹如何在 Rails 中設定一對多關聯性。&lt;/p&gt;
&lt;p&gt;假設我們現在想設計一個網站讓使用者可以在上面發表文章，
由於每位使用者可以發表多篇文章，
於是使用者和文章之間就存在著一對多的關係;
以下將敘述如何實作這樣的關聯性。&lt;/p&gt;
&lt;h3&gt;建立 migration&lt;/h3&gt;
&lt;p&gt;首先， 為 users table 建立 migration 檔案&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;rails generate migration create_users
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;執行命令後，將產生對應的檔案(數字部分代表建立的時間)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;db/migrate/20141028055510_create_users.rb
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;編輯此檔案的內容，指定 table 包含一個 username 的 column，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CreateUsers&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Migration&lt;/span&gt;
  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;change&lt;/span&gt;
    &lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="ss"&gt;:users&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
      &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt; &lt;span class="ss"&gt;:username&lt;/span&gt;

      &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timestamps&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;bundle exec rake db:migrate
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;這時候資料庫就會產生 users 這個 table。&lt;/p&gt;
&lt;p&gt;接下來使用類似步驟來產生 posts table;
先執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;rails generate migration create_posts
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後編輯&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;db/migrate/20141028043352_create_posts.rb
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;指定 table 擁有 title 和 user_id 兩個 column&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CreatePosts&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Migration&lt;/span&gt;
  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;change&lt;/span&gt;
    &lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="ss"&gt;:posts&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
      &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt; &lt;span class="ss"&gt;:title&lt;/span&gt;
      &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;integer&lt;/span&gt; &lt;span class="ss"&gt;:user_id&lt;/span&gt;

      &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timestamps&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;最後，執行 &lt;code&gt;bundle exec rake db:migrate&lt;/code&gt; 來產生 posts table。&lt;/p&gt;
&lt;h3&gt;檢查 database schema&lt;/h3&gt;
&lt;p&gt;我們可以在專案目錄下查看 db/schema.rb 的內容, 如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Schema&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;define&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;version&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;20141028103914&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;users&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;force&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;username&amp;quot;&lt;/span&gt;

    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;create_table&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;posts&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;force&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;title&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;integer&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;user_id&amp;quot;&lt;/span&gt;

    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;updated_at&amp;quot;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;這裡面記錄了資料庫中 users 和 posts 兩個 tables 分別具有哪些 columns。&lt;/p&gt;
&lt;h3&gt;設定 models&lt;/h3&gt;
&lt;p&gt;現在，我們要指定 User model 和 Post model 之間的關係。&lt;/p&gt;
&lt;p&gt;首先，新增並編輯 app/models/user.rb，指定 user 可以擁有多個 posts&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
   &lt;span class="n"&gt;has_many&lt;/span&gt; &lt;span class="ss"&gt;:posts&lt;/span&gt;
 &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後，新增並編輯 app/models/post.rb，指定 post 屬於 user&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Post&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
  &lt;span class="n"&gt;belongs_to&lt;/span&gt; &lt;span class="ss"&gt;:user&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;倘若一切順利，現在你已經完成 User 和 Post 一對多的關聯性實作。&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>Homebrew: Mac 專屬的套件管理者</title><link href="http://tsaith.github.io/homebrew-mac-zhuan-shu-de-tao-jian-guan-li-zhe.html" rel="alternate"></link><updated>2014-10-28T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-10-28:homebrew-mac-zhuan-shu-de-tao-jian-guan-li-zhe.html</id><summary type="html">&lt;p&gt;每一位軟體開發者肯定都需要安裝許多套件來打造所需的開發環境，
而各種套件的版本和相依性一直以來都是件讓人頭痛的問題;
為了讓 Mac 使用者不再總是為此煩惱， 
於是有了 &lt;a href="http://brew.sh/"&gt;Homebrew&lt;/a&gt; 的產生。&lt;/p&gt;
&lt;h3&gt;安裝方式&lt;/h3&gt;
&lt;p&gt;使用 &lt;code&gt;ruby&lt;/code&gt; and &lt;code&gt;curl&lt;/code&gt; 進行安裝&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;ruby -e &amp;quot;$(curl -fsSL https://raw.github.com/mxcl/homebrew/go/install)&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後接著執行 &lt;code&gt;brew doctor&lt;/code&gt; 來檢查系統是否一切正常&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;brew doctor
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果一切順利，我們就可以開始使用 Homebrew 來進行之後的套件管理。&lt;/p&gt;
&lt;h3&gt;基本使用方法&lt;/h3&gt;
&lt;p&gt;如果要搜尋套件，請執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;brew search 套件的部分名稱
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;若想查詢套件資訊，則執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;brew info 套件名稱
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;使用 &lt;code&gt;install&lt;/code&gt; 來安裝套件&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;brew install 套件名稱
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;使用 &lt;code&gt;uninstall&lt;/code&gt; 來移除套件&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;brew uninstall 套件名稱
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;倘若想更新 Homebrew，請執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;brew update
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果需要更多相關資訊，可以參考&lt;a href="https://github.com/Homebrew/homebrew/tree/master/share/doc/homebrew"&gt;這裡&lt;/a&gt;。&lt;/p&gt;</summary><category term="utils"></category></entry><entry><title>一套免費的 SQLite 資料庫瀏覽器</title><link href="http://tsaith.github.io/yi-tao-mian-fei-de-sqlite-zi-liao-ku-liu-lan-qi.html" rel="alternate"></link><updated>2014-10-28T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-10-28:yi-tao-mian-fei-de-sqlite-zi-liao-ku-liu-lan-qi.html</id><summary type="html">&lt;p&gt;在軟體開發時，我們有時會使用輕量的 &lt;a href="http://www.sqlite.org"&gt;SQLite&lt;/a&gt;
資料庫來做測試; 這裡要介紹一套好用又免費的工具
&lt;a href="http://sqlitebrowser.org/"&gt;DB Browser for SQLite&lt;/a&gt;，
它可以用來幫助使用者方便地建立資料庫和搜尋或編輯其中的資訊。&lt;/p&gt;
&lt;h3&gt;安裝方式&lt;/h3&gt;
&lt;p&gt;打開終端機，使用 Homebrew 來進行安裝&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;brew install sqlitebrowser
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;使用方法&lt;/h3&gt;
&lt;p&gt;在命令列直接執行 &lt;code&gt;sqlitebrowser&lt;/code&gt; 來啟動 SQLite Brower&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sqlitebrowser
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在界面的工具列點選 Open Database ，然後選擇 SQLite 資料庫所在的位置，
就能開始存取裡面的資訊
&lt;img src="https://farm8.staticflickr.com/7473/15028743933_1453a944b0_b.jpg"&gt;&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>使用 Guard::LiveReload 自動刷新瀏覽器</title><link href="http://tsaith.github.io/shi-yong-guardlivereload-zi-dong-shua-xin-liu-lan-qi.html" rel="alternate"></link><updated>2014-10-27T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-10-27:shi-yong-guardlivereload-zi-dong-shua-xin-liu-lan-qi.html</id><summary type="html">&lt;p&gt;在編寫網頁的過程中，如果每次修改程式後總是需要手動刷新網頁來檢查結果，
實在是件很麻煩又浪費時間的事; 為了解決這問題，於是有人開發了 LiveReload
這工具，每當程式存檔後，網頁就會自動刷新，於是工程師們可以早點收工回家打電動了(誤)。&lt;/p&gt;
&lt;h3&gt;套件安裝&lt;/h3&gt;
&lt;p&gt;假設你使用的是 &lt;a href="http://bundler.io/"&gt;bundler&lt;/a&gt; 來管理套件，
首先將 &lt;a href="https://github.com/guard/guard"&gt;guard&lt;/a&gt; 和
&lt;a href="https://github.com/guard/guard-livereload"&gt;guard-livereload&lt;/a&gt;
加到 Gemfile 中&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;group&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;development&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;guard&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;gem&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;guard-livereload&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;接著執行 &lt;code&gt;bundle&lt;/code&gt; 開始安裝套件&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;bundle
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後，初始化一個新的 Guardfile&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;bundle exec guard init
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;這個檔案記錄了哪些檔案會被監控，可依自己的需求再進行修改&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;# A sample Guardfile&lt;/span&gt;
&lt;span class="c1"&gt;# More info at https://github.com/guard/guard#readme&lt;/span&gt;

&lt;span class="c1"&gt;#guard &amp;#39;livereload&amp;#39;, port: &amp;#39;4000&amp;#39; do&lt;/span&gt;
&lt;span class="n"&gt;guard&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;livereload&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;watch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;%r{app/views/.+\.(erb|haml|slim)$}&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;watch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;%r{app/helpers/.+\.rb}&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;watch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;%r{public/.+\.(css|js|html)}&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;watch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;%r{config/locales/.+\.yml}&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="c1"&gt;# Rails Assets Pipeline&lt;/span&gt;
  &lt;span class="n"&gt;watch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;%r{(app|vendor)(/assets/\w+/(.+\.(css|js|html|png|jpg))).*}&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/assets/&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;另外，瀏覽器也需要安裝對應套件，假設我們使用的是 Google Chrome，
那麼就需要安裝 &lt;a href="https://chrome.google.com/webstore/detail/livereload/jnihajbhpnppcggbcgedagnkighmdlei/related"&gt;Chrome LiveReload Extension&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;使用方法&lt;/h3&gt;
&lt;p&gt;在專案目錄下，執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;bundle exec guard
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果想看到額外的偵錯資訊，則執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;bundle exec guard --debug
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;最後，點選 Google Chrome 瀏覽器的工具列上的 LiveReload 的圖示，
然後 Chrome 將會與 Guard::LiveReload 作連結。
如果一切順利，現在你每次將程式存檔後，就會看到瀏覽器的頁面自動刷新。&lt;/p&gt;</summary><category term="rails"></category></entry><entry><title>安裝和使用 Git</title><link href="http://tsaith.github.io/an-zhuang-he-shi-yong-git.html" rel="alternate"></link><updated>2014-10-26T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-10-26:an-zhuang-he-shi-yong-git.html</id><summary type="html">&lt;p&gt;在軟體開發中過程中，版本控制無疑是相當重要的一環; 
而 &lt;a href="http://git-scm.com/"&gt;Git&lt;/a&gt; 由於它的優良設計和開源已被廣泛地使用，
這裡將介紹如何在 Mac 上安裝 Git 和基本的使用方法。&lt;/p&gt;
&lt;h3&gt;套件安裝&lt;/h3&gt;
&lt;p&gt;在 Mac 上我們可以利用 &lt;a href="http://brew.sh/index_zh-tw.html"&gt;Homebrew&lt;/a&gt; 來
安裝 Git 套件&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;  brew install git
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;安裝成功後，接下來設定使用者的姓名和郵件位址&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git config --global user.name &amp;quot;Your Name&amp;quot;
git config --global user.email &amp;quot;user@gmail.com&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;也許你會希望加入顏色支援&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git config --global color.ui true
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;使用方法&lt;/h3&gt;
&lt;p&gt;進入你的專案目錄後，我們需要先初始化環境&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git init
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後會產生 .git/ 資料夾，它儲存著版本控制的各種相關檔案。 &lt;/p&gt;
&lt;p&gt;如果你有一個 GitHup repository ，並想將它作為遠端儲存
(假設你的帳號是 silver， repository 名稱是 repo); 那麼請執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git remote add origin https://github.com/silver/repo.git
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;若想將專案目錄下的所有檔案加入版本控制系統，請執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git add -A
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;倘若你只想加入單一檔案，可執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;git&lt;/span&gt; &lt;span class="n"&gt;add&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="n"&gt;Name&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;若是想加入當前目錄下所有 .txt 結尾的檔案則執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git add *.txt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;若是想刪除當前目錄下的某一個檔案則執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;git&lt;/span&gt; &lt;span class="n"&gt;rm&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="n"&gt;Name&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;若是想刪除當前目錄下所有 .txt 結尾的檔案則執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git rm *.txt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在 新增/刪除/修改 檔案後，使用 &lt;code&gt;commit&lt;/code&gt; 提交，-m 之後是提交訊息&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git commit -m &amp;quot;Add test.txt&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;倘若你使用的是遠端 repository， 那麼還需要將資料 &lt;code&gt;push&lt;/code&gt; 出去&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git push -u origin --all
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;若想查詢目前的控制系統的狀態，請執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git status
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果想查詢歷史記錄，則使用 &lt;code&gt;log&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git log
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;若想查詢某一命令的說明可利用 &lt;code&gt;help&lt;/code&gt;，例如&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git help log
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;倘若有些檔案你不想加入版本控制系統，
可以在專案目錄下新增一個檔案 .gitignore 並將那些檔案記錄下來;
例如，假設你不想記錄那些 .tmp 和 .swp 結尾的檔案，
那麼 .gitignore 的內容為&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;*.tmp
*.swp
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;若想比較目前和上次 commit 版本的整體差異&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git diff HEAD
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;若只想比較單一檔案在目前和上次 commit 的差別&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git diff HEAD^ HEAD [Path / File]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;若想回復到前一次的 commitment&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git reset --hard Head^
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;以上是一些 Git 的基本用法，如果需要更多進階的操作，
請參考&lt;a href="http://git-scm.com/doc"&gt;官方文件&lt;/a&gt;。&lt;/p&gt;</summary><category term="utils"></category></entry><entry><title>產生 SSH Key</title><link href="http://tsaith.github.io/chan-sheng-ssh-key.html" rel="alternate"></link><updated>2014-10-26T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-10-26:chan-sheng-ssh-key.html</id><summary type="html">&lt;p&gt;在 web 開發中，許多平台 (例如 GitHup, Heroku, AWS ...等) 
都使用 SSH Key 來提供安全認證機制; 這裡將說明如何產生 SSH Key。&lt;/p&gt;
&lt;h3&gt;產生 SSH key&lt;/h3&gt;
&lt;p&gt;在終端機的命令列，我們可以利用 &lt;code&gt;ssh-keygen&lt;/code&gt; 來產生 private key 和
對應的 public key ; 其預設檔名分別是 id_rsa 和 id_rsa.pub，
而預設的儲存路徑為使用者目錄下的 .ssh/ 資料夾。
執行過程中，會詢問是否要設定密碼? (為了安全性的考量，建議設定)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;ssh-keygen -t rsa -C &amp;quot;your_email@example.com&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;使用 ssh-agent&lt;/h3&gt;
&lt;p&gt;如果在產生 SSH key 的過程中，有設定密碼的話，
你會發現每次登入遠端都要重新輸入密碼，相當麻煩; 
不過，我們可以使用 &lt;code&gt;ssh-agent&lt;/code&gt; 來解決這問題。
假設你的 private key 是 ~/.ssh/id_rsa，這時我們在命令列執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;ssh-add ~/.ssh/id_rsa
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後程式會詢問你的密碼，並儲存下來，之後每次登入就不再需要另外輸入密碼了。&lt;/p&gt;</summary><category term="utils"></category></entry><entry><title>對 Octopress 進行客製化</title><link href="http://tsaith.github.io/dui-octopress-jin-xing-ke-zhi-hua.html" rel="alternate"></link><updated>2014-10-25T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-10-25:dui-octopress-jin-xing-ke-zhi-hua.html</id><summary type="html">&lt;p&gt;會選擇使用 Octopress 的使用者，
應該都是希望之後能夠修改自己的部落格，
可以增加需要的功能以及讓版面顯得與眾不同;
這篇文章將會介紹如何進行。&lt;/p&gt;
&lt;h3&gt;設定部落格標題&lt;/h3&gt;
&lt;p&gt;在 _config.yml 裡面可以設定部落格的標題和子標題，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="l-Scalar-Plain"&gt;url&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;http://tsaith.github.io&lt;/span&gt;
&lt;span class="l-Scalar-Plain"&gt;title&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;TH&amp;#39;s Notes&lt;/span&gt;
&lt;span class="l-Scalar-Plain"&gt;subtitle&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;Ruby / Rails / Life&lt;/span&gt;
&lt;span class="l-Scalar-Plain"&gt;author&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;TH&lt;/span&gt;
&lt;span class="l-Scalar-Plain"&gt;simple_search&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l-Scalar-Plain"&gt;https://www.google.com/search&lt;/span&gt;
&lt;span class="l-Scalar-Plain"&gt;description&lt;/span&gt;&lt;span class="p-Indicator"&gt;:&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;加入 About 頁面&lt;/h3&gt;
&lt;p&gt;在 &lt;code&gt;source/_includes/custom/navigation.html&lt;/code&gt; 裡面加入
&lt;code&gt;About&lt;/code&gt; 連結，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;&amp;lt;ul&lt;/span&gt; &lt;span class="na"&gt;class=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;main-navigation&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;li&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;{{ root_url }}/&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;Blog&lt;span class="nt"&gt;&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;li&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;{{ root_url }}/blog/archives&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;Archives&lt;span class="nt"&gt;&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;li&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;{{ root_url }}/about&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;About&lt;span class="nt"&gt;&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/ul&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;執行 &lt;code&gt;rake new_page['about']&lt;/code&gt; 以產生
&lt;code&gt;source/about/index.markdown&lt;/code&gt;，
在檔案內編寫您的自我介紹，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;### About me&lt;/span&gt;

&lt;span class="no"&gt;Say&lt;/span&gt; &lt;span class="n"&gt;something&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;改變 Color Scheme&lt;/h3&gt;
&lt;p&gt;Octopress 預設採用 dark Solarized highlighting，
如果想改用 light style，
可在 sass/custom/_colors.scss 中 uncomment &lt;code&gt;//$solarized: light;&lt;/code&gt;，如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;/* To use the light Solarized highlighting theme uncomment the following line */&lt;/span&gt;
&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="nt"&gt;solarized&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nt"&gt;light&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果需要更多進階設定，請參考&lt;a href="http://octopress.org/docs/theme/styles/"&gt;官方文件&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;搜尋功能&lt;/h3&gt;
&lt;p&gt;在檔案 &lt;code&gt;source/_includes/navigation.html&lt;/code&gt; 裡面，將&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="x"&gt;&amp;lt;input type=&amp;quot;hidden&amp;quot; name=&amp;quot;q&amp;quot; value=&amp;quot;site:&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;site.url&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="nf"&gt;shorthand_url&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="x"&gt;&amp;quot; /&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;修改為&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="x"&gt;&amp;lt;input type=&amp;quot;hidden&amp;quot; name=&amp;quot;sitesearch&amp;quot; value=&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;site.url&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="nf"&gt;shorthand_url&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="x"&gt;&amp;quot; /&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後存檔，即可透過 Google 進行關鍵字搜尋。&lt;/p&gt;
&lt;h3&gt;留言功能&lt;/h3&gt;
&lt;p&gt;倘若想開啟 Disqus 留言功能，請進行下面兩個步驟:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;到官網&lt;a href="https://disqus.com"&gt;註冊&lt;/a&gt;，登入後，
選擇 'Add Disqus to your site'，註冊你網站來得到對應的 "shortname"。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;在 Octopress 專案下，編輯檔案 _config.yml，
在 &lt;code&gt;disqus_short_name:&lt;/code&gt; 這一欄填入剛剛取得的 "shortname"。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;連結內部文章&lt;/h3&gt;
&lt;p&gt;編輯文章時，常常會需要連結到之前的文章作為參考，
假設欲連結的文章檔名是 2014-10-22-install-rails-on-mac.markdown，那麼可以使用下列的語法&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;link&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;]({&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;post_url&lt;/span&gt; &lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;install&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rails&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;on&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mac&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;倘若上面的語法出現語法解析錯誤，則可以嘗試使用&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;link&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;blog&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;2014&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;install&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rails&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;on&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mac&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="octopress"></category></entry><entry><title>在 Octopress 使用 Whitespace theme</title><link href="http://tsaith.github.io/zai-octopress-shi-yong-whitespace-theme.html" rel="alternate"></link><updated>2014-10-25T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-10-25:zai-octopress-shi-yong-whitespace-theme.html</id><summary type="html">&lt;p&gt;&lt;a href="https://github.com/lucaslew/whitespace"&gt;Whitespace&lt;/a&gt; 為你的部落格提供簡約的外觀並將文章置中，此外，它同樣支援響應式設計。&lt;/p&gt;
&lt;h3&gt;Install&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd &lt;/span&gt;octopress
&lt;span class="nv"&gt;$ &lt;/span&gt;git clone git://github.com/lucaslew/whitespace.git .themes/whitespace
&lt;span class="nv"&gt;$ &lt;/span&gt;rake install&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;whitespace&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="c"&gt;# for zsh, use: rake install\[&amp;#39;whitespace&amp;#39;\]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="octopress"></category></entry><entry><title>使用 Octopress 建構部落格</title><link href="http://tsaith.github.io/shi-yong-octopress-jian-gou-bu-luo-ge.html" rel="alternate"></link><updated>2014-10-23T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-10-23:shi-yong-octopress-jian-gou-bu-luo-ge.html</id><summary type="html">&lt;p&gt;&lt;a href="http://octopress.org/"&gt;Octopress&lt;/a&gt; 是一套優良的部落格框架，
使用者可依照個人需求，設計專屬版面和擴充新功能，關於使用它的種種好處，
可參考神人xdite的&lt;a href="http://blog.xdite.net/posts/2011/10/07/what-is-octopress/"&gt;文章&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;安裝 Octopress&lt;/h3&gt;
&lt;p&gt;打開終端機，將 Octopress 的 &lt;a href="https://github.com/imathis/octopress"&gt;repository&lt;/a&gt; 複製一份到本地端，並指定希望的資料夾名稱。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git clone git://github.com/imathis/octopress.git directory_name
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;進入資料夾，安裝相關套件;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;bundle install
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然後，安裝預設主題，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;rake install
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;現在，我們已經完成所有的安裝步驟。&lt;/p&gt;
&lt;h3&gt;將檔案部署到 GitHup&lt;/h3&gt;
&lt;p&gt;首先在 GitHup 建立新的 repository，並命名為 [帳號].github.io; 例如，我的帳號是 tsaith，所以對應的名字就是 &lt;a href="https://github.com/tsaith/tsaith.github.io"&gt;tsaith.github.io&lt;/a&gt; 。&lt;/p&gt;
&lt;p&gt;然後使用終端機，在對應的部落格資料夾下執行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;rake setup_github_pages
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;setup_github_pages&lt;/code&gt; 將會請你輸入 GitHup repository 的 URL 來設定 GitHup pages。&lt;/p&gt;
&lt;p&gt;執行下面指令來產生部落格檔案，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;rake generate
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;接著 deploy 檔案到 GitHup pages，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;rake deploy
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;最後，將 source 也 push 到 GitHub repository。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git add .
git commit -m &amp;quot;你的訊息&amp;quot;
git push origin source
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果一切順利，你現在已經有了自己的部落格，而對應網址是 [使用者帳號].github.io。&lt;/p&gt;
&lt;h3&gt;新增文章&lt;/h3&gt;
&lt;p&gt;我們可以使用 &lt;code&gt;new_post&lt;/code&gt; 來新增文章，這指令將會在 source/_posts/ 下面產生對應的檔案。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;rake new_post[&amp;quot;article title&amp;quot;]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;就會在 source/_posts/ 下面新增文章的草稿。&lt;/p&gt;
&lt;p&gt;若打開每篇文章的內容會看到最上方會有一些設定資訊如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;---
layout: post
title: &amp;quot;在 Mac 上安裝 Rails&amp;quot;
date: 2014-10-22 12:04:25 +0800
comments: true
categories: Rails
---
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;我們將內容編寫於設定資訊的下方，而撰寫格式則是採用 &lt;a href="http://markdown.tw/"&gt;Markdown&lt;/a&gt; 語法。&lt;/p&gt;
&lt;p&gt;當撰寫文章時，我們可以新開一個終端機視窗並在專案資料夾下執行 &lt;code&gt;rake preview&lt;/code&gt;，然後開啟瀏覽器連到 http://localhost:4000 進行預覽。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;rake preview
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;當編輯完新文章後，執行 &lt;code&gt;rake generate&lt;/code&gt; 產生部落格檔案，然後再將它們 deploy 到 GitHup pages;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;rake generate
rake deploy
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;最後，別忘了 push 對應的 source 到你的 GitHup repository!&lt;/p&gt;
&lt;h3&gt;連結內部文章&lt;/h3&gt;
&lt;p&gt;編輯文章時，常常會需要連結到之前的文章作為參考，
假設欲連結的文章檔名是 2014-10-22-install-rails-on-mac.markdown，那麼可以使用下列的語法&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;[名稱]({% post_url 2014-10-22-install-rails-on-mac %})
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;倘若上面的語法出現語法解析錯誤，則可以嘗試使用&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;[名稱]( /blog/2014/10/22/install-rails-on-mac )
&lt;/pre&gt;&lt;/div&gt;</summary><category term="octopress"></category></entry><entry><title>在 Mac 上安裝 Rails</title><link href="http://tsaith.github.io/zai-mac-shang-an-zhuang-rails.html" rel="alternate"></link><updated>2014-10-22T00:00:00+08:00</updated><author><name>Andrew Tsai</name></author><id>tag:tsaith.github.io,2014-10-22:zai-mac-shang-an-zhuang-rails.html</id><summary type="html">&lt;p&gt;系統環境: OSX 10.9.x&lt;/p&gt;
&lt;p&gt;這篇筆記僅記錄了本人安裝 Rails 的步驟，若需要更詳細的說明，請參考 &lt;a href="http://installrails.com"&gt;Install Rails&lt;/a&gt;。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;首先開啟 App Store 搜尋並安裝 Xcode (下載通常需要等候一段時間)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;接著使用終端機安裝 Homebrew&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;ruby -e &amp;quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;然後檢查安裝是否成功&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;brew doctor
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;安裝 Git&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;brew install git
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;設定使用者姓名和郵件地址&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git config --global user.name &amp;quot;你/妳的姓名&amp;quot;
git config --global user.email &amp;quot;郵件地址&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;安裝 RVM&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;\curl -sSL https://get.rvm.io | bash
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;安裝 Ruby (這裡以版本 2.1.1 為範例)&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;rvm install 2.1.1
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;最後，開始安裝 Rails&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;gem install rails --no-ri --no-rdoc
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;若以上所有步驟都順利完成，那恭喜你/妳可以開始享受撰寫Rails的樂趣了。&lt;/p&gt;</summary><category term="rails"></category></entry></feed>